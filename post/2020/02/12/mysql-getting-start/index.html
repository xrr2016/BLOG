<!DOCTYPE html>
<html lang="zh">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1" />
  <meta name="renderer" content="webkit|ie-comp|ie-stand" />
  <meta name="referrer" content="no-referrer" />
  <meta name="theme-color" content="#333333" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="google" content="notranslate" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="keyword" content="冷石, 前端, 面试，Web, Js, CSS, Node.js, Frontend, Flutter, Docker, Dart, Mysql, Egg.js" />
  <meta name="description" content="孑然一身，傲立于世" />
  <title>冷石的博客</title>
  <base href="/" />
  <link rel="preconnect" href="//cdn.jsdelivr.net" />
  <link rel="shortcut icon" href="/icons/icon-72x72.png" />
  <link
    rel="apple-touch-icon"
    href="/icons/icon-192x192.png"
  />
  <link
    rel="stylesheet"
    href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.7.2/build/styles/atom-one-light.min.css"
  />
  <link rel="stylesheet" href="/index.css">
  <script
    data-ad-client="ca-pub-1196485898698315"
    async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
  ></script>
</head>

  <body>
    <header class="header">
  <a class="logo" href="/">
    <img
      class="logo-img"
      src="https://avatars.githubusercontent.com/u/18013127?v=4"
    />
  </a>
  <div class="color" id="color"></div>
</header>

    <main class=""><article class="container article">
    
      <div class="article-cover">
        <img decoding="async" loading="lazy" src="https://images.unsplash.com/photo-1489875347897-49f64b51c1f8?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=2250&q=80" alt="cover" />
      </div>
    

    <h1 class="article-title">MySQL 入门笔记 📒</h1>
 
    <p class="article-meta">
      <span class="article-meta-item">
        最后更新&#58;&nbsp;<time
          class="post-time"
          datetime="2021-06-28"
          >2021-06-28</time
        >
      </span>
      <span class="article-meta-item"
        >阅读时间&#58;&nbsp;10
        min</span
      >

    </p>
  </section>

  <section class=""><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>什么是 MySQL？引用官方说明</p>
<blockquote>
<p>MySQL is the world’s most popular open source database. Whether you are a fast growing web property, technology ISV or large enterprise, MySQL can cost-effectively help you deliver high performance, scalable database applications.</p>
<p>MySQL 是世界上最受欢迎的开源数据库。无论您是快速增长的 Web 资产，技术 ISV 还是大型企业，MySQL 都能经济高效地帮助您交付高性能，可扩展的数据库应用程序。</p>
</blockquote>
<p>MySQL 是目前最流行的关系型数据库，国内外很多公司都在使用，作为一个应用开发人员还是有必要学习一下 MySQL 的基本知识的。</p>
<h2 id="基础操作"><a href="#基础操作" class="headerlink" title="基础操作"></a>基础操作</h2><p>使用 Docker 运行一个 MySQL 容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name my-mysql -e MYSQL_ROOT_PASSWORD&#x3D;1234 -d -v volume_folder -p 3306:3306 mysql:5</span><br></pre></td></tr></table></figure>

<p>命令行登录 MySQL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it my-mysql bash</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure>

<p>创建数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> db-<span class="keyword">name</span>;</span><br></pre></td></tr></table></figure>

<p>显示数据库列表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br></pre></td></tr></table></figure>

<p>选择数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> dbname;</span><br></pre></td></tr></table></figure>

<p>显示数据表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br></pre></td></tr></table></figure>

<p>创建数据表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`user`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span></span><br><span class="line">(</span><br><span class="line">    <span class="string">`id`</span>                 <span class="built_in">bigint</span>(<span class="number">11</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    <span class="string">`user_id`</span>            <span class="built_in">bigint</span>(<span class="number">11</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户id'</span>,</span><br><span class="line">    <span class="string">`username`</span>           <span class="built_in">varchar</span>(<span class="number">45</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'真实姓名'</span>,</span><br><span class="line">    <span class="string">`email`</span>              <span class="built_in">varchar</span>(<span class="number">30</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户邮箱'</span>,</span><br><span class="line">    <span class="string">`nickname`</span>           <span class="built_in">varchar</span>(<span class="number">45</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'昵称'</span>,</span><br><span class="line">    <span class="string">`avatar`</span>             <span class="built_in">int</span>(<span class="number">11</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'头像'</span>,</span><br><span class="line">    <span class="string">`birthday`</span>           <span class="built_in">date</span>         <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'生日'</span>,</span><br><span class="line">    <span class="string">`gender`</span>                <span class="built_in">tinyint</span>(<span class="number">4</span>)   <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'性别'</span>,</span><br><span class="line">    <span class="string">`bio`</span>    <span class="built_in">varchar</span>(<span class="number">150</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'一句话介绍自己，最多150个汉字'</span>,</span><br><span class="line">    <span class="string">`user_resume`</span>        <span class="built_in">varchar</span>(<span class="number">300</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户提交的简历存放地址'</span>,</span><br><span class="line">    <span class="string">`user_register_ip`</span>   <span class="built_in">int</span>          <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户注册时的源ip'</span>,</span><br><span class="line">    <span class="string">`create_time`</span>        <span class="built_in">timestamp</span>    <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户记录创建的时间'</span>,</span><br><span class="line">    <span class="string">`update_time`</span>        <span class="built_in">timestamp</span>    <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户资料修改的时间'</span>,</span><br><span class="line">    <span class="string">`user_review_status`</span> <span class="built_in">tinyint</span>      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户资料审核状态，1为通过，2为审核中，3为未通过，4为还未提交审核'</span>,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">    <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`idx_user_id`</span> (<span class="string">`user_id`</span>),</span><br><span class="line">    <span class="keyword">KEY</span> <span class="string">`idx_username`</span> (<span class="string">`username`</span>),</span><br><span class="line">    <span class="keyword">KEY</span> <span class="string">`idx_create_time`</span> (<span class="string">`create_time`</span>, <span class="string">`user_review_status`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_unicode_ci <span class="keyword">COMMENT</span> =<span class="string">'网站用户基本信息'</span>;</span><br></pre></td></tr></table></figure>

<p>插入数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name ( field1, field2 ) <span class="keyword">VALUES</span> ( value1, value2 );</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name <span class="keyword">SET</span> field1=<span class="number">1</span>,field2=<span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>查询数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username <span class="keyword">FROM</span> table_name <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">limit</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>更新数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> table_name <span class="keyword">set</span> username=<span class="string">'update'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>删除数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> table_name <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>WHERE 有条件地从表中选取数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> field1, field2,...fieldN <span class="keyword">FROM</span> table_name1, table_name2...</span><br><span class="line">[<span class="keyword">WHERE</span> condition1 [<span class="keyword">AND</span> [<span class="keyword">OR</span>]] condition2.....</span><br></pre></td></tr></table></figure>

<p>LIKE 有条件地从表中选取数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> field1, field2,...fieldN</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> field1 <span class="keyword">LIKE</span> condition1 [<span class="keyword">AND</span> [<span class="keyword">OR</span>]] filed2 = <span class="string">'somevalue'</span></span><br></pre></td></tr></table></figure>

<p>UNION 连接 SELECT 语句的结果组合到一个结果集合中</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> expression1, expression2, ... expression_n</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">tables</span></span><br><span class="line">[<span class="keyword">WHERE</span> conditions]</span><br><span class="line"><span class="keyword">UNION</span> [<span class="keyword">ALL</span> | <span class="keyword">DISTINCT</span>]</span><br><span class="line"><span class="keyword">SELECT</span> expression1, expression2, ... expression_n</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">tables</span></span><br><span class="line">[<span class="keyword">WHERE</span> conditions];</span><br></pre></td></tr></table></figure>

<p>JOIN 根据两个或多个表中的列之间的关系从中查询数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Persons.LastName, Persons.FirstName, Orders.OrderNo</span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> Orders</span><br><span class="line"><span class="keyword">ON</span> Persons.Id_P = Orders.Id_P</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> Persons.LastName;</span><br></pre></td></tr></table></figure>

<p>查找表中多余的重复记录，重复记录是根据单个字段（peopleId）来判断</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> people</span><br><span class="line"><span class="keyword">where</span> peopleId <span class="keyword">in</span> (<span class="keyword">select</span> peopleId <span class="keyword">from</span> people <span class="keyword">group</span> <span class="keyword">by</span> peopleId <span class="keyword">having</span> <span class="keyword">count</span>(peopleId) &gt; <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>删除表中多余的重复记录，重复记录是根据单个字段（peopleId）来判断</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> people</span><br><span class="line"><span class="keyword">where</span> peopleId <span class="keyword">in</span> (<span class="keyword">select</span> peopleId <span class="keyword">from</span> people <span class="keyword">group</span> <span class="keyword">by</span> peopleId <span class="keyword">having</span> <span class="keyword">count</span>(peopleId) &gt; <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>显示数据表的结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">describe</span> table_name;</span><br></pre></td></tr></table></figure>

<p>添加列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> 列名 列数据类型 [<span class="keyword">after</span> 插入位置];</span><br></pre></td></tr></table></figure>

<p>修改列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">change</span> 列名称 列新名称 新数据类型;</span><br></pre></td></tr></table></figure>

<p>删除列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> 列名称;</span><br></pre></td></tr></table></figure>

<p>重命名表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">rename</span> 新表名;</span><br></pre></td></tr></table></figure>

<p>清空数据表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> table_name;</span><br></pre></td></tr></table></figure>

<p>删除数据表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> table_name;</span><br></pre></td></tr></table></figure>

<p>删除数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> dbname;</span><br></pre></td></tr></table></figure>

<p>退出 MySQL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure>

<h2 id="SQL-执行流程"><a href="#SQL-执行流程" class="headerlink" title="SQL 执行流程"></a>SQL 执行流程</h2><ol>
<li>当客户端连接到MySQL服务器时，服务器对其进行认证。可以通过用户名与密码认证，也可以通过SSL证书进行认证。登录认证后，服务器还会验证客户端是否有执行某个查询的操作权限。</li>
<li>在正式查询之前，服务器会检查查询缓存，如果能找到对应的查询，则不必进行查询解析，优化，执行等过程，直接返回缓存中的结果集。</li>
<li>MySQL的解析器会根据查询语句，构造出一个解析树，主要用于根据语法规则来验证语句是否正确，比如SQL的关键字是否正确，关键字的顺序是否正确。而预处理器主要是进一步校验，比如表名，字段名是否正确等</li>
<li>查询优化器将解析树转化为查询计划，一般情况下，一条查询可以有很多种执行方式，最终返回相同的结果，优化器就是根据成本找到这其中最优的执行计划</li>
<li>执行计划调用查询执行引擎，而查询引擎通过一系列API接口查询到数据</li>
<li>得到数据之后，在返回给客户端的同时，会将数据存在查询缓存中</li>
</ol>
<h2 id="使用-MySQL"><a href="#使用-MySQL" class="headerlink" title="使用 MySQL"></a>使用 MySQL</h2><p>使用 DataGrip 链接 MySQL</p>
<p><img src="/images/mysql-datagrip.jpg" alt="folder"></p>
<p>在 Egg.js 中使用 MySQL 数据库</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    sequelize: &#123;</span><br><span class="line">      dialect: <span class="string">'mysql'</span>,</span><br><span class="line">      database: <span class="string">'database-name'</span>,</span><br><span class="line">      host: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">      port: <span class="string">'3306'</span>,</span><br><span class="line">      username: <span class="string">'root'</span>,</span><br><span class="line">      password: <span class="string">'my-secret-pw'</span>,</span><br><span class="line">      pool: &#123;</span><br><span class="line">        max: <span class="number">8</span>, <span class="comment">// 最大连接数</span></span><br><span class="line">        min: <span class="number">0</span>, <span class="comment">// 最小连接数</span></span><br><span class="line">        idle: <span class="number">10000</span>, <span class="comment">// connection释放前的最大空闲时间</span></span><br><span class="line">      &#125;,</span><br><span class="line">      timezone: <span class="string">'+08:00'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="MySQL-索引"><a href="#MySQL-索引" class="headerlink" title="MySQL 索引"></a>MySQL 索引</h2><p>MySQL 官方对索引的定义为：索引（Index）是帮助MySQL高效获取数据的数据结构。是针对表而建立的，它是由数据页面以外的索引页面组成，每个索引页中的行都含有逻辑指针，以便加速检索物理数据，创建索引的目的在于提高查询效率。</p>
<p>MyISAM</p>
<p>MyISAM 引擎使用 B+Tree 作为索引结构，叶节点的data域存放的是数据记录的地址。MyISAM 中索引检索的算法为首先按照 B+Tree 搜索算法搜索索引，如果指定的 Key 存在，则取出其 data 域的值，然后以 data 域的值为地址，读取相应数据记录。MyISAM的索引方式也叫做“非聚集”的，之所以这么称呼是为了与InnoDB的聚集索引区分。</p>
<p>InnoDB</p>
<p>在 InnoDB 中，表数据文件本身就是按B+Tree组织的一个索引结构，这棵树的叶节点data域保存了完整的数据记录。这个索引的key是数据表的主键，因此InnoDB表数据文件本身就是主索引。InnoDB 的辅助索引 data 域存储相应记录主键的值而不是地址。</p>
<p>创建使用索引的原则</p>
<p>1、索引尽量少，索引过多，影响写速度<br>2、建立索引尽量满足左匹配，索引只能命中最左边的范围查询，比如存在索引idx_a_b_c_d,  查询如select * from table where a=1 and b=2 and c&gt;3 and d&lt;4，则只能用到a,b,c<br>3、使用explain查看执行计划，需求所有的查询至少到达range级别<br>4、区分度不高的字段不建索引，比如性别，只有男和女，这种字段不需要建索引<br>5、表必须有主键索引，PRIMARY KEY (<code>id</code>)<br>6、建立索引时，把区分度高的字段放在前面</p>
<h2 id="建表三范式"><a href="#建表三范式" class="headerlink" title="建表三范式"></a>建表三范式</h2><ol>
<li>要求有主键，并且要求每一个字段原子性不可再分</li>
<li>第一范式基础上，要求所有非主键字段完全依赖主键，不能产生部分依赖</li>
<li>在第二范式基础上，所有非主键字段和主键字段之间不能产生传递依赖</li>
</ol>
<h2 id="建表规范"><a href="#建表规范" class="headerlink" title="建表规范"></a>建表规范</h2><p>命名规范</p>
<ul>
<li>表名不使用复数名词</li>
<li>库名、表名、字段名使用小写字母，下划线 “_” 分割</li>
<li>库名、表名、字段名不超过 12 个字符</li>
<li>表名不使用复数名词</li>
<li>库名、表名、字段名见名知意, 尽量使用名词不是动词</li>
<li>不使用数据库保留字比如：key，desc，delete，order……</li>
<li>表的命名使用 “统一前缀_业务名称_表的作用” 模式，如：tb_plan, tb_task, tb_target</li>
</ul>
<p>设计规范</p>
<ul>
<li>使用布尔值类型存储是/否类字段</li>
<li>禁止在表中建立预留字段</li>
<li>所有表和字段都需添加注释</li>
<li>禁止在数据库存储图片、文件等二进制数据</li>
<li>存储引擎选择 InnoDB，表字符集选择 utf8mb4</li>
<li>将大字段拆分值其他表中</li>
<li>字段小写命名，禁止出现大写</li>
<li>尽可能把所有列定义为 NOT NULL，因为 NULL 在 MySQL 中得特殊处理、很难优化</li>
<li>优先选择符合存储需要的最小数据类型</li>
<li>对于非负整数，优先使用无符号整型存储（id）</li>
<li>避免使用 TEXT、BLOB 数据类型，非用不可的情况，可以把 BLOB 和 TEXT 拆分到单独的拓展表中</li>
<li>使用 TIMESTAMP 或 DATETIME 类型存储时间<ul>
<li>TIMESTAMP（4BYTE）1970-01-01 00:00:01 - 2038-01-19 03:14:07</li>
<li>DATETIME（8BYTE）1000-01-01 00:00:00’ -  9999-12-31 23:59:59</li>
</ul>
</li>
<li>用 decimal 来存储金额字段，不要用 float 和 double，会出现数据精度丢失</li>
<li>使用 INT UNSIGNED 存储 IP，IP 转数字函数 inet_aton()、数字转 IP 函数 inet_ntoa()</li>
<li>VARCHAR(N) 中的 N 表示字符数(不是字节数、比如 VARCHAR(N) 能存储 N 个汉字)、满足需求的情况下 N 越小越好、最大长度65535个字节</li>
<li>对于定长的字符类型、比如密码 MD5 值等、建议用 char 类型，效率可以得到提升</li>
</ul>
<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><ul>
<li>Optimize Your Queries For the Query Cache</li>
<li>EXPLAIN Your SELECT Queries</li>
<li>LIMIT 1 When Getting a Unique Row</li>
<li>Index the Search Fields</li>
<li>Index and Use Same Column Types for Joins</li>
<li>Avoid SELECT *</li>
<li>Almost Always Have an id Field</li>
<li>Use ENUM over VARCHAR</li>
<li>Get Suggestions with PROCEDURE ANALYSE()</li>
<li>Use NOT NULL If You Can</li>
<li>Prepared Statements</li>
<li>Unbuffered Queries</li>
<li>Fixed-length(Static) Tables are Faster</li>
<li>Vertical Partitioning</li>
<li>Split the Big DELETE or INSERT Queries</li>
<li>Smaller Columns Are Faster</li>
<li>Choose the Right Storage Engine</li>
<li>Use an Object Relational Mapper</li>
<li>在使用 InnoDB 存储引擎时，如果没有特别的需要，请永远使用一个与业务无关的自增字段作为主键。</li>
<li>禁止从开发环境、测试环境直连生产环境数据库</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://www.runoob.com/mysql/mysql-tutorial.html" target="_blank" rel="noopener">MySQL 教程</a></p>
<p><a href="https://www.kancloud.cn/xuying/sql/269824" target="_blank" rel="noopener">数据库经验小结</a></p>
<p><a href="https://github.com/jaywcjlove/mysql-tutorial/blob/master/21-minutes-MySQL-basic-entry.md" target="_blank" rel="noopener">21分钟MySQL基础入门</a></p>
<p><a href="https://www.jianshu.com/p/3e97c2a1687b" target="_blank" rel="noopener">MySql–数据库设计三范式</a></p>
<p><a href="http://blog.codinglabs.org/articles/theory-of-mysql-index.html" target="_blank" rel="noopener">MySQL索引背后的数据结构及算法原理</a></p>
<p><a href="https://www.cnblogs.com/enein/archive/2012/11/29/2794896.html" target="_blank" rel="noopener">Top 20+ MySQL Best Practices(20条MySQL最佳实践)</a></p></section>

  <a
  class="license-link"
  rel="license"
  href="https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode.zh-Hans"
>
  <img
    class="license-img"
    alt="知识共享许可协议"
    src="https://img.shields.io/badge/license-BY--NC--SA%204.0-green"
  />
</a>

  <section class="article-more">
    
    <a
      class=""
      href="/post/2020/02/26/flutter-github-actions/"
      title="使用 Github Actions 持续发布 Flutter 应用"
    >
      &larr;&nbsp;使用 Github Actions 持续发布 Flutter 应用
    </a>
     
    <a
      class=""
      href="/post/2020/02/03/flutter-cicd/"
      title="使用 Codemagic 持续部署 Flutter 应用"
    >
      使用 Codemagic 持续部署 Flutter 应用&nbsp;&rarr;
    </a>
    
  </section>
</article></main>
    <footer class="footer container">
  <ul class="sns-list">
    <li class="sns-list-item">
      <p class="">
        共计&#58; 61 篇
      </p>
    </li>
    <li class="sns-list-item">
      <p class="">
        <span class=""
          >总字数&#58; 63.9k</span
        >
      </p>
    </li>
  </ul>

  <ul class="sns-list">
    
    <li class="sns-list-item">
      <a
        class="sns-list-link"
        target="_blank"
        rel="noopener"
        href="https://github.com/xrr2016"
        >Github</a
      >
    </li>
     
    <li class="sns-list-item">
      <a
        class="sns-list-link"
        target="_blank"
        rel="noopener"
        href="https://juejin.im/user/576666b7207703006b1e0f09"
        >掘金</a
      >
    </li>
     
    <li class="sns-list-item">
      <a
        class="sns-list-link"
        target="_blank"
        rel="noopener"
        href="https://zhihu.com/people/needforchange/posts"
        >知乎</a
      >
    </li>
     
    <li>
      <a
        class="sns-list-link"
        target="_blank"
        rel="noopener"
        href="https://leetcode-cn.com/u/coldstone"
        >力扣</a
      >
    </li>
    
    <li class="sns-list-item">
      <a class="rss-link" href="/atom.xml">
        <svg
          class=""
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 5c7.18 0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"
          />
        </svg>
      </a>
    </li>
  </ul>

  <ul class="sns-list">
    <li class="sns-list-item">
      <a
        class="sns-list-link"
        href="https://colmugx.github.io/blog/"
        target="_blank"
        >colmugx</a
      >
    </li>
    <li class="sns-list-item">
      <a class="sns-list-link" href="https://kalasearch.cn/blog" target="_blank"
        >卡拉搜索</a
      >
    </li>
    <li class="sns-list-item">
      <a class="sns-list-link" href="https://blog.inmind.ltd/" target="_blank"
        >Mind's blog</a
      >
    </li>
    <li class="sns-list-item">
      <a
        class="sns-list-link"
        href="https://oldchen.top/flutter-blog/#/"
        target="_blank"
        >老晨子</a
      >
    </li>
    <li class="sns-list-item">
      <a class="sns-list-link" href="https://www.v2fy.com/" target="_blank"
        >猫爪导航🐱</a
      >
    </li>
    <li class="sns-list-item">
      <a class="sns-list-link" href="https://wxsm.space" target="_blank"
        >wxsm's space</a
      >
    </li>
  </ul>
</footer>
 <!--
 Copyright (c) 2021 Cold Stone
 
 This software is released under the MIT License.
 https://opensource.org/licenses/MIT
-->
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.7.2/build/highlight.min.js"></script>
<script src="/index.js"></script>

  </body>
</html>
