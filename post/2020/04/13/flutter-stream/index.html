<!DOCTYPE html>
<html lang="zh">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1" />
  <meta name="renderer" content="webkit|ie-comp|ie-stand" />
  <meta name="referrer" content="no-referrer" />
  <meta name="theme-color" content="#333333" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="google" content="notranslate" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="keyword" content="冷石, 前端, 面试，Web, Js, CSS, Node.js, Frontend, Flutter, Docker, Dart, Mysql, Egg.js" />
  <meta name="description" content="孑然一身，傲立于世" />
  <title>冷石的博客</title>
  <base href="/" />
  <link rel="preconnect" href="//cdn.jsdelivr.net" />
  <link rel="shortcut icon" href="/icons/icon-72x72.png" />
  <link
    rel="apple-touch-icon"
    href="/icons/icon-192x192.png"
  />
  <link
    rel="stylesheet"
    href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.7.2/build/styles/atom-one-light.min.css"
  />
  <link rel="stylesheet" href="/index.css">
  <script
    data-ad-client="ca-pub-1196485898698315"
    async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
  ></script>
</head>

  <body>
    <header class="header">
  <a class="logo" href="/">
    <img
      class="logo-img"
      src="https://avatars.githubusercontent.com/u/18013127?v=4"
    />
  </a>
  <div class="color" id="color"></div>
</header>

    <main class=""><article class="container article">
    
      <div class="article-cover">
        <img decoding="async" loading="lazy" src="./images/flutter-stream/stream.png" alt="cover" />
      </div>
    

    <h1 class="article-title">在 Flutter 里使用 Stream</h1>
 
    <p class="article-meta">
      <span class="article-meta-item">
        最后更新&#58;&nbsp;<time
          class="post-time"
          datetime="2021-06-28"
          >2021-06-28</time
        >
      </span>
      <span class="article-meta-item"
        >阅读时间&#58;&nbsp;9
        min</span
      >

    </p>
  </section>

  <section class=""><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在 Flutter 中有两种处理异步操作的方式 <code>Future</code> 和 <code>Stream</code>，<code>Future</code> 用于处理单个异步操作，<code>Stream</code> 用来处理连续的异步操作。比如往水杯倒水，将一个水杯倒满为一个 <code>Future</code>，连续的将多个水杯倒满就是 <code>Stream</code>。</p>
<p><img src="./images/flutter-stream/water-fill.png" alt="water-fill"></p>
<h2 id="Stream-详解"><a href="#Stream-详解" class="headerlink" title="Stream 详解"></a>Stream 详解</h2><p><code>Stream</code> 是一个抽象类，用于表示一序列异步数据的源。它是一种产生连续事件的方式，可以生成数据事件或者错误事件，以及流结束时的完成事件。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Stream</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  Stream();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Stream</code> 分单订阅流和广播流。</p>
<p>单订阅流在发送完成事件之前只允许设置一个监听器，并且只有在流上设置监听器后才开始产生事件，取消监听器后将停止发送事件。即使取消了第一个监听器，也不允许在单订阅流上设置其他的监听器。广播流则允许设置多个监听器，也可以在取消上一个监听器后再次添加新的监听器。</p>
<p><code>Stream</code> 有同步流和异步流之分。</p>
<p>它们的区别在于同步流会在执行 <code>add</code>，<code>addError</code> 或 <code>close</code> 方法时立即向流的监听器 <code>StreamSubscription</code> 发送事件，而异步流总是在事件队列中的代码执行完成后在发送事件。</p>
<h2 id="Stream-家族"><a href="#Stream-家族" class="headerlink" title="Stream 家族"></a><code>Stream</code> 家族</h2><p><code>StreamController</code></p>
<p>带有控制流方法的流。 可以向它的流发送数据，错误和完成事件，也可以检查数据流是否已暂停，是否有监听器。<code>sync</code> 参数决定这个流是同步流还是异步流。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamController</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">StreamSink</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  Stream&lt;T&gt; <span class="keyword">get</span> stream;</span><br><span class="line">  <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">StreamController _streamController = StreamController(</span><br><span class="line">  onCancel: () &#123;&#125;,</span><br><span class="line">  onListen: () &#123;&#125;,</span><br><span class="line">  onPause: () &#123;&#125;,</span><br><span class="line">  onResume: () &#123;&#125;,</span><br><span class="line">  <span class="keyword">sync</span>: <span class="keyword">false</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><code>StreamSink</code></p>
<p>流事件的入口。提供 <code>add</code>，<code>addError</code>，<code>addStream</code> 方法向流发送事件。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamSink</span>&lt;<span class="title">S</span>&gt; <span class="keyword">implements</span> <span class="title">EventSink</span>&lt;<span class="title">S</span>&gt;, <span class="title">StreamConsumer</span>&lt;<span class="title">S</span>&gt; </span>&#123;</span><br><span class="line">  Future close();</span><br><span class="line">  <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line">  Future <span class="keyword">get</span> done;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>StreamSubscription</code></p>
<p>流的监听器。提供 <code>cacenl</code>、<code>pause</code>, <code>resume</code> 等方法管理。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamSubscription</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">StreamSubscription subscription = StreamController().stream.listen(<span class="built_in">print</span>);</span><br><span class="line">subscription.onDone(() =&gt; <span class="built_in">print</span>(<span class="string">'done'</span>));</span><br></pre></td></tr></table></figure>

<p><code>StreamBuilder</code></p>
<p>使用流数据渲染 UI 界面的部件。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">StreamBuilder(</span><br><span class="line">  <span class="comment">// 数据流</span></span><br><span class="line">  stream: stream,</span><br><span class="line">  <span class="comment">// 初始数据</span></span><br><span class="line">  initialData: <span class="string">'loading...'</span>,</span><br><span class="line">  builder: (context, AsyncSnapshot snapshot) &#123;</span><br><span class="line">    <span class="comment">// AsyncSnapshot 对象为数据快照，缓存了当前数据和状态</span></span><br><span class="line">    <span class="comment">// snapshot.connectionState</span></span><br><span class="line">    <span class="comment">// snapshot.data</span></span><br><span class="line">    <span class="keyword">if</span> (snapshot.hasData) &#123;</span><br><span class="line">      <span class="built_in">Map</span> data = snapshot.data;</span><br><span class="line">      <span class="keyword">return</span> Text(data),</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> CircularProgressIndicator();</span><br><span class="line">  &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="创建-Stream"><a href="#创建-Stream" class="headerlink" title="创建 Stream"></a>创建 Stream</h2><p>在 Dart 有几种方式创建 <code>Stream</code></p>
<ol>
<li>从现有的生成一个新的流 <code>Stream</code>，使用 <code>map</code>，<code>where</code>，<code>takeWhile</code> 等方法。</li>
</ol>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 整数流</span></span><br><span class="line">Stream&lt;<span class="built_in">int</span>&gt; intStream = StreamController&lt;<span class="built_in">int</span>&gt;().stream;</span><br><span class="line"><span class="comment">// 偶数流</span></span><br><span class="line">Stream&lt;<span class="built_in">int</span>&gt; evenStream = intStream.where((<span class="built_in">int</span> n) =&gt; n.isEven);</span><br><span class="line"><span class="comment">// 两倍流</span></span><br><span class="line">Stream&lt;<span class="built_in">int</span>&gt; doubleStream = intStream.map((<span class="built_in">int</span> n) =&gt; n * <span class="number">2</span>);</span><br><span class="line"><span class="comment">// 数字大于 10 的流</span></span><br><span class="line">Stream&lt;<span class="built_in">int</span>&gt; biggerStream = intStream.takeWhile((<span class="built_in">int</span> n) =&gt; n &gt; <span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>使用 <code>async*</code> 函数。</li>
</ol>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;<span class="built_in">int</span>&gt; countStream(<span class="built_in">int</span> to) <span class="keyword">async</span>* &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt;= to; i++) &#123;</span><br><span class="line">    <span class="keyword">yield</span> i;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Stream stream = countStream(<span class="number">10</span>);</span><br><span class="line">stream.listen(<span class="built_in">print</span>);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>使用 <code>StreamController</code>。</li>
</ol>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">StreamController&lt;<span class="built_in">Map</span>&gt; _streamController = StreamController(</span><br><span class="line">  onCancel: () &#123;&#125;,</span><br><span class="line">  onListen: () &#123;&#125;,</span><br><span class="line">  onPause: () &#123;&#125;,</span><br><span class="line">  onResume: () &#123;&#125;,</span><br><span class="line">  <span class="keyword">sync</span>: <span class="keyword">false</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">Stream _stream = _streamController.stream;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>使用 <code>Future</code> 对象生成</li>
</ol>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;<span class="built_in">int</span>&gt; _delay(<span class="built_in">int</span> seconds) <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">await</span> Future.delayed(<span class="built_in">Duration</span>(seconds: seconds));</span><br><span class="line">  <span class="keyword">return</span> seconds;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">List</span>&lt;Future&gt; futures = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  futures.add(_delay(<span class="number">3</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Stream _futuresStream = Stream.fromFutures(futures);</span><br></pre></td></tr></table></figure>


<h2 id="应用-Stream"><a href="#应用-Stream" class="headerlink" title="应用 Stream"></a>应用 Stream</h2><p><em>Stream Counter</em></p>
<p>把 Flutter 的默认项目改用 <code>Stream</code> 实现</p>
<img src="./images/flutter-stream/stream-counter.gif" width="320" style="width: 320px;">

<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:async'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StreamCounter</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _StreamCounterState createState() =&gt; _StreamCounterState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_StreamCounterState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">StreamCounter</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// 创建一个 StreamController</span></span><br><span class="line">  StreamController&lt;<span class="built_in">int</span>&gt; _counterStreamController = StreamController&lt;<span class="built_in">int</span>&gt;(</span><br><span class="line">    onCancel: () &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">'cancel'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    onListen: () &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">'listen'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br><span class="line">  Stream _counterStream;</span><br><span class="line">  StreamSink _counterSink;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用 StreamSink 向 Stream 发送事件，当 _counter 大于 9 时调用 close 方法关闭流。</span></span><br><span class="line">  <span class="keyword">void</span> _incrementCounter() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_counter &gt; <span class="number">9</span>) &#123;</span><br><span class="line">      _counterSink.close();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    _counter++;</span><br><span class="line">    _counterSink.add(_counter);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 主动关闭流</span></span><br><span class="line">  <span class="keyword">void</span> _closeStream() &#123;</span><br><span class="line">    _counterStreamController.close();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _counterSink = _counterStreamController.sink;</span><br><span class="line">    _counterStream = _counterStreamController.stream;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">    _counterSink.close();</span><br><span class="line">    _counterStreamController.close();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'Stream Counter'</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Text(<span class="string">'You have pushed the button this many times:'</span>),</span><br><span class="line">            <span class="comment">// 使用 StreamBuilder 显示和更新 UI</span></span><br><span class="line">            StreamBuilder&lt;<span class="built_in">int</span>&gt;(</span><br><span class="line">              stream: _counterStream,</span><br><span class="line">              initialData: _counter,</span><br><span class="line">              builder: (context, snapshot) &#123;</span><br><span class="line">                <span class="keyword">if</span> (snapshot.connectionState == ConnectionState.done) &#123;</span><br><span class="line">                  <span class="keyword">return</span> Text(</span><br><span class="line">                    <span class="string">'Done'</span>,</span><br><span class="line">                    style: Theme.of(context).textTheme.bodyText2,</span><br><span class="line">                  );</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">int</span> number = snapshot.data;</span><br><span class="line">                <span class="keyword">return</span> Text(</span><br><span class="line">                  <span class="string">'<span class="subst">$number</span>'</span>,</span><br><span class="line">                  style: Theme.of(context).textTheme.bodyText2,</span><br><span class="line">                );</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      floatingActionButton: Row(</span><br><span class="line">        mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          FloatingActionButton(</span><br><span class="line">            onPressed: _incrementCounter,</span><br><span class="line">            tooltip: <span class="string">'Increment'</span>,</span><br><span class="line">            child: Icon(Icons.add),</span><br><span class="line">          ),</span><br><span class="line">          SizedBox(width: <span class="number">24.0</span>),</span><br><span class="line">          FloatingActionButton(</span><br><span class="line">            onPressed: _closeStream,</span><br><span class="line">            tooltip: <span class="string">'Close'</span>,</span><br><span class="line">            child: Icon(Icons.close),</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><em>NetWork Status</em></p>
<p>监听手机的网络链接状态，首先添加 <code>connectivity</code> 插件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">connectivity:</span> <span class="string">^0.4.8+2</span></span><br></pre></td></tr></table></figure>

<img src="./images/flutter-stream/network-status.gif" width="320" style="width: 320px;">

<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:async'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:connectivity/connectivity.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetWorkStatus</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _NetWorkStatusState createState() =&gt; _NetWorkStatusState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_NetWorkStatusState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">NetWorkStatus</span>&gt; </span>&#123;</span><br><span class="line">  StreamController&lt;ConnectivityResult&gt; _streamController = StreamController();</span><br><span class="line">  StreamSink _streamSink;</span><br><span class="line">  Stream _stream;</span><br><span class="line">  <span class="built_in">String</span> _result;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> _checkStatus() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> ConnectivityResult result = <span class="keyword">await</span> Connectivity().checkConnectivity();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (result == ConnectivityResult.mobile) &#123;</span><br><span class="line">      _result = <span class="string">'mobile'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result == ConnectivityResult.wifi) &#123;</span><br><span class="line">      _result = <span class="string">'wifi'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result == ConnectivityResult.none) &#123;</span><br><span class="line">      _result = <span class="string">'none'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setState(() &#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _stream = _streamController.stream;</span><br><span class="line">    _streamSink = _streamController.sink;</span><br><span class="line">    _checkStatus();</span><br><span class="line">    Connectivity().onConnectivityChanged.listen(</span><br><span class="line">      (ConnectivityResult result) &#123;</span><br><span class="line">        _streamSink.add(result);</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  dispose() &#123;</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">    _streamSink.close();</span><br><span class="line">    _streamController.close();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'Network Status'</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: StreamBuilder&lt;ConnectivityResult&gt;(</span><br><span class="line">          stream: _stream,</span><br><span class="line">          builder: (context, AsyncSnapshot snapshot) &#123;</span><br><span class="line">            <span class="keyword">if</span> (snapshot.hasData) &#123;</span><br><span class="line">              <span class="keyword">if</span> (snapshot.data == ConnectivityResult.mobile) &#123;</span><br><span class="line">                _result = <span class="string">'mobile'</span>;</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (snapshot.data == ConnectivityResult.wifi) &#123;</span><br><span class="line">                _result = <span class="string">'wifi'</span>;</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (snapshot.data == ConnectivityResult.none) &#123;</span><br><span class="line">                <span class="keyword">return</span> Text(<span class="string">'还没有链接网络'</span>);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (_result == <span class="keyword">null</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> CircularProgressIndicator();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> ResultText(_result);</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResultText</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> result;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> ResultText(<span class="keyword">this</span>.result);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> RichText(</span><br><span class="line">      text: TextSpan(</span><br><span class="line">        style: TextStyle(color: Colors.black),</span><br><span class="line">        text: <span class="string">'正在使用'</span>,</span><br><span class="line">        children: [</span><br><span class="line">          TextSpan(</span><br><span class="line">            text: <span class="string">' <span class="subst">$result</span> '</span>,</span><br><span class="line">            style: TextStyle(</span><br><span class="line">              color: Colors.red,</span><br><span class="line">              fontSize: <span class="number">20.0</span>,</span><br><span class="line">              fontWeight: FontWeight.bold,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          TextSpan(text: <span class="string">'链接网络'</span>),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Random Article</code></p>
<p>请求网络数据创建流</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">dio:</span> <span class="string">^3.0.9</span></span><br><span class="line">  <span class="attr">flutter_html:</span> <span class="string">^0.11.1</span></span><br></pre></td></tr></table></figure>

<img src="./images/flutter-stream/random-article.gif" width="320" style="width: 320px;">

<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:async'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:dio/dio.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter_html/flutter_html.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomArticle</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _RandomArticleState createState() =&gt; _RandomArticleState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_RandomArticleState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">RandomArticle</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> Dio _dio = Dio(</span><br><span class="line">    BaseOptions(baseUrl: <span class="string">'https://interface.meiriyiwen.com'</span>),</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> Future&lt;<span class="built_in">Map</span>&gt; _getArticle() <span class="keyword">async</span> &#123;</span><br><span class="line">    Response response = <span class="keyword">await</span> _dio.<span class="keyword">get</span>(</span><br><span class="line">      <span class="string">'/article/random'</span>,</span><br><span class="line">      queryParameters: &#123;<span class="string">"dev"</span>: <span class="number">1</span>&#125;,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> data = response.data[<span class="string">'data'</span>];</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Stream&lt;<span class="built_in">Map</span>&gt; _futuresStream;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="built_in">List</span>&lt;Future&lt;<span class="built_in">Map</span>&gt;&gt; futures = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="comment">// 添加 Future</span></span><br><span class="line">      futures.add(_getArticle());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成 Stream</span></span><br><span class="line">    _futuresStream = Stream&lt;<span class="built_in">Map</span>&gt;.fromFutures(futures);</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(title: Text(<span class="string">'Random Article'</span>)),</span><br><span class="line">      body: SingleChildScrollView(</span><br><span class="line">        child: Center(</span><br><span class="line">          child: StreamBuilder&lt;<span class="built_in">Map</span>&gt;(</span><br><span class="line">            stream: _futuresStream,</span><br><span class="line">            builder: (context, AsyncSnapshot snapshot) &#123;</span><br><span class="line">              <span class="keyword">if</span> (snapshot.hasData) &#123;</span><br><span class="line">                <span class="built_in">Map</span> article = snapshot.data;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> Container(</span><br><span class="line">                  child: Column(</span><br><span class="line">                    children: &lt;Widget&gt;[</span><br><span class="line">                      SizedBox(height: <span class="number">24.0</span>),</span><br><span class="line">                      Text(</span><br><span class="line">                        article[<span class="string">'title'</span>],</span><br><span class="line">                        style: TextStyle(fontSize: <span class="number">24.0</span>),</span><br><span class="line">                      ),</span><br><span class="line">                      Padding(</span><br><span class="line">                        padding: <span class="keyword">const</span> EdgeInsets.only(</span><br><span class="line">                          top: <span class="number">12.0</span>,</span><br><span class="line">                          left: <span class="number">12.0</span>,</span><br><span class="line">                          right: <span class="number">12.0</span>,</span><br><span class="line">                          bottom: <span class="number">60.0</span>,</span><br><span class="line">                        ),</span><br><span class="line">                        child: Html(</span><br><span class="line">                          data: article[<span class="string">'content'</span>],</span><br><span class="line">                        ),</span><br><span class="line">                      ),</span><br><span class="line">                    ],</span><br><span class="line">                  ),</span><br><span class="line">                );</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">return</span> CircularProgressIndicator();</span><br><span class="line">            &#125;,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Broadcast Stream</code></p>
<p>使用广播流</p>
<img src="./images/flutter-stream/broadcast-stream.gif" width="320" style="width: 320px;">

<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:async'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BroadcastStream</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _BroadcastStreamState createState() =&gt; _BroadcastStreamState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_BroadcastStreamState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">BroadcastStream</span>&gt; </span>&#123;</span><br><span class="line">  StreamController&lt;<span class="built_in">int</span>&gt; _streamController = StreamController&lt;<span class="built_in">int</span>&gt;.broadcast();</span><br><span class="line">  StreamSubscription _subscription1;</span><br><span class="line">  StreamSubscription _subscription2;</span><br><span class="line">  StreamSubscription _subscription3;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int</span> _count = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">int</span> _s1 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">int</span> _s2 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">int</span> _s3 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    _subscription1 = _streamController.stream.listen((n) &#123;</span><br><span class="line">      setState(() &#123;</span><br><span class="line">        _s1 += <span class="number">1</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    _subscription2 = _streamController.stream.listen((n) &#123;</span><br><span class="line">      setState(() &#123;</span><br><span class="line">        _s2 += <span class="number">2</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    _subscription3 = _streamController.stream.listen((n) &#123;</span><br><span class="line">      setState(() &#123;</span><br><span class="line">        _s3 -= <span class="number">1</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> _add() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_count &gt; <span class="number">10</span>) &#123;</span><br><span class="line">      <span class="comment">// 大于 10 时停止第一个订阅</span></span><br><span class="line">      _subscription1.cancel();</span><br><span class="line">    &#125;</span><br><span class="line">    _count++;</span><br><span class="line">    _streamController.add(_count);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">    _streamController.close();</span><br><span class="line">    _subscription1.cancel();</span><br><span class="line">    _subscription2.cancel();</span><br><span class="line">    _subscription3.cancel();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'Broadcast Stream'</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Container(</span><br><span class="line">        width: <span class="built_in">double</span>.infinity,</span><br><span class="line">        height: MediaQuery.of(context).size.height,</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">          crossAxisAlignment: CrossAxisAlignment.center,</span><br><span class="line">          children: [</span><br><span class="line">            Text(<span class="string">'Count: <span class="subst">$_count</span>'</span>),</span><br><span class="line">            SizedBox(height: <span class="number">12.0</span>),</span><br><span class="line">            Text(<span class="string">'S1: <span class="subst">$_s1</span>'</span>),</span><br><span class="line">            SizedBox(height: <span class="number">12.0</span>),</span><br><span class="line">            Text(<span class="string">'S2: <span class="subst">$_s2</span>'</span>),</span><br><span class="line">            SizedBox(height: <span class="number">12.0</span>),</span><br><span class="line">            Text(<span class="string">'S3: <span class="subst">$_s3</span>'</span>),</span><br><span class="line">            SizedBox(height: <span class="number">12.0</span>),</span><br><span class="line">            FloatingActionButton(</span><br><span class="line">              onPressed: _add,</span><br><span class="line">              child: Icon(Icons.plus_one),</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><code>Stream</code> 是处理异步编程的方式之一，它提供一个了异步的事件序列，并在你准备好接受时发送。在 Dart 中流分为同步流和异步流，以及单订阅流和广播流，有多种方式创建 <code>Stream</code>。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://dart.cn/tutorials/language/streams" target="_blank" rel="noopener">异步编程：使用 stream</a></p>
<p><a href="https://dart.cn/articles/libraries/creating-streams" target="_blank" rel="noopener">在 Dart 里使用 Stream</a></p>
<p><a href="https://guoshuyu.cn/home/wx/Flutter-11.html" target="_blank" rel="noopener">全面深入理解Stream</a></p>
<p><a href="https://codingwithjoe.com/flutter-building-a-widget-with-streambuilder/" target="_blank" rel="noopener">Building a Widget with StreamBuilder</a></p>
<p><a href="https://youtu.be/MkKEWHfy99Y" target="_blank" rel="noopener">StreamBuilder (Flutter 本周小部件)</a></p>
<p><a href="https://youtu.be/nQBpOIHE4eE" target="_blank" rel="noopener">Dart Streams - 聚焦 Flutter</a></p></section>

  <a
  class="license-link"
  rel="license"
  href="https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode.zh-Hans"
>
  <img
    class="license-img"
    alt="知识共享许可协议"
    src="https://img.shields.io/badge/license-BY--NC--SA%204.0-green"
  />
</a>

  <section class="article-more">
    
    <a
      class=""
      href="/post/2020/04/26/flutter-animation-from-zero/"
      title="从零开始的 Flutter 动画"
    >
      &larr;&nbsp;从零开始的 Flutter 动画
    </a>
     
    <a
      class=""
      href="/post/2020/04/03/how-flutter-render/"
      title="Flutter 是如何渲染的？"
    >
      Flutter 是如何渲染的？&nbsp;&rarr;
    </a>
    
  </section>
</article></main>
    <footer class="footer container">
  <ul class="sns-list">
    <li class="sns-list-item">
      <p class="">
        共计&#58; 61 篇
      </p>
    </li>
    <li class="sns-list-item">
      <p class="">
        <span class=""
          >总字数&#58; 63.9k</span
        >
      </p>
    </li>
  </ul>

  <ul class="sns-list">
    
    <li class="sns-list-item">
      <a
        class="sns-list-link"
        target="_blank"
        rel="noopener"
        href="https://github.com/xrr2016"
        >Github</a
      >
    </li>
     
    <li class="sns-list-item">
      <a
        class="sns-list-link"
        target="_blank"
        rel="noopener"
        href="https://juejin.im/user/576666b7207703006b1e0f09"
        >掘金</a
      >
    </li>
     
    <li class="sns-list-item">
      <a
        class="sns-list-link"
        target="_blank"
        rel="noopener"
        href="https://zhihu.com/people/needforchange/posts"
        >知乎</a
      >
    </li>
     
    <li>
      <a
        class="sns-list-link"
        target="_blank"
        rel="noopener"
        href="https://leetcode-cn.com/u/coldstone"
        >力扣</a
      >
    </li>
    
    <li class="sns-list-item">
      <a class="rss-link" href="/atom.xml">
        <svg
          class=""
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 5c7.18 0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"
          />
        </svg>
      </a>
    </li>
  </ul>

  <ul class="sns-list">
    <li class="sns-list-item">
      <a
        class="sns-list-link"
        href="https://colmugx.github.io/blog/"
        target="_blank"
        >colmugx</a
      >
    </li>
    <li class="sns-list-item">
      <a class="sns-list-link" href="https://kalasearch.cn/blog" target="_blank"
        >卡拉搜索</a
      >
    </li>
    <li class="sns-list-item">
      <a class="sns-list-link" href="https://blog.inmind.ltd/" target="_blank"
        >Mind's blog</a
      >
    </li>
    <li class="sns-list-item">
      <a
        class="sns-list-link"
        href="https://oldchen.top/flutter-blog/#/"
        target="_blank"
        >老晨子</a
      >
    </li>
    <li class="sns-list-item">
      <a class="sns-list-link" href="https://www.v2fy.com/" target="_blank"
        >猫爪导航🐱</a
      >
    </li>
    <li class="sns-list-item">
      <a class="sns-list-link" href="https://wxsm.space" target="_blank"
        >wxsm's space</a
      >
    </li>
  </ul>
</footer>
 <!--
 Copyright (c) 2021 Cold Stone
 
 This software is released under the MIT License.
 https://opensource.org/licenses/MIT
-->
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.7.2/build/highlight.min.js"></script>
<script src="/index.js"></script>

  </body>
</html>
