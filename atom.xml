<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å†·çŸ³</title>
  <icon>https://coldstone.fun/avatar.png</icon>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://coldstone.fun/"/>
  <updated>2021-06-28T09:25:25.305Z</updated>
  <id>https://coldstone.fun/</id>
  
  <author>
    <name>å†·çŸ³</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å­¦ä¹ æŠ½è±¡è¯­æ³•æ ‘ AST</title>
    <link href="https://coldstone.fun/post/2021/04/26/learn-ast/"/>
    <id>https://coldstone.fun/post/2021/04/26/learn-ast/</id>
    <published>2021-04-26T07:40:51.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>ä½œä¸ºä¸€ä¸ªå‰ç«¯åˆ‡å›¾ä»”ï¼Œå·¥ä½œä¸­å°‘ä¸äº†ç”¨ä¸Š Babelï¼ŒESLintï¼ŒPrettier è¿™äº›å·¥å…·ï¼Œä½†æ˜¯è¿™äº›å·¥å…·èƒŒåçš„å·¥ä½œåŸç†å´ä¸æ±‚ç”šè§£ğŸ˜… </p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä½œä¸ºä¸€ä¸ªå‰ç«¯åˆ‡å›¾ä»”ï¼Œå·¥ä½œä¸­å°‘ä¸äº†ç”¨ä¸Š Babelï¼ŒESLintï¼ŒPrettier è¿™äº›å·¥å…·ï¼Œä½†æ˜¯è¿™äº›å·¥å…·èƒŒåçš„å·¥ä½œåŸç†å´ä¸æ±‚ç”šè§£ğŸ˜… ï¼Œæœ€è¿‘æ‰å°è¯•å»äº†è§£ä¸€ç•ªï¼Œæ²¡æƒ³åˆ°å‘ç°ä¸€ä¸ªå…¨æ–°çš„ä¸–ç•Œï¼Œé‚£å°±æ˜¯ <code>AST</code> ä¸­æ–‡åæŠ½è±¡è¯­æ³•æ ‘ã€‚</p><h2 id="åˆè¯†"><a href="#åˆè¯†" class="headerlink" title="åˆè¯†"></a>åˆè¯†</h2><blockquote><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒæŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntax Treeï¼ŒASTï¼‰ï¼Œæˆ–ç®€ç§°è¯­æ³•æ ‘ï¼ˆSyntax treeï¼‰ï¼Œæ˜¯æºä»£ç è¯­æ³•æ¶æ„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤ºã€‚å®ƒä»¥æ ‘çŠ¶çš„å½¢å¼è¡¨ç°ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚ä¹‹æ‰€ä»¥è¯´è¯­æ³•æ˜¯â€œæŠ½è±¡â€çš„ï¼Œæ˜¯å› ä¸ºè¿™é‡Œçš„è¯­æ³•å¹¶ä¸ä¼šè¡¨ç¤ºå‡ºçœŸæ˜¯è¯­æ³•ä¸­å‡ºç°çš„æ¯ä¸ªç»†èŠ‚ã€‚æ¯”å¦‚åµŒå¥—æ‹¬å·è¢«éšå«åœ¨æ ‘çš„ç»“æ„ä¸­ï¼Œå¹¶æ²¡æœ‰ä»¥èŠ‚ç‚¹çš„å½¢å¼å‘ˆç°ï¼›äºŒç±»ä¼¼äº <code>if-condition-then</code>è¿™æ ·çš„æ¡ä»¶è·³è½¬è¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰ä¸‰ä¸ªåˆ†æ”¯çš„èŠ‚ç‚¹æ¥è¡¨ç¤ºã€‚<br>å’ŒæŠ½è±¡è¯­æ³•æ ‘ç›¸å¯¹çš„æ˜¯å…·ä½“è¯­æ³•æ ‘ï¼ˆé€šå¸¸ç§°ä½œåˆ†ææ ‘ï¼‰ã€‚ä¸€èˆ¬çš„ï¼Œåœ¨æºä»£ç çš„ç¿»è¯‘å’Œç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œè¯­æ³•åˆ†æå™¨åˆ›å»ºå‡ºåˆ†ææ ‘ï¼Œç„¶åä»åˆ†ææ ‘ç”ŸæˆASTã€‚ä¸€æ—¦ASTè¢«åˆ›å»ºå‡ºæ¥ï¼Œåœ¨åç»­çš„å¤„ç†è¿‡ç¨‹ä¸­ï¼Œæ¯”å¦‚è¯­ä¹‰åˆ†æé˜¶æ®µï¼Œä¼šæ·»åŠ ä¸€äº›ä¿¡æ¯ã€‚</p></blockquote><p><a href="https://zh.wikipedia.org/wiki/%E6%8A%BD%E8%B1%A1%E8%AA%9E%E6%B3%95%E6%A8%B9" target="_blank" rel="noopener">æŠ½è±¡èªæ³•æ¨¹</a></p><p>è®©æˆ‘ä»¬ä»ä¸€ä¸ªå…¨èƒ½çš„å‡½æ•°å¼€å§‹ï¼Œå®ƒè¿”å›<a href="https://zh.wikipedia.org/wiki/%E7%94%9F%E5%91%BD%E3%80%81%E5%AE%87%E5%AE%99%E4%BB%A5%E5%8F%8A%E4%BB%BB%E4%BD%95%E4%BA%8B%E6%83%85%E7%9A%84%E7%B5%82%E6%A5%B5%E7%AD%94%E6%A1%88" target="_blank" rel="noopener">ç”Ÿå‘½ã€å®‡å®™ä»¥åŠä»»ä½•äº‹æƒ…çš„ç»ˆæç­”æ¡ˆ</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ask</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> answer = <span class="number">42</span></span><br><span class="line">  <span class="keyword">return</span> answer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°å£°æ˜ï¼Œå‡½æ•°åç§°ä¸º <code>ask</code> ï¼Œå‡½æ•°ä½“å†…å®šä¹‰äº†ä¸€ä¸ªå¸¸é‡ answer å€¼ä¸º 42ï¼Œæœ€åè¿”å› answerã€‚æŠŠå®ƒè¾“å…¥åˆ°ä¸€ä¸ªç¥å¥‡çš„ç½‘ç«™ <a href="https://astexplorer.net/" target="_blank" rel="noopener">astexplorer</a>ï¼Œç¥ç§˜çš„ <code>AST</code> ç»ˆäºè¢«æ­å¼€äº†é¢çº±ã€‚</p><p><img src="./images/learn-ast/ast.jpeg" alt="ast"></p><p>å¯ä»¥çœ‹å‡º <code>AST</code> å°±æ˜¯ä¸€ä¸ªè‡ªä¸Šè€Œä¸‹çš„æ ‘å½¢ç»“æ„ï¼Œæ¯ä¸€å±‚æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ç»„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ª <code>type</code> å±æ€§è¡¨ç¤ºèŠ‚ç‚¹çš„ç±»å‹ï¼Œå¦‚ â€œFunctionDeclarationâ€, â€œBlockStatementâ€, â€œVariableDeclarationâ€ï¼Œä»¥åŠèŠ‚ç‚¹çš„å…¶ä»–å±æ€§ã€‚ï¼ˆèŠ‚ç‚¹çš„ç±»å‹å®šä¹‰åœ¨ <a href="https://github.com/estree/estree" target="_blank" rel="noopener">ESTree</a> è¿™ä¸ªä»“åº“ï¼Œå®ƒåŒ…æ‹¬äº† es5 åˆ°æœ€æ–°çš„ js è¯­æ³•å®šä¹‰ï¼‰ã€‚ä¸‹å›¾å¯ä»¥æ›´æ¸…æ™°çš„çœ‹å‡ºè¿™ä¸ªå‡½æ•° <code>AST</code> çš„ç»“æ„ï¼Œè‡³æ­¤æˆ‘ä»¬å¯¹ <code>AST</code> æœ‰äº†åˆæ­¥çš„è®¤è¯†ã€‚</p><p><img src="./images/learn-ast/draw.jpeg" alt="draw"></p><h2 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h2><p>è¦å¾—åˆ°ä»£ç çš„ <code>AST</code>ï¼Œé¦–å…ˆéœ€è¦å¯¹ä»£ç è¿›è¡Œè§£æã€‚è§£æé˜¶æ®µæ¥å—æºç å¹¶è¾“å‡º <code>AST</code> ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªè§£æå™¨å¯¹æºç è¿›è¡Œ<strong>è¯æ³•åˆ†æ</strong>å’Œ<strong>è¯­æ³•åˆ†æã€‚</strong> è¯æ³•åˆ†æå°†å­—ç¬¦ä¸²å½¢å¼çš„ä»£ç è½¬æ¢ä¸ºä¸€ä¸ªè¯­æ³•ç‰‡æ®µæ•°ç»„ <strong>Tokens</strong> ï¼Œè¯­æ³•åˆ†æé˜¶æ®µæŠŠ *<em>Tokens *</em>è½¬æ¢æˆ <code>AST</code> å½¢å¼ã€‚</p><h3 id="è¯æ³•åˆ†æ"><a href="#è¯æ³•åˆ†æ" class="headerlink" title="è¯æ³•åˆ†æ"></a>è¯æ³•åˆ†æ</h3><p><strong>Tokens</strong> æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç”±ä»£ç è¯­å¥çš„ç¢ç‰‡ç»„æˆï¼Œå®ƒä»¬å¯ä»¥æ˜¯æ•°å­—ã€æ ‡ç­¾ã€æ ‡ç‚¹ç¬¦å·ã€è¿ç®—ç¬¦ï¼Œæˆ–è€…å…¶å®ƒä»»ä½•ä¸œè¥¿ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æºç </span></span><br><span class="line">a + b</span><br><span class="line"></span><br><span class="line"><span class="comment">// Tokens</span></span><br><span class="line">[</span><br><span class="line">  &#123; <span class="attr">type</span>: &#123; ... &#125;, <span class="attr">value</span>: <span class="string">"a"</span>, <span class="attr">start</span>: <span class="number">0</span>, <span class="attr">end</span>: <span class="number">1</span>, <span class="attr">loc</span>: &#123; ... &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">type</span>: &#123; ... &#125;, <span class="attr">value</span>: <span class="string">"+"</span>, <span class="attr">start</span>: <span class="number">2</span>, <span class="attr">end</span>: <span class="number">3</span>, <span class="attr">loc</span>: &#123; ... &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">type</span>: &#123; ... &#125;, <span class="attr">value</span>: <span class="string">"b"</span>, <span class="attr">start</span>: <span class="number">4</span>, <span class="attr">end</span>: <span class="number">5</span>, <span class="attr">loc</span>: &#123; ... &#125; &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="è¯­æ³•åˆ†æ"><a href="#è¯­æ³•åˆ†æ" class="headerlink" title="è¯­æ³•åˆ†æ"></a>è¯­æ³•åˆ†æ</h3><p>è¯­æ³•åˆ†æé˜¶æ®µæŠŠ *<em>Tokens *</em> æ•°ç»„è½¬æ¢æˆ <code>AST</code> çš„å½¢å¼ä¾¿äºåç»­æ“ä½œï¼Œè¯¦ç»†æ“ä½œå¯ä»¥æŸ¥çœ‹è¿™é‡Œçš„<a href="https://github.com/starkwang/the-super-tiny-compiler-cn/blob/master/super-tiny-compiler-chinese.js#L446" target="_blank" rel="noopener">ä»£ç </a>ã€‚</p><h2 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h2><p>æœ‰äº† <code>AST</code> å°±å¯ä»¥å¯¹è¿™æ£µæ ‘è¿›è¡Œä»ä¸Šåˆ°ä¸‹çš„é€’å½’éå†ï¼Œè¿‡ç¨‹ä¸­è®¿é—®æ ‘çš„èŠ‚ç‚¹ï¼Œè¿™é‡Œä½¿ç”¨äº†ä¸€ç§è®¾è®¡æ¨¡å¼ <a href="https://zh.wikipedia.org/wiki/%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F" target="_blank" rel="noopener">è®¿é—®è€…æ¨¡å¼</a>ï¼Œé€šè¿‡åˆ›å»ºä¸€ä¸ªè®¿é—®è€… <code>visitor</code> å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­åŒ…æ‹¬ä¸€äº›æ–¹æ³•ï¼Œåœ¨éå† <code>AST</code> è¿‡ç¨‹ä¸­è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸå°±è°ƒç”¨è®¿é—®è€…çš„æ–¹æ³•ã€‚</p><p>é€šè¿‡è®¿é—®èŠ‚ç‚¹å¯ä»¥å¯¹æºç è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼ŒESLint å°±æ˜¯åŸºäºæ­¤ï¼Œä»¥ä¸‹æ˜¯æ£€æµ‹è¯­æ³•çš„è§„åˆ™ç¤ºä¾‹ï¼ˆå…³äºç¼–å†™ ESLint è§„åˆ™çš„è¯¦ç»†å†…å®¹å¯ä»¥æŸ¥çœ‹æ­¤<a href="https://cn.eslint.org/docs/developer-guide/working-with-rules" target="_blank" rel="noopener">é“¾æ¥</a>ï¼‰</p><h4 id="é™åˆ¶å‡½æ•°å‚æ•°æ•°é‡"><a href="#é™åˆ¶å‡½æ•°å‚æ•°æ•°é‡" class="headerlink" title="é™åˆ¶å‡½æ•°å‚æ•°æ•°é‡"></a>é™åˆ¶å‡½æ•°å‚æ•°æ•°é‡</h4><p>æ€è·¯æ˜¯åŒ¹é…ç±»å‹ä¸º <code>FunctionDeclaration</code> çš„èŠ‚ç‚¹ï¼Œ<code>FunctionDeclaration</code> è¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹ä¸ºå‡½æ•°å£°æ˜ï¼Œå¦‚æœå‡½æ•°çš„å‚æ•°æ•°é‡å¤§äº 3 ä¸ªå°±è¿›è¡Œæç¤ºã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// è®¿é—® FunctionDeclaration èŠ‚ç‚¹</span></span><br><span class="line">    FunctionDeclaration: <span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// åˆ¤æ–­å‡½æ•°å‚æ•°ä¸ªæ•°</span></span><br><span class="line">      <span class="keyword">if</span> (node.params.length &gt; <span class="number">3</span>) &#123;</span><br><span class="line">        context.report(&#123;</span><br><span class="line">          node,</span><br><span class="line">          message: <span class="string">"å‚æ•°æœ€å¤šä¸èƒ½è¶…è¿‡3ä¸ª"</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹</p><p><img src="./images/learn-ast/params.png" alt="params"></p><h4 id="é™åˆ¶åµŒå¥—çš„æ¡ä»¶è¯­å¥"><a href="#é™åˆ¶åµŒå¥—çš„æ¡ä»¶è¯­å¥" class="headerlink" title="é™åˆ¶åµŒå¥—çš„æ¡ä»¶è¯­å¥"></a>é™åˆ¶åµŒå¥—çš„æ¡ä»¶è¯­å¥</h4><p>åŒ¹é…ç±»å‹ä¸º <code>IfStatement</code> çš„èŠ‚ç‚¹ï¼Œå¦‚æœå®ƒçš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹è¿˜æ˜¯ <code>IfStatement</code> å°±è¿›è¡Œæç¤ºã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    IfStatement(node) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; consequent &#125; = node;</span><br><span class="line">      <span class="keyword">const</span> &#123; body &#125; = consequent;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ¤æ–­ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ç±»å‹æ˜¯å¦æ˜¯ IfStatement</span></span><br><span class="line">      <span class="keyword">if</span> (body[<span class="number">0</span>] &amp;&amp; body[<span class="number">0</span>].type === <span class="string">"IfStatement"</span>) &#123;</span><br><span class="line">        context.report(&#123;</span><br><span class="line">          node: body[<span class="number">0</span>],</span><br><span class="line">          message: <span class="string">"ä¸å…è®¸åµŒå¥—çš„æ¡ä»¶è¯­å¥"</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="./images/learn-ast/if.png" alt="if"></p><h2 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h2><p>åœ¨éå† <code>AST</code> è¿‡ç¨‹ä¸­å¯ä»¥å¯¹æ ‘çš„èŠ‚ç‚¹è¿›è¡Œä¿®æ”¹ï¼Œå¦‚æ·»åŠ ï¼Œç§»åŠ¨ï¼Œæ›¿æ¢è¿™äº›èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥ç”Ÿæˆå…¨æ–°çš„ <code>AST</code>ã€‚</p><p>Babel çš„ä½œç”¨å°±æ˜¯ä¿®æ”¹ <code>AST</code> ä¸Šçš„èŠ‚ç‚¹ï¼Œä»è€Œåˆ°è¾¾ä¿®æ”¹ä»£ç çš„æ•ˆæœã€‚ä¸€ä¸ª Babel æ’ä»¶æ˜¯ä¸€ä¸ªæ¥æ”¶ <code>babel</code> å¯¹è±¡ä½œä¸ºå‚æ•°çš„å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå¸¦æœ‰ <code>visitor</code> å±æ€§çš„å¯¹è±¡ã€‚<code>visitor</code> å¯¹è±¡ä¸­çš„æ¯ä¸ªå‡½æ•°æ¥å— <code>path</code> å’Œ <code>state</code> å‚æ•°ï¼Œä»¥ä¸‹æ˜¯ç¼–å†™ Babel æ’ä»¶ç¤ºä¾‹ï¼Œå…³äºç¼–å†™ Babel æ’ä»¶å¯ä»¥æŸ¥çœ‹æ­¤<a href="https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md#toc-stages-of-babel" target="_blank" rel="noopener">é“¾æ¥</a>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Babel æ’ä»¶</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">babel</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    visitor: &#123;</span><br><span class="line">      Identifier(path, state) &#123;&#125;,</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å°†-è¯­æ³•è½¬æ¢ä¸º-Math-pow"><a href="#å°†-è¯­æ³•è½¬æ¢ä¸º-Math-pow" class="headerlink" title="å°† ** è¯­æ³•è½¬æ¢ä¸º Math.pow"></a>å°† <code>**</code> è¯­æ³•è½¬æ¢ä¸º <code>Math.pow</code></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Before</span></span><br><span class="line"><span class="keyword">const</span> a = <span class="number">10</span> ** <span class="number">2</span> </span><br><span class="line"><span class="comment">// After</span></span><br><span class="line"><span class="keyword">const</span> a = <span class="built_in">Math</span>.pow(<span class="number">10</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure><ol><li>æ‰¾åˆ° <code>**</code> è¯­æ³•æ‰€åœ¨ä½ç½®</li><li>è·å–å·¦å³æ“ä½œæ•°</li><li>åˆ›å»º <code>Math.pow</code> è¯­å¥ï¼Œæ›¿æ¢åŸèŠ‚ç‚¹</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params">babel</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">types</span>: t &#125; = babel;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    visitor: &#123;</span><br><span class="line">      <span class="comment">// è®¿é—®äºŒå…ƒè¡¨è¾¾å¼</span></span><br><span class="line">      BinaryExpression(path) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; node &#125; = path</span><br><span class="line">        <span class="comment">// å¦‚æœæ“ä½œç¬¦ä¸æ˜¯ ** å°±é€€å‡º</span></span><br><span class="line">        <span class="keyword">if</span> (node.operator !== <span class="string">'**'</span>) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">const</span> &#123; left, right &#125; = node</span><br><span class="line">        <span class="comment">// åˆ›å»ºè°ƒç”¨è¯­å¥</span></span><br><span class="line">        <span class="keyword">const</span> newNode = t.callExpression(</span><br><span class="line">          t.memberExpression(t.identifier(<span class="string">'Math'</span>), t.identifier(<span class="string">'pow'</span>)),</span><br><span class="line">          [left, right]</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">// æ›¿æ¢åŸèŠ‚ç‚¹</span></span><br><span class="line">        path.replaceWith(newNode)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹å·¥å…·å‡½æ•°å¼•å…¥æ–¹å¼"><a href="#ä¿®æ”¹å·¥å…·å‡½æ•°å¼•å…¥æ–¹å¼" class="headerlink" title="ä¿®æ”¹å·¥å…·å‡½æ•°å¼•å…¥æ–¹å¼"></a>ä¿®æ”¹å·¥å…·å‡½æ•°å¼•å…¥æ–¹å¼</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Before</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">get</span>, isFunction &#125; from 'lodash'</span><br><span class="line">// After</span><br><span class="line">import <span class="keyword">get</span> from "lodash/<span class="keyword">get</span>";</span><br><span class="line">import isFunction from "lodash/isFunction";</span><br></pre></td></tr></table></figure><ol><li>æ‰¾åˆ° <code>lodash</code> çš„ <code>import</code> èŠ‚ç‚¹</li><li>éå†æ‰€æœ‰çš„å¼•å…¥å€¼ï¼Œè·å–å¼•ç”¨çš„ <code>name</code> å±æ€§</li><li>æ’å…¥æ–°ç”Ÿæˆçš„ <code>import</code> èŠ‚ç‚¹</li><li>åˆ é™¤åŸèŠ‚ç‚¹</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params">babel</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">types</span>: t &#125; = babel;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    visitor: &#123;</span><br><span class="line">      <span class="comment">// è®¿é—®å¯¼å…¥å£°æ˜</span></span><br><span class="line">      ImportDeclaration(path) &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; node &#125; = path</span><br><span class="line">        <span class="keyword">if</span> (node.source.value !== <span class="string">'lodash'</span>) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">const</span> val = node.source.value</span><br><span class="line"></span><br><span class="line">        node.specifiers.forEach(<span class="function">(<span class="params">spec</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (t.isImportSpecifier(spec)) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; local &#125; = spec</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ’å…¥æ–°çš„å¯¼å…¥èŠ‚ç‚¹</span></span><br><span class="line">            path.insertBefore(</span><br><span class="line">              t.importDeclaration(</span><br><span class="line">                [t.importDefaultSpecifier(local)],</span><br><span class="line">                t.stringLiteral(<span class="string">`<span class="subst">$&#123;val&#125;</span>/<span class="subst">$&#123;local.name&#125;</span>`</span>)</span><br><span class="line">              )</span><br><span class="line">            )</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// åˆ é™¤åŸèŠ‚ç‚¹</span></span><br><span class="line">        path.remove()</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆ"><a href="#ç”Ÿæˆ" class="headerlink" title="ç”Ÿæˆ"></a>ç”Ÿæˆ</h2><p>å°±æ˜¯æ ¹æ® <code>AST</code> è¾“å‡ºä»£ç ï¼Œä¸‹é¢é€šè¿‡ä¸¤ä¸ªå·¥å…·è¯´æ˜ã€‚</p><h3 id="Jscodeshift"><a href="#Jscodeshift" class="headerlink" title="Jscodeshift"></a>Jscodeshift</h3><p><a href="https://github.com/facebook/jscodeshift" target="_blank" rel="noopener">jscodeshift</a> æ˜¯ä¸€ä¸ª Facebook å¼€æºçš„ç”¨æ¥å¯¹ JavaScript æˆ–è€… TypeScript æ–‡ä»¶è¿è¡Œè½¬æ¢çš„å·¥å…·ï¼Œå®ƒçš„ç›®çš„æ˜¯æ›´æ–¹ä¾¿çš„æ‰¹é‡ä¿®æ”¹ä»£ç ã€‚å®ƒé€šè¿‡æ¥å— *<em>transformer *</em>å¯¹æºç è¿›è¡Œè½¬æ¢ï¼Œä¸€ä¸ª *<em>transformer *</em>å°±æ˜¯ä¸€ä¸ªæ¥å— <code>fileInfo</code>, <code>api</code>, <code>options</code> å‚æ•°å¹¶è¿”å›æºç çš„å‡½æ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">fileInfo, api, options</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// transform `fileInfo.source` here</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// return changed source</span></span><br><span class="line">  <span class="keyword">return</span> source;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼Œå°† <code>&lt;React.Fragment&gt;</code> è½¬æ¢æˆ <code>&lt;&gt;``&lt;/&gt;</code> è¯­æ³•ï¼Œæ€è·¯æ˜¯æ‰¾åˆ° <code>name</code> å±æ€§ä¸º <code>Fragment</code> çš„èŠ‚ç‚¹ï¼Œç„¶åå°†å®ƒçš„çˆ¶èŠ‚ç‚¹æ¸…é™¤ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">transformer</span>(<span class="params">file, api</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> j = api.jscodeshift</span><br><span class="line">  <span class="keyword">const</span> root = j(file.source)</span><br><span class="line"></span><br><span class="line">  root.find(j.JSXIdentifier).forEach(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; node &#125; = p</span><br><span class="line">    <span class="keyword">if</span> (node.name !== <span class="string">'Fragment'</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    j(p.parent).remove()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> root.toSource()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="./images/learn-ast/header.gif" alt="header"></p><p>æ›´å¤šç¤ºä¾‹å¯æŸ¥çœ‹è¿™ä¸ª<a href="https://github.com/cpojer/js-codemod/" target="_blank" rel="noopener">é“¾æ¥</a></p><h3 id="Gogocode"><a href="#Gogocode" class="headerlink" title="Gogocode"></a>Gogocode</h3><p><a href="https://github.com/thx/gogocode" target="_blank" rel="noopener">gogocode</a> æ˜¯æœ€è¿‘å‘ç°çš„ä¸€ä¸ª <code>AST</code> å¤„ç†å·¥å…·ï¼Œå·ç§°å…¨ç½‘æœ€ç®€å•æ˜“ä¸Šæ‰‹ï¼Œå¯è¯»æ€§æœ€å¼ºï¼Œæä¾›çš„ç¤ºä¾‹æä¾›ç±»ä¼¼äº jQuery çš„ APIã€‚</p><p>ä¸€ä¸ªæ›¿æ¢å˜é‡åä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> $ = <span class="built_in">require</span>(<span class="string">'gogocode'</span>)</span><br><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">  function ask() &#123;</span></span><br><span class="line"><span class="string">    const answer = 42</span></span><br><span class="line"><span class="string">    return answer</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="keyword">const</span> newCode = $(code)</span><br><span class="line">  .replace(<span class="string">'ask'</span>, <span class="string">'question'</span>)</span><br><span class="line">  .replace(<span class="string">'answer'</span>, <span class="string">'result'</span>)</span><br><span class="line">  .generate()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(newCode)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// function question() &#123;</span></span><br><span class="line"><span class="comment">//   const result = 42</span></span><br><span class="line"><span class="comment">//   return result;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure><p><img src="./images/learn-ast/gogocode.gif" alt="gogocode"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡è§£é‡Šäº†ä»€ä¹ˆæ˜¯ <code>AST</code> æŠ½è±¡è¯­æ³•æ ‘ï¼Œå¦‚ä½•è·å¾—ä»£ç çš„ <code>AST</code>ï¼Œä»¥åŠå¯¹ <code>AST</code> è¿›è¡Œéå†ï¼Œä¿®æ”¹å’Œç”Ÿæˆï¼Œåˆ©ç”¨ <code>AST</code> æˆ‘ä»¬å¯ä»¥å¼€å‘çš„ä»£ç å·¥å…·ã€‚</p><p><a href="https://github.com/xrr2016/ast-learn" target="_blank" rel="noopener">æœ¬æ–‡ä»£ç åœ°å€</a></p><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><p><a href="https://github.com/cowchimp/awesome-ast" target="_blank" rel="noopener">Awesome AST</a><br><a href="https://github.com/estree/estree" target="_blank" rel="noopener">The ESTree Spec</a><a href="https://github.com/cowchimp/awesome-ast" target="_blank" rel="noopener"> </a><br><a href="https://github.com/jamiebuilds/babel-handbook" target="_blank" rel="noopener">Babel Handbook</a><br><a href="https://github.com/jamiebuilds/the-super-tiny-compiler" target="_blank" rel="noopener">The Super Tiny Compiler</a><br><a href="https://cn.eslint.org/docs/developer-guide/working-with-rules" target="_blank" rel="noopener">Working with Rules</a><br><a href="https://github.com/facebook/jscodeshift" target="_blank" rel="noopener">jscodeshift</a><br><a href="https://github.com/thx/gogocode" target="_blank" rel="noopener">GOGOCODE</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œä¸ºä¸€ä¸ªå‰ç«¯åˆ‡å›¾ä»”ï¼Œå·¥ä½œä¸­å°‘ä¸äº†ç”¨ä¸Š Babelï¼ŒESLintï¼ŒPrettier è¿™äº›å·¥å…·ï¼Œä½†æ˜¯è¿™äº›å·¥å…·èƒŒåçš„å·¥ä½œåŸç†å´ä¸æ±‚ç”šè§£ğŸ˜… &lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Babel" scheme="https://coldstone.fun/tags/Babel/"/>
    
      <category term="AST" scheme="https://coldstone.fun/tags/AST/"/>
    
      <category term="ESLint" scheme="https://coldstone.fun/tags/ESLint/"/>
    
  </entry>
  
  <entry>
    <title>JS æ£€æŸ¥å…ƒç´ æ˜¯å¦åœ¨è§†å£å†…</title>
    <link href="https://coldstone.fun/post/2021/04/13/js-check-element/"/>
    <id>https://coldstone.fun/post/2021/04/13/js-check-element/</id>
    <published>2021-04-13T02:50:51.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ†äº«ä¸¤ä¸ªç›‘æµ‹å…ƒç´ æ˜¯å¦åœ¨è§†å£å†…çš„æ–¹æ³•</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åˆ†äº«ä¸¤ä¸ªç›‘æµ‹å…ƒç´ æ˜¯å¦åœ¨è§†å£å†…çš„æ–¹æ³•</p><h2 id="1-ä½ç½®è®¡ç®—"><a href="#1-ä½ç½®è®¡ç®—" class="headerlink" title="1. ä½ç½®è®¡ç®—"></a>1. ä½ç½®è®¡ç®—</h2><ul><li>ä½¿ç”¨ <code>Element.getBoundingClientRect()</code> æ–¹æ³•è¿”å›å…ƒç´ ç›¸å¯¹äºè§†å£çš„ä½ç½®</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isElementVisible = <span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> rect = el.getBoundingClientRect();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>è·å–æµè§ˆå™¨çª—å£çš„å®½é«˜</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isElementVisible = <span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> rect = el.getBoundingClientRect();</span><br><span class="line">  <span class="keyword">const</span> vWidth = <span class="built_in">window</span>.innerWidth || <span class="built_in">document</span>.documentElement.clientWidth;</span><br><span class="line">  <span class="keyword">const</span> vHeight = <span class="built_in">window</span>.innerHeight || <span class="built_in">document</span>.documentElement.clientHeight;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨è§†å£å†…ï¼Œå¦‚å›¾æ‰€ç¤º</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2021/jpeg/224563/1618280613646-4e71c246-5d11-45cc-9fb4-b2da5c557249.jpeg#align=left&display=inline&height=600&margin=%5Bobject%20Object%5D&name=Xnip2021-04-13_10-23-24.jpg&originHeight=600&originWidth=800&size=333703&status=done&style=none&width=800" alt="Xnip2021-04-13_10-23-24.jpg"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isElementVisible = <span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> rect = el.getBoundingClientRect()</span><br><span class="line">  <span class="keyword">const</span> vWidth = <span class="built_in">window</span>.innerWidth || <span class="built_in">document</span>.documentElement.clientWidth</span><br><span class="line">  <span class="keyword">const</span> vHeight = <span class="built_in">window</span>.innerHeight || <span class="built_in">document</span>.documentElement.clientHeight</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    rect.right &lt; <span class="number">0</span> ||</span><br><span class="line">    rect.bottom &lt; <span class="number">0</span> ||</span><br><span class="line">    rect.left &gt; vWidth ||</span><br><span class="line">    rect.top &gt; vHeight</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>getBoundingClientRect</code> æ–¹æ³•ä¼šä½¿æµè§ˆå™¨å‘ç”Ÿå›æµå’Œé‡ç»˜ï¼Œæ€§èƒ½æ¶ˆè€—ç¨å¤§ï¼Œä½†å…¼å®¹æ€§æ¯” Intersection Observer è¦å¥½ã€‚</p><h2 id="2-Intersection-Observer"><a href="#2-Intersection-Observer" class="headerlink" title="2. Intersection Observer"></a>2. Intersection Observer</h2><blockquote><p>The Intersection Observer API provides a way to asynchronously observe changes in the intersection of a target element with an ancestor element or with a top-level documentâ€™s <a href="https://developer.mozilla.org/en-US/docs/Glossary/Viewport" target="_blank" rel="noopener">viewport</a>.</p></blockquote><p>Intersection Observer APIæä¾›äº†ä¸€ç§å¼‚æ­¥æ£€æµ‹ç›®æ ‡å…ƒç´ ä¸ç¥–å…ˆå…ƒç´ æˆ– <a href="https://developer.mozilla.org/en-US/docs/Glossary/Viewport" target="_blank" rel="noopener">viewport</a> ç›¸äº¤æƒ…å†µå˜åŒ–çš„æ–¹æ³•ã€‚åœ¨ç›®æ ‡å…ƒç´ ä¸è§†å£æˆ–è€…å…¶ä»–æŒ‡å®šå…ƒç´ å‘ç”Ÿäº¤é›†æ—¶å’Œè§¦å‘é…ç½®çš„å›è°ƒå‡½æ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–è¦ç›‘æµ‹çš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">const</span> boxes = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.box'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºè§‚å¯Ÿè€…ï¼Œé…ç½®å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment">// é€šè¿‡ isIntersecting å±æ€§åˆ¤æ–­å…ƒç´ ä¸è§†å£æ˜¯å¦ç›¸äº¤</span></span><br><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> IntersectionObserver(<span class="function">(<span class="params">entries, observer</span>) =&gt;</span> &#123;</span><br><span class="line"> entries.forEach(<span class="function">(<span class="params">entry</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(</span><br><span class="line">      entry.target,</span><br><span class="line">      entry.isIntersecting ? <span class="string">"visible"</span> : <span class="string">"invisible"</span></span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">boxes.forEach(<span class="function">(<span class="params">box</span>) =&gt;</span> &#123;</span><br><span class="line">  observer.observe(box);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p class="codepen" data-height="265" data-theme-id="dark" data-default-tab="js,result" data-user="xrr2016" data-slug-hash="ExZQOGL" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="js check element in viewport">  <span>See the Pen <a href="https://codepen.io/xrr2016/pen/ExZQOGL" target="_blank" rel="noopener">  js check element in viewport</a> by Cold Stone (<a href="https://codepen.io/xrr2016" target="_blank" rel="noopener">@xrr2016</a>)  on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</span></p><script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://dev.to/narendersaini32/how-to-check-an-element-is-in-viewport-4bcl" target="_blank" rel="noopener">how-to-check-an-element-is-in-viewport-4bcl</a></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API" target="_blank" rel="noopener">Intersection Observer API</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åˆ†äº«ä¸¤ä¸ªç›‘æµ‹å…ƒç´ æ˜¯å¦åœ¨è§†å£å†…çš„æ–¹æ³•&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="WEB" scheme="https://coldstone.fun/tags/WEB/"/>
    
      <category term="JS" scheme="https://coldstone.fun/tags/JS/"/>
    
      <category term="Viewport" scheme="https://coldstone.fun/tags/Viewport/"/>
    
  </entry>
  
  <entry>
    <title>JS æ–‡ä»¶è½¬æ¢</title>
    <link href="https://coldstone.fun/post/2021/04/01/js-file-transform/"/>
    <id>https://coldstone.fun/post/2021/04/01/js-file-transform/</id>
    <published>2021-04-01T09:52:22.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘éœ€è¦å°† base64 æ ¼å¼çš„å›¾ç‰‡è½¬åŒ–æˆ JS é‡Œçš„ File å¯¹è±¡è¿›è¡Œä¸Šä¼ ï¼Œäºæ˜¯å­¦ä¹ äº†ä¸€ä¸‹è¿™æ–¹é¢çš„çŸ¥è¯†</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘éœ€è¦å°† base64 æ ¼å¼çš„å›¾ç‰‡è½¬åŒ–æˆ JS é‡Œçš„ File å¯¹è±¡è¿›è¡Œä¸Šä¼ ï¼Œäºæ˜¯å­¦ä¹ äº†ä¸€ä¸‹è¿™æ–¹é¢çš„çŸ¥è¯†</p><h2 id="Base64-è½¬-Blob"><a href="#Base64-è½¬-Blob" class="headerlink" title="Base64 è½¬ Blob"></a>Base64 è½¬ Blob</h2><ol><li><p>åˆ†å‰² Base64 æ•°æ®ï¼Œç”Ÿæˆç±»æ–‡ä»¶å¯¹è±¡ï¼Œbase64 -&gt; Uint8Array -&gt; Blob</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dataURI2Blob</span>(<span class="params">dataURI</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ†å‰²æ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> [meta, data] = dataURI.split(<span class="string">','</span>)</span><br><span class="line">  <span class="comment">// å¯¹æ•°æ®ç¼–ç </span></span><br><span class="line">  <span class="keyword">let</span> byte</span><br><span class="line">  <span class="keyword">if</span> (meta.includes(<span class="string">'base64'</span>)) &#123;</span><br><span class="line">    byte = atob(data)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    byte = <span class="built_in">encodeURI</span>(data)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è·å–å›¾ç‰‡æ ¼å¼</span></span><br><span class="line">  <span class="keyword">const</span> mime = meta.split(<span class="string">':'</span>)[<span class="number">1</span>].split(<span class="string">';'</span>)[<span class="number">0</span>]</span><br><span class="line">  <span class="comment">// åˆ›å»º 8 ä½æ— ç¬¦å·æ•´å‹æ•°ç»„</span></span><br><span class="line">  <span class="keyword">const</span> ia = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(byte.length)</span><br><span class="line">  <span class="comment">// è·å–å­—ç¬¦ UTF-16 ç¼–ç å€¼</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; byte.length; i++) &#123;</span><br><span class="line">    ia[i] = byte.codePointAt(i)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç”Ÿæˆç±»æ–‡ä»¶å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Blob([ia], &#123; <span class="attr">type</span>: mime &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹“å±•ä¸€ä¸‹ç›´æ¥è½¬æˆ File å¯¹è±¡ä¹Ÿå¯ä»¥</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿæˆæ–‡ä»¶å¯¹è±¡</span></span><br><span class="line"><span class="keyword">new</span> File([ia], <span class="string">'test.jpg'</span>, &#123; <span class="attr">type</span>: mime &#125;)</span><br></pre></td></tr></table></figure></li><li><p>å–å·§çš„æ–¹æ³•ï¼Œåˆ©ç”¨ fetch </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">dataURI2Blob</span>(<span class="params">dataURI</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è¿”å› blob ç±»å‹çš„æ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> blob = <span class="keyword">await</span> fetch(dataURI).then(<span class="function">(<span class="params">res</span>) =&gt;</span> res.blob())</span><br><span class="line">  <span class="keyword">return</span> blob</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>ä¸ªäººå–œå¥½ç¬¬äºŒç§ï¼Œæ¯•ç«Ÿç®€æ´æ˜“æ‡‚ï¼Œä»£ç é‡ä¹Ÿå°‘å¾ˆå¤šã€‚ä¹‹åå°±å¯ä»¥è¿›è¡Œä¸Šä¼ æ–‡ä»¶çš„æ“ä½œäº†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fd = <span class="keyword">new</span> FormData();</span><br><span class="line">fd.append(<span class="string">"img"</span>, blob, <span class="string">"test.jpg"</span>);</span><br></pre></td></tr></table></figure><h2 id="Blob-è½¬-Base64"><a href="#Blob-è½¬-Base64" class="headerlink" title="Blob è½¬ Base64"></a>Blob è½¬ Base64</h2><p>ä½¿ç”¨ FileReader è¿›è¡Œåå‘è½¬æ¢ï¼ŒåŒç†å¯è½¬æ¢ File å¯¹è±¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blob2Base64</span>(<span class="params">blob, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader()</span><br><span class="line"></span><br><span class="line">  reader.addEventListener(<span class="string">'load'</span>, () =&gt; &#123;</span><br><span class="line">    callback(reader.result)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  reader.readAsDataURL(blob)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‹“å±•ä¸€ä¸‹"><a href="#æ‹“å±•ä¸€ä¸‹" class="headerlink" title="æ‹“å±•ä¸€ä¸‹"></a>æ‹“å±•ä¸€ä¸‹</h2><p>å°†è¿œç¨‹å›¾ç‰‡è½¬æ¢ä¸º Base64 æ ¼å¼ url -&gt;  Image -&gt; Canvas -&gt; Base64</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">remoteImageToBase64</span>(<span class="params">url, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> img = <span class="keyword">new</span> Image()</span><br><span class="line">  <span class="keyword">let</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>)</span><br><span class="line">  <span class="keyword">let</span> context = canvas.getContext(<span class="string">'2d'</span>)</span><br><span class="line"></span><br><span class="line">  img.addEventListener(<span class="string">'load'</span>, () =&gt; &#123;</span><br><span class="line">    canvas.width = img.width</span><br><span class="line">    canvas.height = img.height</span><br><span class="line">    context.drawImage(img, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å› Canvas çš„ base64 æ•°æ®</span></span><br><span class="line">    callback(canvas.toDataURL(<span class="string">'image/jpg'</span>, <span class="number">1</span>))</span><br><span class="line">    canvas = <span class="literal">null</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  img.src = url</span><br><span class="line">  <span class="comment">// å¤„ç† Canvas è·¨åŸŸ</span></span><br><span class="line">  img.crossOrigin = <span class="string">'Anonymous'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> remoteImageToBase64(<span class="string">'https://game.gtimg.cn/images/lol/act/img/skin/big145014.jpg'</span>, (res) =&gt; &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'base64: '</span>, res)</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ fetch è½¬ä¸º Blob ç±»å‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">remoteImageToBlob</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">const</span> blob = <span class="keyword">await</span> fetch(url).then(<span class="function">(<span class="params">res</span>) =&gt;</span> res.blob())</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">return</span> blob</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="string">`</span></span><br></pre></td></tr></table></figure><p>å®Œ</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘éœ€è¦å°† base64 æ ¼å¼çš„å›¾ç‰‡è½¬åŒ–æˆ JS é‡Œçš„ File å¯¹è±¡è¿›è¡Œä¸Šä¼ ï¼Œäºæ˜¯å­¦ä¹ äº†ä¸€ä¸‹è¿™æ–¹é¢çš„çŸ¥è¯†&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="WEB" scheme="https://coldstone.fun/tags/WEB/"/>
    
      <category term="File" scheme="https://coldstone.fun/tags/File/"/>
    
      <category term="Blob" scheme="https://coldstone.fun/tags/Blob/"/>
    
      <category term="Base64" scheme="https://coldstone.fun/tags/Base64/"/>
    
  </entry>
  
  <entry>
    <title>ç”»ä¸€é¢—åœ£è¯æ ‘ğŸ„</title>
    <link href="https://coldstone.fun/post/2020/12/23/christmas-tree/"/>
    <id>https://coldstone.fun/post/2020/12/23/christmas-tree/</id>
    <published>2020-12-23T00:49:20.000Z</published>
    <updated>2021-06-28T09:25:25.301Z</updated>
    
    <content type="html"><![CDATA[<p>JUST FOR FUN</p><a id="more"></a><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><p>æ–°å»ºé¡µé¢ï¼Œæ·»åŠ ä¸€ä¸ª <code>canvas</code> å…ƒç´ ï¼Œå¼•å…¥ css, js æ–‡ä»¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Christmas Tree<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"style.css"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"tree"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./index.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">canvas</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fefdfd</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CANVAS_WIDTH = <span class="number">360</span></span><br><span class="line"><span class="keyword">const</span> CANVAS_HEIGHT = <span class="number">620</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initCanvas</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id)</span><br><span class="line">  canvas.width = CANVAS_WIDTH</span><br><span class="line">  canvas.height = CANVAS_HEIGHT</span><br><span class="line">  <span class="keyword">return</span> canvas</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = initCanvas(<span class="string">'tree'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, main)</span><br></pre></td></tr></table></figure><h2 id="ç”»æ ‘æ"><a href="#ç”»æ ‘æ" class="headerlink" title="ç”»æ ‘æ"></a>ç”»æ ‘æ</h2><p>ä½¿ç”¨ <code>stroke</code> æ–¹æ³•ç»˜åˆ¶æ ‘æï¼Œè®¾ç½®æ—‹è½¬è§’åº¦ç»˜åˆ¶å·¦å³å­æ ‘ï¼Œä¿å­˜çŠ¶æ€ï¼Œé€’å½’ç»˜åˆ¶å­æ ‘ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = initCanvas(<span class="string">'tree'</span>)</span><br><span class="line">  <span class="comment">// æ ‘çš„èµ·å§‹ä½ç½®</span></span><br><span class="line">  <span class="keyword">const</span> location = [CANVAS_WIDTH * <span class="number">0.5</span>, CANVAS_HEIGHT]</span><br><span class="line"></span><br><span class="line">  drawBranches(canvas, location, <span class="number">0</span>, <span class="number">100</span>, <span class="number">20</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * canvas       ç”»å¸ƒ</span></span><br><span class="line"><span class="comment"> * start        èµ·å§‹ä½ç½®</span></span><br><span class="line"><span class="comment"> * angle        æ—‹è½¬è§’åº¦</span></span><br><span class="line"><span class="comment"> * branchHeight æ ‘æé•¿åº¦</span></span><br><span class="line"><span class="comment"> * branchWidth  æ ‘æå®½åº¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawBranches</span>(<span class="params">canvas, start, angle, branchHeight, branchWidth</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ctx = canvas.getContext(<span class="string">'2d'</span>)</span><br><span class="line">  ctx.save()</span><br><span class="line">  ctx.beginPath()</span><br><span class="line">  <span class="comment">// å°†ç”»å¸ƒåŸç‚¹ç§»åŠ¨åˆ°èµ·å§‹ä½ç½®</span></span><br><span class="line">  ctx.translate(...start)</span><br><span class="line">  <span class="comment">// è®¾ç½®ç»˜åˆ¶é¢œè‰²</span></span><br><span class="line">  ctx.strokeStyle = <span class="string">'#333'</span></span><br><span class="line">  <span class="comment">// è®¾ç½®ç»˜åˆ¶å®½åº¦</span></span><br><span class="line">  ctx.lineWidth = branchWidth</span><br><span class="line">  <span class="comment">// è®¾ç½®æ—‹è½¬è§’åº¦</span></span><br><span class="line">  ctx.rotate((angle * <span class="built_in">Math</span>.PI) / <span class="number">180</span>)</span><br><span class="line"></span><br><span class="line">  ctx.moveTo(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">  ctx.lineTo(<span class="number">0</span>, -branchHeight)</span><br><span class="line">  ctx.stroke()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (branchHeight &gt; <span class="number">6</span>) &#123;</span><br><span class="line">    <span class="comment">// ç»˜åˆ¶å³å­æ ‘</span></span><br><span class="line">    drawBranches(canvas, [<span class="number">0</span>, -branchHeight], <span class="number">35</span>, branchHeight * <span class="number">0.5</span>, branchWidth * <span class="number">0.7</span>)</span><br><span class="line">    <span class="comment">// ç»˜åˆ¶å·¦å­æ ‘</span></span><br><span class="line">    drawBranches(canvas, [<span class="number">0</span>, -branchHeight], <span class="number">-35</span>, branchHeight * <span class="number">0.5</span>, branchWidth * <span class="number">0.7</span>)</span><br><span class="line">    <span class="comment">// ç»˜åˆ¶ä¸­é—´çš„æ ‘å¹²</span></span><br><span class="line">    drawBranches(canvas, [<span class="number">0</span>, -branchHeight], <span class="number">0</span>, branchHeight * <span class="number">0.8</span>, branchWidth * <span class="number">0.7</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ctx.restore()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/png/224563/1608733907096-e7ccfbf1-8ad5-408d-a011-ce128ffef243.png#align=left&display=inline&height=660&margin=%5Bobject%20Object%5D&name=branch.png&originHeight=1320&originWidth=840&size=257047&status=done&style=none&width=420" alt="branch.png"></p><h2 id="ç”»æ ‘å¶"><a href="#ç”»æ ‘å¶" class="headerlink" title="ç”»æ ‘å¶"></a>ç”»æ ‘å¶</h2><p>è·å–ç”»å¸ƒæ‰€æœ‰åƒç´ ç‚¹ <code>alpha</code> é€šé“å€¼ï¼Œåˆ¤æ–­æ­¤å¤„æ˜¯å¦æœ‰å›¾åƒï¼Œå¾ªç¯åƒç´ ç‚¹æ•°ç»„ç»˜åˆ¶åŠåœ†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = initCanvas(<span class="string">'tree'</span>)</span><br><span class="line">  <span class="keyword">const</span> location = [CANVAS_WIDTH * <span class="number">0.5</span>, CANVAS_HEIGHT]</span><br><span class="line"></span><br><span class="line">  drawBranches(canvas, location, <span class="number">0</span>, <span class="number">100</span>, <span class="number">20</span>)</span><br><span class="line">  drawLeaves(canvas)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ä¸€ä¸ªæ•°ç»„ä¿å­˜ç»˜åˆ¶æ ‘çš„åƒç´ ç‚¹</span></span><br><span class="line"><span class="keyword">const</span> branchPixels = []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawLeaves</span>(<span class="params">canvas</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ctx = canvas.getContext(<span class="string">'2d'</span>)</span><br><span class="line">  <span class="comment">// è·å–ç”»å¸ƒåƒç´ æ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> imageData = ctx.getImageData(<span class="number">0</span>, <span class="number">0</span>, CANVAS_WIDTH, CANVAS_HEIGHT)</span><br><span class="line">  <span class="keyword">const</span> data = imageData.data</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> y = <span class="number">0</span>; y &lt; CANVAS_HEIGHT; y++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> x = <span class="number">0</span>; x &lt; CANVAS_WIDTH; x++) &#123;</span><br><span class="line">      <span class="comment">// è·å–åƒç´ ç‚¹ alpha é€šé“å€¼</span></span><br><span class="line">      <span class="keyword">const</span> alpha = data[<span class="number">4</span> * (y * CANVAS_WIDTH + x) + <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœ alpha å€¼å¤§äº 0 è¯´æ˜è¿™ä¸ªä½ç½®æœ‰å›¾åƒï¼›æ’é™¤åŸºç¡€æ ‘å¹²çš„åƒç´ ç‚¹ï¼›</span></span><br><span class="line">      <span class="keyword">if</span> (alpha &gt; <span class="number">0</span> &amp;&amp; y &lt; CANVAS_HEIGHT - <span class="number">100</span>) &#123;</span><br><span class="line">        branchPixels.push([x, y])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; branchPixels.length; i++) &#123;</span><br><span class="line">    <span class="comment">// å‡å°‘ç»˜åˆ¶å‡ ç‡</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.3</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> loc = branchPixels[i]</span><br><span class="line">      loc[<span class="number">0</span>] += (<span class="built_in">Math</span>.random() - <span class="number">0.5</span>) * <span class="number">5</span></span><br><span class="line">      loc[<span class="number">1</span>] += (<span class="built_in">Math</span>.random() - <span class="number">0.5</span>) * <span class="number">5</span></span><br><span class="line">      <span class="comment">// è®¾ç½®ç»˜åˆ¶é¢œè‰²ï¼Œè¶Šå¾€å¤–é¢œè‰²è¶Šæµ…</span></span><br><span class="line">      <span class="keyword">const</span> green = (<span class="number">255</span> * (CANVAS_HEIGHT - loc[<span class="number">1</span>])) / CANVAS_HEIGHT</span><br><span class="line"></span><br><span class="line">      ctx.save()</span><br><span class="line">      ctx.beginPath()</span><br><span class="line">      ctx.translate(...loc)</span><br><span class="line">      ctx.rotate(<span class="built_in">Math</span>.random() * <span class="built_in">Math</span>.PI * <span class="number">2</span>)</span><br><span class="line">      ctx.fillStyle = <span class="string">`rgba(0, <span class="subst">$&#123;green&#125;</span>, 0, .2)`</span></span><br><span class="line">      <span class="comment">// ç»˜åˆ¶åŠåœ†</span></span><br><span class="line">      ctx.arc(<span class="number">0</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI)</span><br><span class="line">      ctx.fill()</span><br><span class="line">      ctx.restore()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/png/224563/1608734737527-08917a38-0a45-496d-9ec9-de9309fbfca0.png#align=left&display=inline&height=660&margin=%5Bobject%20Object%5D&name=leaves.png&originHeight=1320&originWidth=840&size=480606&status=done&style=none&width=420" alt="leaves.png"></p><h2 id="ç”»ç¤¼ç‰©"><a href="#ç”»ç¤¼ç‰©" class="headerlink" title="ç”»ç¤¼ç‰©"></a>ç”»ç¤¼ç‰©</h2><p>ä½¿ç”¨ <code>fillText</code> å’Œ <code>drawImage</code> æ–¹æ³•ç»˜åˆ¶æ–‡å­—å’Œå›¾ç‰‡ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = initCanvas(<span class="string">'tree'</span>)</span><br><span class="line">  <span class="keyword">const</span> location = [CANVAS_WIDTH * <span class="number">0.5</span>, CANVAS_HEIGHT]</span><br><span class="line"></span><br><span class="line">  drawBranches(canvas, location, <span class="number">0</span>, <span class="number">100</span>, <span class="number">20</span>)</span><br><span class="line">  drawLeaves(canvas)</span><br><span class="line">  drawGifts(canvas)</span><br><span class="line">  drawStar(canvas)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> gifts = [<span class="string">'ğŸ'</span>, <span class="string">'ğŸ'</span>, <span class="string">'ğŸ­'</span>, <span class="string">'ğŸ¬'</span>, <span class="string">'ğŸˆ'</span>, <span class="string">'ğŸ§¸'</span>, <span class="string">'ğŸ””'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawGifts</span>(<span class="params">canvas</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ctx = canvas.getContext(<span class="string">'2d'</span>)</span><br><span class="line"></span><br><span class="line">  ctx.save()</span><br><span class="line">  ctx.font = <span class="string">'1.5rem sans-serif'</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// ä»æ ‘çš„åƒç´ ç‚¹æ•°ç»„ä¸­éšæœºè·å–ä½ç½®</span></span><br><span class="line">    <span class="keyword">const</span> location = branchPixels[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * branchPixels.length)]</span><br><span class="line">    <span class="keyword">const</span> gift = gifts[i % gifts.length]</span><br><span class="line"></span><br><span class="line">    ctx.fillText(gift, ...location)</span><br><span class="line">  &#125;</span><br><span class="line">  ctx.restore()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> image = <span class="keyword">new</span> Image(<span class="number">500</span>, <span class="number">500</span>)</span><br><span class="line">image.src = <span class="string">'star.png'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawStar</span>(<span class="params">canvas</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> size = <span class="number">50</span></span><br><span class="line">  <span class="keyword">const</span> ctx = canvas.getContext(<span class="string">'2d'</span>)</span><br><span class="line">  <span class="keyword">const</span> loc = [CANVAS_WIDTH * <span class="number">0.5</span> - size / <span class="number">2</span>, <span class="number">80</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç»˜åˆ¶å›¾ç‰‡</span></span><br><span class="line">  ctx.drawImage(image, ...loc, size, size)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="./images/christmas-tree/tree.png" alt="cover"></p><p>JUST FOR FUN</p><p><a href="https://github.com/xrr2016/christmas-tree" target="_blank" rel="noopener">æºç </a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;JUST FOR FUN&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Canvas" scheme="https://coldstone.fun/tags/Canvas/"/>
    
  </entry>
  
  <entry>
    <title>Slate ä»‹ç»åˆ†æä¸å®è·µ</title>
    <link href="https://coldstone.fun/post/2020/12/13/slate-intro/"/>
    <id>https://coldstone.fun/post/2020/12/13/slate-intro/</id>
    <published>2020-12-13T14:21:01.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>Slate æ˜¯ä¸€ä¸ªä½¿ç”¨ TypeScript å¼€å‘å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å¼€å‘æ¡†æ¶ï¼Œè¯ç”Ÿäº 2016 å¹´ã€‚</p><a id="more"></a><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p><a href="https://github.com/ianstormtaylor/slate" target="_blank" rel="noopener">Slate</a> æ˜¯ä¸€ä¸ªä½¿ç”¨ TypeScript å¼€å‘å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å¼€å‘æ¡†æ¶ï¼Œè¯ç”Ÿäº 2016 å¹´ï¼Œä½œè€…æ˜¯ <a href="https://github.com/ianstormtaylor" target="_blank" rel="noopener">Ian Storm Taylor</a>ã€‚å®ƒå¸æ”¶äº† <a href="https://quilljs.com/" target="_blank" rel="noopener">Quill</a>ï¼Œ<a href="http://prosemirror.net/" target="_blank" rel="noopener">Prosemirror</a>ï¼Œ<a href="https://facebook.github.io/draft-js/" target="_blank" rel="noopener">Draft.js</a> çš„ä¼˜ç‚¹ï¼Œæ ¸å¿ƒæ•°æ®æ¨¡å‹ååˆ†ç²¾ç®€ï¼Œå…·æœ‰é«˜åº¦çš„å¯æ‰©å±•æ€§ï¼Œæœ€æ–°ç‰ˆæœ¬ä¸º <a href="https://github.com/ianstormtaylor/slate/releases/tag/v0.60.1" target="_blank" rel="noopener">v0.60.1</a>ã€‚</p><h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><ul><li>æ’ä»¶ä½œä¸ºä¸€ç­‰å…¬æ°‘ï¼Œèƒ½å¤Ÿå®Œå…¨ä¿®æ”¹ç¼–è¾‘å™¨è¡Œä¸º</li><li>æ•°æ®å±‚å’Œæ¸²æŸ“å±‚åˆ†ç¦»ï¼Œæ›´æ–°æ•°æ®è§¦å‘æ¸²æŸ“</li><li>æ–‡æ¡£æ•°æ®ç±»ä¼¼äº DOM æ ‘ï¼Œå¯åµŒå¥—</li><li>å…·æœ‰åŸå­åŒ–æ“ä½œ APIï¼Œç†è®ºä¸Šæ”¯æŒååŒç¼–è¾‘</li><li>ä½¿ç”¨ React ä½œä¸ºæ¸²æŸ“å±‚</li><li>ä¸å¯å˜æ•°æ®ç»“æ„ <a href="https://github.com/immerjs/immer" target="_blank" rel="noopener">Immer</a></li></ul><h2 id="æ¶æ„å›¾"><a href="#æ¶æ„å›¾" class="headerlink" title="æ¶æ„å›¾"></a>æ¶æ„å›¾</h2><p><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/224563/1607834865765-972840cc-33fc-4434-8e84-1707f162256a.jpeg#align=left&display=inline&height=629&margin=%5Bobject%20Object%5D&name=slate.jpg&originHeight=629&originWidth=764&size=45676&status=done&style=none&width=764" alt="slate.jpg"></p><h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><p>Slate ä½¿ç”¨ monorepo æ–¹å¼ç®¡ç†ä»“åº“ï¼Œpackages ç›®å½•ä¸­æœ‰ 4 ä¸ªæºç åŒ…ã€‚</p><h3 id="slate"><a href="#slate" class="headerlink" title="slate"></a>slate</h3><p><a href="https://github.com/ianstormtaylor/slate/tree/main/packages/slate" target="_blank" rel="noopener">slate</a> æ ¸å¿ƒä»“åº“ï¼ŒåŒ…å«æŠ½è±¡æ•°æ®æ¨¡å‹ interfacesï¼Œæ“ä½œèŠ‚ç‚¹çš„æ–¹æ³• transformsï¼Œåˆ›å»ºå®ä¾‹çš„æ–¹æ³•ç­‰ã€‚</p><h4 id="Interfaces"><a href="#Interfaces" class="headerlink" title="Interfaces"></a>Interfaces</h4><p>intefaces ç›®å½•ä¸‹æ˜¯ Slate å®šä¹‰çš„æ•°æ®æ¨¡å‹ã€‚</p><p><code>Node</code> è¡¨ç¤º Slate æ–‡æ¡£æ ‘ä¸­ä¸åŒç±»å‹çš„èŠ‚ç‚¹ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> BaseNode = Editor | Element | Text</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> Descendant = Element | Text</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> Ancestor = Editor | Element</span><br></pre></td></tr></table></figure><p><code>Editor</code>  å¯¹è±¡ç”¨äºå­˜å‚¨ç¼–è¾‘å™¨çš„æ‰€æœ‰çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡æ’ä»¶æ·»åŠ è¾…åŠ©å‡½æ•°æˆ–å®ç°æ–°è¡Œä¸ºã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> BaseEditor &#123;</span><br><span class="line">  children: Descendant[]</span><br><span class="line">  selection: Selection</span><br><span class="line">  operations: Operation[]</span><br><span class="line">  marks: Omit&lt;Text, <span class="string">'text'</span>&gt; | <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Element</code> å¯¹è±¡æ˜¯ Slate æ–‡æ¡£æ ‘ä¸­åŒ…å«å…¶ä»– <code>Element</code> æˆ– <code>Text</code> çš„ä¸€ç§èŠ‚ç‚¹ï¼Œå–å†³äºç¼–è¾‘å™¨é…ç½®å®ƒå¯ä»¥æ˜¯å—çº§ <code>block</code> æˆ–å†…è” <code>inline</code> çš„ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ElementInterface &#123;</span><br><span class="line">  isAncestor: <span class="function">(<span class="params">value: <span class="built_in">any</span></span>) =&gt;</span> value is Ancestor</span><br><span class="line">  isElement: <span class="function">(<span class="params">value: <span class="built_in">any</span></span>) =&gt;</span> value is Element</span><br><span class="line">  isElementList: <span class="function">(<span class="params">value: <span class="built_in">any</span></span>) =&gt;</span> value is Element[]</span><br><span class="line">  isElementProps: <span class="function">(<span class="params">props: <span class="built_in">any</span></span>) =&gt;</span> props is Partial&lt;Element&gt;</span><br><span class="line">  matches: <span class="function">(<span class="params">element: Element, props: Partial&lt;Element&gt;</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Text</code> å¯¹è±¡è¡¨ç¤ºæ–‡æ¡£æ ‘ä¸­çš„å¶å­èŠ‚ç‚¹ï¼Œæ˜¯å®é™…åŒ…å«æ–‡æœ¬å’Œæ ¼å¼çš„èŠ‚ç‚¹ï¼Œå®ƒä»¬ä¸èƒ½åŒ…å«å…¶ä»–èŠ‚ç‚¹ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> TextInterface &#123;</span><br><span class="line">  equals: <span class="function">(<span class="params">text: Text, another: Text, options?: &#123; loose?: <span class="built_in">boolean</span> &#125;</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  isText: <span class="function">(<span class="params">value: <span class="built_in">any</span></span>) =&gt;</span> value is Text</span><br><span class="line">  isTextList: <span class="function">(<span class="params">value: <span class="built_in">any</span></span>) =&gt;</span> value is Text[]</span><br><span class="line">  isTextProps: <span class="function">(<span class="params">props: <span class="built_in">any</span></span>) =&gt;</span> props is Partial&lt;Text&gt;</span><br><span class="line">  matches: <span class="function">(<span class="params">text: Text, props: Partial&lt;Text&gt;</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  decorations: <span class="function">(<span class="params">node: Text, decorations: Range[]</span>) =&gt;</span> Text[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Path</code> æ˜¯ä¸€ä¸ªæè¿°èŠ‚ç‚¹åœ¨æ–‡æ¡£æ ‘ä¸­çš„å…·ä½“ä½ç½®çš„ç´¢å¼•åˆ—è¡¨ï¼Œä¸€èˆ¬ç›¸å¯¹äº <code>Editor</code> èŠ‚ç‚¹ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯å…¶ä»– <code>Node</code> èŠ‚ç‚¹ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> PathInterface &#123;</span><br><span class="line">  ancestors: <span class="function">(<span class="params">path: Path, options?: &#123; reverse?: <span class="built_in">boolean</span> &#125;</span>) =&gt;</span> Path[]</span><br><span class="line">  common: <span class="function">(<span class="params">path: Path, another: Path</span>) =&gt;</span> Path</span><br><span class="line">  compare: <span class="function">(<span class="params">path: Path, another: Path</span>) =&gt;</span> <span class="number">-1</span> | <span class="number">0</span> | <span class="number">1</span></span><br><span class="line">  endsAfter: <span class="function">(<span class="params">path: Path, another: Path</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  endsAt: <span class="function">(<span class="params">path: Path, another: Path</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  endsBefore: <span class="function">(<span class="params">path: Path, another: Path</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  equals: <span class="function">(<span class="params">path: Path, another: Path</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  hasPrevious: <span class="function">(<span class="params">path: Path</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  isAfter: <span class="function">(<span class="params">path: Path, another: Path</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  isAncestor: <span class="function">(<span class="params">path: Path, another: Path</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  isBefore: <span class="function">(<span class="params">path: Path, another: Path</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  isChild: <span class="function">(<span class="params">path: Path, another: Path</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  isCommon: <span class="function">(<span class="params">path: Path, another: Path</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  isDescendant: <span class="function">(<span class="params">path: Path, another: Path</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  isParent: <span class="function">(<span class="params">path: Path, another: Path</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  isPath: <span class="function">(<span class="params">value: <span class="built_in">any</span></span>) =&gt;</span> value is Path</span><br><span class="line">  isSibling: <span class="function">(<span class="params">path: Path, another: Path</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  levels: (</span><br><span class="line">    path: Path,</span><br><span class="line">    options?: &#123;</span><br><span class="line">      reverse?: <span class="built_in">boolean</span></span><br><span class="line">    &#125;</span><br><span class="line">  ) =&gt; Path[]</span><br><span class="line">  next: <span class="function">(<span class="params">path: Path</span>) =&gt;</span> Path</span><br><span class="line">  parent: <span class="function">(<span class="params">path: Path</span>) =&gt;</span> Path</span><br><span class="line">  previous: <span class="function">(<span class="params">path: Path</span>) =&gt;</span> Path</span><br><span class="line">  relative: <span class="function">(<span class="params">path: Path, ancestor: Path</span>) =&gt;</span> Path</span><br><span class="line">  transform: (</span><br><span class="line">    path: Path,</span><br><span class="line">    operation: Operation,</span><br><span class="line">    options?: &#123; affinity?: <span class="string">'forward'</span> | <span class="string">'backward'</span> | <span class="literal">null</span> &#125;</span><br><span class="line">  ) =&gt; Path | <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Point</code> å¯¹è±¡è¡¨ç¤ºæ–‡æœ¬èŠ‚ç‚¹åœ¨æ–‡æ¡£æ ‘ä¸­çš„ä¸€ä¸ªç‰¹å®šä½ç½®ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> PointInterface &#123;</span><br><span class="line">  compare: <span class="function">(<span class="params">point: Point, another: Point</span>) =&gt;</span> <span class="number">-1</span> | <span class="number">0</span> | <span class="number">1</span></span><br><span class="line">  isAfter: <span class="function">(<span class="params">point: Point, another: Point</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  isBefore: <span class="function">(<span class="params">point: Point, another: Point</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  equals: <span class="function">(<span class="params">point: Point, another: Point</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  isPoint: <span class="function">(<span class="params">value: <span class="built_in">any</span></span>) =&gt;</span> value is Point</span><br><span class="line">  transform: (</span><br><span class="line">    point: Point,</span><br><span class="line">    op: Operation,</span><br><span class="line">    options?: &#123; affinity?: <span class="string">'forward'</span> | <span class="string">'backward'</span> | <span class="literal">null</span> &#125;</span><br><span class="line">  ) =&gt; Point | <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Operation</code> å¯¹è±¡æ˜¯ Slate ç”¨æ¥æ›´æ”¹å†…éƒ¨çŠ¶æ€çš„ä½çº§æŒ‡ä»¤ï¼ŒSlate å°†æ‰€æœ‰å˜åŒ–è¡¨ç¤ºä¸º <code>Operation</code> ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> OperationInterface &#123;</span><br><span class="line">  isNodeOperation: <span class="function">(<span class="params">value: <span class="built_in">any</span></span>) =&gt;</span> value is NodeOperation</span><br><span class="line">  isOperation: <span class="function">(<span class="params">value: <span class="built_in">any</span></span>) =&gt;</span> value is Operation</span><br><span class="line">  isOperationList: <span class="function">(<span class="params">value: <span class="built_in">any</span></span>) =&gt;</span> value is Operation[]</span><br><span class="line">  isSelectionOperation: <span class="function">(<span class="params">value: <span class="built_in">any</span></span>) =&gt;</span> value is SelectionOperation</span><br><span class="line">  isTextOperation: <span class="function">(<span class="params">value: <span class="built_in">any</span></span>) =&gt;</span> value is TextOperation</span><br><span class="line">  inverse: <span class="function">(<span class="params">op: Operation</span>) =&gt;</span> Operation</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Transforms"><a href="#Transforms" class="headerlink" title="Transforms"></a>Transforms</h4><p><code>Transforms</code>  æ˜¯å¯¹æ–‡æ¡£è¿›è¡Œæ“ä½œçš„è¾…åŠ©å‡½æ•°ï¼ŒåŒ…æ‹¬é€‰åŒºè½¬æ¢ï¼ŒèŠ‚ç‚¹è½¬æ¢ï¼Œæ–‡æœ¬è½¬æ¢å’Œé€šç”¨è½¬æ¢ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Transforms = &#123;</span><br><span class="line">  ...GeneralTransforms, <span class="comment">// æ“ä½œ Operation å‘½ä»¤</span></span><br><span class="line">  ...NodeTransforms, <span class="comment">// æ“ä½œèŠ‚ç‚¹</span></span><br><span class="line">  ...SelectionTransforms, <span class="comment">// æ“ä½œé€‰åŒº</span></span><br><span class="line">  ...TextTransforms, <span class="comment">// æ“ä½œæ–‡æœ¬</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="createEditor"><a href="#createEditor" class="headerlink" title="createEditor"></a>createEditor</h4><p>åˆ›å»ºç¼–è¾‘å™¨å®ä¾‹çš„æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªå®ç°äº† <code>Editor</code> æ¥å£çš„ç¼–è¾‘å™¨å®ä¾‹å¯¹è±¡ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// create-editor.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createEditor = (): <span class="function"><span class="params">Editor</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> editor: Editor = &#123;&#125;</span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">  <span class="keyword">return</span> editor</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="slate-react"><a href="#slate-react" class="headerlink" title="slate-react"></a>slate-react</h3><p><a href="https://github.com/ianstormtaylor/slate/tree/main/packages/slate-react" target="_blank" rel="noopener">slate-react</a> ç¼–è¾‘å™¨çš„ React ç»„ä»¶ï¼Œæ¸²æŸ“æ–‡æ¡£æ•°æ®ã€‚</p><h4 id="Slate"><a href="#Slate" class="headerlink" title="Slate"></a>Slate</h4><p>ç»„ä»¶ä¸Šä¸‹æ–‡çš„åŒ…è£…å™¨ï¼Œå¤„ç† <code>onChange</code> äº‹ä»¶ï¼Œæ¥å—æ–‡æ¡£æ•°æ® <code>value</code>ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Slate.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Slate = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;SlateContext.Provider value=&#123;context&#125;&gt;</span><br><span class="line">      &lt;EditorContext.Provider value=&#123;editor&#125;&gt;</span><br><span class="line">        &lt;FocusedContext.Provider value=&#123;ReactEditor.isFocused(editor)&#125;&gt;</span><br><span class="line">          &#123;children&#125;</span><br><span class="line">        &lt;<span class="regexp">/FocusedContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>EditorContext.Provider&gt;</span><br><span class="line">    &lt;<span class="regexp">/SlateContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="Editable"><a href="#Editable" class="headerlink" title="Editable"></a>Editable</h4><p>ç¼–è¾‘å™¨çš„ä¸»è¦åŒºåŸŸï¼Œè®¾ç½®æ ‡ç­¾å±æ€§ï¼Œå¤„ç† DOM äº‹ä»¶ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Editable.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Editable = <span class="function">(<span class="params">props: EditableProps</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ReadOnlyContext.Provider value=&#123;readOnly&#125;&gt;</span><br><span class="line">      &lt;Component&gt;</span><br><span class="line">        &lt;Children /&gt;</span><br><span class="line">      &lt;<span class="regexp">/Component&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>ReadOnlyContext.Provider&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Children"><a href="#Children" class="headerlink" title="Children"></a>Children</h4><p>æ ¹æ®ç¼–è¾‘å™¨æ–‡æ¡£æ•°æ®ç”Ÿæˆæ¸²æŸ“ç»„ä»¶ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Children.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Children = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> children = []</span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">  <span class="keyword">return</span> &lt;React.Fragment&gt;&#123;children&#125;&lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="Element"><a href="#Element" class="headerlink" title="Element"></a>Element</h4><p>æ¸²æŸ“ <code>Elment</code> çš„ç»„ä»¶ï¼Œä½¿ç”¨ <code>renderElement</code> æ–¹æ³•æ¸²æŸ“å…ƒç´ ï¼Œä½¿ç”¨ <code>Children</code> ç»„ä»¶ç”Ÿæˆå­å…ƒç´ ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Element.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Element = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;SelectedContext.Provider value=&#123;!!selection&#125;&gt;</span><br><span class="line">      &#123;renderElement(&#123; attributes, children, element &#125;)&#125;</span><br><span class="line">    &lt;<span class="regexp">/SelectedContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h4><p>æ¸²æŸ“æ–‡æœ¬èŠ‚ç‚¹ç»„ä»¶ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Text.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Text = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;span data-slate-node=<span class="string">"text"</span> ref=&#123;ref&#125;&gt;</span><br><span class="line">      &#123;children&#125;</span><br><span class="line">    &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="withReact"><a href="#withReact" class="headerlink" title="withReact"></a>withReact</h4><p>Slate æ’ä»¶ï¼Œæ·»åŠ /é‡å†™äº†ç¼–è¾‘å™¨å®ä¾‹çš„ä¸€äº›æ–¹æ³•ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// with-react.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withReact = &lt;T <span class="keyword">extends</span> Editor&gt;<span class="function">(<span class="params">editor: T</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> e = editor <span class="keyword">as</span> T &amp; ReactEditor</span><br><span class="line">  <span class="keyword">const</span> &#123; apply, onChange &#125; = e</span><br><span class="line"></span><br><span class="line">  e.apply = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">  e.setFragmentData = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">  e.insertData = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">  e.onChange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> e</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="slate-history"><a href="#slate-history" class="headerlink" title="slate-history"></a>slate-history</h3><p><a href="https://github.com/ianstormtaylor/slate/tree/main/packages/slate-history" target="_blank" rel="noopener">slate-history</a> Slate æ’ä»¶ï¼Œä¸ºç¼–è¾‘å™¨æä¾› <strong>æ’¤é”€ **å’Œ</strong> é‡åš**åŠŸèƒ½ã€‚</p><h4 id="History"><a href="#History" class="headerlink" title="History"></a>History</h4><p>ä½¿ç”¨ <code>redos</code> å’Œ <code>undos</code> æ•°ç»„å­˜å‚¨ç¼–è¾‘å™¨æ‰€æœ‰åº•å±‚ <code>Operation</code> å‘½ä»¤çš„å¯¹è±¡ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// History.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> History &#123;</span><br><span class="line">  redos: Operation[][]</span><br><span class="line">  undos: Operation[][]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="HistoryEditor"><a href="#HistoryEditor" class="headerlink" title="HistoryEditor"></a>HistoryEditor</h4><p>å¸¦æœ‰å†å²è®°å½•åŠŸèƒ½çš„ç¼–è¾‘å™¨å¯¹è±¡ï¼Œå…·æœ‰æ“ä½œå†å²è®°å½•çš„æ–¹æ³•ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// HistoryEditor.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HistoryEditor = &#123;</span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="withHistory"><a href="#withHistory" class="headerlink" title="withHistory"></a>withHistory</h4><p>Slate ç¼–è¾‘å™¨æ’ä»¶ï¼Œä½¿ç”¨ <code>undos</code> å’Œ <code>redos</code> æ ˆè¿½è¸ªç¼–è¾‘å™¨æ“ä½œï¼Œå®ç°ç¼–è¾‘å™¨çš„ <code>redo</code>ï¼Œ<code>undo</code> æ–¹æ³•ï¼Œé‡å†™äº†<code>apply</code> æ–¹æ³•ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// with-history.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withHistory = &lt;T <span class="keyword">extends</span> Editor&gt;<span class="function">(<span class="params">editor: T</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> e = editor <span class="keyword">as</span> T &amp; HistoryEditor</span><br><span class="line">  <span class="keyword">const</span> &#123; apply &#125; = e</span><br><span class="line">  e.history = &#123; undos: [], redos: [] &#125;</span><br><span class="line"></span><br><span class="line">  e.redo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  e.undo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  e.apply = <span class="function">(<span class="params">op: Operation</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> e</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="slate-hyperscript"><a href="#slate-hyperscript" class="headerlink" title="slate-hyperscript"></a>slate-hyperscript</h3><p><a href="https://github.com/ianstormtaylor/slate/tree/main/packages/slate-hyperscript" target="_blank" rel="noopener">slate-hyperscript</a> æ˜¯ä¸€ä¸ªä½¿ç”¨  JSX  ç¼–å†™  Slate  æ–‡æ¡£çš„  hyperscript  å·¥å…·</p><h2 id="æ’ä»¶æœºåˆ¶"><a href="#æ’ä»¶æœºåˆ¶" class="headerlink" title="æ’ä»¶æœºåˆ¶"></a>æ’ä»¶æœºåˆ¶</h2><p>Slate çš„æ’ä»¶åªæ˜¯ä¸€ä¸ªè¿”å› <code>editor</code> å®ä¾‹çš„å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­é€šè¿‡é‡å†™ç¼–è¾‘å™¨å®ä¾‹æ–¹æ³•ï¼Œä¿®æ”¹ç¼–è¾‘å™¨è¡Œä¸ºã€‚<br>åœ¨åˆ›å»ºç¼–è¾‘å™¨å®ä¾‹çš„æ—¶å€™è°ƒç”¨æ’ä»¶å‡½æ•°å³å¯ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Editor &#125; <span class="keyword">from</span> <span class="string">'slate'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myPlugin = <span class="function">(<span class="params">editor: Editor</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œå¯¹ editor çš„ä¸€äº›æ–¹æ³•è¿›è¡Œé‡å†™, è¿”å›ç¼–è¾‘å™¨å®ä¾‹</span></span><br><span class="line">  editor.apply = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">return</span> editor</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> myPlugin</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createEditor &#125; <span class="keyword">from</span> <span class="string">'slate'</span></span><br><span class="line"><span class="keyword">import</span> myPlugin <span class="keyword">from</span> <span class="string">'./myPlugin'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> editor = myPlugin(createEditor())</span><br></pre></td></tr></table></figure><p>å¦‚æ­¤ä»¥æ¥æ’ä»¶å°±èƒ½å®Œå…¨æ§åˆ¶ç¼–è¾‘å™¨è¡Œä¸ºï¼Œæ­£å¦‚ Slate çš„å®˜æ–¹ä»‹ç»æ‰€è¯´</p><blockquote><p>Slate æ˜¯ä¸€ä¸ª   å®Œå…¨   å¯å®šåˆ¶çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æ¡†æ¶ã€‚</p></blockquote><h2 id="æ¸²æŸ“æœºåˆ¶"><a href="#æ¸²æŸ“æœºåˆ¶" class="headerlink" title="æ¸²æŸ“æœºåˆ¶"></a>æ¸²æŸ“æœºåˆ¶</h2><h3 id="æ¸²æŸ“åŸç†"><a href="#æ¸²æŸ“åŸç†" class="headerlink" title="æ¸²æŸ“åŸç†"></a>æ¸²æŸ“åŸç†</h3><p>Slate çš„æ–‡æ¡£æ•°æ®æ˜¯ä¸€é¢—ç±»ä¼¼ DOM çš„èŠ‚ç‚¹æ ‘ï¼Œslate-react é€šè¿‡é€’å½’è¿™é¢—æ ‘ç”Ÿæˆ <code>children</code> æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„æœ‰ä¸¤ç§ç±»å‹çš„ç»„ä»¶ <code>Element</code> å’Œ <code>Text</code>ï¼Œ æœ€ç»ˆ raect å°† <code>children</code> æ•°ç»„ä¸­çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Šï¼Œæ­¥éª¤å¦‚ä¸‹ã€‚</p><ol><li>è®¾ç½®ç¼–è¾‘å™¨å®ä¾‹çš„ <code>children</code> å±æ€§</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Slate.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Slate = (props: &#123;</span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">&#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; editor, children, onChange, value, ...rest &#125; = props</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> context: [ReactEditor] = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è®¾ç½® editor å®ä¾‹çš„ children å±æ€§ä¸º value</span></span><br><span class="line">    editor.children = value</span><br><span class="line">    <span class="comment">/// ...</span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><code>Editable</code> ç»„ä»¶ä¼ é€’ <code>editor</code> å®ä¾‹ç»™ <code>Children</code></li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Editable.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Editable = <span class="function">(<span class="params">props: EditableProps</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è·å– editor å®ä¾‹</span></span><br><span class="line">  <span class="keyword">const</span> editor = useSlate()</span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ReadOnlyContext.Provider value=&#123;readOnly&#125;&gt;</span><br><span class="line">      &lt;Component&gt;</span><br><span class="line">        &lt;Children</span><br><span class="line">          <span class="comment">// å°† editor ä¼ é€’ç»™ Children ç»„ä»¶</span></span><br><span class="line">          node=&#123;editor&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/Component&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>ReadOnlyContext.Provider&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><code>Children</code> ç”Ÿæˆæ¸²æŸ“æ•°ç»„ï¼Œäº¤ç»™ React æ¸²æŸ“ç»„ä»¶ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Children.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Children = (props: &#123;</span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">&#125;) =&gt; &#123;</span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">  <span class="keyword">const</span> children = []</span><br><span class="line">  <span class="comment">// éå† editor å®ä¾‹ä¸Šçš„ children æ•°ç»„</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; node.children.length; i++) &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ•°æ®ä¸º Element æˆ– Text</span></span><br><span class="line">    <span class="keyword">if</span> (Element.isElement(n)) &#123;</span><br><span class="line">      children.push(&lt;ElementComponent /&gt;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      children.push(&lt;TextComponent /&gt;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;React.Fragment&gt;&#123;children&#125;&lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/224563/1607849094929-29169d1b-fbd0-42b5-b624-87890e8f312b.jpeg#align=left&display=inline&height=761&margin=%5Bobject%20Object%5D&name=render.jpg&originHeight=761&originWidth=1173&size=149056&status=done&style=none&width=1173" alt="render.jpg"></p><p>å‡è®¾æœ‰ä»¥ä¸‹æ•°æ®</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">;[</span><br><span class="line">  &#123;</span><br><span class="line">    type: <span class="string">'paragraph'</span>,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        text: <span class="string">'A line of text in a paragraph.'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    type: <span class="string">'paragraph'</span>,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        text: <span class="string">'Another line of text in a paragraph.'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>é¡µé¢æ˜¾ç¤ºä¸º<br><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/224563/1607849801505-0de6e8ea-e8c9-4a5e-826e-025c33c6014a.jpeg#align=left&display=inline&height=774&margin=%5Bobject%20Object%5D&name=2line-text.jpg&originHeight=774&originWidth=1800&size=321159&status=done&style=none&width=1800" alt="2line-text.jpg"></p><h3 id="è‡ªå®šä¹‰æ¸²æŸ“"><a href="#è‡ªå®šä¹‰æ¸²æŸ“" class="headerlink" title="è‡ªå®šä¹‰æ¸²æŸ“"></a>è‡ªå®šä¹‰æ¸²æŸ“</h3><p>ä¼ é€’æ¸²æŸ“å‡½æ•° <code>renderElement</code> å’Œ <code>renderLeaf</code> ç»™ <code>Editable</code> ç»„ä»¶ï¼Œå¯¹å…ƒç´ å’Œå¶å­èŠ‚ç‚¹è¿›è¡Œè‡ªå®šä¹‰æ¸²æŸ“ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Leaf = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; attributes, children, leaf &#125; = props</span><br><span class="line">  <span class="comment">// æ ¹æ®å±æ€§å€¼è®¾ç½® HTML æ ‡ç­¾</span></span><br><span class="line">  <span class="keyword">if</span> (leaf.bold) &#123;</span><br><span class="line">    children = &lt;strong&gt;&#123;children&#125;&lt;<span class="regexp">/strong&gt;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  return &lt;span &#123;...attributes&#125;&gt;&#123;children&#125;&lt;/</span>span&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Element = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; element &#125; = props</span><br><span class="line">  <span class="comment">// æ ¹æ®ç±»å‹è¿”å›ç»„ä»¶</span></span><br><span class="line">  <span class="keyword">switch</span> (element.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'custom-type'</span>:</span><br><span class="line">      <span class="keyword">return</span> &lt;CustomElement &#123;...props&#125; /&gt;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> &lt;DefaultElement &#123;...props&#125; /&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> renderLeaf = <span class="function"><span class="params">props</span> =&gt;</span> &lt;Leaf &#123;...props&#125; /&gt;</span><br><span class="line"><span class="keyword">const</span> renderElement = <span class="function"><span class="params">props</span> =&gt;</span> &lt;Element &#123;...props&#125; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Slate&gt;</span><br><span class="line">  &lt;Editable</span><br><span class="line">    <span class="comment">// ä¼ é€’è‡ªå®šä¹‰æ¸²æŸ“å‡½æ•°</span></span><br><span class="line">    renderLeaf=&#123;renderLeaf&#125;</span><br><span class="line">    renderElement=&#123;renderElement&#125;</span><br><span class="line">  /&gt;</span><br><span class="line">&lt;<span class="regexp">/Slate&gt;</span></span><br></pre></td></tr></table></figure><h3 id="è§¦å‘æ¸²æŸ“"><a href="#è§¦å‘æ¸²æŸ“" class="headerlink" title="è§¦å‘æ¸²æŸ“"></a>è§¦å‘æ¸²æŸ“</h3><p>slate-react çš„ <code>withReact</code> æ’ä»¶ä¼šé‡å†™ç¼–è¾‘å™¨çš„ <code>onChange</code> æ–¹æ³•ï¼Œåœ¨æ¯æ¬¡æ–‡æ¡£æ•°æ®æ›´æ–°æ—¶ï¼Œè°ƒç”¨ <code>onContextChange</code> å‡½æ•°ï¼Œæ‰§è¡Œ <code>setKey(key + 1)</code> è§¦å‘ React é‡æ–°æ¸²æŸ“ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// slate.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Slate = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [key, setKey] = useState(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onContextChange = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    onChange(editor.children)</span><br><span class="line">    <span class="comment">// è®¾ç½® key + 1 è§¦å‘ React é‡æ–°æ¸²æŸ“</span></span><br><span class="line">    setKey(key + <span class="number">1</span>)</span><br><span class="line">  &#125;, [key, onChange])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½® onContextChange å‡½æ•°</span></span><br><span class="line">  EDITOR_TO_ON_CHANGE.set(editor, onContextChange)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// with.react.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withReact = &lt;T <span class="keyword">extends</span> Editor&gt;<span class="function">(<span class="params">editor: T</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// é‡å†™ onChange æ–¹æ³•</span></span><br><span class="line">  e.onChange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ReactDOM.unstable_batchedUpdates(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> onContextChange = EDITOR_TO_ON_CHANGE.get(e)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (onContextChange) &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œ onContextChange è¿›è¡Œ key + 1</span></span><br><span class="line">        onContextChange()</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      onChange()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> e</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®è·µç¤ºä¾‹"><a href="#å®è·µç¤ºä¾‹" class="headerlink" title="å®è·µç¤ºä¾‹"></a>å®è·µç¤ºä¾‹</h2><h3 id="ä¸€ä¸ªåŸºç¡€çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨"><a href="#ä¸€ä¸ªåŸºç¡€çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨" class="headerlink" title="ä¸€ä¸ªåŸºç¡€çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨"></a>ä¸€ä¸ªåŸºç¡€çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨</h3><ol><li>å¯¼å…¥ä¾èµ–ï¼Œåˆ›å»º <code>&lt;MyEditor /&gt;</code>  ç»„ä»¶</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createEditor &#125; <span class="keyword">from</span> <span class="string">'slate'</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useMemo, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Slate, Editable, withReact &#125; <span class="keyword">from</span> <span class="string">'slate-react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyEditor = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyEditor</span><br></pre></td></tr></table></figure><ol start="2"><li>åˆ›å»ºç¼–è¾‘å™¨å¯¹è±¡ <code>editor</code> å’Œæ–‡æ¡£æ•°æ® <code>value</code>ï¼Œä¼ é€’ç»™ <code>&lt;Slate /&gt;</code> ã€‚</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyEditor = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState([])</span><br><span class="line">  <span class="keyword">const</span> editor = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> withReact(createEditor()), [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// Slate ç»„ä»¶ä¿å­˜ç¼–è¾‘å™¨çš„çŠ¶æ€ï¼Œç›®çš„æ˜¯å…±äº«çŠ¶æ€ï¼Œä½¿å¾—å…¶ä»–ç»„ä»¶æ¯”å¦‚å·¥å…·æ ä¹Ÿèƒ½è·å–åˆ°ç¼–è¾‘å™¨çŠ¶æ€ã€‚</span></span><br><span class="line">    &lt;Slate</span><br><span class="line">      editor=&#123;editor&#125;</span><br><span class="line">      value=&#123;value&#125;</span><br><span class="line">      onChange=&#123;(value) =&gt; setValue(value)&#125;</span><br><span class="line">    &gt;&lt;<span class="regexp">/Slate&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨ <code>&lt;Editable /&gt;</code> æ¸²æŸ“ç¼–è¾‘å™¨ä¸»è¦åŒºåŸŸã€‚</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyEditor = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState([])</span><br><span class="line">  <span class="keyword">const</span> editor = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> withReact(createEditor()), [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Slate editor=&#123;editor&#125; value=&#123;value&#125; onChange=&#123;(value) =&gt; setValue(value)&#125;&gt;</span><br><span class="line">      <span class="comment">// Editable ç»„ä»¶æ˜¯ç¼–è¾‘å™¨å®é™…çš„æ¸²æŸ“åŒºåŸŸï¼Œç”¨æˆ·åœ¨è¿™é‡Œè¿›è¡Œäº¤äº’</span></span><br><span class="line">      &lt;Editable</span><br><span class="line">        style=&#123;&#123;</span><br><span class="line">          width: <span class="number">500</span>,</span><br><span class="line">          height: <span class="number">300</span>,</span><br><span class="line">          padding: <span class="number">20</span>,</span><br><span class="line">          border: <span class="string">'1px solid grey'</span>,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">        placeholder=<span class="string">"This is placeholder..."</span></span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Slate&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><ol start="4"><li>æ·»åŠ ç¼–è¾‘å™¨çš„é»˜è®¤å€¼ï¼Œæ­¤æ—¶é¡µé¢ä¸Šä¼šå‡ºç°è¿™è¡Œæ–‡æœ¬ã€‚</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¾‘å™¨çš„å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œslate ä¼šæ ¹æ®å®ƒæ¥ç”Ÿæˆæ•°æ®æ¨¡å‹ï¼Œäº¤ç»™ slate-react æ¸²æŸ“</span></span><br><span class="line"><span class="keyword">const</span> initialValue = [</span><br><span class="line">  &#123;</span><br><span class="line">    type: <span class="string">'paragraph'</span>,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        text: <span class="string">'A line of text in a paragraph.'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyEditor = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–ç¼–è¾‘å™¨ value ä¸º initialValue</span></span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(initialValue)</span><br><span class="line">  <span class="keyword">const</span> editor = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> withReact(createEditor()), [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Slate editor=&#123;editor&#125; value=&#123;value&#125; onChange=&#123;(value) =&gt; setValue(value)&#125;&gt;</span><br><span class="line">      &lt;Editable</span><br><span class="line">        style=&#123;&#123;</span><br><span class="line">          width: <span class="number">500</span>,</span><br><span class="line">          height: <span class="number">300</span>,</span><br><span class="line">          padding: <span class="number">20</span>,</span><br><span class="line">          border: <span class="string">'1px solid grey'</span>,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">        placeholder=<span class="string">"This is placeholder..."</span></span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Slate&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/224563/1607690549872-2a8f5d1f-2cb3-4379-8e6f-b49d935f2a1f.jpeg#align=left&display=inline&height=420&margin=%5Bobject%20Object%5D&name=basic-editor.jpg&originHeight=420&originWidth=640&size=21433&status=done&style=none&width=640" alt="basic-editor.jpg"></p><ol start="5"><li>åˆ›å»ºå·¥å…·æ ç»„ä»¶ï¼Œæ·»åŠ åŠ ç²—ï¼Œæ–œä½“ï¼Œä¸‹åˆ’çº¿æŒ‰é’®ã€‚</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MyToolbar = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div</span><br><span class="line">      style=&#123;&#123;</span><br><span class="line">        width: <span class="number">500</span>,</span><br><span class="line">        display: <span class="string">'flex'</span>,</span><br><span class="line">        padding: <span class="string">'10px 20px'</span>,</span><br><span class="line">        alignItems: <span class="string">'center'</span>,</span><br><span class="line">        margin: <span class="string">'0 auto'</span>,</span><br><span class="line">        marginTop: <span class="number">50</span>,</span><br><span class="line">        border: <span class="string">'1px solid grey'</span>,</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;button</span><br><span class="line">        style=&#123;&#123;</span><br><span class="line">          marginRight: <span class="number">20</span>,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">        onMouseDown=&#123;(event) =&gt; &#123;</span><br><span class="line">          event.preventDefault()</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        B</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">      &lt;button</span></span><br><span class="line"><span class="regexp">        style=&#123;&#123;</span></span><br><span class="line"><span class="regexp">          marginRight: 20,</span></span><br><span class="line"><span class="regexp">        &#125;&#125;</span></span><br><span class="line"><span class="regexp">        onMouseDown=&#123;(event) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          event.preventDefault()</span></span><br><span class="line"><span class="regexp">        &#125;&#125;</span></span><br><span class="line"><span class="regexp">      &gt;</span></span><br><span class="line"><span class="regexp">        I</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line"></span><br><span class="line">      &lt;button</span><br><span class="line">        style=&#123;&#123;</span><br><span class="line">          marginRight: <span class="number">20</span>,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">        onMouseDown=&#123;(event) =&gt; &#123;</span><br><span class="line">          event.preventDefault()</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        U</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&lt;Slate editor=&#123;editor&#125; value=&#123;value&#125; onChange=&#123;(value) =&gt; setValue(value)&#125;&gt;</span><br><span class="line">  <span class="comment">// åœ¨æ­¤å¤„ä½¿ç”¨</span></span><br><span class="line">  &lt;MyToolbar /&gt;</span><br><span class="line">  &lt;Editable</span><br><span class="line">    style=&#123;&#123;</span><br><span class="line">      width: <span class="number">500</span>,</span><br><span class="line">      height: <span class="number">300</span>,</span><br><span class="line">      padding: <span class="number">20</span>,</span><br><span class="line">      margin: <span class="string">'0 auto'</span>,</span><br><span class="line">      border: <span class="string">'1px solid grey'</span>,</span><br><span class="line">      borderTopWidth: <span class="number">0</span>,</span><br><span class="line">    &#125;&#125;</span><br><span class="line">    placeholder=<span class="string">"This is placeholder..."</span></span><br><span class="line">  /&gt;</span><br><span class="line">&lt;<span class="regexp">/Slate&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/224563/1607691438279-9e7b3b6d-39e4-4fef-8b1e-f4cfcbd46a29.jpeg#align=left&display=inline&height=420&margin=%5Bobject%20Object%5D&name=toolbar.jpg&originHeight=420&originWidth=640&size=26074&status=done&style=none&width=640" alt="toolbar.jpg"></p><ol start="6"><li>è®¾ç½®åŠ ç²—ï¼Œæ–œä½“ï¼Œä¸‹åˆ’çº¿æ¸²æŸ“æ ·å¼ï¼Œä¼ é€’ <code>renderLeaf</code> å‡½æ•°ç»™ <code>Editable</code>ã€‚</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///  MyEditor.jsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å…·ä½“æ ·å¼å¦‚ä½•æ¸²æŸ“</span></span><br><span class="line"><span class="keyword">const</span> Leaf = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; attributes, children, leaf &#125; = props</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (leaf.bold) &#123;</span><br><span class="line">    children = <span class="xml"><span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (leaf.italic) &#123;</span><br><span class="line">    children = <span class="xml"><span class="tag">&lt;<span class="name">i</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (leaf.underline) &#123;</span><br><span class="line">    children = <span class="xml"><span class="tag">&lt;<span class="name">u</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">u</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">span</span> &#123;<span class="attr">...attributes</span>&#125;&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyEditor = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="keyword">const</span> renderLeaf = useCallback(<span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Leaf</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Slate editor=&#123;editor&#125; value=&#123;value&#125; onChange=&#123;(value) =&gt; setValue(value)&#125;&gt;</span><br><span class="line">      &lt;MyToolbar editor=&#123;editor&#125; /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;Editable</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        renderLeaf=&#123;renderLeaf&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Slate&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><ol start="7"><li>åœ¨å·¥å…·æ ä¸Šæ·»åŠ è½¬æ¢èŠ‚ç‚¹å±æ€§çš„æ–¹æ³•ï¼Œç‚¹å‡»æ—¶è°ƒç”¨ã€‚</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// MyToolbar.jsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Text, Editor &#125; <span class="keyword">from</span> <span class="string">'slate'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Transforms &#125; <span class="keyword">from</span> <span class="string">'slate'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­èŠ‚ç‚¹çš„å±æ€§å€¼æ˜¯å¦ä¸ºçœŸ</span></span><br><span class="line"><span class="keyword">const</span> isFormatActive = <span class="function">(<span class="params">editor, format</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [match] = Editor.nodes(editor, &#123;</span><br><span class="line">    match: <span class="function">(<span class="params">n</span>) =&gt;</span> n[format] === <span class="literal">true</span>,</span><br><span class="line">    universal: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> !!match</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ®æ ·å¼åˆ‡æ¢å±æ€§å€¼</span></span><br><span class="line"><span class="keyword">const</span> toggleFormat = <span class="function">(<span class="params">event, editor, format</span>) =&gt;</span> &#123;</span><br><span class="line">  event.preventDefault()</span><br><span class="line">  <span class="keyword">const</span> isActive = isFormatActive(editor, format)</span><br><span class="line"></span><br><span class="line">  Transforms.setNodes(</span><br><span class="line">    editor,</span><br><span class="line">    &#123; [format]: isActive ? <span class="literal">false</span> : <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">match</span>: <span class="function">(<span class="params">n</span>) =&gt;</span> Text.isText(n), <span class="attr">split</span>: <span class="literal">true</span> &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyToolbar = <span class="function">(<span class="params">&#123; editor &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div</span><br><span class="line">      style=&#123;&#123;</span><br><span class="line">        width: <span class="number">500</span>,</span><br><span class="line">        display: <span class="string">'flex'</span>,</span><br><span class="line">        padding: <span class="string">'10px 20px'</span>,</span><br><span class="line">        alignItems: <span class="string">'center'</span>,</span><br><span class="line">        margin: <span class="string">'0 auto'</span>,</span><br><span class="line">        marginTop: <span class="number">50</span>,</span><br><span class="line">        border: <span class="string">'1px solid grey'</span>,</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;button</span><br><span class="line">        style=&#123;&#123;</span><br><span class="line">          marginRight: <span class="number">20</span>,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">        <span class="comment">// åœ¨ç‚¹å‡»äº‹ä»¶ä¸Šè°ƒç”¨</span></span><br><span class="line">        onClick=&#123;(event) =&gt; &#123;</span><br><span class="line">          toggleFormat(event, editor, <span class="string">'bold'</span>)</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        B</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      /</span><span class="comment">// ...</span></span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/gif/224563/1607741881685-f065f648-4e0c-4084-9ff1-369188314062.gif#align=left&display=inline&height=420&margin=%5Bobject%20Object%5D&name=toggle-format.gif&originHeight=420&originWidth=640&size=230856&status=done&style=none&width=640" alt="toggle-format.gif"></p><h3 id="åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰æ ‘å‹å…ƒç´ "><a href="#åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰æ ‘å‹å…ƒç´ " class="headerlink" title="åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰æ ‘å‹å…ƒç´ "></a>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰æ ‘å‹å…ƒç´ </h3><p>Slate çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒçš„å¯æ‰©å±•æ€§ï¼Œä»¥ä¸‹å±•ç¤ºå¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªæ ‘å½¢å…ƒç´ ã€‚</p><ol><li>å®šä¹‰æ ‘å½¢å…ƒç´ </li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// TreeElement.jsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TreeElement = <span class="function">(<span class="params">&#123; attributes, children, element &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; checked, label &#125; = element</span><br><span class="line">  <span class="keyword">const</span> [isChecked, setIsChecked] = useState(checked)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onChange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setIsChecked(!isChecked)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div &#123;...attributes&#125;&gt;</span><br><span class="line">      &lt;p</span><br><span class="line">        style=&#123;&#123;</span><br><span class="line">          display: <span class="string">'flex'</span>,</span><br><span class="line">          alignItems: <span class="string">'center'</span>,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">        contentEditable=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          type=<span class="string">"checkbox"</span></span><br><span class="line">          style=&#123;&#123;</span><br><span class="line">            width: <span class="number">20</span>,</span><br><span class="line">          &#125;&#125;</span><br><span class="line">          checked=&#123;isChecked&#125;</span><br><span class="line">          onChange=&#123;onChange&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;label&gt;&#123;label&#125;&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>p&gt;</span><br><span class="line">      &#123;isChecked ? <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">paddingLeft:</span> <span class="attr">20</span> &#125;&#125;&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> : <span class="literal">null</span>&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>å°† <code>renderElement</code> æ–¹æ³•ä¼ é€’ç»™ <code>&lt;Editable /&gt;</code>ã€‚</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// ...</span></span><br><span class="line"><span class="keyword">const</span> Element = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; element &#125; = props</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (element.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'tree-item'</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">TreeElement</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">DefaultElement</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// ...</span></span><br><span class="line"><span class="keyword">const</span> renderElement = useCallback(<span class="function">(<span class="params">props</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">Element</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>, [])</span><br><span class="line"></span><br><span class="line"><span class="comment">/// ...</span></span><br><span class="line">&lt;Editable</span><br><span class="line">  renderElement=&#123;renderElement&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>æ·»åŠ æ ‘å½¢å…ƒç´ æ•°æ®</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initialValue = [</span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">  &#123;</span><br><span class="line">    type: <span class="string">'tree-item'</span>,</span><br><span class="line">    checked: <span class="literal">true</span>,</span><br><span class="line">    label: <span class="string">'first level'</span>,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">'tree-item'</span>,</span><br><span class="line">        checked: <span class="literal">false</span>,</span><br><span class="line">        label: <span class="string">'second level'</span>,</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            type: <span class="string">'tree-item'</span>,</span><br><span class="line">            label: <span class="string">'third level'</span>,</span><br><span class="line">            checked: <span class="literal">false</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                type: <span class="string">'paragraph'</span>,</span><br><span class="line">                children: [</span><br><span class="line">                  &#123;</span><br><span class="line">                    text: <span class="string">'This is a tree item'</span>,</span><br><span class="line">                  &#125;,</span><br><span class="line">                ],</span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/gif/224563/1607743615375-926fdbe6-5d1c-434b-a0ee-2c6f2fb34b37.gif#align=left&display=inline&height=420&margin=%5Bobject%20Object%5D&name=tree-element.gif&originHeight=420&originWidth=640&size=109844&status=done&style=none&width=640" alt="tree-element.gif"></p><h3 id="åˆ›å»ºä¸€ä¸ªæ§åˆ¶è¾“å…¥çš„æ’ä»¶"><a href="#åˆ›å»ºä¸€ä¸ªæ§åˆ¶è¾“å…¥çš„æ’ä»¶" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæ§åˆ¶è¾“å…¥çš„æ’ä»¶"></a>åˆ›å»ºä¸€ä¸ªæ§åˆ¶è¾“å…¥çš„æ’ä»¶</h3><p>ä»¥ä¸‹å±•ç¤ºå¦‚ä½•å®šä¹‰ä¸€ä¸ª Slate æ’ä»¶</p><ol><li>åˆ›å»ºä¸€ä¸ª <code>withEmojis</code> æ’ä»¶</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// with-emojis.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; ReactEditor &#125; <span class="keyword">from</span> <span class="string">'slate-react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> letterEmojis = &#123;</span><br><span class="line">  a: <span class="string">'ğŸœ'</span>,</span><br><span class="line">  b: <span class="string">'ğŸ»'</span>,</span><br><span class="line">  c: <span class="string">'ğŸ±'</span>,</span><br><span class="line">  d: <span class="string">'ğŸ¶'</span>,</span><br><span class="line">  e: <span class="string">'ğŸ˜'</span>,</span><br><span class="line">  f: <span class="string">'ğŸ¦Š'</span>,</span><br><span class="line">  g: <span class="string">'ğŸ¦'</span>,</span><br><span class="line">  h: <span class="string">'ğŸµ'</span>,</span><br><span class="line">  i: <span class="string">'ğŸ¦„'</span>,</span><br><span class="line">  j: <span class="string">'ğŸ¦‹'</span>,</span><br><span class="line">  k: <span class="string">'ğŸ¦€'</span>,</span><br><span class="line">  l: <span class="string">'ğŸ¦'</span>,</span><br><span class="line">  m: <span class="string">'ğŸ­'</span>,</span><br><span class="line">  n: <span class="string">'ğŸ®'</span>,</span><br><span class="line">  o: <span class="string">'ğŸ‹'</span>,</span><br><span class="line">  p: <span class="string">'ğŸ¼'</span>,</span><br><span class="line">  q: <span class="string">'ğŸ§'</span>,</span><br><span class="line">  r: <span class="string">'ğŸ°'</span>,</span><br><span class="line">  s: <span class="string">'ğŸ•·'</span>,</span><br><span class="line">  t: <span class="string">'ğŸ¯'</span>,</span><br><span class="line">  u: <span class="string">'ğŸ'</span>,</span><br><span class="line">  v: <span class="string">'ğŸ¦–'</span>,</span><br><span class="line">  w: <span class="string">'ğŸ¦•'</span>,</span><br><span class="line">  x: <span class="string">'ğŸ¦›'</span>,</span><br><span class="line">  y: <span class="string">'ğŸ³'</span>,</span><br><span class="line">  z: <span class="string">'ğŸ¦“'</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> withEmojis = <span class="function">(<span class="params">editor: ReactEditor</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; insertText &#125; = editor</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡å†™ editor çš„ insertText æ–¹æ³•</span></span><br><span class="line">  editor.insertText = <span class="function">(<span class="params">text: string</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (letterEmojis[text.toLowerCase()]) &#123;</span><br><span class="line">      text = letterEmojis[text]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰§è¡ŒåŸæœ‰çš„ insertText æ–¹æ³•</span></span><br><span class="line">    insertText(text)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> editor</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withEmojis</span><br></pre></td></tr></table></figure><ol start="2"><li>åœ¨æ–°å»ºç¼–è¾‘å™¨å¯¹è±¡æ—¶ä½¿ç”¨æ’ä»¶</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// MyEditor.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> editor = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> withEmojis(withReact(createEditor())), [])</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/gif/224563/1607744811398-c468d0c2-b35a-4231-8e4e-09149df91db7.gif#align=left&display=inline&height=420&margin=%5Bobject%20Object%5D&name=with-emojis.gif&originHeight=420&originWidth=640&size=154855&status=done&style=none&width=640" alt="with-emojis.gif"></p><h2 id="ä¸è¶³ä¹‹å¤„"><a href="#ä¸è¶³ä¹‹å¤„" class="headerlink" title="ä¸è¶³ä¹‹å¤„"></a>ä¸è¶³ä¹‹å¤„</h2><ul><li>è¿˜æ²¡æœ‰å‘å¸ƒæ­£å¼ç‰ˆï¼Œå¤„äº Beta é˜¶æ®µï¼ŒAPI å¯èƒ½ä¼šæœ‰å˜åŒ–</li><li>æ¸²æŸ“å±‚ç›®å‰åªæœ‰ Reactï¼Œè¦åœ¨å…¶ä»–æ¡†æ¶ä¸­ä½¿ç”¨éœ€è¦è‡ªè¡Œå®ç°</li><li>æ•°æ®æ¸²æŸ“åˆ†ç¦»ï¼Œéœ€è¦å®Œå…¨æ§åˆ¶ç”¨æˆ·è¾“å…¥è¡Œä¸ºï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æ•°æ®å’Œæ¸²æŸ“ä¸åŒæ­¥</li><li>åŸºäº contenteditable æ— æ³•çªç ´æµè§ˆå™¨çš„æ’ç‰ˆæ•ˆæœ</li><li>å¯¹ä¸­æ–‡è¾“å…¥æ”¯æŒä¸è¶³ï¼Œè¯¦è§æ­¤ <a href="https://www.zhihu.com/question/361228704/answer/937791493" target="_blank" rel="noopener">é“¾æ¥</a></li><li>ç¤¾åŒºé©±åŠ¨å¼€å‘ï¼Œé—®é¢˜å¯èƒ½å¾—ä¸åˆ°åŠæ—¶ä¿®å¤</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Slate æ˜¯ä¸€ä¸ªè®¾è®¡ä¼˜ç§€çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å¼€å‘æ¡†æ¶ï¼Œå…·æœ‰å¾ˆé«˜çš„å¯æ‰©å±•æ€§ã€‚<br>å¦‚æœéœ€è¦ä¸€ä¸ªèƒ½è¿…é€Ÿæ¥å…¥å¹¶ä½¿ç”¨çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ ckeditor4, tinymce, ueditor è¿™äº›æä¾›å¼€ç®±å³ç”¨åŠŸèƒ½çš„ç¼–è¾‘å™¨ã€‚å¦‚æœæ˜¯è¦å¼€å‘ä¸€æ¬¾åŠŸèƒ½ä¸°å¯Œï¼Œéœ€è¦å®šåˆ¶åŒ–çš„ç¼–è¾‘å™¨é‚£ä¹ˆ Slate å°†æ˜¯ä½ çš„ç¬¬ä¸€é€‰æ‹©ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://zhuanlan.zhihu.com/p/268366406" target="_blank" rel="noopener">å¼€æºå¯Œæ–‡æœ¬ç¼–è¾‘å™¨æŠ€æœ¯çš„æ¼”è¿›ï¼ˆ2020 1024ï¼‰</a><br><a href="https://zhuanlan.zhihu.com/p/262209236" target="_blank" rel="noopener">slate æ¶æ„è®¾è®¡åˆ†æ</a><br><a href="https://zhuanlan.zhihu.com/p/90931631" target="_blank" rel="noopener">ç¼–è¾‘å™¨åˆä½“éªŒ</a><br><a href="https://rain120.github.io/athena/zh/slate/SlateStart.html" target="_blank" rel="noopener">Slate ä¸­æ–‡æ–‡æ¡£</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Slate æ˜¯ä¸€ä¸ªä½¿ç”¨ TypeScript å¼€å‘å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å¼€å‘æ¡†æ¶ï¼Œè¯ç”Ÿäº 2016 å¹´ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Web" scheme="https://coldstone.fun/tags/Web/"/>
    
      <category term="Rich Editor" scheme="https://coldstone.fun/tags/Rich-Editor/"/>
    
  </entry>
  
  <entry>
    <title>è®¤è¯† Range å’Œ Selection å¯¹è±¡</title>
    <link href="https://coldstone.fun/post/2020/12/05/selection-and-range/"/>
    <id>https://coldstone.fun/post/2020/12/05/selection-and-range/</id>
    <published>2020-12-05T02:51:38.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>æµè§ˆå™¨çš„ Range å’Œ Selection å¯¹è±¡</p><a id="more"></a><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><p>DOM æ–‡æ¡£å¯¹è±¡æ¨¡å‹ä¸­æ€»å…±æœ‰ 12 ç§èŠ‚ç‚¹ç±»å‹ï¼Œå¸¸è§çš„æœ‰ä»¥ä¸‹å‡ ç§</p><table><thead><tr><th align="left">å¸¸é‡</th><th align="left">å€¼</th><th align="left">ç±»å‹</th></tr></thead><tbody><tr><td align="left">ELEMENT_NODE</td><td align="left">1</td><td align="left">å…ƒç´ èŠ‚ç‚¹</td></tr><tr><td align="left">TEXT_NODE</td><td align="left">3</td><td align="left">æ–‡æœ¬èŠ‚ç‚¹</td></tr><tr><td align="left">COMMENT_NODE</td><td align="left">8</td><td align="left">æ³¨é‡ŠèŠ‚ç‚¹</td></tr><tr><td align="left">DOCUMENT_NODE</td><td align="left">9</td><td align="left">Document èŠ‚ç‚¹</td></tr><tr><td align="left">DOCUMENT_FRAGMENT_NODE</td><td align="left">11</td><td align="left">DocumentFragment èŠ‚ç‚¹</td></tr></tbody></table><blockquote><p><a href="https://wiki.developer.mozilla.org/zh-CN/docs/Web/API/Node/nodeType" target="_blank" rel="noopener">https://wiki.developer.mozilla.org/zh-CN/docs/Web/API/Node/nodeType</a></p></blockquote><h2 id="Range"><a href="#Range" class="headerlink" title="Range"></a>Range</h2><p><code>Range</code> å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªèŒƒå›´ï¼Œæœ‰èµ·å§‹ç‚¹å’Œç»ˆæ­¢ç‚¹ï¼Œæ˜¯ç”¨äºç®¡ç†é€‰æ‹©èŒƒå›´çš„é€šç”¨å¯¹è±¡ã€‚</p><p>æ¯ä¸ªç‚¹éƒ½æ˜¯ä¸€ä¸ªç›¸å¯¹äºçˆ¶èŠ‚ç‚¹çš„åç§»é‡ï¼ˆoffsetï¼‰ï¼Œå¦‚æœçˆ¶èŠ‚ç‚¹æ˜¯å…ƒç´ èŠ‚ç‚¹ï¼Œåˆ™åç§»é‡æ˜¯å­èŠ‚ç‚¹çš„ç¼–å·ã€‚å¦‚æœçˆ¶èŠ‚ç‚¹æ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œåˆ™æ˜¯æ–‡æœ¬ä¸­çš„ä½ç½®ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ç»ˆç‚¹è¦åœ¨èµ·ç‚¹ä¹‹åã€‚</p><p>æœ‰ä»¥ä¸‹ HTML ç‰‡æ®µ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div"</span>&gt;</span>Hello <span class="tag">&lt;<span class="name">span</span>&gt;</span>World<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>!<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-Range-é€‰æ‹©èŠ‚ç‚¹"><a href="#ä½¿ç”¨-Range-é€‰æ‹©èŠ‚ç‚¹" class="headerlink" title="ä½¿ç”¨ Range é€‰æ‹©èŠ‚ç‚¹"></a>ä½¿ç”¨ Range é€‰æ‹©èŠ‚ç‚¹</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> div = <span class="built_in">document</span>.getElementById(<span class="string">'div'</span>)</span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ª `Range` å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> range = <span class="keyword">new</span> Range()</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®èŒƒå›´èµ·ç‚¹ä¸ºæ–‡æœ¬èŠ‚ç‚¹ Hello</span></span><br><span class="line">range.setStart(div, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®èŒƒå›´ç»ˆç‚¹ä¸ºå…ƒç´ èŠ‚ç‚¹ &lt;b&gt;!&lt;/b&gt; ï¼ˆä¸åŒ…æ‹¬ï¼‰</span></span><br><span class="line">range.setEnd(div, <span class="number">2</span>);</span><br><span class="line"><span class="comment">// ä»¥æ–‡æœ¬å½¢å¼è¿”å›å…¶å†…å®¹</span></span><br><span class="line"><span class="built_in">console</span>.log(range.toString()); <span class="comment">// Hello World</span></span><br></pre></td></tr></table></figure><h3 id="é€‰æ‹©æ–‡æœ¬èŠ‚ç‚¹çš„ä¸€éƒ¨åˆ†"><a href="#é€‰æ‹©æ–‡æœ¬èŠ‚ç‚¹çš„ä¸€éƒ¨åˆ†" class="headerlink" title="é€‰æ‹©æ–‡æœ¬èŠ‚ç‚¹çš„ä¸€éƒ¨åˆ†"></a>é€‰æ‹©æ–‡æœ¬èŠ‚ç‚¹çš„ä¸€éƒ¨åˆ†</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">range.setStart(div.firstChild, <span class="number">4</span>);</span><br><span class="line">range.setEnd(div, <span class="number">2</span>);</span><br><span class="line">  </span><br><span class="line"><span class="built_in">console</span>.log(range.toString()); <span class="comment">// o World</span></span><br></pre></td></tr></table></figure><h3 id="Range-çš„æ–¹æ³•"><a href="#Range-çš„æ–¹æ³•" class="headerlink" title="Range çš„æ–¹æ³•"></a>Range çš„æ–¹æ³•</h3><p><code>setStart(node, offset)</code> å°†èµ·ç‚¹è®¾ç½®åœ¨ï¼šnode ä¸­çš„ä½ç½® offset<br><code>setStartBefore(node)</code> å°†èµ·ç‚¹è®¾ç½®åœ¨ï¼šnode å‰é¢<br><code>setStartAfter(node)</code> å°†èµ·ç‚¹è®¾ç½®åœ¨ï¼šnode åé¢</p><p><code>setEnd(node, offset)</code> å°†ç»ˆç‚¹è®¾ç½®ä¸ºï¼šnode ä¸­çš„ä½ç½® offset<br><code>setEndBefore(node)</code> å°†ç»ˆç‚¹è®¾ç½®ä¸ºï¼šnode å‰é¢<br><code>setEndAfter(node)</code> å°†ç»ˆç‚¹è®¾ç½®ä¸ºï¼šnode åé¢</p><p><code>selectNode(node)</code> è®¾ç½®èŒƒå›´ä»¥é€‰æ‹©æ•´ä¸ª node<br><code>selectNodeContents(node)</code> è®¾ç½®èŒƒå›´ä»¥é€‰æ‹©æ•´ä¸ª node çš„å†…å®¹<br><code>collapse(toStart)</code> å¦‚æœ toStart=true åˆ™è®¾ç½® end=startï¼Œå¦åˆ™è®¾ç½® start=endï¼Œä»è€ŒæŠ˜å èŒƒå›´<br><code>cloneRange()</code> åˆ›å»ºä¸€ä¸ªå…·æœ‰ç›¸åŒèµ·ç‚¹/ç»ˆç‚¹çš„æ–°èŒƒå›´</p><p><code>deleteContents()</code>  ä»æ–‡æ¡£ä¸­åˆ é™¤èŒƒå›´å†…å®¹<br><code>extractContents()</code> ä»æ–‡æ¡£ä¸­åˆ é™¤èŒƒå›´å†…å®¹ï¼Œå¹¶å°†åˆ é™¤çš„å†…å®¹ä½œä¸º DocumentFragment è¿”å›<br><code>cloneContents()</code> å¤åˆ¶èŒƒå›´å†…å®¹ï¼Œå¹¶å°†å¤åˆ¶çš„å†…å®¹ä½œä¸º DocumentFragment è¿”å›<br><code>insertNode(node)</code> åœ¨èŒƒå›´çš„èµ·å§‹å¤„å°† node æ’å…¥æ–‡æ¡£<br><code>surroundContents(node)</code> ä½¿ç”¨ node å°†æ‰€é€‰èŒƒå›´å†…å®¹åŒ…è£¹èµ·æ¥ã€‚è¦ä½¿æ­¤æ“ä½œæœ‰æ•ˆï¼Œåˆ™è¯¥èŒƒå›´å¿…é¡»åŒ…å«å…¶ä¸­æ‰€æœ‰å…ƒç´ çš„å¼€å§‹å’Œç»“æŸæ ‡ç­¾ï¼šä¸èƒ½åƒ <i>abc è¿™æ ·çš„éƒ¨åˆ†èŒƒå›´</p><h2 id="Selection"><a href="#Selection" class="headerlink" title="Selection"></a>Selection</h2><p><code>Selection</code> å¯¹è±¡è¡¨ç¤ºæ–‡æ¡£ä¸­çš„é€‰æ‹©èŒƒå›´ï¼Œå¯é€šè¿‡ <code>window.getSelection()</code> æˆ– <code>document.getSelection()</code> æ¥è·å–ã€‚</p><p>é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥ç›‘å¬é€‰æ‹©äº‹ä»¶</p><p><code>elem.onselectstart</code> â€”â€” å½“é€‰æ‹©åœ¨ elem ä¸Šè§¦å‘æ—¶ï¼Œä¾‹å¦‚ï¼Œç”¨æˆ·æŒ‰ä¸‹é¼ æ ‡é”®å¹¶å¼€å§‹ç§»åŠ¨é¼ æ ‡ï¼Œé˜»æ­¢é»˜è®¤è¡Œä¸ºä¼šä½¿é€‰æ‹©æ— æ³•å¼€å§‹ã€‚</p><p><code>document.onselectionchange</code> â€”â€” å½“é€‰æ‹©å˜åŠ¨æ—¶ï¼Œæ­¤äº‹ä»¶ç›‘å¬åªèƒ½åœ¨ document ä¸Šè®¾ç½®ã€‚</p><p>é€‰æ‹©å¯¹è±¡çš„ä¸»è¦å±æ€§æœ‰</p><p><code>anchorNode</code> é€‰æ‹©çš„èµ·å§‹èŠ‚ç‚¹<br><code>anchorOffset</code> é€‰æ‹©èµ·å§‹èŠ‚ç‚¹çš„åç§»é‡<br><code>focusNode</code> é€‰æ‹©çš„ç»“æŸèŠ‚ç‚¹<br><code>focusOffset</code> é€‰æ‹©ç»“æŸèŠ‚ç‚¹çš„åç§»é‡<br><code>isCollapsed</code> é€‰æ‹©æ˜¯å¦ä¸ºç©ºæˆ–ä¸å­˜åœ¨<br><code>rangeCount</code> é€‰æ‹©ä¸­çš„èŒƒå›´ (Range) æ•°ï¼Œé™¤ Firefox å¤–ï¼Œå…¶ä»–æµè§ˆå™¨æœ€å¤šä¸º 1</p><h3 id="è·å–é€‰æ‹©"><a href="#è·å–é€‰æ‹©" class="headerlink" title="è·å–é€‰æ‹©"></a>è·å–é€‰æ‹©</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div"</span>&gt;</span>Hello <span class="tag">&lt;<span class="name">span</span>&gt;</span>World<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>!<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'selectionchange'</span>, event =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;anchorNode, anchorOffset, focusNode, focusOffset&#125; = <span class="built_in">document</span>.getSelection();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'anchorNode: '</span>, anchorNode)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'anchorOffset: '</span>, anchorOffset)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'focusNode: '</span>, focusNode)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'focusOffset: '</span>, focusOffset)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'----------'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="./images/selection-and-range/right-to-left.jpg" alt="right-to-left"></p><h3 id="é€‰æ‹©çš„æ–¹æ³•"><a href="#é€‰æ‹©çš„æ–¹æ³•" class="headerlink" title="é€‰æ‹©çš„æ–¹æ³•"></a>é€‰æ‹©çš„æ–¹æ³•</h3><p><code>getRangeAt(i)</code> è·å–ä» 0 å¼€å§‹çš„ç¬¬ i ä¸ªèŒƒå›´ã€‚åœ¨é™¤ Firefox ä¹‹å¤–çš„æ‰€æœ‰æµè§ˆå™¨ä¸­ï¼Œä»…ä½¿ç”¨ 0ã€‚<br><code>addRange(range)</code> å°† range æ·»åŠ åˆ°é€‰æ‹©ä¸­ã€‚å¦‚æœé€‰æ‹©å·²æœ‰å…³è”çš„èŒƒå›´ï¼Œåˆ™é™¤ Firefox å¤–çš„æ‰€æœ‰æµè§ˆå™¨éƒ½å°†å¿½ç•¥è¯¥è°ƒç”¨ã€‚<br><code>removeRange(range)</code> ä»é€‰æ‹©ä¸­åˆ é™¤ rangeã€‚<br><code>removeAllRanges()</code> åˆ é™¤é€‰æ‹©ä¸­æ‰€æœ‰èŒƒå›´ã€‚<br><code>empty()</code> removeAllRanges çš„åˆ«åã€‚</p><p><code>collapse(node, offset)</code> ç”¨ä¸€ä¸ªæ–°çš„èŒƒå›´æ›¿æ¢é€‰å®šçš„èŒƒå›´ï¼Œè¯¥æ–°èŒƒå›´ä»ç»™å®šçš„ node å¤„å¼€å§‹ï¼Œåˆ°åç§» offset å¤„ç»“æŸã€‚<br><code>setPosition(node, offset)</code> collapse çš„åˆ«åã€‚<br><code>collapseToStart()</code> æŠ˜å ï¼ˆæ›¿æ¢ä¸ºç©ºèŒƒå›´ï¼‰åˆ°é€‰æ‹©èµ·ç‚¹ã€‚<br><code>collapseToEnd()</code> æŠ˜å åˆ°é€‰æ‹©ç»ˆç‚¹ã€‚<br><code>extend(node, offset)</code> å°†é€‰æ‹©çš„ç„¦ç‚¹ï¼ˆfocusï¼‰ç§»åˆ°ç»™å®šçš„ nodeï¼Œä½ç½®åç§» oofsetã€‚</p><p><code>setBaseAndExtent(anchorNode, anchorOffset, focusNode, focusOffset)</code> ç”¨ç»™å®šçš„èµ·ç‚¹ anchorNode/anchorOffset å’Œç»ˆç‚¹ focusNode/focusOffset æ¥æ›¿æ¢é€‰æ‹©èŒƒå›´ã€‚é€‰ä¸­å®ƒä»¬ä¹‹é—´çš„æ‰€æœ‰å†…å®¹ã€‚<br><code>selectAllChildren(node)</code> é€‰æ‹© node çš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚<br><code>deleteFromDocument()</code> ä»æ–‡æ¡£ä¸­åˆ é™¤æ‰€é€‰æ‹©çš„å†…å®¹ã€‚<br><code>containsNode(node, allowPartialContainment = false)</code> æ£€æŸ¥é€‰æ‹©ä¸­æ˜¯å¦åŒ…å« nodeï¼ˆç‰¹åˆ«æ˜¯å¦‚æœç¬¬äºŒä¸ªå‚æ•°æ˜¯ true çš„è¯ï¼‰ã€‚</p><h2 id="ä½¿æ–‡æ¡£ä¸­æŸäº›å†…å®¹ä¸å¯é€‰"><a href="#ä½¿æ–‡æ¡£ä¸­æŸäº›å†…å®¹ä¸å¯é€‰" class="headerlink" title="ä½¿æ–‡æ¡£ä¸­æŸäº›å†…å®¹ä¸å¯é€‰"></a>ä½¿æ–‡æ¡£ä¸­æŸäº›å†…å®¹ä¸å¯é€‰</h2><ol><li>ä½¿ç”¨ CSS å±æ€§ <code>user-select: none</code> ä¸å…è®¸é€‰æ‹©ä» elem å¼€å§‹ï¼Œä½†æ˜¯ç”¨æˆ·å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹å¼€å§‹é€‰æ‹©ï¼Œå¹¶å°† elem åŒ…å«åœ¨å†…ã€‚</li><li>é˜»æ­¢ <code>onselectstart</code> æˆ– <code>mousedown</code> äº‹ä»¶ä¸­çš„é»˜è®¤è¡Œä¸ºï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢åœ¨ elem ä¸Šå¼€å§‹é€‰æ‹©ï¼Œä½†æ˜¯è®¿é—®è€…å¯ä»¥åœ¨å¦ä¸€ä¸ªå…ƒç´ ä¸Šå¼€å§‹é€‰æ‹©ï¼Œç„¶åæ‰©å±•åˆ° elemã€‚</li><li>ä½¿ç”¨ <code>document.getSelection().empty()</code> æ–¹æ³•åœ¨é€‰æ‹©å‘ç”Ÿåæ¸…é™¤é€‰æ‹©èŒƒå›´ã€‚</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Node" target="_blank" rel="noopener">Node</a><br><a href="https://zh.javascript.info/selection-range#comments" target="_blank" rel="noopener">é€‰æ‹©ï¼ˆSelectionï¼‰å’ŒèŒƒå›´ï¼ˆRangeï¼‰</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æµè§ˆå™¨çš„ Range å’Œ Selection å¯¹è±¡&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Web" scheme="https://coldstone.fun/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>ä»€ä¹ˆæ˜¯ peerDependencies</title>
    <link href="https://coldstone.fun/post/2020/11/29/npm-peerDependencies/"/>
    <id>https://coldstone.fun/post/2020/11/29/npm-peerDependencies/</id>
    <published>2020-11-29T11:30:00.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p><code>package.json</code> é‡Œé¢çš„ <code>peerDependencies</code> æ˜¯ä»€ä¹ˆæ„æ€</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¼—æ‰€å‘¨çŸ¥ <code>dependencies</code> æ˜¯é¡¹ç›®çš„ä¾èµ–åŒ…ï¼Œ<code>devDependencies</code> é¡¹ç›®å¼€å‘é˜¶æ®µçš„ä¾èµ–åŒ…ï¼Œè¿™äº›ä¾èµ–åŒ…ä¼šåœ¨ <code>npm install</code> è¿‡ç¨‹ä¸­è‡ªåŠ¨å®‰è£…ã€‚</p><p>å‡è®¾é¡¹ç›®æœ¬èº«ä¾èµ– package A, ä½†æ˜¯å¦ä¸€ä¸ª package B åŒæ—¶ä¾èµ– package Aï¼Œä¸ºäº†é¿å…å†²çªï¼Œè¿™æ—¶å€™å°±éœ€è¦å°† package A è®¾ç½®ä¸º package B çš„<br><code>peerDependencies</code>ã€‚</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>å‡è®¾é¡¹ç›® A ä¾èµ– package B</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;b&quot;: &quot;^1.0.0&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>package B æœ‰ä¸€ä¸ª <code>peerDependencies</code> package c</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;peerDependencies&quot;: &#123;</span><br><span class="line">    &quot;c&quot;: &quot;^1.x&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆåœ¨é¡¹ç›® A å®‰è£… package B çš„æ—¶å€™, è¦æ±‚åŒæ—¶å®‰è£… package C ä½œä¸º A çš„ <code>dependencies</code>ã€‚</p><p>æ€»è€Œè¨€ä¹‹ <code>peerDependencies</code> æ˜¯<code>å®¿ä¸»</code>é¡¹ç›®å®‰è£…ç»™å…¶ä»–ä¾èµ–åŒ…ä½¿ç”¨çš„ packageã€‚</p><blockquote><p>æ³¨æ„: npm 1 å’Œ 2 ç‰ˆæœ¬ä¼šè‡ªåŠ¨å®‰è£… peerDependenciesã€‚ä» npm@3 å¼€å§‹å°†ä¸å†è‡ªåŠ¨å®‰è£…ï¼Œè€Œæ˜¯å¾—åˆ°ä¸€ä¸ªè­¦å‘Šï¼Œå‘ŠçŸ¥ <code>peerDependency</code> æ²¡æœ‰è¢«å®‰è£…ã€‚</p></blockquote><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://flaviocopes.com/npm-peer-dependencies/" target="_blank" rel="noopener">What are peer dependencies in a Node module?</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;package.json&lt;/code&gt; é‡Œé¢çš„ &lt;code&gt;peerDependencies&lt;/code&gt; æ˜¯ä»€ä¹ˆæ„æ€&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="npm" scheme="https://coldstone.fun/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>å­¦ä¹ è§‚å¯Ÿè€…æ¨¡å¼</title>
    <link href="https://coldstone.fun/post/2020/10/20/design-patterns-observer/"/>
    <id>https://coldstone.fun/post/2020/10/20/design-patterns-observer/</id>
    <published>2020-10-20T14:00:00.000Z</published>
    <updated>2021-06-28T09:25:25.301Z</updated>
    
    <content type="html"><![CDATA[<p>è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå…è®¸ä½ å®šä¹‰ä¸€ç§è®¢é˜…æœºåˆ¶ï¼Œå¯åœ¨å¯¹è±¡äº‹ä»¶å‘ç”Ÿæ—¶é€šçŸ¥å¤šä¸ª â€œè§‚å¯Ÿâ€ è¯¥å¯¹è±¡çš„å¯¹è±¡ã€‚</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼</h2><p>è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå…è®¸ä½ å®šä¹‰ä¸€ç§è®¢é˜…æœºåˆ¶ï¼Œå¯åœ¨å¯¹è±¡äº‹ä»¶å‘ç”Ÿæ—¶é€šçŸ¥å¤šä¸ª â€œè§‚å¯Ÿâ€ è¯¥å¯¹è±¡çš„å¯¹è±¡ã€‚</p><p>æœ‰å€¼å¾—å…³æ³¨çš„çŠ¶æ€çš„å¯¹è±¡é€šå¸¸è¢«ç§°ä¸ºç›®æ ‡ï¼Œç”±äºå®ƒè¦å°†è‡ªèº«çš„çŠ¶æ€æ”¹å˜é€šçŸ¥ç»™å…¶ä»–å¯¹è±¡ï¼Œæˆ‘ä»¬ä¹Ÿå°†å…¶ç§°ä¸ºå‘å¸ƒè€… ï¼ˆpublisherï¼‰ï¼Œæ‰€æœ‰å¸Œæœ›å…³æ³¨å‘å¸ƒè€…çŠ¶æ€å˜åŒ–çš„å…¶ä»–å¯¹è±¡è¢«ç§°ä¸ºè®¢é˜…è€…ï¼ˆsubscribersï¼‰ã€‚</p><p>å½“å‘å¸ƒè€…å‘å¸ƒäº†äº‹ä»¶ï¼Œå®ƒè¦éå†è®¢é˜…è€…å¹¶è°ƒç”¨å…¶å¯¹è±¡çš„ç‰¹å®šé€šçŸ¥æ–¹æ³•ã€‚</p><p>ä¸¾ä¾‹è¯´æ˜è§‚å¯Ÿè€…æ¨¡å¼ç±»ä¼¼äºæ˜æ˜Ÿä¸ç²‰ä¸çš„å…³ç³»ï¼Œç²‰ä¸å…³æ³¨æ˜æ˜Ÿï¼Œå½“æ˜æ˜Ÿå‘å¸ƒæ¶ˆæ¯çš„æ—¶å€™ï¼Œç²‰ä¸ä¼šå¯¹è¿™ä¸ªæ¶ˆæ¯åšå‡ºååº”ã€‚</p><h2 id="è§‚å¯Ÿè€…æ¨¡å¼é€‚ç”¨åœºæ™¯"><a href="#è§‚å¯Ÿè€…æ¨¡å¼é€‚ç”¨åœºæ™¯" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼é€‚ç”¨åœºæ™¯"></a>è§‚å¯Ÿè€…æ¨¡å¼é€‚ç”¨åœºæ™¯</h2><p>å½“ä¸€ä¸ªå¯¹è±¡çŠ¶æ€çš„æ”¹å˜éœ€è¦æ”¹å˜å…¶ä»–å¯¹è±¡ï¼Œå¯ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p><p>å½“ä¸€äº›å¯¹è±¡å¿…é¡»è§‚å¯Ÿå…¶ä»–å¯¹è±¡æ—¶ï¼Œå¯ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p><h2 id="å®ç°è§‚å¯Ÿè€…æ¨¡å¼"><a href="#å®ç°è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="å®ç°è§‚å¯Ÿè€…æ¨¡å¼"></a>å®ç°è§‚å¯Ÿè€…æ¨¡å¼</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç›®æ ‡</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ è§‚å¯Ÿè€…</span></span><br><span class="line">  attach(observer) &#123;</span><br><span class="line">    <span class="keyword">const</span> isExist = <span class="keyword">this</span>.observers.includes(observer)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isExist) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'è§‚å¯Ÿè€…å·²æ·»åŠ '</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.observers.push(observer)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç§»é™¤è§‚å¯Ÿè€…</span></span><br><span class="line">  detach(observer) &#123;</span><br><span class="line">    <span class="keyword">const</span> index = <span class="keyword">this</span>.observers.indexOf(observer)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'è§‚å¯Ÿè€…ä¸å­˜åœ¨'</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.observers.splice(index, <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€šçŸ¥è§‚å¯Ÿè€…</span></span><br><span class="line">  notify() &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> observer <span class="keyword">of</span> <span class="keyword">this</span>.observers) &#123;</span><br><span class="line">      observer.update(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§‚å¯Ÿè€…</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="comment">// æ¥æ”¶å‘å¸ƒäº‹ä»¶</span></span><br><span class="line">  update(subject) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸€ä¸ªä¾‹å­"><a href="#ä¸€ä¸ªä¾‹å­" class="headerlink" title="ä¸€ä¸ªä¾‹å­"></a>ä¸€ä¸ªä¾‹å­</h2><p>å°æ˜ï¼Œå°çº¢ï¼Œå°å®‰éƒ½ä¼šç•™æ„æ—©é¤åƒä»€ä¹ˆï¼Œä¸åŒçš„æ—©é¤ä¼šä½¿ä»–ä»¬äº§ç”Ÿä¸åŒçš„æƒ…ç»ªï¼Œå› æ­¤æ—©é¤æ˜¯ç›®æ ‡ï¼Œä¸‰äººæ˜¯è§‚å¯Ÿè€…ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»§æ‰¿ç›®æ ‡ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Breakfast</span> <span class="keyword">extends</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(element) &#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">    <span class="keyword">this</span>.value = <span class="string">''</span></span><br><span class="line">    <span class="keyword">this</span>.element = element</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.element.addEventListener(<span class="string">'change'</span>, (event) =&gt; &#123;</span><br><span class="line">      <span class="keyword">this</span>.value = <span class="keyword">this</span>.element.value</span><br><span class="line">      <span class="keyword">this</span>.notify()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  notify() &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> observer <span class="keyword">of</span> <span class="keyword">this</span>.observers) &#123;</span><br><span class="line">      observer.update(<span class="keyword">this</span>.value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»§æ‰¿è§‚å¯Ÿè€…ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">extends</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(element) &#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">    <span class="keyword">this</span>.mood = <span class="string">''</span></span><br><span class="line">    <span class="keyword">this</span>.element = element</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  update(subject) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»å‹ä¸€</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person1</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  update(value) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (value) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'bread'</span>:</span><br><span class="line">        <span class="keyword">this</span>.mood = <span class="string">'å¼€å¿ƒ'</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'noodles'</span>:</span><br><span class="line">        <span class="keyword">this</span>.mood = <span class="string">'å–œæ‚¦'</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'gruel'</span>:</span><br><span class="line">        <span class="keyword">this</span>.mood = <span class="string">'è®¨åŒ'</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">this</span>.mood = <span class="string">''</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.element.querySelector(<span class="string">'.mood'</span>).innerHTML = <span class="keyword">this</span>.mood</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»å‹äºŒ</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person2</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  update(value) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (value) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'bread'</span>:</span><br><span class="line">        <span class="keyword">this</span>.mood = <span class="string">'è®¨åŒ'</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'noodles'</span>:</span><br><span class="line">        <span class="keyword">this</span>.mood = <span class="string">'å¼€å¿ƒ'</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'gruel'</span>:</span><br><span class="line">        <span class="keyword">this</span>.mood = <span class="string">'è¿˜å¯ä»¥'</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">this</span>.mood = <span class="string">''</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.element.querySelector(<span class="string">'.mood'</span>).innerHTML = <span class="keyword">this</span>.mood</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»å‹ä¸‰</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person3</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  update(value) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (value) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'bread'</span>:</span><br><span class="line">        <span class="keyword">this</span>.mood = <span class="string">'ä¸å–œæ¬¢'</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'noodles'</span>:</span><br><span class="line">        <span class="keyword">this</span>.mood = <span class="string">'è¿˜å¯ä»¥'</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'gruel'</span>:</span><br><span class="line">        <span class="keyword">this</span>.mood = <span class="string">'å¼€å¿ƒ'</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">this</span>.mood = <span class="string">''</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.element.querySelector(<span class="string">'.mood'</span>).innerHTML = <span class="keyword">this</span>.mood</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºç›®æ ‡â€œæ—©é¤â€</span></span><br><span class="line"><span class="keyword">const</span> breakfast = <span class="keyword">new</span> Breakfast(<span class="built_in">document</span>.getElementById(<span class="string">'breakfast'</span>))</span><br><span class="line"><span class="comment">// åˆ›å»ºè§‚å¯Ÿè€…å°æ˜</span></span><br><span class="line"><span class="keyword">const</span> xiaoming = <span class="keyword">new</span> Person1(<span class="built_in">document</span>.getElementById(<span class="string">'xiaoming'</span>))</span><br><span class="line"><span class="comment">// åˆ›å»ºè§‚å¯Ÿè€…å°çº¢</span></span><br><span class="line"><span class="keyword">const</span> xiaohong = <span class="keyword">new</span> Person2(<span class="built_in">document</span>.getElementById(<span class="string">'xiaohong'</span>))</span><br><span class="line"><span class="comment">// åˆ›å»ºè§‚å¯Ÿè€…å°å®‰</span></span><br><span class="line"><span class="keyword">const</span> xiaoan = <span class="keyword">new</span> Person3(<span class="built_in">document</span>.getElementById(<span class="string">'xiaoan'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ è§‚å¯Ÿè€…</span></span><br><span class="line">breakfast.attach(xiaoming)</span><br><span class="line">breakfast.attach(xiaohong)</span><br><span class="line">breakfast.attach(xiaoan)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å–æ¶ˆè§‚å¯Ÿ</span></span><br><span class="line"><span class="comment">// breakfast.detach(xiaoan)</span></span><br></pre></td></tr></table></figure><p>å½“æ—©é¤å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¸åŒç±»å‹çš„äººä¼šæ ¹æ®ä¸åŒçš„æ—©é¤äº§ç”Ÿä¸åŒçš„æƒ…ç»ªã€‚</p><p><img src="./images/design-patterns-observer/breakfast.gif" alt="breakfrast"></p><p class="codepen" data-height="265" data-theme-id="dark" data-default-tab="js,result" data-user="xrr2016" data-slug-hash="xxOEqJK" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Observer Pattern">  <span>See the Pen <a href="https://codepen.io/xrr2016/pen/xxOEqJK" target="_blank" rel="noopener">  Observer Pattern</a> by Cold Stone (<a href="https://codepen.io/xrr2016" target="_blank" rel="noopener">@xrr2016</a>)  on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</span></p><script async src="https://static.codepen.io/assets/embed/ei.js"></script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå…è®¸ä½ å®šä¹‰ä¸€ç§è®¢é˜…æœºåˆ¶ï¼Œå¯åœ¨å¯¹è±¡äº‹ä»¶å‘ç”Ÿæ—¶é€šçŸ¥å¤šä¸ª â€œè§‚å¯Ÿâ€ è¯¥å¯¹è±¡çš„å¯¹è±¡ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://coldstone.fun/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="Design Patterns" scheme="https://coldstone.fun/tags/Design-Patterns/"/>
    
  </entry>
  
  <entry>
    <title>Flutter ç»˜åˆ¶å›¾å½¢ Circle Packing</title>
    <link href="https://coldstone.fun/post/2020/09/17/flutter-generative-artistry-03/"/>
    <id>https://coldstone.fun/post/2020/09/17/flutter-generative-artistry-03/</id>
    <published>2020-09-17T13:28:44.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡è®²è§£ä½¿ç”¨ Flutter å®ç° Generative Artistry æ•™ç¨‹é‡Œé¢çš„ç¬¬å…­ä¸ªå›¾å½¢ Circle Packingï¼ˆåœ†å½¢å¡«å……ï¼‰</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ‡’ç™Œå‘ä½œï¼Œå¥½ä¹…æ²¡å†™åšå®¢äº†â€¦</p><p>æœ¬æ–‡è®²è§£ä½¿ç”¨ Flutter å®ç° <a href="https://generativeartistry.com/tutorials" target="_blank" rel="noopener">Generative Artistry</a> æ•™ç¨‹é‡Œé¢çš„ç¬¬å…­ä¸ªå›¾å½¢ Circle Packingï¼ˆåœ†å½¢å¡«å……ï¼‰ã€‚</p><p>å®ç°è¿™ä¸ªå›¾å½¢çš„æ€è·¯å¤§è‡´æ˜¯ï¼š</p><ol><li>åˆ›å»ºä¸€ä¸ªåœ†ã€‚</li><li>åˆ¤æ–­è¿™ä¸ªåœ†æ˜¯å¦ä¸å…¶ä»–åœ†å‘ç”Ÿç¢°æ’ã€‚</li><li>æ²¡æœ‰åˆ™ä¸æ–­å¢å¤§åœ†çš„åŠå¾„ï¼Œå†æ¬¡è¿›è¡Œç¢°æ’æ£€æµ‹ï¼Œç›´è‡³æœ€å¤§åŠå¾„ã€‚</li><li>ç»˜åˆ¶æ›´å¤šçš„åœ†å½¢ï¼Œé‡å¤ä»¥ä¸Šã€‚</li></ol><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><p>ç…§æ—§åˆ›å»ºä¸€ä¸ª <code>CirclePacking</code> æ§ä»¶ä»¥åŠ <code>CirclePackingPainter</code>ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CirclePacking</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> CustomPaint(</span><br><span class="line">      painter: CirclePackingPainter(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CirclePackingPainter</span> <span class="keyword">extends</span> <span class="title">CustomPainter</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> shouldRepaint(CirclePackingPainter oldDelegate) =&gt; <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå®šä¹‰ä¸€ä¸ª <code>Circle</code> ç±»ï¼Œä»£è¡¨ç»˜åˆ¶çš„åœ†å½¢ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line">  Point center;</span><br><span class="line">  <span class="built_in">double</span> radius;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å£°æ˜ç»˜åˆ¶éœ€è¦çš„å˜é‡ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿæˆçš„åœ†å½¢æ•°ç»„</span></span><br><span class="line"><span class="built_in">List</span>&lt;Circle&gt; circles = [];</span><br><span class="line"><span class="comment">// åœ†å½¢çš„æœ€å°åŠå¾„</span></span><br><span class="line"><span class="built_in">double</span> minRaidus = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// åœ†å½¢çš„æœ€å¤§åŠå¾„</span></span><br><span class="line"><span class="built_in">double</span> maxRaidus = <span class="number">100</span>;</span><br><span class="line"><span class="comment">// åœ†å½¢çš„æ€»æ•°</span></span><br><span class="line"><span class="built_in">int</span> totalCircles = <span class="number">500</span>;</span><br><span class="line"><span class="comment">// å°è¯•ç»˜åˆ¶åœ†å½¢çš„æ€»æ•°</span></span><br><span class="line"><span class="built_in">int</span> createCircleAttemps = <span class="number">500</span>;</span><br><span class="line"><span class="comment">// éšæœºå› å­</span></span><br><span class="line">Random random = Random();</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºåœ†å½¢"><a href="#åˆ›å»ºåœ†å½¢" class="headerlink" title="åˆ›å»ºåœ†å½¢"></a>åˆ›å»ºåœ†å½¢</h2><p>ä½¿ç”¨ <code>_createCircles</code> æ–¹æ³•ç”Ÿæˆéœ€è¦ç»˜åˆ¶çš„åœ†å½¢ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _createCircles(Canvas canvas, Size size) &#123;</span><br><span class="line">  Circle circle = Circle()</span><br><span class="line">    ..radius = minRaidus</span><br><span class="line">    ..center = Point(</span><br><span class="line">      random.nextDouble() * size.width,</span><br><span class="line">      random.nextDouble() * size.height,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°ç¢°æ’ï¼Œä¸€ç›´å¢å¤§åœ†å½¢çš„åŠå¾„</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = minRaidus; i &lt; maxRaidus; i++) &#123;</span><br><span class="line">    circle.radius = i;</span><br><span class="line">    <span class="keyword">if</span> (_doesHaveCollision(circle, size)) &#123;</span><br><span class="line">      circle.radius--;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  circles.add(circle);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>_doesHaveCollision</code> æ–¹æ³•è¿›è¡Œç¢°æ’æ£€æµ‹ï¼Œç›®å‰éƒ½è¿”å› <code>false</code>ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> _doesHaveCollision(Circle circle, Size size) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»˜åˆ¶åœ†å½¢"><a href="#ç»˜åˆ¶åœ†å½¢" class="headerlink" title="ç»˜åˆ¶åœ†å½¢"></a>ç»˜åˆ¶åœ†å½¢</h2><p>åˆ›å»ºä¸€ä¸ª <code>_drawCircles</code> æ–¹æ³•ç»˜åˆ¶åœ†å½¢ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _drawCircles(Canvas canvas) &#123;</span><br><span class="line">  Paint paint = Paint()</span><br><span class="line">    ..strokeWidth = <span class="number">0.5</span></span><br><span class="line">    ..isAntiAlias = <span class="keyword">true</span></span><br><span class="line">    ..color = Colors.black</span><br><span class="line">    ..style = PaintingStyle.stroke;</span><br><span class="line"></span><br><span class="line">  circles.asMap().forEach((key, circle) &#123;</span><br><span class="line">    <span class="keyword">final</span> Offset offset = Offset(circle.center.x, circle.center.y);</span><br><span class="line">    canvas.drawCircle(offset, circle.radius, paint);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>paint</code> æ–¹æ³•é‡Œè°ƒç”¨åˆ›å»ºå’Œç»˜åˆ¶åœ†å½¢çš„æ–¹æ³•ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; totalCircles; i++) &#123;</span><br><span class="line">    _createCircles(canvas, size);</span><br><span class="line">    _drawCircles(canvas);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å™”å™”å™”ï¼Œä¸€å›¢ä¹±éº»ï¼</p><img src="./images/flutter-generative-artistry-03/mess.png" width="640" style="width: 320px"><h2 id="ç¢°æ’æ£€æµ‹"><a href="#ç¢°æ’æ£€æµ‹" class="headerlink" title="ç¢°æ’æ£€æµ‹"></a>ç¢°æ’æ£€æµ‹</h2><p>å®Œå–„åœ†å½¢ä¹‹é—´çš„ç¢°æ’æ£€æµ‹æ–¹æ³• <code>_doesHaveCollision</code>ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> _doesHaveCollision(Circle circle, Size size) &#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œè¿›è¡Œä¼ å…¥åœ†å½¢ä¸å…¶ä»–åœ†å½¢çš„ç¢°æ’æ£€æµ‹</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; circles.length; i++) &#123;</span><br><span class="line">    Circle otherCircle = circles[i];</span><br><span class="line">    <span class="built_in">double</span> r2 = circle.radius + otherCircle.radius;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­ä¸¤åœ†åœ†å¿ƒçš„è·ç¦»æ˜¯å¦å°äºå®ƒä»¬çš„åŠå¾„å’Œ</span></span><br><span class="line">    <span class="keyword">if</span> (r2 &gt;= circle.center.distanceTo(otherCircle.center) - <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿™é‡Œåˆ¤æ–­åœ†å½¢æ˜¯å¦è¶…è¿‡å·¦å³è¾¹ç•Œ</span></span><br><span class="line">  <span class="keyword">if</span> (circle.center.x + circle.radius &gt;= size.width ||</span><br><span class="line">      circle.center.x - circle.radius &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è¿™é‡Œåˆ¤æ–­åœ†å½¢æ˜¯å¦è¶…è¿‡ä¸Šä¸‹è¾¹ç•Œ</span></span><br><span class="line">  <span class="keyword">if</span> (circle.center.y + circle.radius &gt;= size.height ||</span><br><span class="line">      circle.center.y - circle.radius &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-generative-artistry-03/collision.png" width="640" style="width: 320px"><p>æœ€åéœ€è¦åšçš„æ˜¯åœ¨åˆ›å»ºåœ†å½¢ä¹‹å‰çš„æ£€æµ‹ï¼Œæ›´æ–°åˆ›å»ºåœ†å½¢çš„æ–¹æ³• <code>_createCircles</code>ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _createCircles(Canvas canvas, Size size) &#123;</span><br><span class="line">  Circle circle;</span><br><span class="line">  <span class="built_in">bool</span> circleSafeToDraw = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨å°è¯•ç»˜åˆ¶åœ†å½¢çš„æ¬¡æ•°è¿›è¡Œå¾ªç¯</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; createCircleAttemps; i++) &#123;</span><br><span class="line">    circle = Circle()</span><br><span class="line">      ..radius = minRaidus</span><br><span class="line">      ..center = Point(</span><br><span class="line">        random.nextDouble() * size.width,</span><br><span class="line">        random.nextDouble() * size.height,</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœç¢°æ’æ£€æµ‹å¤±è´¥è·³è¿‡è¿™ä¸ªåœ†å½¢ï¼Œè¿›è¡Œä¸‹ä¸€æ¬¡å°è¯•</span></span><br><span class="line">    <span class="comment">// å¦åˆ™è·³å‡ºå¾ªç¯å°†è¿™ä¸ªåœ†å½¢åŠ å…¥ circles æ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (_doesHaveCollision(circle, size)) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      circleSafeToDraw = <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!circleSafeToDraw) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸æ–­å¢å¤§åœ†å½¢çš„åŠå¾„</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = minRaidus; i &lt; maxRaidus; i++) &#123;</span><br><span class="line">    circle.radius = i;</span><br><span class="line">    <span class="keyword">if</span> (_doesHaveCollision(circle, size)) &#123;</span><br><span class="line">      circle.radius--;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  circles.add(circle);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§åŠŸå‘Šæˆ ğŸ‰</p><img src="./images/flutter-generative-artistry-03/finish.png" width="640" style="width: 320px"><p>æœ€ç»ˆä»£ç </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:math'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line">  Point center;</span><br><span class="line">  <span class="built_in">double</span> radius;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CirclePacking</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> CustomPaint(</span><br><span class="line">      painter: CirclePackingPainter(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CirclePackingPainter</span> <span class="keyword">extends</span> <span class="title">CustomPainter</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ç”Ÿæˆçš„åœ†å½¢æ•°ç»„</span></span><br><span class="line">  <span class="built_in">List</span>&lt;Circle&gt; circles = [];</span><br><span class="line">  <span class="comment">// åœ†å½¢çš„æœ€å°åŠå¾„</span></span><br><span class="line">  <span class="built_in">double</span> minRaidus = <span class="number">2</span>;</span><br><span class="line">  <span class="comment">// åœ†å½¢çš„æœ€å¤§åŠå¾„</span></span><br><span class="line">  <span class="built_in">double</span> maxRaidus = <span class="number">100</span>;</span><br><span class="line">  <span class="comment">// åœ†å½¢çš„æ€»æ•°</span></span><br><span class="line">  <span class="built_in">int</span> totalCircles = <span class="number">500</span>;</span><br><span class="line">  <span class="comment">// å°è¯•ç»˜åˆ¶åœ†å½¢çš„æ€»æ•°</span></span><br><span class="line">  <span class="built_in">int</span> createCircleAttemps = <span class="number">500</span>;</span><br><span class="line">  <span class="comment">// éšæœºå› å­</span></span><br><span class="line">  Random random = Random();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> _createCircles(Canvas canvas, Size size) &#123;</span><br><span class="line">    Circle circle;</span><br><span class="line">    <span class="built_in">bool</span> circleSafeToDraw = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; createCircleAttemps; i++) &#123;</span><br><span class="line">      circle = Circle()</span><br><span class="line">        ..radius = minRaidus</span><br><span class="line">        ..center = Point(</span><br><span class="line">          random.nextDouble() * size.width,</span><br><span class="line">          random.nextDouble() * size.height,</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœç¢°æ’æ£€æµ‹å¤±è´¥è·³è¿‡è¿™ä¸ªåœ†å½¢ï¼Œè¿›è¡Œä¸‹ä¸€æ¬¡å°è¯•</span></span><br><span class="line">      <span class="comment">// å¦åˆ™è·³å‡ºå¾ªç¯å°†è¿™ä¸ªåœ†å½¢åŠ å…¥ circles æ•°ç»„</span></span><br><span class="line">      <span class="keyword">if</span> (_doesHaveCollision(circle, size)) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        circleSafeToDraw = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!circleSafeToDraw) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸æ–­å¢å¤§åœ†å½¢çš„åŠå¾„</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = minRaidus; i &lt; maxRaidus; i++) &#123;</span><br><span class="line">      circle.radius = i;</span><br><span class="line">      <span class="keyword">if</span> (_doesHaveCollision(circle, size)) &#123;</span><br><span class="line">        circle.radius--;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    circles.add(circle);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span> _doesHaveCollision(Circle circle, Size size) &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œå¯¹ä¼ å…¥çš„åœ†å½¢ä¸å…¶ä»–ç»˜åˆ¶åœ†å½¢çš„æ£€æµ‹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; circles.length; i++) &#123;</span><br><span class="line">      Circle otherCircle = circles[i];</span><br><span class="line">      <span class="built_in">double</span> r2 = circle.radius + otherCircle.radius;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ¤æ–­ä¸¤ä¸ªåœ†å½¢åœ†å¿ƒçš„è·ç¦»æ˜¯å¦å°äºä¸¤åœ†å½¢çš„åŠå¾„å’Œ</span></span><br><span class="line">      <span class="keyword">if</span> (r2 &gt;= circle.center.distanceTo(otherCircle.center) - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œåˆ¤æ–­åœ†å½¢æ˜¯å¦è¶…è¿‡å·¦å³è¾¹ç•Œ</span></span><br><span class="line">    <span class="keyword">if</span> (circle.center.x + circle.radius &gt;= size.width ||</span><br><span class="line">        circle.center.x - circle.radius &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿™é‡Œåˆ¤æ–­åœ†å½¢æ˜¯å¦è¶…è¿‡ä¸Šä¸‹è¾¹ç•Œ</span></span><br><span class="line">    <span class="keyword">if</span> (circle.center.y + circle.radius &gt;= size.height ||</span><br><span class="line">        circle.center.y - circle.radius &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> _drawCircles(Canvas canvas) &#123;</span><br><span class="line">    Paint paint = Paint()</span><br><span class="line">      ..strokeWidth = <span class="number">0.5</span></span><br><span class="line">      ..isAntiAlias = <span class="keyword">true</span></span><br><span class="line">      ..style = PaintingStyle.stroke;</span><br><span class="line"></span><br><span class="line">    circles.asMap().forEach((key, circle) &#123;</span><br><span class="line">      paint.color = Colors.black;</span><br><span class="line">      Offset offset = Offset(circle.center.x, circle.center.y);</span><br><span class="line">      canvas.drawCircle(offset, circle.radius, paint);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; totalCircles; i++) &#123;</span><br><span class="line">      _createCircles(canvas, size);</span><br><span class="line">      _drawCircles(canvas);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> shouldRepaint(CirclePackingPainter oldDelegate) =&gt; <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡è®²è§£ä½¿ç”¨ Flutter å®ç° Generative Artistry æ•™ç¨‹é‡Œé¢çš„ç¬¬å…­ä¸ªå›¾å½¢ Circle Packingï¼ˆåœ†å½¢å¡«å……ï¼‰&lt;/p&gt;
    
    </summary>
    
    
      <category term="æ•™ç¨‹" scheme="https://coldstone.fun/categories/%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
      <category term="Generative artistry" scheme="https://coldstone.fun/tags/Generative-artistry/"/>
    
  </entry>
  
  <entry>
    <title>é˜¿é‡Œçš„ä¸‰é“é¢è¯•é¢˜</title>
    <link href="https://coldstone.fun/post/2020/08/31/ali-interview-questions/"/>
    <id>https://coldstone.fun/post/2020/08/31/ali-interview-questions/</id>
    <published>2020-08-31T09:00:00.000Z</published>
    <updated>2021-06-28T09:25:25.301Z</updated>
    
    <content type="html"><![CDATA[<p>å‰æ®µæ—¶é—´åšäº†ä¸‰é“é˜¿é‡Œçš„åœ¨çº¿é¢è¯•é¢˜ï¼Œåˆ†äº«ä¸€ä¸‹</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰æ®µæ—¶é—´åšäº†ä¸‰é“é˜¿é‡Œçš„åœ¨çº¿é¢è¯•é¢˜ï¼Œåˆ†äº«ä¸€ä¸‹ã€‚</p><h2 id="ä¸€-èº«ä¸ºå‰ç«¯ï¼Œæˆ‘å¾ˆæŠ±æ­‰"><a href="#ä¸€-èº«ä¸ºå‰ç«¯ï¼Œæˆ‘å¾ˆæŠ±æ­‰" class="headerlink" title="(ä¸€) èº«ä¸ºå‰ç«¯ï¼Œæˆ‘å¾ˆæŠ±æ­‰"></a>(ä¸€) èº«ä¸ºå‰ç«¯ï¼Œæˆ‘å¾ˆæŠ±æ­‰</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">æ ¹æ®è¡¨è¾¾å¼è®¡ç®—å­—æ¯æ•°ã€‚</span><br><span class="line">è¯´æ˜ï¼š</span><br><span class="line">  ç»™å®šä¸€ä¸ªæè¿°å­—æ¯æ•°é‡çš„è¡¨è¾¾å¼ï¼Œè®¡ç®—è¡¨è¾¾å¼é‡Œçš„æ¯ä¸ªå­—æ¯å®é™…æ•°é‡</span><br><span class="line">  è¡¨è¾¾å¼æ ¼å¼ï¼š</span><br><span class="line">    å­—æ¯ç´§è·Ÿè¡¨ç¤ºæ¬¡æ•°çš„æ•°å­—ï¼Œå¦‚ A2B3</span><br><span class="line">    æ‹¬å·å¯å°†è¡¨è¾¾å¼å±€éƒ¨åˆ†ç»„åè·Ÿä¸Šæ•°å­—ï¼Œ(A2)<span class="number">2</span>B</span><br><span class="line">    æ•°å­—ä¸º<span class="number">1</span>æ—¶å¯ç¼ºçœï¼Œå¦‚ AB3ã€‚</span><br><span class="line">ç¤ºä¾‹ï¼š</span><br><span class="line">  countOfLetters(<span class="string">'A2B3'</span>); <span class="comment">// &#123; A: 2, B: 3 &#125;</span></span><br><span class="line">  countOfLetters(<span class="string">'A(A3B)2'</span>); <span class="comment">// &#123; A: 7, B: 2 &#125;</span></span><br><span class="line">  countOfLetters(<span class="string">'C4(A(A3B)2)2'</span>); <span class="comment">// &#123; A: 14, B: 4, C: 4 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">countOfLetters</span>(<span class="params">letters, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/** ä»£ç å®ç° */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜é¢è¯•çš„æ—¶å€™å®Œå…¨æ²¡æ€è·¯ï¼Œä¹‹åæœç´¢äº†ä¸€ä¸‹ï¼Œå‘ç°è·Ÿ LeetCode ä¸Šçš„ä¸€é“ç®—æ³•é¢˜ç±»ä¼¼ç±»ä¼¼ <a href="https://leetcode-cn.com/problems/number-of-atoms/" target="_blank" rel="noopener">726.åŸå­çš„æ•°é‡</a> ğŸ¤¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isNum = <span class="function">(<span class="params">a</span>) =&gt;</span> <span class="regexp">/[\d]/</span>.test(a);</span><br><span class="line"><span class="keyword">const</span> isUpper = <span class="function">(<span class="params">a</span>) =&gt;</span> <span class="regexp">/[A-Z]/</span>.test(a);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">countOfLetters</span>(<span class="params">formula</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> stack = [];</span><br><span class="line">  <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"></span><br><span class="line">  stack.push([]);</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> getNums = <span class="function">(<span class="params">index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> num = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">while</span> (isNum(formula[index])) &#123;</span><br><span class="line">      num += formula[index];</span><br><span class="line">      index++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> num;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (i &lt; formula.length) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isUpper(formula[i])) &#123;</span><br><span class="line">      <span class="keyword">let</span> atom = formula[i];</span><br><span class="line">      i += atom.length;</span><br><span class="line">      <span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line">      obj[<span class="string">"name"</span>] = atom;</span><br><span class="line">      <span class="keyword">if</span> (isNum(formula[i])) &#123;</span><br><span class="line">        <span class="keyword">let</span> num = getNums(i);</span><br><span class="line">        i += num.length;</span><br><span class="line">        obj[<span class="string">"value"</span>] = <span class="built_in">Number</span>(num);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        obj[<span class="string">"value"</span>] = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      stack[stack.length - <span class="number">1</span>].push(obj);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (formula[i] === <span class="string">"("</span>) &#123;</span><br><span class="line">      stack.push([]);</span><br><span class="line">      i++;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (formula[i] === <span class="string">")"</span>) &#123;</span><br><span class="line">      i++;</span><br><span class="line">      <span class="keyword">let</span> multi = getNums(i);</span><br><span class="line">      i += multi.length;</span><br><span class="line">      <span class="keyword">let</span> left = stack[stack.length - <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">let</span> right = stack[stack.length - <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; right.length; ++j) &#123;</span><br><span class="line">        <span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line">        obj[<span class="string">"value"</span>] = multi * right[j].value;</span><br><span class="line">        obj[<span class="string">"name"</span>] = right[j].name;</span><br><span class="line">        left.push(obj);</span><br><span class="line">      &#125;</span><br><span class="line">      stack.pop();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// console.log(stack[0])</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; stack[<span class="number">0</span>].length; ++i) &#123;</span><br><span class="line">    obj[stack[<span class="number">0</span>][i].name] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; stack[<span class="number">0</span>].length; ++i) &#123;</span><br><span class="line">    obj[stack[<span class="number">0</span>][i].name] += stack[<span class="number">0</span>][i].value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res = countOfLetters(<span class="string">"C4(A(A3B)2)2"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(res);</span><br></pre></td></tr></table></figure><h2 id="äºŒ-é˜²æŠ–èŠ‚æµï¼ŒåŠ›äº‰ä¸Šæ¸¸"><a href="#äºŒ-é˜²æŠ–èŠ‚æµï¼ŒåŠ›äº‰ä¸Šæ¸¸" class="headerlink" title="(äºŒ) é˜²æŠ–èŠ‚æµï¼ŒåŠ›äº‰ä¸Šæ¸¸"></a>(äºŒ) é˜²æŠ–èŠ‚æµï¼ŒåŠ›äº‰ä¸Šæ¸¸</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å®ç°ä¸€ä¸ª<span class="string">`Foo`</span>æ–¹æ³•ï¼Œæ¥å—å‡½æ•°<span class="string">`func`</span>å’Œæ—¶é—´<span class="string">`wait`</span>ï¼Œè¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œæ–°å‡½æ•°å³æ—¶è¿ç»­å¤šæ¬¡æ‰§è¡Œï¼Œä½†ä¹Ÿåªé™åˆ¶åœ¨<span class="string">`wait`</span>çš„æ—¶é—´æ‰§è¡Œä¸€æ¬¡ã€‚</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params">func, wait</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* ä»£ç å®ç° */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜æ˜¯å¸¸è§çš„é˜²æŠ–èŠ‚æµå‡½æ•°ï¼Œéœ€è¦ç‰¢ç‰¢æŒæ¡å•Šã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params">func, wait</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timeout;</span><br><span class="line">  <span class="keyword">let</span> args = <span class="built_in">arguments</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (timeout) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    timeout = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      func.call(<span class="keyword">this</span>, args);</span><br><span class="line">      clearTimeout(timeout);</span><br><span class="line">    &#125;, wait);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸‰-é€’å½’é€’å½’ï¼Œå­¦ä¼šä¸äº"><a href="#ä¸‰-é€’å½’é€’å½’ï¼Œå­¦ä¼šä¸äº" class="headerlink" title="(ä¸‰) é€’å½’é€’å½’ï¼Œå­¦ä¼šä¸äº"></a>(ä¸‰) é€’å½’é€’å½’ï¼Œå­¦ä¼šä¸äº</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">å¯¹è±¡æ‰å¹³åŒ–</span><br><span class="line">  è¯´æ˜ï¼šè¯·å®ç° flatten(input) å‡½æ•°ï¼Œinput ä¸ºä¸€ä¸ª javascript å¯¹è±¡ï¼ˆ<span class="built_in">Object</span> æˆ–è€… <span class="built_in">Array</span>ï¼‰ï¼Œè¿”å›å€¼ä¸ºæ‰å¹³åŒ–åçš„ç»“æœã€‚</span><br><span class="line">  ç¤ºä¾‹ï¼š</span><br><span class="line">    <span class="keyword">var</span> input = &#123;</span><br><span class="line">      a: <span class="number">1</span>,</span><br><span class="line">      b: [ <span class="number">1</span>, <span class="number">2</span>, &#123; <span class="attr">c</span>: <span class="literal">true</span> &#125;, [ <span class="number">3</span> ] ],</span><br><span class="line">      d: &#123; <span class="attr">e</span>: <span class="number">2</span>, <span class="attr">f</span>: <span class="number">3</span> &#125;,</span><br><span class="line">      g: <span class="literal">null</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> output = flatten(input);</span><br><span class="line">    outputå¦‚ä¸‹</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"a"</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">"b[0]"</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">"b[1]"</span>: <span class="number">2</span>,</span><br><span class="line">      <span class="string">"b[2].c"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"b[3][0]"</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="string">"d.e"</span>: <span class="number">2</span>,</span><br><span class="line">      <span class="string">"d.f"</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="comment">// "g": null,  å€¼ä¸ºnullæˆ–è€…undefinedï¼Œä¸¢å¼ƒ</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">flatten</span>(<span class="params">input</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/** ä»£ç å®ç° */</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>é€’å½’æ€æƒ³å®ç°å¯¹è±¡çš„æ‰å¹³åŒ–ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flatten</span>(<span class="params">obj, parentKey = <span class="string">""</span>, result = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class="line">      <span class="keyword">let</span> keyName = <span class="string">`<span class="subst">$&#123;parentKey&#125;</span><span class="subst">$&#123;key&#125;</span>`</span>;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> obj[key] === <span class="string">"object"</span>) &#123;</span><br><span class="line">        flatten(obj[key], keyName + <span class="string">"."</span>, result);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        result[keyName] = obj[key];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰æ®µæ—¶é—´åšäº†ä¸‰é“é˜¿é‡Œçš„åœ¨çº¿é¢è¯•é¢˜ï¼Œåˆ†äº«ä¸€ä¸‹&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢è¯•" scheme="https://coldstone.fun/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
      <category term="Interview" scheme="https://coldstone.fun/tags/Interview/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Github Action å‘å¸ƒ Flutter æ’ä»¶</title>
    <link href="https://coldstone.fun/post/2020/07/28/github-action-publish-flutter-plugin/"/>
    <id>https://coldstone.fun/post/2020/07/28/github-action-publish-flutter-plugin/</id>
    <published>2020-07-28T06:49:16.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡è¯´æ˜å¦‚ä½•ä½¿ç”¨ Github Actions è‡ªåŠ¨å‘å¸ƒ Flutter æ’ä»¶åˆ° pub.dev</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç¬”è€…æœ‰å‘å¸ƒè¿‡å‡ ä¸ª Flutter æ’ä»¶ï¼Œä¸€ç›´åœ¨æ‰‹åŠ¨æ›´æ–°ã€‚æ‰‹åŠ¨æ›´æ–°æ’ä»¶æœ‰ç‚¹éº»çƒ¦ä¸”å®¹æ˜“å¤±è´¥ï¼ˆéœ€è¦ç§‘å­¦ä¸Šç½‘ï¼‰ï¼Œå› æ­¤ç ”ç©¶äº†ä¸‹å¦‚ä½•ä½¿ç”¨ <a href="https://help.github.com/en/actions" target="_blank" rel="noopener">Github Actions</a>ï¼ˆGithub æä¾›çš„ä¸€ç§ CI/CD æœåŠ¡ï¼‰è‡ªåŠ¨å‘å¸ƒæ’ä»¶åˆ° pub.devï¼Œè¿™æ ·åšçš„å¥½å¤„æœ‰</p><ol><li>é¿å…æ‰‹åŠ¨å‘å¸ƒï¼ŒèŠ‚çº¦ä¸Šä¼ æ—¶é—´</li><li>åœ¨ Github åˆå¹¶åˆ«äººæäº¤çš„ä»£ç åä¹Ÿå¯ä»¥ç«‹å³å‘å¸ƒ</li></ol><p>ä»¥ä¸‹è¯´æ˜å¦‚ä½•è¿›è¡Œ</p><h2 id="æ·»åŠ æµç¨‹"><a href="#æ·»åŠ æµç¨‹" class="headerlink" title="æ·»åŠ æµç¨‹"></a>æ·»åŠ æµç¨‹</h2><p>é¦–å…ˆåœ¨æ’ä»¶çš„ <code>.github/workflows</code> ç›®å½•å†…åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ <code>publish.yml</code>ã€‚</p><p><img src="./images/github-action-publish-flutter-plugin/publish.png" alt="publish"></p><p>å†…å®¹å¦‚ä¸‹</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Publish</span> <span class="string">to</span> <span class="string">Pub.dev</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æµç¨‹è§¦å‘æ—¶æœºï¼Œå½“æœ‰æ ‡ç­¾åˆ›å»ºæ—¶è§¦å‘ï¼Œå¦‚ v1.0.0ã€‚å½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©åˆ«çš„è§¦å‘æ—¶æœºï¼Œå¦‚ pushï¼Œrelease ç­‰</span></span><br><span class="line"><span class="attr">on:</span> <span class="string">create</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">publishing:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="comment"># æ‹‰å–ä»“åº“ä»£ç </span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">"Checkout"</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">      <span class="comment"># å‘å¸ƒæ’ä»¶</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Dart</span> <span class="string">and</span> <span class="string">Flutter</span> <span class="string">Package</span> <span class="string">Publisher</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">k-paxian/dart-package-publisher@v1.2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="comment"># è®¾ç½®å‘å¸ƒæ’ä»¶éœ€è¦çš„ Token</span></span><br><span class="line">          <span class="attr">accessToken:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.OAUTH_ACCESS_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">refreshToken:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.OAUTH_REFRESH_TOKEN</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>æµç¨‹ä¸­éœ€è¦è®¾ç½® <code>OAUTH_ACCESS_TOKEN</code> å’Œ <code>OAUTH_REFRESH_TOKEN</code> è¿™ä¸¤ä¸ª Tokenï¼Œä»–ä»¬åœ¨ <code>.pub-cache/credentials.json</code> çš„æ–‡ä»¶å†…ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ç¬¬ä¸€æ¬¡æ‰‹åŠ¨å‘å¸ƒæ’ä»¶æˆåŠŸåè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œåœ¨ç”¨æˆ·çš„ home ç›®å½•æˆ–è€…æ˜¯å®‰è£… Flutter SDK ç›®å½•å†…ã€‚</p><p><img src="./images/github-action-publish-flutter-plugin/credentials.png" alt="credentials"></p><p>æ‹¿åˆ° Token åå»æ’ä»¶ä»“åº“æ·»åŠ ä»¥ä¸Šä¸¤ä¸ª Secretï¼Œè‡³æ­¤é…ç½®å·¥ä½œå·²å®Œæˆ ğŸ‰</p><p><img src="./images/github-action-publish-flutter-plugin/secrets.png" alt="secrets"></p><h2 id="å‘å¸ƒæ’ä»¶"><a href="#å‘å¸ƒæ’ä»¶" class="headerlink" title="å‘å¸ƒæ’ä»¶"></a>å‘å¸ƒæ’ä»¶</h2><p>ç°åœ¨æ¯æ¬¡æ›´æ–°æ’ä»¶åªéœ€è¦æ–°å¢æ ‡ç­¾ç„¶åæ¨é€åˆ°ä»“åº“ï¼Œå°±å¯ä»¥è‡ªåŠ¨æ›´æ–°æ’ä»¶å•¦ï¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git tag v1.0.1</span><br><span class="line"></span><br><span class="line">git push --tags</span><br></pre></td></tr></table></figure><p><img src="./images/github-action-publish-flutter-plugin/action.png" alt="action"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://github.com/marketplace/actions/dart-and-flutter-package-publisher" target="_blank" rel="noopener">Dart and Flutter Package Publisher</a></p><p>ç¬¬ä¸€æ¬¡å‘å¸ƒæ’ä»¶çœ‹è¿™é‡Œ <a href="https://flutter.cn/docs/development/packages-and-plugins/developing-packages" target="_blank" rel="noopener">Publishing your package</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡è¯´æ˜å¦‚ä½•ä½¿ç”¨ Github Actions è‡ªåŠ¨å‘å¸ƒ Flutter æ’ä»¶åˆ° pub.dev&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
      <category term="Github" scheme="https://coldstone.fun/tags/Github/"/>
    
  </entry>
  
  <entry>
    <title>Flutter ç»˜åˆ¶ä¸‰è§’ç½‘æ ¼ Triangular Mesh</title>
    <link href="https://coldstone.fun/post/2020/07/14/flutter-generative-artistry-02/"/>
    <id>https://coldstone.fun/post/2020/07/14/flutter-generative-artistry-02/</id>
    <published>2020-07-14T09:56:19.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡å®ç° Generative Artistry æ•™ç¨‹çš„ç¬¬ 4 ç¯‡å›¾å½¢ Triangular mesh æ•ˆæœå¦‚ä¸‹</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡å®ç° <a href="https://generativeartistry.com/tutorials/" target="_blank" rel="noopener">Generative Artistry</a> æ•™ç¨‹çš„ç¬¬ 4 ç¯‡å›¾å½¢ Triangular mesh æ•ˆæœå¦‚ä¸‹ã€‚</p><img src="./images/flutter-generative-artistry-02/colors.png" width="580" style="width: 290px"><p>æ²¡æŒ‰é¡ºåºæ¥ï¼Œå› ä¸ºç¬¬äºŒç¯‡ Joy Division æˆ‘è¿˜æ²¡å®ç° ğŸ˜</p><h2 id="åˆ›å»ºç”»å¸ƒ"><a href="#åˆ›å»ºç”»å¸ƒ" class="headerlink" title="åˆ›å»ºç”»å¸ƒ"></a>åˆ›å»ºç”»å¸ƒ</h2><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªç”¨äºç»˜åˆ¶çš„ç”»å¸ƒï¼Œç„¶åå®ç° <code>TriangularMeshPainter</code> çš„ <code>paint</code> æ–¹æ³•ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TriangularMesh</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> CustomPaint(</span><br><span class="line">      painter: TriangularMeshPainter(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TriangularMeshPainter</span> <span class="keyword">extends</span> <span class="title">CustomPainter</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;&#125;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> shouldRepaint(TriangularMeshPainter oldDelegate) =&gt; <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»˜åˆ¶ç«¯ç‚¹"><a href="#ç»˜åˆ¶ç«¯ç‚¹" class="headerlink" title="ç»˜åˆ¶ç«¯ç‚¹"></a>ç»˜åˆ¶ç«¯ç‚¹</h2><p>å£°æ˜ä¸€ä¸ª <code>gap</code> å˜é‡ç­‰æ¯”åˆ†å‰²ç”»å¸ƒï¼Œåœ¨çºµè½´ï¼Œæ¨ªè½´æ–¹å‘æ¯éš” <code>gap</code> é•¿åº¦ä½¿ç”¨ <code>canvas.drawCircle</code> æ–¹æ³•ç»˜åˆ¶åœ†ç‚¹ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TriangularMeshPainter</span> <span class="keyword">extends</span> <span class="title">CustomPainter</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">    <span class="comment">// å£°æ˜ line å’Œ lines å˜é‡å­˜å‚¨ç‚¹å’Œçº¿</span></span><br><span class="line">    <span class="built_in">List</span> line;</span><br><span class="line">    <span class="built_in">List</span> lines = [];</span><br><span class="line">    <span class="built_in">double</span> gap = size.width / <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®ç‚¹çš„ç»˜åˆ¶å±æ€§</span></span><br><span class="line">    Paint paint = Paint()</span><br><span class="line">      ..color = Colors.black</span><br><span class="line">      ..isAntiAlias = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çºµè½´æ–¹å‘</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">double</span> y = gap / <span class="number">2</span>; y &lt;= size.height; y += gap) &#123;</span><br><span class="line">      line = [];</span><br><span class="line">      <span class="comment">// æ¨ªè½´æ–¹å‘</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">double</span> x = gap / <span class="number">4</span>; x &lt;= size.width; x += gap) &#123;</span><br><span class="line">        line.add(&#123;<span class="string">"x"</span>: x, <span class="string">"y"</span>: y&#125;);</span><br><span class="line">        <span class="comment">// ç»˜åˆ¶åœ†ï¼Œå‚æ•°åˆ†åˆ«æ˜¯åœ†ç‚¹ä½ç½®ï¼Œåœ†çš„åŠå¾„ï¼Œç»˜åˆ¶å±æ€§</span></span><br><span class="line">        canvas.drawCircle(Offset(x, y), <span class="number">1</span>, paint);</span><br><span class="line">      &#125;</span><br><span class="line">      lines.add(line);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-generative-artistry-02/circle.png" width="580" style="width: 290px"><p>åˆ›å»ºä¸€ä¸ª <code>Point</code> ç±»ï¼Œè¡¨ç¤ºä¸€ä¸ªç»˜åˆ¶çš„åœ†ç‚¹ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="built_in">double</span> x;</span><br><span class="line">  <span class="built_in">double</span> y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†ä½¿ç‚¹ä¹‹é—´å½¢æˆä¸‰è§’å½¢ï¼Œä½¿ç”¨ä¸€ä¸ª <code>odd</code> å˜é‡ï¼Œåœ¨æ¯æ¬¡æ·»åŠ åœ†ç‚¹çš„æ—¶å€™æ”¹å˜ç‚¹çš„æ¨ªè½´å€¼ï¼Œå½¢æˆäº¤é”™æ•ˆæœã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">  <span class="built_in">bool</span> odd = <span class="keyword">false</span>;</span><br><span class="line">  <span class="built_in">List</span>&lt;Point&gt; line;</span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="built_in">List</span>&lt;Point&gt;&gt; lines = [];</span><br><span class="line">  <span class="built_in">double</span> gap = size.width / <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">  Paint paint = Paint()</span><br><span class="line">    ..color = Colors.black</span><br><span class="line">    ..isAntiAlias = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">double</span> y = gap / <span class="number">2</span>; y &lt;= size.height; y += gap) &#123;</span><br><span class="line">    <span class="comment">// æ¯æ¬¡æ·»åŠ åœ†ç‚¹ä¹‹å‰å¯¹ odd å–å</span></span><br><span class="line">    odd = !odd;</span><br><span class="line">    line = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">double</span> x = gap / <span class="number">4</span>; x &lt;= size.width; x += gap) &#123;</span><br><span class="line">      Point point = Point();</span><br><span class="line">      <span class="comment">// èµ‹å€¼åœ†ç‚¹æ¨ªè½´ä½ç½®æ—¶æ ¹æ® odd å˜é‡åˆ¤æ–­æ˜¯å¦éœ€è¦å¢åŠ è·ç¦»</span></span><br><span class="line">      point.x = x + (odd ? gap / <span class="number">2</span> : <span class="number">0</span>);</span><br><span class="line">      point.y = y;</span><br><span class="line">      <span class="comment">// å°†ç‚¹æ·»åŠ åˆ° line æ•°ç»„</span></span><br><span class="line">      line.add(point);</span><br><span class="line">      canvas.drawCircle(Offset(point.x, point.y), <span class="number">1</span>, paint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    lines.add(line);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-generative-artistry-02/odd.png" width="580" style="width: 290px"><h2 id="ç»˜åˆ¶ç½‘æ ¼"><a href="#ç»˜åˆ¶ç½‘æ ¼" class="headerlink" title="ç»˜åˆ¶ç½‘æ ¼"></a>ç»˜åˆ¶ç½‘æ ¼</h2><p>æ¥ä¸‹æ¥éœ€è¦å»ºç«‹ 3 ä¸ªç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œä»è€Œç»˜åˆ¶ä¸‰è§’å½¢ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ¥æ”¶ä¸‰è§’å½¢ä¸‰ä¸ªåæ ‡ï¼Œå¹¶è¿æ¥ç»˜åˆ¶å®ƒä»¬çš„å‡½æ•°ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _drawTriangle(Canvas canvas, Point pointA, Point pointB, Point pointC) &#123;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨ä¸€ä¸ªè·¯å¾„é“¾æ¥ 3 ç‚¹å¹¶ç»˜åˆ¶è¿™æ¡è·¯å¾„</span></span><br><span class="line">  Path path = Path();</span><br><span class="line">  Paint line = Paint()</span><br><span class="line">    ..color = Colors.black</span><br><span class="line">    ..style = PaintingStyle.stroke</span><br><span class="line">    ..strokeJoin = StrokeJoin.bevel</span><br><span class="line">    ..isAntiAlias = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">  path.moveTo(pointA.x, pointA.y);</span><br><span class="line">  path.lineTo(pointB.x, pointB.y);</span><br><span class="line">  path.lineTo(pointC.x, pointC.y);</span><br><span class="line">  path.lineTo(pointA.x, pointA.y);</span><br><span class="line">  <span class="comment">// å‚æ•°åˆ†åˆ«æ˜¯è·¯å¾„ï¼Œè·¯å¾„çš„ç»˜åˆ¶å±æ€§</span></span><br><span class="line">  canvas.drawPath(path, line);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åéå†æ‰€æœ‰å­˜å‚¨çš„çº¿ï¼Œå¹¶ç»„åˆç›¸é‚»çº¿çš„ç‚¹ä»¥å½¢æˆä¸‰è§’å½¢ã€‚</p><blockquote><p><a href="https://github.com/JChehe/blog/issues/24" target="_blank" rel="noopener">è¿™éƒ¨åˆ†ä¹Ÿè®¸ä¼šæœ‰ç‚¹éš¾ä»¥ç†è§£ã€‚è„šæœ¬ä¼šéå†æ‰€æœ‰çº¿ï¼Œå¹¶ç»„åˆç›¸é‚»çº¿çš„ç‚¹ä»¥å½¢æˆä¸‰è§’å½¢ã€‚ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬å°†ç›¸é‚»çš„ä¸¤æ¡çº¿åˆ†åˆ«ç§°ä¸º a å’Œ bã€‚ç„¶åå°†ä¸¤çº¿ç¬¦åˆè¦æ±‚çš„ç‚¹åˆå¹¶åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒâ€œä¹‹â€å­—å‹ï¼ša1ã€b1ã€a2ã€b2ã€a3 ä»¥æ­¤ç±»æ¨ã€‚<br>è¿™å°†ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå«æœ‰ä¸‰è§’å½¢æ‰€æœ‰åæ ‡çš„æ•°ç»„ã€‚å¦‚ï¼š[a1, b1, a2]ã€[b1, a2, b2], [a2, b2, a3] ç­‰ã€‚</a></p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">  <span class="comment">///<span class="markdown">...</span></span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">List</span> dotLine;</span><br><span class="line">  odd = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt; lines.length - <span class="number">1</span>; y++) &#123;</span><br><span class="line">    odd = !odd;</span><br><span class="line">    dotLine = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; lines[y].length; i++) &#123;</span><br><span class="line">      dotLine.add(odd ? lines[y][i] : lines[y + <span class="number">1</span>][i]);</span><br><span class="line">      dotLine.add(odd ? lines[y + <span class="number">1</span>][i] : lines[y][i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; dotLine.length - <span class="number">2</span>; i++) &#123;</span><br><span class="line">      _drawTriangle(canvas, dotLine[i], dotLine[i + <span class="number">1</span>], dotLine[i + <span class="number">2</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-generative-artistry-02/triangle.png" width="580" style="width: 290px"><p>åˆ›å»ºåœ†ç‚¹æ—¶åŠ å…¥éšæœºé‡ï¼Œå½¢æˆä¸è§„åˆ™çš„ä¸‰è§’å½¢ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">double</span> x = gap / <span class="number">4</span>; x &lt;= size.width; x += gap) &#123;</span><br><span class="line">  Point point = Point();</span><br><span class="line">  <span class="built_in">double</span> random = (Random().nextDouble() * <span class="number">.8</span> - <span class="number">.4</span>) * gap;</span><br><span class="line">  point.x = x + random + (odd ? gap / <span class="number">2</span> : <span class="number">0</span>);</span><br><span class="line">  point.y = y + (Random().nextDouble() * <span class="number">.8</span> - <span class="number">.4</span>) * gap;</span><br><span class="line">  line.add(point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-generative-artistry-02/random.png" width="580" style="width: 290px"><h2 id="æ·»åŠ é¢œè‰²"><a href="#æ·»åŠ é¢œè‰²" class="headerlink" title="æ·»åŠ é¢œè‰²"></a>æ·»åŠ é¢œè‰²</h2><p>æœ€ååœ¨ç»˜åˆ¶ä¸‰è§’å½¢å‡½æ•°é‚£é‡ŒåŠ ä¸Šä¸€äº›é¢œè‰²ï¼Œåªéœ€è¦è®¾ç½®è·¯å¾„çš„ <code>color</code> å’Œ <code>style</code> ç»˜åˆ¶å±æ€§å³å¯ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _drawTriangle(Canvas canvas, Point pointA, Point pointB, Point pointC) &#123;</span><br><span class="line">  Path path = Path();</span><br><span class="line">  Paint fill = Paint()</span><br><span class="line">    <span class="comment">// æ·»åŠ é¢œè‰²ï¼Œå¯ä»¥å°è¯•è®¾ç½®ä¸åŒçš„é¢œè‰²</span></span><br><span class="line">    ..color = Colors.black.withOpacity(Random().nextDouble() * <span class="number">.9</span>)</span><br><span class="line">    <span class="comment">// ..color = colors[Random().nextInt(colors.length)].withOpacity(.8)</span></span><br><span class="line">    <span class="comment">// å°†è·¯å¾„çš„ç»˜åˆ¶æ ·å¼è®¾ç½®ä¸º fill</span></span><br><span class="line">    ..style = PaintingStyle.fill</span><br><span class="line">    ..strokeJoin = StrokeJoin.bevel</span><br><span class="line">    ..isAntiAlias = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">  Paint line = Paint()</span><br><span class="line">    ..color = Colors.black</span><br><span class="line">    ..style = PaintingStyle.stroke</span><br><span class="line">    ..strokeJoin = StrokeJoin.bevel</span><br><span class="line">    ..isAntiAlias = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">  path.moveTo(pointA.x, pointA.y);</span><br><span class="line">  path.lineTo(pointB.x, pointB.y);</span><br><span class="line">  path.lineTo(pointC.x, pointC.y);</span><br><span class="line">  path.lineTo(pointA.x, pointA.y);</span><br><span class="line"></span><br><span class="line">  canvas.drawPath(path, fill);</span><br><span class="line">  <span class="comment">// æ–°å¢ä¸€ä¸ªè·¯å¾„ç»˜åˆ¶</span></span><br><span class="line">  canvas.drawPath(path, line);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§åŠŸå‘Šæˆï¼ğŸ‘</p><img src="./images/flutter-generative-artistry-02/black.png" width="580" style="width: 290px"><img src="./images/flutter-generative-artistry-02/colors.png" width="580" style="width: 290px"><p><a href="https://github.com/xrr2016/flutter-generative-artistry/blob/master/lib/graphs/triangular_mesh.dart" target="_blank" rel="noopener">ä»£ç åœ°å€</a></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://generativeartistry.com/tutorials/triangular-mesh" target="_blank" rel="noopener">Triangular Mesh</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡å®ç° Generative Artistry æ•™ç¨‹çš„ç¬¬ 4 ç¯‡å›¾å½¢ Triangular mesh æ•ˆæœå¦‚ä¸‹&lt;/p&gt;
    
    </summary>
    
    
      <category term="æ•™ç¨‹" scheme="https://coldstone.fun/categories/%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
      <category term="Generative artistry" scheme="https://coldstone.fun/tags/Generative-artistry/"/>
    
  </entry>
  
  <entry>
    <title>Flutter ç»˜åˆ¶ç“·ç –çº¿ Tiled Lines</title>
    <link href="https://coldstone.fun/post/2020/07/07/flutter-generative-artistry-01/"/>
    <id>https://coldstone.fun/post/2020/07/07/flutter-generative-artistry-01/</id>
    <published>2020-07-07T08:20:50.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>å‰å‡ å¤©å‘ç°äº†ä¸€ä¸ªä½¿ç”¨ <code>&lt;canvas&gt;</code> ç»˜åˆ¶å›¾å½¢çš„æ•™ç¨‹ generative artistry æ„Ÿè§‰å¾ˆæœ‰æ„æ€ï¼Œå°è¯•ç”¨ Flutter å®ç°ã€‚æœ¬æ–‡å®ç°ç¬¬ä¸€ç¯‡æ•™ç¨‹çš„å›¾å½¢ Tiled Lines æ•ˆæœå¦‚ä¸‹ã€‚</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰å‡ å¤©å‘ç°äº†ä¸€ä¸ªä½¿ç”¨ <code>&lt;canvas&gt;</code> ç»˜åˆ¶å›¾å½¢çš„æ•™ç¨‹ <a href="https://generativeartistry.com/tutorials/" target="_blank" rel="noopener">generative artistry</a> æ„Ÿè§‰å¾ˆæœ‰æ„æ€ï¼Œå°è¯•ç”¨ Flutter å®ç°ã€‚æœ¬æ–‡å®ç°ç¬¬ä¸€ç¯‡æ•™ç¨‹çš„å›¾å½¢ Tiled Lines æ•ˆæœå¦‚ä¸‹ã€‚</p><img src="./images/flutter-generative-artistry-01/tiled-lines.png" width="580" style="width: 290px"><h2 id="åˆ›å»ºç”»å¸ƒ"><a href="#åˆ›å»ºç”»å¸ƒ" class="headerlink" title="åˆ›å»ºç”»å¸ƒ"></a>åˆ›å»ºç”»å¸ƒ</h2><p>é¦–å…ˆä½¿ç”¨ä¸€ä¸ª <code>Container</code> æ§ä»¶åˆ›å»ºä¸€ä¸ª <code>320*320</code> å¤§å°çš„ç»˜åˆ¶åŒºåŸŸï¼Œæ·»åŠ  <code>CustomPaint</code> ç”»å¸ƒå’Œä¸€ä¸ªç»§æ‰¿ <code>CustomPainter</code><br>çš„ç”»ç¬” <code>TiledLinesPainter</code>ã€‚å…³äº <code>CustomPaint</code> å’Œ <code>CustomPainter</code> çš„çŸ¥è¯†å¯ä»¥æŸ¥é˜…è¿™ç¯‡æ–‡ç«  <a href="https://coldstone.fun/post/2020/05/31/flutter-bar-chart">ä½¿ç”¨ Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆä¸€ï¼‰æŸ±çŠ¶å›¾ ğŸ“Š</a>ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TiledLines</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: Center(</span><br><span class="line">        child: Container(</span><br><span class="line">          width: <span class="number">320.0</span>,</span><br><span class="line">          height: <span class="number">320.0</span>,</span><br><span class="line">          decoration: BoxDecoration(</span><br><span class="line">            border: Border.all(</span><br><span class="line">              color: Colors.black,</span><br><span class="line">              width: <span class="number">1.0</span>,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          child: CustomPaint(</span><br><span class="line">            painter: TiledLinesPainter(),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TiledLinesPainter</span> <span class="keyword">extends</span> <span class="title">CustomPainter</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span> shouldRepaint(TiledLinesPainter oldDelegate) =&gt; <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-generative-artistry-01/container.png" width="580" style="width: 290px"><h2 id="ç»˜åˆ¶çº¿æ¡"><a href="#ç»˜åˆ¶çº¿æ¡" class="headerlink" title="ç»˜åˆ¶çº¿æ¡"></a>ç»˜åˆ¶çº¿æ¡</h2><p>åˆ›å»ºå¥½ç”»å¸ƒååœ¨ <code>TiledLinesPainter</code> çš„ <code>paint</code> æ–¹æ³•é‡Œè¿›è¡Œç»˜åˆ¶ã€‚æ·»åŠ ä¸€ä¸ª <code>_drawLine</code> æ–¹æ³•ç”¨æ¥ç»˜åˆ¶çº¿æ¡ï¼Œç»˜åˆ¶çº¿æ¡éœ€è¦èµ·å§‹ç‚¹å’Œç»ˆæ­¢ç‚¹ï¼Œé€šè¿‡å‚æ•°å°†æ•°å€¼ä¼ å…¥ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TiledLinesPainter</span> <span class="keyword">extends</span> <span class="title">CustomPainter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">void</span> _drawLine(</span><br><span class="line">    Canvas canvas,</span><br><span class="line">    <span class="built_in">double</span> x,</span><br><span class="line">    <span class="built_in">double</span> y,</span><br><span class="line">    <span class="built_in">double</span> width,</span><br><span class="line">    <span class="built_in">double</span> height,</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">final</span> Paint paint = Paint()</span><br><span class="line">      ..strokeCap = StrokeCap.square</span><br><span class="line">      ..strokeWidth = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    Offset p1 = Offset(x, y);</span><br><span class="line">    Offset p2 = Offset(x + width, y + height);</span><br><span class="line"></span><br><span class="line">    canvas.drawLine(p1, p2, paint);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">    _drawLine(canvas, <span class="number">0</span>, <span class="number">0</span>, size.width, size.height);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span> shouldRepaint(TiledLinesPainter oldDelegate) =&gt; <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-generative-artistry-01/line.png" width="580" style="width: 290px"><h2 id="åŠ å…¥éšæœºæ€§"><a href="#åŠ å…¥éšæœºæ€§" class="headerlink" title="åŠ å…¥éšæœºæ€§"></a>åŠ å…¥éšæœºæ€§</h2><p>ä½¿ç”¨ <code>Random().nextBool()</code> æ–¹æ³•åˆ›å»ºä¸€ä¸ªéšæœºçš„å¸ƒå°”å€¼ï¼Œåœ¨ç»˜åˆ¶çº¿æ¡ä¹‹å‰æ”¹å˜èµ·å§‹ç‚¹å’Œç»ˆæ­¢ç‚¹çš„åæ ‡ï¼Œè¿™æ · <code>_drawLine</code> æ–¹æ³•å°±æœ‰äº†ç»˜åˆ¶ä¸åŒæ–¹å‘çš„çº¿æ¡çš„èƒ½åŠ›ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _drawLine(</span><br><span class="line">    Canvas canvas,</span><br><span class="line">    <span class="built_in">double</span> x,</span><br><span class="line">    <span class="built_in">double</span> y,</span><br><span class="line">    <span class="built_in">double</span> width,</span><br><span class="line">    <span class="built_in">double</span> height,</span><br><span class="line">  ) &#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">bool</span> isLeftToRight = Random().nextBool();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> Paint paint = Paint()</span><br><span class="line">    ..strokeCap = StrokeCap.square</span><br><span class="line">    ..strokeWidth = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">  Offset p1;</span><br><span class="line">  Offset p2;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isLeftToRight) &#123;</span><br><span class="line">    p1 = Offset(x, y);</span><br><span class="line">    p2 = Offset(x + width, y + height);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    p1 = Offset(x + width, y);</span><br><span class="line">    p2 = Offset(x, y + height);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  canvas.drawLine(p1, p2, paint);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-generative-artistry-01/line2.png" width="580" style="width: 290px"><h2 id="ç»˜åˆ¶æ›´å¤šçš„çº¿æ¡"><a href="#ç»˜åˆ¶æ›´å¤šçš„çº¿æ¡" class="headerlink" title="ç»˜åˆ¶æ›´å¤šçš„çº¿æ¡"></a>ç»˜åˆ¶æ›´å¤šçš„çº¿æ¡</h2><p>å¯ä»¥ç»˜åˆ¶æ›´å¤šçš„çº¿æ¡å–½ï¼ç»™ <code>TiledLinesPainter</code> æ·»åŠ ä¸€ä¸ª <code>step</code> å±æ€§ï¼Œè¡¨ç¤ºåœ¨ç”»å¸ƒä¸Šæ¯éš”å¤šé•¿è·ç¦»ç»˜åˆ¶ä¸€æ¡çº¿ã€‚ä½¿ç”¨ <code>step</code> å°†ç”»å¸ƒåˆ†å‰²ä¸ºå¤šä¸ªå°çš„æ–¹æ ¼ï¼Œåœ¨æ¯ä¸ªå°çš„æ–¹æ ¼é‡Œé¢ç»˜åˆ¶çº¿æ¡ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TiledLinesPainter</span> <span class="keyword">extends</span> <span class="title">CustomPainter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> step;</span><br><span class="line"></span><br><span class="line">  TiledLinesPainter(<span class="keyword">this</span>.step);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> _drawLine(</span><br><span class="line">    Canvas canvas,</span><br><span class="line">    <span class="built_in">double</span> x,</span><br><span class="line">    <span class="built_in">double</span> y,</span><br><span class="line">    <span class="built_in">double</span> width,</span><br><span class="line">    <span class="built_in">double</span> height,</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">bool</span> isLeftToRight = Random().nextBool();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Paint paint = Paint()</span><br><span class="line">      ..strokeCap = StrokeCap.square</span><br><span class="line">      ..strokeWidth = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    Offset p1;</span><br><span class="line">    Offset p2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isLeftToRight) &#123;</span><br><span class="line">      p1 = Offset(x, y);</span><br><span class="line">      p2 = Offset(x + width, y + height);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      p1 = Offset(x + width, y);</span><br><span class="line">      p2 = Offset(x, y + height);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    canvas.drawLine(p1, p2, paint);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">double</span> x = <span class="number">0</span>; x &lt; size.width; x += step) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">double</span> y = <span class="number">0</span>; y &lt; size.height; y += step) &#123;</span><br><span class="line">        _drawLine(canvas, x, y, step, step);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span> shouldRepaint(TiledLinesPainter oldDelegate) =&gt; <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">TiledLinesPainter(<span class="number">20</span>)</span><br></pre></td></tr></table></figure><img src="./images/flutter-generative-artistry-01/step.png" width="580" style="width: 290px"><h2 id="ç»˜åˆ¶è¾¹æ¡†å’Œé˜´å½±"><a href="#ç»˜åˆ¶è¾¹æ¡†å’Œé˜´å½±" class="headerlink" title="ç»˜åˆ¶è¾¹æ¡†å’Œé˜´å½±"></a>ç»˜åˆ¶è¾¹æ¡†å’Œé˜´å½±</h2><p>æœ€åç»™ç”»å¸ƒæ·»åŠ è¾¹æ¡†å’Œé˜´å½±æ•ˆæœï¼Œå¤§åŠŸå‘Šæˆï¼ğŸ‘ æ„Ÿè°¢é˜…è¯»ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:math'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TiledLines</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="built_in">List</span>&lt;BoxShadow&gt; shadows = [];</span><br><span class="line">    <span class="built_in">double</span> opacity = <span class="number">0.1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ ç”»å¸ƒé˜´å½±</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">double</span> i = <span class="number">1</span>; i &lt;= <span class="number">16</span>; i++) &#123;</span><br><span class="line">      opacity -= <span class="number">0.01</span>;</span><br><span class="line">      opacity = opacity &gt; <span class="number">0.01</span> ? opacity : <span class="number">0.01</span>;</span><br><span class="line"></span><br><span class="line">      shadows.add(</span><br><span class="line">        BoxShadow(</span><br><span class="line">          offset: Offset(-i, i),</span><br><span class="line">          color: Color.fromRGBO(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, opacity),</span><br><span class="line">          blurRadius: <span class="number">2</span>,</span><br><span class="line">          spreadRadius: <span class="number">1</span>,</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: Center(</span><br><span class="line">        child: Container(</span><br><span class="line">          width: <span class="number">320.0</span>,</span><br><span class="line">          height: <span class="number">320.0</span>,</span><br><span class="line">          decoration: BoxDecoration(</span><br><span class="line">            <span class="comment">// æ·»åŠ ç”»å¸ƒè¾¹æ¡†</span></span><br><span class="line">            border: Border.all(</span><br><span class="line">              color: Colors.black,</span><br><span class="line">              width: <span class="number">20.0</span>,</span><br><span class="line">            ),</span><br><span class="line">            boxShadow: shadows,</span><br><span class="line">          ),</span><br><span class="line">          child: Container(</span><br><span class="line">            color: Colors.white,</span><br><span class="line">            padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">20.0</span>),</span><br><span class="line">            child: CustomPaint(</span><br><span class="line">              painter: TiledLinesPainter(<span class="number">20</span>),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TiledLinesPainter</span> <span class="keyword">extends</span> <span class="title">CustomPainter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> step;</span><br><span class="line"></span><br><span class="line">  TiledLinesPainter(<span class="keyword">this</span>.step);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> _drawLine(</span><br><span class="line">    Canvas canvas,</span><br><span class="line">    <span class="built_in">double</span> x,</span><br><span class="line">    <span class="built_in">double</span> y,</span><br><span class="line">    <span class="built_in">double</span> width,</span><br><span class="line">    <span class="built_in">double</span> height,</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºéšæœºæ€§</span></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">bool</span> isLeftToRight = Random().nextBool();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Paint paint = Paint()</span><br><span class="line">      ..strokeCap = StrokeCap.square</span><br><span class="line">      ..strokeWidth = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    Offset p1;</span><br><span class="line">    Offset p2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®çº¿æ¡çš„èµ·å§‹ç‚¹å’Œç»ˆæ­¢ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (isLeftToRight) &#123;</span><br><span class="line">      p1 = Offset(x, y);</span><br><span class="line">      p2 = Offset(x + width, y + height);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      p1 = Offset(x + width, y);</span><br><span class="line">      p2 = Offset(x, y + height);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    canvas.drawLine(p1, p2, paint);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ step åˆ†å‰²ç”»å¸ƒï¼Œåˆ›å»ºå°çš„ç»˜åˆ¶æ–¹æ ¼</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">double</span> x = <span class="number">0</span>; x &lt; size.width; x += step) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">double</span> y = <span class="number">0</span>; y &lt; size.height; y += step) &#123;</span><br><span class="line">        _drawLine(canvas, x, y, step, step);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span> shouldRepaint(TiledLinesPainter oldDelegate) =&gt; <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-generative-artistry-01/tiled-lines.png" width="580" style="width: 290px"><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://generativeartistry.com/tutorials/tiled-lines/" target="_blank" rel="noopener">Tiled Lines</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰å‡ å¤©å‘ç°äº†ä¸€ä¸ªä½¿ç”¨ &lt;code&gt;&amp;lt;canvas&amp;gt;&lt;/code&gt; ç»˜åˆ¶å›¾å½¢çš„æ•™ç¨‹ generative artistry æ„Ÿè§‰å¾ˆæœ‰æ„æ€ï¼Œå°è¯•ç”¨ Flutter å®ç°ã€‚æœ¬æ–‡å®ç°ç¬¬ä¸€ç¯‡æ•™ç¨‹çš„å›¾å½¢ Tiled Lines æ•ˆæœå¦‚ä¸‹ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æ•™ç¨‹" scheme="https://coldstone.fun/categories/%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
      <category term="Generative artistry" scheme="https://coldstone.fun/tags/Generative-artistry/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨ Flutter å®ç°æ¢æ¢å¡ç‰‡å¸ƒå±€</title>
    <link href="https://coldstone.fun/post/2020/06/18/flutter-tinder-card/"/>
    <id>https://coldstone.fun/post/2020/06/18/flutter-tinder-card/</id>
    <published>2020-06-18T04:22:08.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>å‰å‡ å¤©å†™äº†ä¸€ä¸ª Fluter æ’ä»¶ tcardï¼Œç”¨æ¥å®ç°ç±»ä¼¼äºæ¢æ¢å¡ç‰‡çš„å¸ƒå±€ã€‚</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰å‡ å¤©å†™äº†ä¸€ä¸ª Fluter æ’ä»¶ <a href="https://github.com/xrr2016/tcard" target="_blank" rel="noopener">tcard</a>ï¼Œç”¨æ¥å®ç°ç±»ä¼¼äºæ¢æ¢å¡ç‰‡çš„å¸ƒå±€ã€‚æ•ˆæœå¦‚ä¸‹ï¼Œæœ¬æ–‡è®²è§£å¦‚ä½•ä½¿ç”¨ <code>Stack</code> æ§ä»¶å®ç°è¿™ä¸ªå¸ƒå±€ã€‚</p><img src="./images/flutter-tinder-card/images.gif" width="900" style="width: 500px"><p><a href="https://dartpad.dev/efe152273d6835af5cec6d8f40ab0c58" target="_blank" rel="noopener">åœ¨çº¿æŸ¥çœ‹</a></p><h2 id="åˆè¯†-Stack"><a href="#åˆè¯†-Stack" class="headerlink" title="åˆè¯† Stack"></a>åˆè¯† Stack</h2><p><code>Stack</code> æ˜¯ä¸€ä¸ªæœ‰å¤šå­é¡¹çš„æ§ä»¶ï¼Œå®ƒä¼šå°†è‡ªå·±çš„å­é¡¹ç›¸å¯¹äºè‡ªèº«è¾¹ç¼˜è¿›è¡Œå®šä½ï¼Œåé¢çš„å­é¡¹ä¼šè¦†ç›–å‰é¢çš„å­é¡¹ã€‚é€šå¸¸ç”¨æ¥å®ç°å°†ä¸€ä¸ªæ§ä»¶è¦†ç›–äºå¦ä¸€ä¸ªæ§ä»¶ä¹‹ä¸Šçš„å¸ƒå±€ï¼Œæ¯”å¦‚åœ¨ä¸€å¼ å›¾ç‰‡ä¸Šæ˜¾ç¤ºä¸€äº›æ–‡å­—ã€‚å­é¡¹çš„é»˜è®¤ä½ç½®åœ¨ <code>Stack</code> å·¦ä¸Šè§’ï¼Œä¹Ÿå¯ä»¥ç”¨ <code>Align</code> æˆ–è€… <code>Positioned</code> æ§ä»¶åˆ†åˆ«è¿›è¡Œå®šä½ã€‚</p><img src="https://flutter.github.io/assets-for-api-docs/assets/widgets/stack.png" style="width: 520px"><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Stack(</span><br><span class="line">  children: &lt;Widget&gt;[</span><br><span class="line">    Container(</span><br><span class="line">      width: <span class="number">100</span>,</span><br><span class="line">      height: <span class="number">100</span>,</span><br><span class="line">      color: Colors.red,</span><br><span class="line">    ),</span><br><span class="line">    Container(</span><br><span class="line">      width: <span class="number">90</span>,</span><br><span class="line">      height: <span class="number">90</span>,</span><br><span class="line">      color: Colors.green,</span><br><span class="line">    ),</span><br><span class="line">    Container(</span><br><span class="line">      width: <span class="number">80</span>,</span><br><span class="line">      height: <span class="number">80</span>,</span><br><span class="line">      color: Colors.blue,</span><br><span class="line">    ),</span><br><span class="line">  ],</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><a href="https://youtu.be/liEGSeD3Zt8" target="_blank" rel="noopener">Stack (Flutter Widget of the Week)</a></p><h2 id="å¸ƒå±€æ€è·¯"><a href="#å¸ƒå±€æ€è·¯" class="headerlink" title="å¸ƒå±€æ€è·¯"></a>å¸ƒå±€æ€è·¯</h2><p>è¦ä½¿ç”¨ <code>Stack</code> å®ç°è¿™ä¸ªå¡ç‰‡å¸ƒå±€çš„å¤§è‡´æ€è·¯å¦‚ä¸‹</p><ol><li>é¦–å…ˆéœ€è¦å‰ï¼Œä¸­ï¼Œåä¸‰ä¸ªå­æ§ä»¶ï¼Œä½¿ç”¨ <code>Align</code> æ§ä»¶å®šä½åœ¨å®¹å™¨ä¸­ã€‚</li><li>éœ€è¦ä¸€ä¸ªæ‰‹åŠ¿ç›‘å¬å™¨ <code>GestureDetector</code> ç›‘å¬æ‰‹æŒ‡æ»‘åŠ¨ã€‚</li><li>ç›‘å¬æ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ»‘åŠ¨åŒæ—¶æ›´æ–°æœ€å‰é¢å¡ç‰‡çš„ä½ç½®ã€‚</li><li>åˆ¤æ–­ç§»åŠ¨çš„æ¨ªè½´è·ç¦»è¿›è¡Œå¡ç‰‡ä½ç½®å˜æ¢åŠ¨ç”»æˆ–è€…å¡ç‰‡å›å¼¹åŠ¨ç”»ã€‚</li><li>å¦‚æœè¿è¡Œäº†å¡ç‰‡ä½ç½®å˜æ¢åŠ¨ç”»åœ¨åŠ¨ç”»ç»“æŸåæ›´æ–°å¡ç‰‡çš„ç´¢å¼•å€¼ã€‚</li></ol><h2 id="å¡ç‰‡å¸ƒå±€"><a href="#å¡ç‰‡å¸ƒå±€" class="headerlink" title="å¡ç‰‡å¸ƒå±€"></a>å¡ç‰‡å¸ƒå±€</h2><ol><li>åˆ›å»º <code>Stack</code> å®¹å™¨ä»¥åŠå‰ï¼Œä¸­ï¼Œåä¸‰ä¸ªå­æ§ä»¶</li></ol><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _MyAppState createState() =&gt; _MyAppState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyAppState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyApp</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">//  å‰é¢çš„å¡ç‰‡ï¼Œä½¿ç”¨ Align å®šä½</span></span><br><span class="line">  Widget _frontCard() &#123;</span><br><span class="line">    <span class="keyword">return</span> Align(</span><br><span class="line">      child: Container(</span><br><span class="line">        color: Colors.blue,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸­é—´çš„å¡ç‰‡ï¼Œä½¿ç”¨ Align å®šä½</span></span><br><span class="line">  Widget _middleCard() &#123;</span><br><span class="line">    <span class="keyword">return</span> Align(</span><br><span class="line">      child: Container(</span><br><span class="line">        color: Colors.red,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åé¢çš„å¡ç‰‡ï¼Œä½¿ç”¨ Align å®šä½</span></span><br><span class="line">  Widget _backCard() &#123;</span><br><span class="line">    <span class="keyword">return</span> Align(</span><br><span class="line">      child: Container(</span><br><span class="line">        color: Colors.green,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">'TCards demo'</span>,</span><br><span class="line">      debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        body: Center(</span><br><span class="line">          child: SizedBox(</span><br><span class="line">            width: <span class="number">300</span>,</span><br><span class="line">            height: <span class="number">400</span>,</span><br><span class="line">            child: Stack(</span><br><span class="line">              children: [</span><br><span class="line">                <span class="comment">// åé¢çš„å­é¡¹ä¼šæ˜¾ç¤ºåœ¨ä¸Šé¢ï¼Œæ‰€ä»¥å‰é¢çš„å¡ç‰‡æ”¾åœ¨æœ€å</span></span><br><span class="line">                _backCard(),</span><br><span class="line">                _middleCard(),</span><br><span class="line">                _frontCard(),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-tinder-card/stack.png" width="560" style="width: 280px"><ol start="2"><li>å¯¹å­æ§ä»¶åˆ†åˆ«å®šä½å¹¶è®¾ç½®å…¶å°ºå¯¸</li></ol><p>å®šä½éœ€è¦è®¾ç½® <code>Align</code> æ§ä»¶çš„ alignment å±æ€§ï¼Œä¼ å…¥ä¸€ä¸ª <code>Alignment(x, y)</code> è¿›è¡Œè®¾ç½®ã€‚è®¾ç½®å°ºå¯¸éœ€è¦ä½¿ç”¨ <code>LayoutBuilder</code> è·å–å½“å‰çˆ¶å®¹å™¨çš„å°ºå¯¸ï¼Œç„¶åæ ¹æ®å®¹å™¨å°ºå¯¸è¿›è¡Œè®¡ç®—ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyAppState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyApp</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">//  å‰é¢çš„å¡ç‰‡ï¼Œä½¿ç”¨ Align å®šä½</span></span><br><span class="line">  Widget _frontCard(BoxConstraints constraints) &#123;</span><br><span class="line">    <span class="keyword">return</span> Align(</span><br><span class="line">      alignment: Alignment(<span class="number">0.0</span>, <span class="number">-0.5</span>),</span><br><span class="line">      <span class="comment">// ä½¿ç”¨ SizedBox ç¡®å®šå¡ç‰‡å°ºå¯¸</span></span><br><span class="line">      child: SizedBox.fromSize(</span><br><span class="line">        <span class="comment">// è®¡ç®—å¡ç‰‡å°ºå¯¸ï¼Œç›¸å¯¹äºçˆ¶å®¹å™¨</span></span><br><span class="line">        size: Size(constraints.maxWidth * <span class="number">0.9</span>, constraints.maxHeight * <span class="number">0.9</span>),</span><br><span class="line">        child: Container(</span><br><span class="line">          color: Colors.blue,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸­é—´çš„å¡ç‰‡ï¼Œä½¿ç”¨ Align å®šä½</span></span><br><span class="line">  Widget _middleCard(BoxConstraints constraints) &#123;</span><br><span class="line">    <span class="keyword">return</span> Align(</span><br><span class="line">      alignment: Alignment(<span class="number">0.0</span>, <span class="number">0.0</span>),</span><br><span class="line">      child: SizedBox.fromSize(</span><br><span class="line">        <span class="comment">// è®¡ç®—å¡ç‰‡å°ºå¯¸ï¼Œç›¸å¯¹äºçˆ¶å®¹å™¨</span></span><br><span class="line">        size: Size(constraints.maxWidth * <span class="number">0.85</span>, constraints.maxHeight * <span class="number">0.9</span>),</span><br><span class="line">        child: Container(</span><br><span class="line">          color: Colors.red,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åé¢çš„å¡ç‰‡ï¼Œä½¿ç”¨ Align å®šä½</span></span><br><span class="line">  Widget _backCard(BoxConstraints constraints) &#123;</span><br><span class="line">    <span class="keyword">return</span> Align(</span><br><span class="line">      alignment: Alignment(<span class="number">0.0</span>, <span class="number">0.5</span>),</span><br><span class="line">      child: SizedBox.fromSize(</span><br><span class="line">        <span class="comment">// è®¡ç®—å¡ç‰‡å°ºå¯¸ï¼Œç›¸å¯¹äºçˆ¶å®¹å™¨</span></span><br><span class="line">        size: Size(constraints.maxWidth * <span class="number">0.8</span>, constraints.maxHeight * <span class="number">.9</span>),</span><br><span class="line">        child: Container(</span><br><span class="line">          color: Colors.green,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">'TCards demo'</span>,</span><br><span class="line">      debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        body: Center(</span><br><span class="line">          child: SizedBox(</span><br><span class="line">            width: <span class="number">300</span>,</span><br><span class="line">            height: <span class="number">400</span>,</span><br><span class="line">            child: LayoutBuilder(</span><br><span class="line">              builder: (context, constraints) &#123;</span><br><span class="line">                <span class="comment">// ä½¿ç”¨ LayoutBuilder è·å–å®¹å™¨çš„å°ºå¯¸ï¼Œä¼ ä¸ªå­é¡¹è®¡ç®—å¡ç‰‡å°ºå¯¸</span></span><br><span class="line">                <span class="keyword">return</span> Stack(</span><br><span class="line">                  children: [</span><br><span class="line">                    <span class="comment">// åé¢çš„å­é¡¹ä¼šæ˜¾ç¤ºåœ¨ä¸Šé¢ï¼Œæ‰€ä»¥å‰é¢çš„å¡ç‰‡æ”¾åœ¨æœ€å</span></span><br><span class="line">                    _backCard(constraints),</span><br><span class="line">                    _middleCard(constraints),</span><br><span class="line">                    _frontCard(constraints),</span><br><span class="line">                  ],</span><br><span class="line">                );</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-tinder-card/align.png" width="560" style="width: 280px"><ol start="3"><li>æ›´æ–°æœ€å‰é¢å¡ç‰‡ä½ç½®</li></ol><p>å‘ <code>Stack</code> å®¹å™¨æ·»åŠ ä¸€ä¸ª <code>GestureDetector</code>ï¼Œæ‰‹æŒ‡åœ¨å±å¹•ä¸Šç§»åŠ¨æ—¶æ›´æ–°æœ€å‰é¢å¡ç‰‡çš„ä½ç½®ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyAppState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyApp</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// ä¿å­˜æœ€å‰é¢å¡ç‰‡çš„å®šä½</span></span><br><span class="line">  Alignment _frontCardAlignment = Alignment(<span class="number">0.0</span>, <span class="number">-0.5</span>);</span><br><span class="line">  <span class="comment">// ä¿å­˜æœ€å‰é¢å¡ç‰‡çš„æ—‹è½¬è§’åº¦</span></span><br><span class="line">  <span class="built_in">double</span> _frontCardRotation = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  å‰é¢çš„å¡ç‰‡ï¼Œä½¿ç”¨ Align å®šä½</span></span><br><span class="line">  Widget _frontCard(BoxConstraints constraints) &#123;</span><br><span class="line">    <span class="keyword">return</span> Align(</span><br><span class="line">      alignment: _frontCardAlignment,</span><br><span class="line">      <span class="comment">// ä½¿ç”¨ Transform.rotate æ—‹è½¬å¡ç‰‡</span></span><br><span class="line">      child: Transform.rotate(</span><br><span class="line">        angle: (pi / <span class="number">180.0</span>) * _frontCardRotation,</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ SizedBox ç¡®å®šå¡ç‰‡å°ºå¯¸</span></span><br><span class="line">        child: SizedBox.fromSize(</span><br><span class="line">          size: Size(constraints.maxWidth * <span class="number">0.9</span>, constraints.maxHeight * <span class="number">0.9</span>),</span><br><span class="line">          child: Container(</span><br><span class="line">            color: Colors.blue,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// çœç•¥......</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">'TCards demo'</span>,</span><br><span class="line">      debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        body: Center(</span><br><span class="line">          child: SizedBox(</span><br><span class="line">            width: <span class="number">300</span>,</span><br><span class="line">            height: <span class="number">400</span>,</span><br><span class="line">            child: LayoutBuilder(</span><br><span class="line">              builder: (context, constraints) &#123;</span><br><span class="line">                <span class="comment">// ä½¿ç”¨ LayoutBuilder è·å–å®¹å™¨çš„å°ºå¯¸ï¼Œä¼ ä¸ªå­é¡¹è®¡ç®—å¡ç‰‡å°ºå¯¸</span></span><br><span class="line">                Size size = MediaQuery.of(context).size;</span><br><span class="line">                <span class="built_in">double</span> speed = <span class="number">10.0</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> Stack(</span><br><span class="line">                  children: [</span><br><span class="line">                    <span class="comment">// åé¢çš„å­é¡¹ä¼šæ˜¾ç¤ºåœ¨ä¸Šé¢ï¼Œæ‰€ä»¥å‰é¢çš„å¡ç‰‡æ”¾åœ¨æœ€å</span></span><br><span class="line">                    _backCard(constraints),</span><br><span class="line">                    _middleCard(constraints),</span><br><span class="line">                    _frontCard(constraints),</span><br><span class="line">                    <span class="comment">// ä½¿ç”¨ä¸€ä¸ªå æ»¡çˆ¶å…ƒç´ çš„ GestureDetector ç›‘å¬æ‰‹æŒ‡ç§»åŠ¨</span></span><br><span class="line">                    SizedBox.expand(</span><br><span class="line">                      child: GestureDetector(</span><br><span class="line">                        onPanDown: (DragDownDetails details) &#123;&#125;,</span><br><span class="line">                        onPanUpdate: (DragUpdateDetails details) &#123;</span><br><span class="line">                          <span class="comment">// æ‰‹æŒ‡ç§»åŠ¨å°±æ›´æ–°æœ€å‰é¢å¡ç‰‡çš„ alignment å±æ€§</span></span><br><span class="line">                          _frontCardAlignment += Alignment(</span><br><span class="line">                            details.delta.dx / (size.width / <span class="number">2</span>) * speed,</span><br><span class="line">                            details.delta.dy / (size.height / <span class="number">2</span>) * speed,</span><br><span class="line">                          );</span><br><span class="line">                          <span class="comment">// è®¾ç½®æœ€å‰é¢å¡ç‰‡çš„æ—‹è½¬è§’åº¦</span></span><br><span class="line">                          _frontCardRotation = _frontCardAlignment.x;</span><br><span class="line">                          <span class="comment">// setState æ›´æ–°ç•Œé¢</span></span><br><span class="line">                          setState(() &#123;&#125;);</span><br><span class="line">                        &#125;,</span><br><span class="line">                        onPanEnd: (DragEndDetails details) &#123;&#125;,</span><br><span class="line">                      ),</span><br><span class="line">                    ),</span><br><span class="line">                  ],</span><br><span class="line">                );</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-tinder-card/pan.gif" width="260" style="width: 280px"><h2 id="å¡ç‰‡åŠ¨ç”»"><a href="#å¡ç‰‡åŠ¨ç”»" class="headerlink" title="å¡ç‰‡åŠ¨ç”»"></a>å¡ç‰‡åŠ¨ç”»</h2><p>è¿™ä¸ªå¸ƒå±€æœ‰ä¸‰ç§åŠ¨ç”»ï¼Œæœ€å‰é¢å¡ç‰‡ç§»å¼€çš„åŠ¨ç”»ï¼›åé¢ä¸¤å¼ å¡ç‰‡ä½ç½®å’Œå°ºå¯¸å˜åŒ–çš„åŠ¨ç”»ï¼›æœ€å‰é¢å¡ç‰‡å›åˆ°åŸä½çš„åŠ¨ç”»ã€‚</p><ol><li>åˆ¤æ–­å¡ç‰‡æ¨ªè½´ç§»åŠ¨è·ç¦»</li></ol><p>åœ¨æ‰‹æŒ‡ç¦»å¼€å±å¹•æ—¶åˆ¤æ–­å¡ç‰‡æ¨ªè½´çš„ç§»åŠ¨è·ç¦»ï¼Œå¦‚æœæœ€å‰é¢çš„å¡ç‰‡æ¨ªè½´ç§»åŠ¨è·ç¦»è¶…è¿‡é™åˆ¶å°±è¿è¡Œæ¢ä½åŠ¨ç”»ï¼Œå¦åˆ™è¿è¡Œå›å¼¹åŠ¨ç”»ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ”¹å˜ä½ç½®çš„åŠ¨ç”»</span></span><br><span class="line"><span class="keyword">void</span> _runChangeOrderAnimation() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¡ç‰‡å›å¼¹çš„åŠ¨ç”»</span></span><br><span class="line"><span class="keyword">void</span> _runReboundAnimation(Offset pixelsPerSecond, Size size) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœç•¥...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¡ç‰‡æ¨ªè½´è·ç¦»é™åˆ¶</span></span><br><span class="line"><span class="keyword">final</span> <span class="built_in">double</span> limit = <span class="number">10.0</span>;</span><br><span class="line"></span><br><span class="line">SizedBox.expand(</span><br><span class="line">  child: GestureDetector(</span><br><span class="line">    <span class="comment">// çœç•¥...</span></span><br><span class="line">    onPanEnd: (DragEndDetails details) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæœ€å‰é¢çš„å¡ç‰‡æ¨ªè½´ç§»åŠ¨è·ç¦»è¶…è¿‡é™åˆ¶å°±è¿è¡Œæ¢ä½åŠ¨ç”»ï¼Œå¦åˆ™è¿è¡Œå›å¼¹åŠ¨ç”»</span></span><br><span class="line">      <span class="keyword">if</span> (_frontCardAlignment.x &gt; limit ||</span><br><span class="line">          _frontCardAlignment.x &lt; -limit) &#123;</span><br><span class="line">        _runChangeOrderAnimation();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _runReboundAnimation(</span><br><span class="line">          details.velocity.pixelsPerSecond,</span><br><span class="line">          size,</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  ),</span><br><span class="line">),</span><br></pre></td></tr></table></figure><ol start="2"><li>å¡ç‰‡å›å¼¹åŠ¨ç”»</li></ol><p>é¦–å…ˆå®ç°å¡ç‰‡å›å¼¹çš„åŠ¨ç”»ï¼Œä½¿ç”¨ <code>AnimationController</code> æ§åˆ¶åŠ¨ç”»ï¼Œåœ¨ <code>initState</code> åˆå§‹åŒ–åŠ¨ç”»æ§åˆ¶å™¨ã€‚åˆ›å»ºä¸€ä¸ª <code>AlignmentTween</code> è®¾ç½®åŠ¨ç”»è¿åŠ¨å€¼ï¼Œèµ·å§‹å€¼æ˜¯å¡ç‰‡å½“å‰ä½ç½®ï¼Œæœ€ç»ˆå€¼æ˜¯å¡ç‰‡çš„é»˜è®¤ä½ç½®ã€‚ç„¶åå°†ä¸€ä¸ªå¼¹ç°§æ¨¡æ‹Ÿ <code>SpringSimulation</code> ä¼ é€’ç»™åŠ¨ç”»æ§åˆ¶å™¨ï¼Œè®©åŠ¨ç”»æ¨¡æ‹Ÿè¿è¡Œã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyAppState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyApp</span>&gt; <span class="title">with</span> <span class="title">TickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  <span class="comment">// çœç•¥...</span></span><br><span class="line">  <span class="comment">// å¡ç‰‡å›å¼¹åŠ¨ç”»</span></span><br><span class="line">  Animation&lt;Alignment&gt; _reboundAnimation;</span><br><span class="line">  <span class="comment">// å¡ç‰‡å›å¼¹åŠ¨ç”»æ§åˆ¶å™¨</span></span><br><span class="line">  AnimationController _reboundController;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// çœç•¥...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¡ç‰‡å›å¼¹çš„åŠ¨ç”»</span></span><br><span class="line">  <span class="keyword">void</span> _runReboundAnimation(Offset pixelsPerSecond, Size size) &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºåŠ¨ç”»å€¼</span></span><br><span class="line">    _reboundAnimation = _reboundController.drive(</span><br><span class="line">      AlignmentTween(</span><br><span class="line">        <span class="comment">// èµ·å§‹å€¼æ˜¯å¡ç‰‡å½“å‰ä½ç½®ï¼Œæœ€ç»ˆå€¼æ˜¯å¡ç‰‡çš„é»˜è®¤ä½ç½®</span></span><br><span class="line">        begin: _frontCardAlignment,</span><br><span class="line">        end: Alignment(<span class="number">0.0</span>, <span class="number">-0.5</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// è®¡ç®—å¡ç‰‡è¿åŠ¨é€Ÿåº¦</span></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">double</span> unitsPerSecondX = pixelsPerSecond.dx / size.width;</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">double</span> unitsPerSecondY = pixelsPerSecond.dy / size.height;</span><br><span class="line">    <span class="keyword">final</span> unitsPerSecond = Offset(unitsPerSecondX, unitsPerSecondY);</span><br><span class="line">    <span class="keyword">final</span> unitVelocity = unitsPerSecond.distance;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå¼¹ç°§æ¨¡æ‹Ÿçš„å®šä¹‰</span></span><br><span class="line">    <span class="keyword">const</span> spring = SpringDescription(mass: <span class="number">30</span>, stiffness: <span class="number">1</span>, damping: <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// åˆ›å»ºå¼¹ç°§æ¨¡æ‹Ÿ</span></span><br><span class="line">    <span class="keyword">final</span> simulation = SpringSimulation(spring, <span class="number">0</span>, <span class="number">1</span>, -unitVelocity);</span><br><span class="line">    <span class="comment">// æ ¹æ®ç»™å®šçš„æ¨¡æ‹Ÿè¿è¡ŒåŠ¨ç”»</span></span><br><span class="line">    _reboundController.animateWith(simulation);</span><br><span class="line">    <span class="comment">// é‡ç½®æ—‹è½¬å€¼</span></span><br><span class="line">    _frontCardRotation = <span class="number">0.0</span>;</span><br><span class="line">    setState(() &#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å›å¼¹çš„åŠ¨ç”»æ§åˆ¶å™¨</span></span><br><span class="line">    _reboundController = AnimationController(vsync: <span class="keyword">this</span>)</span><br><span class="line">      ..addListener(() &#123;</span><br><span class="line">        setState(() &#123;</span><br><span class="line">          <span class="comment">// åŠ¨ç”»è¿è¡Œæ—¶æ›´æ–°æœ€å‰é¢å¡ç‰‡çš„ alignment å±æ€§</span></span><br><span class="line">          _frontCardAlignment = _reboundAnimation.value;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// çœç•¥...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-tinder-card/rebound.gif" width="536" style="width: 280px"><ol start="3"><li>å¡ç‰‡æ¢ä½åŠ¨ç”»</li></ol><p>å¡ç‰‡æ¢ä½åŠ¨ç”»å°±æ˜¯å°†æœ€å‰é¢çš„å¡ç‰‡ç§»é™¤å¯è§†åŒºï¼Œå°†ä¸­é—´çš„å¡ç‰‡ç§»åŠ¨åˆ°æœ€å‰é¢ï¼Œå°†æœ€åçš„å¡ç‰‡ç§»åŠ¨åˆ°ä¸­é—´ï¼Œç„¶åæ–°å»ºä¸€ä¸ªæœ€åé¢çš„å¡ç‰‡ã€‚åœ¨å¡ç‰‡æ›´æ¢ä½ç½®çš„åŒæ—¶éœ€è¦æ”¹å˜å¡ç‰‡çš„å°ºå¯¸ï¼Œä½ç½®åŠ¨ç”»å’Œå°ºå¯¸åŠ¨ç”»åŒæ—¶è¿›è¡Œã€‚é¦–å…ˆå®šä¹‰æ¯ä¸ªå¡ç‰‡è¿åŠ¨æ—¶çš„åŠ¨ç”»å€¼</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// <span class="markdown">å¡ç‰‡å°ºå¯¸</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CardSizes</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> Size front(BoxConstraints constraints) &#123;</span><br><span class="line">    <span class="keyword">return</span> Size(constraints.maxWidth * <span class="number">0.9</span>, constraints.maxHeight * <span class="number">0.9</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> Size middle(BoxConstraints constraints) &#123;</span><br><span class="line">    <span class="keyword">return</span> Size(constraints.maxWidth * <span class="number">0.85</span>, constraints.maxHeight * <span class="number">0.9</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> Size back(BoxConstraints constraints) &#123;</span><br><span class="line">    <span class="keyword">return</span> Size(constraints.maxWidth * <span class="number">0.8</span>, constraints.maxHeight * <span class="number">.9</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="markdown">å¡ç‰‡ä½ç½®</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CardAlignments</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> Alignment front = Alignment(<span class="number">0.0</span>, <span class="number">-0.5</span>);</span><br><span class="line">  <span class="keyword">static</span> Alignment middle = Alignment(<span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">  <span class="keyword">static</span> Alignment back = Alignment(<span class="number">0.0</span>, <span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="markdown">å¡ç‰‡è¿åŠ¨åŠ¨ç”»</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CardAnimations</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="markdown">æœ€å‰é¢å¡ç‰‡çš„æ¶ˆå¤±åŠ¨ç”»å€¼</span></span></span><br><span class="line">  <span class="keyword">static</span> Animation&lt;Alignment&gt; frontCardDisappearAnimation(</span><br><span class="line">    AnimationController parent,</span><br><span class="line">    Alignment beginAlignment,</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> AlignmentTween(</span><br><span class="line">      begin: beginAlignment,</span><br><span class="line">      end: Alignment(</span><br><span class="line">        beginAlignment.x &gt; <span class="number">0</span></span><br><span class="line">            ? beginAlignment.x + <span class="number">30.0</span></span><br><span class="line">            : beginAlignment.x - <span class="number">30.0</span>,</span><br><span class="line">        <span class="number">0.0</span>,</span><br><span class="line">      ),</span><br><span class="line">    ).animate(</span><br><span class="line">      CurvedAnimation(</span><br><span class="line">        parent: parent,</span><br><span class="line">        curve: Interval(<span class="number">0.0</span>, <span class="number">0.5</span>, curve: Curves.easeIn),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="markdown">ä¸­é—´å¡ç‰‡ä½ç½®å˜æ¢åŠ¨ç”»å€¼</span></span></span><br><span class="line">  <span class="keyword">static</span> Animation&lt;Alignment&gt; middleCardAlignmentAnimation(</span><br><span class="line">    AnimationController parent,</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> AlignmentTween(</span><br><span class="line">      begin: CardAlignments.middle,</span><br><span class="line">      end: CardAlignments.front,</span><br><span class="line">    ).animate(</span><br><span class="line">      CurvedAnimation(</span><br><span class="line">        parent: parent,</span><br><span class="line">        curve: Interval(<span class="number">0.2</span>, <span class="number">0.5</span>, curve: Curves.easeIn),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="markdown">ä¸­é—´å¡ç‰‡å°ºå¯¸å˜æ¢åŠ¨ç”»å€¼</span></span></span><br><span class="line">  <span class="keyword">static</span> Animation&lt;Size&gt; middleCardSizeAnimation(</span><br><span class="line">    AnimationController parent,</span><br><span class="line">    BoxConstraints constraints,</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> SizeTween(</span><br><span class="line">      begin: CardSizes.middle(constraints),</span><br><span class="line">      end: CardSizes.front(constraints),</span><br><span class="line">    ).animate(</span><br><span class="line">      CurvedAnimation(</span><br><span class="line">        parent: parent,</span><br><span class="line">        curve: Interval(<span class="number">0.2</span>, <span class="number">0.5</span>, curve: Curves.easeIn),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="markdown">æœ€åé¢å¡ç‰‡ä½ç½®å˜æ¢åŠ¨ç”»å€¼</span></span></span><br><span class="line">  <span class="keyword">static</span> Animation&lt;Alignment&gt; backCardAlignmentAnimation(</span><br><span class="line">    AnimationController parent,</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> AlignmentTween(</span><br><span class="line">      begin: CardAlignments.back,</span><br><span class="line">      end: CardAlignments.middle,</span><br><span class="line">    ).animate(</span><br><span class="line">      CurvedAnimation(</span><br><span class="line">        parent: parent,</span><br><span class="line">        curve: Interval(<span class="number">0.4</span>, <span class="number">0.7</span>, curve: Curves.easeIn),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="markdown">æœ€åé¢å¡ç‰‡å°ºå¯¸å˜æ¢åŠ¨ç”»å€¼</span></span></span><br><span class="line">  <span class="keyword">static</span> Animation&lt;Size&gt; backCardSizeAnimation(</span><br><span class="line">    AnimationController parent,</span><br><span class="line">    BoxConstraints constraints,</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> SizeTween(</span><br><span class="line">      begin: CardSizes.back(constraints),</span><br><span class="line">      end: CardSizes.middle(constraints),</span><br><span class="line">    ).animate(</span><br><span class="line">      CurvedAnimation(</span><br><span class="line">        parent: parent,</span><br><span class="line">        curve: Interval(<span class="number">0.4</span>, <span class="number">0.7</span>, curve: Curves.easeIn),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸€ä¸ª <code>AnimationController</code> æ§åˆ¶åŠ¨ç”»è¿è¡Œï¼ŒåŠ¨ç”»è¿è¡Œæ—¶åœ¨å¡ç‰‡ä¸Šåº”ç”¨ä»¥ä¸Šçš„åŠ¨ç”»å€¼ï¼Œå¦åˆ™ä½¿ç”¨å¡ç‰‡é»˜è®¤çš„ä½ç½®å’Œå°ºå¯¸ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyAppState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyApp</span>&gt; <span class="title">with</span> <span class="title">TickerProviderStateMixin</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// çœç•¥...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¡ç‰‡ä½ç½®å˜æ¢åŠ¨ç”»æ§åˆ¶å™¨</span></span><br><span class="line">  AnimationController _cardChangeController;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  å‰é¢çš„å¡ç‰‡ï¼Œä½¿ç”¨ Align å®šä½</span></span><br><span class="line">  Widget _frontCard(BoxConstraints constraints) &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­åŠ¨ç”»æ˜¯å¦åœ¨è¿è¡Œ</span></span><br><span class="line">    <span class="built_in">bool</span> forward = _cardChangeController.status == AnimationStatus.forward;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ Transform.rotate æ—‹è½¬å¡ç‰‡</span></span><br><span class="line">    Widget rotate = Transform.rotate(</span><br><span class="line">      angle: (pi / <span class="number">180.0</span>) * _frontCardRotation,</span><br><span class="line">      <span class="comment">// ä½¿ç”¨ SizedBox ç¡®å®šå¡ç‰‡å°ºå¯¸</span></span><br><span class="line">      child: SizedBox.fromSize(</span><br><span class="line">        size: CardSizes.front(constraints),</span><br><span class="line">        child: Container(</span><br><span class="line">          color: Colors.blue,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨åŠ¨ç”»è¿è¡Œæ—¶ä½¿ç”¨åŠ¨ç”»å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (forward) &#123;</span><br><span class="line">      <span class="keyword">return</span> Align(</span><br><span class="line">        alignment: CardAnimations.frontCardDisappearAnimation(</span><br><span class="line">          _cardChangeController,</span><br><span class="line">          _frontCardAlignment,</span><br><span class="line">        ).value,</span><br><span class="line">        child: rotate,</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦åˆ™ä½¿ç”¨é»˜è®¤å€¼</span></span><br><span class="line">    <span class="keyword">return</span> Align(</span><br><span class="line">      alignment: _frontCardAlignment,</span><br><span class="line">      child: rotate,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸­é—´çš„å¡ç‰‡ï¼Œä½¿ç”¨ Align å®šä½</span></span><br><span class="line">  Widget _middleCard(BoxConstraints constraints) &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­åŠ¨ç”»æ˜¯å¦åœ¨è¿è¡Œ</span></span><br><span class="line">    <span class="built_in">bool</span> forward = _cardChangeController.status == AnimationStatus.forward;</span><br><span class="line">    Widget child = Container(color: Colors.red);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨åŠ¨ç”»è¿è¡Œæ—¶ä½¿ç”¨åŠ¨ç”»å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (forward) &#123;</span><br><span class="line">      <span class="keyword">return</span> Align(</span><br><span class="line">        alignment: CardAnimations.middleCardAlignmentAnimation(</span><br><span class="line">          _cardChangeController,</span><br><span class="line">        ).value,</span><br><span class="line">        child: SizedBox.fromSize(</span><br><span class="line">          size: CardAnimations.middleCardSizeAnimation(</span><br><span class="line">            _cardChangeController,</span><br><span class="line">            constraints,</span><br><span class="line">          ).value,</span><br><span class="line">          child: child,</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦åˆ™ä½¿ç”¨é»˜è®¤å€¼</span></span><br><span class="line">    <span class="keyword">return</span> Align(</span><br><span class="line">      alignment: CardAlignments.middle,</span><br><span class="line">      child: SizedBox.fromSize(</span><br><span class="line">        size: CardSizes.middle(constraints),</span><br><span class="line">        child: child,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åé¢çš„å¡ç‰‡ï¼Œä½¿ç”¨ Align å®šä½</span></span><br><span class="line">  Widget _backCard(BoxConstraints constraints) &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­åŠ¨ç”»æ˜¯å¦åœ¨è¿è¡Œ</span></span><br><span class="line">    <span class="built_in">bool</span> forward = _cardChangeController.status == AnimationStatus.forward;</span><br><span class="line">    Widget child = Container(color: Colors.green);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨åŠ¨ç”»è¿è¡Œæ—¶ä½¿ç”¨åŠ¨ç”»å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (forward) &#123;</span><br><span class="line">      <span class="keyword">return</span> Align(</span><br><span class="line">        alignment: CardAnimations.backCardAlignmentAnimation(</span><br><span class="line">          _cardChangeController,</span><br><span class="line">        ).value,</span><br><span class="line">        child: SizedBox.fromSize(</span><br><span class="line">          size: CardAnimations.backCardSizeAnimation(</span><br><span class="line">            _cardChangeController,</span><br><span class="line">            constraints,</span><br><span class="line">          ).value,</span><br><span class="line">          child: child,</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦åˆ™ä½¿ç”¨é»˜è®¤å€¼</span></span><br><span class="line">    <span class="keyword">return</span> Align(</span><br><span class="line">      alignment: CardAlignments.back,</span><br><span class="line">      child: SizedBox.fromSize(</span><br><span class="line">        size: CardSizes.back(constraints),</span><br><span class="line">        child: child,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ”¹å˜ä½ç½®çš„åŠ¨ç”»</span></span><br><span class="line">  <span class="keyword">void</span> _runChangeOrderAnimation() &#123;</span><br><span class="line">    _cardChangeController.reset();</span><br><span class="line">    _cardChangeController.forward();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// çœç•¥...</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    <span class="comment">// çœç•¥...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å¡ç‰‡æ¢ä½åŠ¨ç”»æ§åˆ¶å™¨</span></span><br><span class="line">    _cardChangeController = AnimationController(</span><br><span class="line">      duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">1000</span>),</span><br><span class="line">      vsync: <span class="keyword">this</span>,</span><br><span class="line">    )</span><br><span class="line">      ..addListener(() =&gt; setState(() &#123;&#125;))</span><br><span class="line">      ..addStatusListener((status) &#123;</span><br><span class="line">        <span class="keyword">if</span> (status == AnimationStatus.completed) &#123;</span><br><span class="line">          <span class="comment">// åŠ¨ç”»è¿è¡Œç»“æŸåé‡ç½®ä½ç½®å’Œæ—‹è½¬</span></span><br><span class="line">          _frontCardRotation = <span class="number">0.0</span>;</span><br><span class="line">          _frontCardAlignment = CardAlignments.front;</span><br><span class="line">          setState(() &#123;&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// çœç•¥...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-tinder-card/foward.gif" width="260" style="width: 280px"><h2 id="æ•°æ®æ›´æ–°"><a href="#æ•°æ®æ›´æ–°" class="headerlink" title="æ•°æ®æ›´æ–°"></a>æ•°æ®æ›´æ–°</h2><p>å¯ä»¥çœ‹åˆ°åŠ¨ç”»è¿è¡Œä¹‹åä¸‰å¼ å¡ç‰‡éƒ½æ¢å¤äº†é»˜è®¤çš„ä½ç½®å’Œå°ºå¯¸ï¼Œè€Œéœ€è¦çš„æ•ˆæœæ˜¯å½“å¡ç‰‡æ¢ä½åŠ¨ç”»å®Œæˆåä¸‰å¼ å¡ç‰‡çš„æ•°æ®ä¼šæ”¹å˜ï¼Œæ‰€ä»¥è¿˜éœ€è¦åœ¨åŠ¨ç”»ä¹‹åè¿›è¡Œæ•°æ®å¤„ç†ã€‚</p><p>åˆ›å»ºä¸€ä¸ªæ•°ç»„ä¿å­˜å…¨éƒ¨å­é¡¹ç›®ï¼Œä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ›´æ–°æœ€å‰é¢å¡ç‰‡çš„å­é¡¹ç´¢å¼•ï¼Œåœ¨å¡ç‰‡æ¢ä½åŠ¨ç”»ç»“æŸåç´¢å¼•å€¼åŠ ä¸€ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; images = [</span><br><span class="line">  <span class="string">'https://gank.io/images/5ba77f3415b44f6c843af5e149443f94'</span>,</span><br><span class="line">  <span class="string">'https://gank.io/images/02eb8ca3297f4931ab64b7ebd7b5b89c'</span>,</span><br><span class="line">  <span class="string">'https://gank.io/images/31f92f7845f34f05bc10779a468c3c13'</span>,</span><br><span class="line">  <span class="string">'https://gank.io/images/b0f73f9527694f44b523ff059d8a8841'</span>,</span><br><span class="line">  <span class="string">'https://gank.io/images/1af9d69bc60242d7aa2e53125a4586ad'</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆå¡ç‰‡æ•°ç»„</span></span><br><span class="line"><span class="built_in">List</span>&lt;Widget&gt; cards = <span class="built_in">List</span>.generate(</span><br><span class="line">  images.length,</span><br><span class="line">  (<span class="built_in">int</span> index) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      decoration: BoxDecoration(</span><br><span class="line">        color: Colors.white,</span><br><span class="line">        borderRadius: BorderRadius.circular(<span class="number">16.0</span>),</span><br><span class="line">        boxShadow: [</span><br><span class="line">          BoxShadow(</span><br><span class="line">            offset: Offset(<span class="number">0</span>, <span class="number">17</span>),</span><br><span class="line">            blurRadius: <span class="number">23.0</span>,</span><br><span class="line">            spreadRadius: <span class="number">-13.0</span>,</span><br><span class="line">            color: Colors.black54,</span><br><span class="line">          )</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">      child: ClipRRect(</span><br><span class="line">        borderRadius: BorderRadius.circular(<span class="number">16.0</span>),</span><br><span class="line">        child: Image.network(</span><br><span class="line">          images[index],</span><br><span class="line">          fit: BoxFit.cover,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨ç”Ÿæˆçš„å¡ç‰‡æ•°ç»„</span></span><br><span class="line">  runApp(MyApp(cards: cards));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;Widget&gt; cards;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> MyApp(&#123;<span class="meta">@required</span> <span class="keyword">this</span>.cards&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _MyAppState createState() =&gt; _MyAppState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyAppState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyApp</span>&gt; <span class="title">with</span> <span class="title">TickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  <span class="comment">// å¡ç‰‡åˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;Widget&gt; _cards = [];</span><br><span class="line">  <span class="comment">// æœ€å‰é¢å¡ç‰‡çš„ç´¢å¼•</span></span><br><span class="line">  <span class="built_in">int</span> _frontCardIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// çœç•¥...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//  å‰é¢çš„å¡ç‰‡ï¼Œä½¿ç”¨ Align å®šä½</span></span><br><span class="line">  Widget _frontCard(BoxConstraints constraints) &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦è¿˜æœ‰å¡ç‰‡</span></span><br><span class="line">    Widget card =</span><br><span class="line">        _frontCardIndex &lt; _cards.length ? _cards[_frontCardIndex] : Container();</span><br><span class="line">    <span class="built_in">bool</span> forward = _cardChangeController.status == AnimationStatus.forward;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ Transform.rotate æ—‹è½¬å¡ç‰‡</span></span><br><span class="line">    Widget rotate = Transform.rotate(</span><br><span class="line">      angle: (pi / <span class="number">180.0</span>) * _frontCardRotation,</span><br><span class="line">      <span class="comment">// ä½¿ç”¨ SizedBox ç¡®å®šå¡ç‰‡å°ºå¯¸</span></span><br><span class="line">      child: SizedBox.fromSize(</span><br><span class="line">        size: CardSizes.front(constraints),</span><br><span class="line">        <span class="comment">// ä½¿ç”¨æ•°ç»„ä¸­çš„å­é¡¹</span></span><br><span class="line">        child: card,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">   <span class="comment">// çœç•¥...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸­é—´çš„å¡ç‰‡ï¼Œä½¿ç”¨ Align å®šä½</span></span><br><span class="line">  Widget _middleCard(BoxConstraints constraints) &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸¤å¼ å¡ç‰‡</span></span><br><span class="line">    Widget card = _frontCardIndex &lt; _cards.length - <span class="number">1</span></span><br><span class="line">        ? _cards[_frontCardIndex + <span class="number">1</span>]</span><br><span class="line">        : Container();</span><br><span class="line">    <span class="comment">// çœç•¥...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åé¢çš„å¡ç‰‡ï¼Œä½¿ç”¨ Align å®šä½</span></span><br><span class="line">  Widget _backCard(BoxConstraints constraints) &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦è¿˜æœ‰ä¸‰å¼ å¡ç‰‡</span></span><br><span class="line">    Widget card = _frontCardIndex &lt; _cards.length - <span class="number">2</span></span><br><span class="line">        ? _cards[_frontCardIndex + <span class="number">2</span>]</span><br><span class="line">        : Container();</span><br><span class="line">    <span class="comment">// çœç•¥...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// çœç•¥...</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å¡ç‰‡æ•°ç»„</span></span><br><span class="line">    _cards.addAll(widget.cards);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çœç•¥...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å¡ç‰‡æ¢ä½åŠ¨ç”»æ§åˆ¶å™¨</span></span><br><span class="line">    _cardChangeController = AnimationController(</span><br><span class="line">      duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">1000</span>),</span><br><span class="line">      vsync: <span class="keyword">this</span>,</span><br><span class="line">    )</span><br><span class="line">      ..addListener(() =&gt; setState(() &#123;&#125;))</span><br><span class="line">      ..addStatusListener((status) &#123;</span><br><span class="line">        <span class="keyword">if</span> (status == AnimationStatus.completed) &#123;</span><br><span class="line">          <span class="comment">// åŠ¨ç”»ç»“æŸåå°†æœ€å‰é¢å¡ç‰‡çš„ç´¢å¼•å‘å‰ç§»åŠ¨ä¸€ä½</span></span><br><span class="line">          _frontCardIndex++;</span><br><span class="line">          <span class="comment">// åŠ¨ç”»è¿è¡Œç»“æŸåé‡ç½®ä½ç½®å’Œæ—‹è½¬</span></span><br><span class="line">          _frontCardRotation = <span class="number">0.0</span>;</span><br><span class="line">          _frontCardAlignment = CardAlignments.front;</span><br><span class="line">          setState(() &#123;&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// çœç•¥...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> Stack(</span><br><span class="line">  children: [</span><br><span class="line">    <span class="comment">// çœç•¥...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ä¸€ä¸ªå æ»¡çˆ¶å…ƒç´ çš„ GestureDetector ç›‘å¬æ‰‹æŒ‡ç§»åŠ¨</span></span><br><span class="line">    <span class="comment">// å¦‚æœåŠ¨ç”»åœ¨è¿è¡Œä¸­å°±ä¸åœ¨å“åº”æ‰‹åŠ¿</span></span><br><span class="line">    _cardChangeController.status != AnimationStatus.forward</span><br><span class="line">        ? SizedBox.expand(</span><br><span class="line">            child: GestureDetector(</span><br><span class="line">              <span class="comment">// çœç•¥...</span></span><br><span class="line">            )</span><br><span class="line">          )</span><br><span class="line">        : IgnorePointer(),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤æ•´ä¸ªå¸ƒå±€å°±å®ç°äº† ğŸ‰</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ä¸ªå¸ƒå±€çš„å…³é”®ç‚¹åœ¨äº</p><ol><li>ä¸‰å¼ å¡ç‰‡çš„å®šä½</li><li>ç›‘å¬æ‰‹åŠ¿æ›´æ–°æœ€å‰é¢å¡ç‰‡çš„ä½ç½®</li><li>å¡ç‰‡çš„æ¢ä½åŠ¨ç”»å’Œå›å¼¹åŠ¨ç”»</li></ol><p>ä½œè€…å·²ç»å°è£…äº†è¿™ä¸ªæ’ä»¶ï¼Œåœ°å€æ˜¯ <a href="https://pub.dev/packages/tcard" target="_blank" rel="noopener">https://pub.dev/packages/tcard</a> æ¬¢è¿ä½¿ç”¨ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://api.flutter.dev/flutter/widgets/Stack-class.html" target="_blank" rel="noopener">Stack class</a></p><p><a href="https://github.com/Ivaskuu/tinder_cards" target="_blank" rel="noopener">tinder_cards</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰å‡ å¤©å†™äº†ä¸€ä¸ª Fluter æ’ä»¶ tcardï¼Œç”¨æ¥å®ç°ç±»ä¼¼äºæ¢æ¢å¡ç‰‡çš„å¸ƒå±€ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>æœ€å¥½çš„ä½ </title>
    <link href="https://coldstone.fun/post/2020/06/17/leetcode-1014/"/>
    <id>https://coldstone.fun/post/2020/06/17/leetcode-1014/</id>
    <published>2020-06-17T06:19:00.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>LeetCode 1014 æœ€ä½³è§‚å…‰ç»„åˆ</p><a id="more"></a><p><a href="https://leetcode-cn.com/problems/best-sightseeing-pair/" target="_blank" rel="noopener">LeetCode 1014. æœ€ä½³è§‚å…‰ç»„åˆ</a></p><img src="./images/best_of_you.png" width="1106" style="width: 553px" alt="best_of_you">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;LeetCode 1014 æœ€ä½³è§‚å…‰ç»„åˆ&lt;/p&gt;
    
    </summary>
    
    
      <category term="ä»£ç å†™è¯—" scheme="https://coldstone.fun/categories/%E4%BB%A3%E7%A0%81%E5%86%99%E8%AF%97/"/>
    
    
      <category term="leetcode" scheme="https://coldstone.fun/tags/leetcode/"/>
    
  </entry>
  
  <entry>
    <title>Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆäºŒï¼‰é¥¼çŠ¶å›¾ğŸª</title>
    <link href="https://coldstone.fun/post/2020/06/09/flutter-pie-chart/"/>
    <id>https://coldstone.fun/post/2020/06/09/flutter-pie-chart/</id>
    <published>2020-06-09T06:08:00.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡è®²è§£å¦‚ä½•ä½¿ç”¨ Flutter ç»˜åˆ¶é¥¼çŠ¶å›¾</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ¥ä¸Šæ–‡ï¼Œæœ¬æ–‡è®²è§£å¦‚ä½•ä½¿ç”¨ Flutter ç»˜åˆ¶é¥¼çŠ¶å›¾ï¼Œæœ€ç»ˆæ•ˆæœå¦‚å›¾</p><img src="./images/flutter-pie-chart/pie.gif" width="524" style="width: 260px"><p><a href="https://dartpad.dartlang.org/b8a2b88647fa75df5d31445a93cb390f" target="_blank" rel="noopener">åœ¨çº¿æŸ¥çœ‹</a></p><h2 id="å®šä¹‰-PieChart-amp-PiePart"><a href="#å®šä¹‰-PieChart-amp-PiePart" class="headerlink" title="å®šä¹‰ PieChart &amp; PiePart"></a>å®šä¹‰ PieChart &amp; PiePart</h2><p>ç¬¬ä¸€æ­¥å®šä¹‰ <code>PieChart</code> å’Œ <code>PiePart</code> ç±»ã€‚<code>PieChart</code> æ˜¯æ•´ä¸ªé¥¼çŠ¶å›¾æ§ä»¶ï¼Œæœ‰ <code>datas</code> å’Œ <code>legends</code> ä¸¤ä¸ªå±æ€§ï¼Œè¡¨ç¤ºé¥¼å›¾çš„æ•°æ®å’Œæ¯éƒ¨åˆ†çš„æ ‡è¯†ã€‚<br><code>PiePart</code> è¡¨ç¤ºé¥¼å›¾çš„ä¸€éƒ¨åˆ†ï¼Œæœ‰ <code>color</code>, <code>startAngle</code>, <code>sweepAngle</code> ä¸‰ä¸ªå±æ€§ï¼Œåˆ†åˆ«è¡¨ç¤ºé¢œè‰²ï¼Œèµ·å§‹å¼§åº¦å€¼ï¼Œå æ®åœ†å½¢çš„å¼§åº¦å€¼ã€‚<code>PeiChartPainter</code> ç±»å®ç°äº†å…·ä½“çš„ç»˜åˆ¶æ–¹æ³•ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PiePart</span> </span>&#123;</span><br><span class="line">  <span class="built_in">double</span> sweepAngle;</span><br><span class="line">  <span class="keyword">final</span> Color color;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> startAngle;</span><br><span class="line"></span><br><span class="line">  PiePart(</span><br><span class="line">    <span class="keyword">this</span>.startAngle,</span><br><span class="line">    <span class="keyword">this</span>.sweepAngle,</span><br><span class="line">    <span class="keyword">this</span>.color,</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PieChart</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">double</span>&gt; datas;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; legends;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> PieChart(&#123;</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.datas,</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.legends,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _PieChartState createState() =&gt; _PieChartState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_PieChartState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">PieChart</span>&gt; <span class="title">with</span> <span class="title">TickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  <span class="built_in">double</span> _total = <span class="number">0.0</span>;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;PiePart&gt; _parts = &lt;PiePart&gt;[];</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">      children: [</span><br><span class="line">        Container(</span><br><span class="line">          width: <span class="number">300</span>,</span><br><span class="line">          height: <span class="number">300</span>,</span><br><span class="line">          child: CustomPaint(</span><br><span class="line">            painter: PeiChartPainter(</span><br><span class="line">              total: _total,</span><br><span class="line">              parts: _parts,</span><br><span class="line">              datas: widget.datas,</span><br><span class="line">              legends: widget.legends</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PeiChartPainter</span> <span class="keyword">extends</span> <span class="title">CustomPainter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> total;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">double</span>&gt; datas;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;PiePart&gt; parts;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; legends;</span><br><span class="line"></span><br><span class="line">  PeiChartPainter(&#123;</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.total,</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.datas,</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.parts,</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.legends,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> shouldRepaint(PeiChartPainter oldDelegate) =&gt; <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»˜åˆ¶åœ†æ¡†"><a href="#ç»˜åˆ¶åœ†æ¡†" class="headerlink" title="ç»˜åˆ¶åœ†æ¡†"></a>ç»˜åˆ¶åœ†æ¡†</h2><p>å…ˆç»˜åˆ¶å›¾è¡¨çš„åœ†æ¡†ï¼Œåœ¨ <code>PeiChartPainter</code> ä¸Šæ·»åŠ  <code>drawCircle</code> æ–¹æ³•ï¼Œä»¥åœ†çš„ä¸­å¿ƒç‚¹å’Œåœ†çš„åŠå¾„ç»˜åˆ¶ä¸€ä¸ªç©ºå¿ƒåœ†å½¢ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> drawCircle(Canvas canvas, Size size) &#123;</span><br><span class="line">  <span class="keyword">final</span> sw = size.width;</span><br><span class="line">  <span class="keyword">final</span> sh = size.height;</span><br><span class="line">  <span class="comment">// ç¡®å®šåœ†çš„åŠå¾„</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> radius = math.min(sw, sh) / <span class="number">2</span>;</span><br><span class="line">  <span class="comment">// å®šä¹‰ä¸­å¿ƒç‚¹</span></span><br><span class="line">  <span class="keyword">final</span> Offset center = Offset(sw / <span class="number">2</span>, sh / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®šä¹‰åœ†å½¢çš„ç»˜åˆ¶å±æ€§</span></span><br><span class="line">  <span class="keyword">final</span> paint = Paint()</span><br><span class="line">    ..style = PaintingStyle.stroke</span><br><span class="line">    ..color = Colors.grey</span><br><span class="line">    ..strokeWidth = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨ Canvas çš„ drawCircle ç»˜åˆ¶</span></span><br><span class="line">  canvas.drawCircle(center, radius, paint);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">  drawCircle(canvas, size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-pie-chart/circle.png" width="520" style="width: 260px"><h2 id="ç»˜åˆ¶æ ‡è¯†"><a href="#ç»˜åˆ¶æ ‡è¯†" class="headerlink" title="ç»˜åˆ¶æ ‡è¯†"></a>ç»˜åˆ¶æ ‡è¯†</h2><p>è¿™ä¸€æ­¥éœ€è¦å…ˆåœ¨ <code>_PieChartState</code> é‡Œé¢è¿›è¡Œæ•°æ®çš„åˆå§‹åŒ–ï¼Œç„¶åç»˜åˆ¶æ¯ä¸ªæ•°æ®å¯¹åº”çš„æ ‡è¯†ï¼Œåˆ†ä»¥ä¸‹å‡ æ­¥è¿›è¡Œ</p><ol><li>è®¡ç®—å‡ºæ¯ä¸ªæ•°æ®å æ€»å’Œçš„å æ¯”</li><li>æ ¹æ®å æ¯”è®¡ç®—æ•°æ®å æ®åœ†çš„å¼§åº¦å€¼</li><li>æ ¹æ®ä¹‹å‰æ•°æ®å æ®åœ†å½¢çš„å¼§åº¦å€¼è®¡ç®—å‡ºä¸‹ä¸€ä¸ªæ•°æ®çš„èµ·å§‹å¼§åº¦å€¼</li><li>æ ¹æ®è®¡ç®—å‡ºçš„èµ·å§‹å¼§åº¦å€¼å’Œå æ®å¼§åº¦å€¼åˆ›å»º <code>PiePart</code> å¯¹è±¡</li><li>ä½¿ç”¨ <code>PiePart</code> å¯¹è±¡ç»˜åˆ¶æ ‡è¯†</li></ol><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_PieChartState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">PieChart</span>&gt; <span class="title">with</span> <span class="title">TickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  <span class="built_in">double</span> _total = <span class="number">0.0</span>;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;PiePart&gt; _parts = &lt;PiePart&gt;[];</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">List</span>&lt;<span class="built_in">double</span>&gt; datas = widget.datas;</span><br><span class="line">    <span class="comment">// è®¡ç®—å‡ºæ•°æ®æ€»å’Œ</span></span><br><span class="line">    _total = datas.reduce((a, b) =&gt; a + b);</span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªèµ·å§‹å˜é‡</span></span><br><span class="line">    <span class="built_in">double</span> startAngle = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; datas.length; i++) &#123;</span><br><span class="line">      <span class="keyword">final</span> data = datas[i];</span><br><span class="line">      <span class="comment">// è®¡ç®—å‡ºæ¯ä¸ªæ•°æ®æ‰€å çš„å¼§åº¦å€¼</span></span><br><span class="line">      <span class="keyword">final</span> angle = (data / _total) * -math.pi * <span class="number">2</span>;</span><br><span class="line">      PiePart peiPart;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// ä¸‹ä¸€ä¸ªæ•°æ®çš„èµ·å§‹å¼§åº¦å€¼ç­‰äºä¹‹å‰çš„æ•°æ®å¼§åº¦å€¼ä¹‹å’Œ</span></span><br><span class="line">        <span class="built_in">double</span> lastSweepAngle = _parts[i - <span class="number">1</span>].sweepAngle;</span><br><span class="line">        startAngle += lastSweepAngle;</span><br><span class="line">        peiPart = PiePart(startAngle, angle, colors[i]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€ä¸ªæ•°æ®çš„èµ·å§‹å¼§åº¦ä¸º 0.0</span></span><br><span class="line">        peiPart = PiePart(<span class="number">0.0</span>, angle, colors[i]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æ·»åŠ åˆ°æ•°ç»„ä¸­</span></span><br><span class="line">      _parts.add(peiPart);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">      children: [</span><br><span class="line">        Container(</span><br><span class="line">          width: <span class="number">300</span>,</span><br><span class="line">          height: <span class="number">300</span>,</span><br><span class="line">          child: CustomPaint(</span><br><span class="line">            <span class="comment">// å°†æ•°æ®ä¼ ç»™ PeiChartPainter</span></span><br><span class="line">            painter: PeiChartPainter(</span><br><span class="line">              total: _total,</span><br><span class="line">              parts: _parts,</span><br><span class="line">              datas: widget.datas,</span><br><span class="line">              legends: widget.legends,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ PeiChartPainter ä¸Šæ·»åŠ  <code>drawLegends</code> æ–¹æ³•ï¼Œåœ¨åœ†æ¡†çš„å¤–å›´ç»˜åˆ¶æ¯éƒ¨åˆ†å¯¹åº”çš„æ ‡è¯†ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> drawLegends(Canvas canvas, Size size) &#123;</span><br><span class="line">  <span class="keyword">final</span> sw = size.width;</span><br><span class="line">  <span class="keyword">final</span> sh = size.height;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> radius = math.min(sw, sh) / <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> fontSize = <span class="number">12.0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; datas.length; i++) &#123;</span><br><span class="line">    <span class="keyword">final</span> PiePart <span class="keyword">part</span> = parts[i];</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">String</span> legend = legends[i];</span><br><span class="line">    <span class="comment">// æ ¹æ®æ¯éƒ¨åˆ†çš„èµ·å§‹å¼§åº¦åŠ ä¸Šè‡ªèº«å¼§åº¦å€¼çš„ä¸€åŠå¾—åˆ°æ¯éƒ¨åˆ†çš„ä¸­é—´å¼§åº¦å€¼</span></span><br><span class="line">    <span class="keyword">final</span> radians = <span class="keyword">part</span>.startAngle + <span class="keyword">part</span>.sweepAngle / <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// æ ¹æ®ä¸‰è§’å‡½æ•°è®¡ç®—ä¸­å‡ºæ ‡è¯†æ–‡å­—çš„ x å’Œ y ä½ç½®ï¼Œéœ€è¦åŠ ä¸Šå®½å’Œé«˜çš„ä¸€åŠé€‚é… Canvas çš„åæ ‡</span></span><br><span class="line">    <span class="built_in">double</span> x = math.cos(radians) * (radius + <span class="number">32</span>) + sw / <span class="number">2</span> - fontSize;</span><br><span class="line">    <span class="built_in">double</span> y = math.sin(radians) * (radius + <span class="number">32</span>) + sh / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">final</span> offset = Offset(x, y);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ TextPainter ç»˜åˆ¶æ–‡å­—æ ‡è¯†</span></span><br><span class="line">    TextPainter(</span><br><span class="line">      textAlign: TextAlign.center,</span><br><span class="line">      text: TextSpan(</span><br><span class="line">        text: legend,</span><br><span class="line">        style: TextStyle(</span><br><span class="line">          fontSize: fontSize,</span><br><span class="line">          color: Colors.black,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      textDirection: TextDirection.ltr,</span><br><span class="line">    )</span><br><span class="line">      ..layout(</span><br><span class="line">        minWidth: <span class="number">0</span>,</span><br><span class="line">        maxWidth: size.width,</span><br><span class="line">      )</span><br><span class="line">      ..paint(canvas, offset);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">  drawCircle(canvas, size);</span><br><span class="line">  drawLegends(canvas, size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-pie-chart/legend.png" width="520" style="width: 260px"><p>è®¡ç®—æ–‡å­—ä½ç½®ç”¨åˆ°çš„çš„ä¸‰è§’å‡½æ•°æ˜¯</p><p><img src="./images/flutter-pie-chart/angle.png" alt="angle"></p><h2 id="ç»˜åˆ¶æ•°æ®å¯¹åº”çš„å¼§å½¢"><a href="#ç»˜åˆ¶æ•°æ®å¯¹åº”çš„å¼§å½¢" class="headerlink" title="ç»˜åˆ¶æ•°æ®å¯¹åº”çš„å¼§å½¢"></a>ç»˜åˆ¶æ•°æ®å¯¹åº”çš„å¼§å½¢</h2><p>åœ¨ <code>PeiChartPainter</code> ä¸Šæ·»åŠ  <code>drawParts</code> æ–¹æ³•ï¼Œç»˜åˆ¶æ¯ä¸ªæ•°æ®å¯¹åº”çš„å¼§å½¢ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> drawParts(Canvas canvas, Size size) &#123;</span><br><span class="line">  <span class="keyword">final</span> sw = size.width;</span><br><span class="line">  <span class="keyword">final</span> sh = size.height;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> fontSize = <span class="number">10.0</span>;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> radius = math.min(sw, sh) / <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">final</span> Offset center = Offset(sw / <span class="number">2</span>, sh / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ›å»ºå¼§å½¢ä¾ç…§çš„çŸ©å½¢</span></span><br><span class="line">  <span class="keyword">final</span> rect = Rect.fromCenter(</span><br><span class="line">    center: center,</span><br><span class="line">    width: radius * <span class="number">2</span>,</span><br><span class="line">    height: radius * <span class="number">2</span>,</span><br><span class="line">  );</span><br><span class="line">  <span class="comment">// è®¾ç½®ç»˜åˆ¶å±æ€§</span></span><br><span class="line">  <span class="keyword">final</span> paint = Paint()</span><br><span class="line">    ..strokeWidth = <span class="number">0.0</span></span><br><span class="line">    ..isAntiAlias = <span class="keyword">true</span></span><br><span class="line">    ..style = PaintingStyle.fill;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; parts.length; i++) &#123;</span><br><span class="line">    <span class="keyword">final</span> PiePart <span class="keyword">part</span> = parts[i];</span><br><span class="line">    <span class="comment">// è®¾ç½®æ¯éƒ¨åˆ†çš„é¢œè‰²</span></span><br><span class="line">    paint.color = <span class="keyword">part</span>.color;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ drawArc æ–¹æ³•ç”»å‡ºå¼§å½¢ï¼Œå‚æ•°ä¾æ¬¡æ˜¯ä¾ç…§çš„çŸ©å½¢ï¼Œèµ·å§‹å¼§åº¦å€¼ï¼Œå æ®çš„å¼§åº¦å€¼ï¼Œæ˜¯å¦ä»ä¸­å¿ƒç‚¹ç»˜åˆ¶ï¼Œç»˜åˆ¶å±æ€§</span></span><br><span class="line">    canvas.drawArc(rect, <span class="keyword">part</span>.startAngle, <span class="keyword">part</span>.sweepAngle, <span class="keyword">true</span>, paint);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">double</span> data = datas[i];</span><br><span class="line">    <span class="comment">// è®¡ç®—æ¯éƒ¨åˆ†å æ¯”</span></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">String</span> percent = (data / total * <span class="number">100</span>).toStringAsFixed(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">double</span> radians = <span class="keyword">part</span>.startAngle + <span class="keyword">part</span>.sweepAngle / <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ä¸‰è§’å‡½æ•°è®¡ç®—æ–‡å­—ä½ç½®</span></span><br><span class="line">    <span class="built_in">double</span> x = math.cos(radians) * radius / <span class="number">2</span> + sw / <span class="number">2</span> - fontSize * <span class="number">3</span>;</span><br><span class="line">    <span class="built_in">double</span> y = math.sin(radians) * radius / <span class="number">2</span> + sh / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">final</span> Offset offset = Offset(x, y);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ TextPainter ç»˜åˆ¶æ–‡å­—æ ‡è¯†</span></span><br><span class="line">    TextPainter(</span><br><span class="line">      textAlign: TextAlign.start,</span><br><span class="line">      text: TextSpan(</span><br><span class="line">        text: <span class="string">'<span class="subst">$data</span> <span class="subst">$percent</span>%'</span>,</span><br><span class="line">        style: TextStyle(</span><br><span class="line">          fontSize: fontSize,</span><br><span class="line">          color: Colors.white,</span><br><span class="line">          fontWeight: FontWeight.bold,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      textDirection: TextDirection.ltr,</span><br><span class="line">    )</span><br><span class="line">      ..layout(</span><br><span class="line">        minWidth: <span class="number">0</span>,</span><br><span class="line">        maxWidth: size.width,</span><br><span class="line">      )</span><br><span class="line">      ..paint(canvas, offset);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">  drawCircle(canvas, size);</span><br><span class="line">  drawLegends(canvas, size);</span><br><span class="line">  drawParts(canvas, size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-pie-chart/part.png" width="520" style="width: 260px"><h2 id="æ·»åŠ åŠ¨ç”»"><a href="#æ·»åŠ åŠ¨ç”»" class="headerlink" title="æ·»åŠ åŠ¨ç”»"></a>æ·»åŠ åŠ¨ç”»</h2><p>æœ€åç»™é¥¼å›¾æ·»åŠ ä¸€ä¸ªæ•°æ®ä¸æ–­å¢é•¿çš„åŠ¨ç”»æ•ˆæœï¼Œåœ¨ <code>_PieChartState</code> æ·»åŠ åŠ¨ç”»çš„æ§åˆ¶å™¨ <code>_controller</code> å’Œä¿å­˜åŠ¨ç”»æ•°æ®çš„ <code>_animateDatas</code> æ•°ç»„ã€‚åœ¨ <code>initState</code> ä¸­åˆå§‹åŒ–åŠ¨ç”»æ§åˆ¶å™¨å’Œå¡«å…… <code>_animateDatas</code> æ•°ç»„ã€‚ç„¶ååˆ›å»ºä¸¤ä¸ª <code>double</code> ç±»å‹çš„è¡¥é—´åŠ¨ç”»ï¼Œå°†åŠ¨ç”»å€¼ä¼ ç»™ <code>PeiChartPainter</code> ä½¿ç”¨å³å¯ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_PieChartState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">PieChart</span>&gt; <span class="title">with</span> <span class="title">TickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  <span class="built_in">double</span> _total = <span class="number">0.0</span>;</span><br><span class="line">  AnimationController _controller;</span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="built_in">double</span>&gt; _animateDatas = [];</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;PiePart&gt; _parts = &lt;PiePart&gt;[];</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–åŠ¨ç”»æ§åˆ¶å™¨</span></span><br><span class="line">    _controller = AnimationController(</span><br><span class="line">      duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">3000</span>),</span><br><span class="line">      vsync: <span class="keyword">this</span>,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="built_in">List</span>&lt;<span class="built_in">double</span>&gt; datas = widget.datas;</span><br><span class="line">    <span class="comment">// è®¡ç®—å‡ºæ•°æ®æ€»å’Œ</span></span><br><span class="line">    _total = datas.reduce((a, b) =&gt; a + b);</span><br><span class="line">    <span class="comment">// è®¾ç½®ä¸€ä¸ªèµ·å§‹å˜é‡</span></span><br><span class="line">    <span class="built_in">double</span> startAngle = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; datas.length; i++) &#123;</span><br><span class="line">      <span class="comment">// å¡«å……åŠ¨ç”»æ•°ç»„</span></span><br><span class="line">      _animateDatas.add(<span class="number">0.0</span>);</span><br><span class="line">      <span class="keyword">final</span> data = datas[i];</span><br><span class="line">      <span class="comment">// è®¡ç®—å‡ºæ¯ä¸ªæ•°æ®æ‰€å çš„å¼§åº¦å€¼</span></span><br><span class="line">      <span class="keyword">final</span> angle = (data / _total) * -math.pi * <span class="number">2</span>;</span><br><span class="line">      PiePart peiPart;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// ä¸‹ä¸€ä¸ªæ•°æ®çš„èµ·å§‹å¼§åº¦å€¼ç­‰äºä¹‹å‰çš„å¼§åº¦å€¼ç›¸åŠ </span></span><br><span class="line">        <span class="built_in">double</span> lastSweepAngle = _parts[i - <span class="number">1</span>].sweepAngle;</span><br><span class="line">        startAngle += lastSweepAngle;</span><br><span class="line">        peiPart = PiePart(startAngle, angle, colors[i]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€ä¸ªæ•°æ®çš„èµ·å§‹å¼§åº¦ä¸º 0.0</span></span><br><span class="line">        peiPart = PiePart(<span class="number">0.0</span>, angle, colors[i]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æ·»åŠ åˆ°æ•°ç»„ä¸­</span></span><br><span class="line">      _parts.add(peiPart);</span><br><span class="line"></span><br><span class="line">      CurvedAnimation curvedAnimation = CurvedAnimation(</span><br><span class="line">        parent: _controller,</span><br><span class="line">        curve: Curves.ease,</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ›å»ºå¼§å½¢çš„è¡¥é—´åŠ¨ç”»</span></span><br><span class="line">      <span class="keyword">final</span> partTween = Tween&lt;<span class="built_in">double</span>&gt;(begin: <span class="number">0.0</span>, end: peiPart.sweepAngle);</span><br><span class="line">      Animation&lt;<span class="built_in">double</span>&gt; animation = partTween.animate(curvedAnimation);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ›å»ºæ–‡å­—çš„è¡¥é—´åŠ¨ç”»</span></span><br><span class="line">      <span class="keyword">final</span> percentTween = Tween&lt;<span class="built_in">double</span>&gt;(begin: <span class="number">0.0</span>, end: data);</span><br><span class="line">      Animation&lt;<span class="built_in">double</span>&gt; percentAnimation =</span><br><span class="line">          percentTween.animate(curvedAnimation);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åœ¨åŠ¨ç”»å¯åŠ¨åä¸æ–­æ”¹å˜æ•°æ®å€¼</span></span><br><span class="line">      _controller.addListener(() &#123;</span><br><span class="line">        _parts[i].sweepAngle = animation.value;</span><br><span class="line">        _animateDatas[i] =</span><br><span class="line">            <span class="built_in">double</span>.parse(percentAnimation.value.toStringAsFixed(<span class="number">1</span>));</span><br><span class="line">        setState(() &#123;&#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// å¼€å§‹åŠ¨ç”»</span></span><br><span class="line">      _controller.forward();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">      children: [</span><br><span class="line">        Container(</span><br><span class="line">          width: <span class="number">300</span>,</span><br><span class="line">          height: <span class="number">300</span>,</span><br><span class="line">          child: CustomPaint(</span><br><span class="line">            <span class="comment">// å°†æ•°æ®ä¼ ç»™ PeiChartPainter</span></span><br><span class="line">            painter: PeiChartPainter(</span><br><span class="line">              total: _total,</span><br><span class="line">              parts: _parts,</span><br><span class="line">              datas: _animateDatas,</span><br><span class="line">              legends: widget.legends,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        SizedBox(height: <span class="number">80</span>),</span><br><span class="line">        Container(</span><br><span class="line">          decoration: BoxDecoration(</span><br><span class="line">            color: Colors.blue,</span><br><span class="line">            shape: BoxShape.circle,</span><br><span class="line">          ),</span><br><span class="line">          child: IconButton(</span><br><span class="line">            color: Colors.white,</span><br><span class="line">            icon: Icon(Icons.refresh),</span><br><span class="line">            onPressed: () &#123;</span><br><span class="line">              _controller.reset();</span><br><span class="line">              _controller.forward();</span><br><span class="line">            &#125;,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤æ•´ä¸ªé¥¼çŠ¶å›¾çš„ç»˜åˆ¶å°±å®Œæˆäº†ï¼Œä¼ å…¥æ•°æ®å³å¯ä½¿ç”¨ ğŸ‰ğŸ‰ğŸ‰</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PieChart(</span><br><span class="line">  datas: [<span class="number">60.0</span>, <span class="number">50.0</span>, <span class="number">40.0</span>, <span class="number">30.0</span>, <span class="number">90.0</span>],</span><br><span class="line">  legends: [<span class="string">'ä¸€æœˆ'</span>, <span class="string">'äºŒæœˆ'</span>, <span class="string">'ä¸‰æœˆ'</span>, <span class="string">'å››æœˆ'</span>, <span class="string">'äº”æœˆ'</span>],</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç åœ°å€ï¼š<a href="https://github.com/xrr2016/flutter-charts/blob/master/lib/charts/pie_chart.dart" target="_blank" rel="noopener">pie_chart.dart</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨ Flutter ç»˜åˆ¶ä¸€ä¸ªé¥¼çŠ¶å›¾ï¼Œä½¿ç”¨äº†ä¸€ç‚¹ä¸‰è§’å‡½æ•°ï¼Œå…³é”®ç‚¹åœ¨äºè®¡ç®—å‡ºæ¯ä¸ªæ•°æ®å æ®æ•´ä¸ªåœ†å½¢çš„å¼§åº¦å€¼ï¼Œä»¥åŠæ•°æ®çš„èµ·å§‹å¼§åº¦å€¼ã€‚<br>æ•°å€¼å¢é•¿çš„åŠ¨ç”»æ•ˆæœä½¿ç”¨ä¸€ä¸ª <code>AnimationController</code> åœ¨å¼€å§‹åŠ¨ç”»åä¸æ–­çš„æ›´æ–°ç»˜åˆ¶ä½¿ç”¨çš„æ•°æ®ï¼Œåœ¨å°†æ•°æ®ä¼ é€’ç»™ <code>PeiChartPainter</code> ä½¿ç”¨å³å¯å®ç°ã€‚</p><h2 id="é™„è¨€"><a href="#é™„è¨€" class="headerlink" title="é™„è¨€"></a>é™„è¨€</h2><p>å‡†å¤‡å†™ä¸€ç³»åˆ—å…³äºç”¨ Flutter ç”»å›¾è¡¨çš„æ–‡ç« ï¼Œç”¨æ¥åˆ†äº«è¿™æ–¹é¢çš„çŸ¥è¯†ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯è¿™ä¸ªç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œé¢„è®¡ 6 ç¯‡ã€‚</p><ol><li><a href="https://coldstone.fun/post/2020/05/31/flutter-bar-chart/">Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆä¸€ï¼‰æŸ±çŠ¶å›¾ğŸ“Š</a></li><li><a href="https://coldstone.fun/post/2020/06/09/flutter-pie-chart/">Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆäºŒï¼‰é¥¼çŠ¶å›¾ğŸª</a>ï¼ˆæœ¬æ–‡ï¼‰</li><li>Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆä¸‰ï¼‰æŠ˜çº¿å›¾ğŸ“ˆ</li><li>Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆå››ï¼‰é›·è¾¾å›¾ğŸ¯</li><li>Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆäº”ï¼‰ç¯çŠ¶å›¾ğŸ©</li><li>Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆå…­ï¼‰æ¡å½¢å›¾ğŸ“</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡è®²è§£å¦‚ä½•ä½¿ç”¨ Flutter ç»˜åˆ¶é¥¼çŠ¶å›¾&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆä¸€ï¼‰æŸ±çŠ¶å›¾ğŸ“Š</title>
    <link href="https://coldstone.fun/post/2020/05/31/flutter-bar-chart/"/>
    <id>https://coldstone.fun/post/2020/05/31/flutter-bar-chart/</id>
    <published>2020-05-31T14:00:00.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡è®²è§£å¦‚ä½•ä½¿ç”¨ Flutter ç»˜åˆ¶ä¸€ä¸ªå¸¦æœ‰åŠ¨ç”»æ•ˆæœçš„æŸ±çŠ¶å›¾è¡¨</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡è®²è§£å¦‚ä½•ä½¿ç”¨ <a href="https://flutter.dev/" target="_blank" rel="noopener">Flutter</a> ï¼ˆGoogle å¼€æºçš„ UI å·¥å…·åŒ…ï¼Œå¸®åŠ©å¼€å‘è€…é€šè¿‡ä¸€å¥—ä»£ç åº“é«˜æ•ˆæ„å»ºå¤šå¹³å°ç²¾ç¾åº”ç”¨ï¼Œæ”¯æŒç§»åŠ¨ã€Webã€æ¡Œé¢å’ŒåµŒå…¥å¼å¹³å°ï¼‰ ç»˜åˆ¶ä¸€ä¸ªå¸¦æœ‰åŠ¨ç”»æ•ˆæœçš„æŸ±çŠ¶å›¾è¡¨ï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾ã€‚</p><img src="./images/flutter-bar-chart/bar-chart.gif" width="568" style="width: 260px"><p>è¦ç»˜åˆ¶è¿™æ ·çš„å›¾è¡¨æ™®é€šçš„ Widget éš¾ä»¥å®ç°ï¼Œè¿™æ—¶å°±éœ€è¦ <code>CustomPaint</code> å’Œ <code>CustomPainter</code> å‡ºåœºäº†ï¼Œå®ƒä»¬ç±»ä¼¼äº Web é‡Œé¢çš„ <code>&lt;canvas&gt;</code> å…ƒç´ ï¼Œ<code>CustomPaint</code> æä¾›äº†ä¸€ä¸ªç»˜åˆ¶åŒºåŸŸï¼Œè€Œ <code>CustomPainter</code> æ‹¥æœ‰å…·ä½“çš„ç»˜åˆ¶æ–¹æ³•ã€‚</p><h2 id="CustomPaint-æ˜¯ä»€ä¹ˆ"><a href="#CustomPaint-æ˜¯ä»€ä¹ˆ" class="headerlink" title="CustomPaint æ˜¯ä»€ä¹ˆ"></a>CustomPaint æ˜¯ä»€ä¹ˆ</h2><p><code>CustomPaint</code> æ˜¯ç”¨æ¥æä¾›ç”»å¸ƒçš„æ§ä»¶ï¼Œå®ƒä½¿ç”¨ä¼ å…¥ç”»ç¬” <code>painter</code> åœ¨ <code>child</code> æ§ä»¶åé¢ç»˜åˆ¶å›¾å½¢, ï¼Œ<code>foregroundPainter</code> ç”»ç¬”ç»˜åˆ¶åœ¨ <code>child</code> æ§ä»¶ä¹‹å‰ã€‚<code>size</code> å±æ€§æ§åˆ¶ç”»å¸ƒçš„å¤§å°ï¼Œå‡å¦‚å®šä¹‰äº†å­æ§ä»¶ <code>child</code>ï¼Œé‚£ä¹ˆç”»å¸ƒçš„å¤§å°å°†ç”±å­æ§ä»¶çš„å¤§å°å†³å®šï¼Œ<code>size</code> å±æ€§è¢«å¿½ç•¥ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomPaint</span> <span class="keyword">extends</span> <span class="title">SingleChildRenderObjectWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> CustomPaint(&#123;</span><br><span class="line">    Key key,</span><br><span class="line">    <span class="keyword">this</span>.painter,</span><br><span class="line">    <span class="keyword">this</span>.foregroundPainter,</span><br><span class="line">    <span class="keyword">this</span>.size = Size.zero,</span><br><span class="line">    <span class="keyword">this</span>.isComplex = <span class="keyword">false</span>,</span><br><span class="line">    <span class="keyword">this</span>.willChange = <span class="keyword">false</span>,</span><br><span class="line">    Widget child,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œ <code>CustomPainter</code> æ˜¯å®ç°ç»˜åˆ¶å›¾å½¢çš„æ§ä»¶ï¼Œè¦åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶å›¾å½¢éœ€è¦å®ç°å®ƒçš„ <code>paint</code> æ–¹æ³•ã€‚<code>paint</code> æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œ<code>Canvas canvas</code> å’Œ <code>Size size</code>ã€‚<code>Size</code> å¯¹è±¡è¡¨ç¤ºç”»å¸ƒçš„å°ºå¯¸ï¼Œ<code>Canvas</code> å¯¹è±¡ä¸Šæ˜¯å…·ä½“çš„ç»˜åˆ¶å›¾å½¢çš„æ–¹æ³•ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomPainter</span> <span class="keyword">extends</span> <span class="title">Listenable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">void</span> paint(Canvas canvas, Size size);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span> shouldRepaint(<span class="keyword">covariant</span> CustomPainter oldDelegate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Canvas canvas</code> å¯¹è±¡ä¸»è¦çš„ç»˜åˆ¶å›¾å½¢æ–¹æ³•æœ‰</p><table><thead><tr><th align="left">æ–¹æ³•å</th><th align="left">å‚æ•°</th><th align="left">æ•ˆæœ</th></tr></thead><tbody><tr><td align="left"><code>drawColor</code></td><td align="left"><code>Color color</code>, <code>BlendMode blendMode</code></td><td align="left">ç»˜åˆ¶é¢œè‰²åˆ°ç”»å¸ƒä¸Š</td></tr><tr><td align="left"><code>drawLine</code></td><td align="left"><code>Offset p1</code>, <code>Offset p2</code>, <code>Paint paint</code></td><td align="left">ä¸¤ç‚¹ä¹‹é—´ç”»çº¿</td></tr><tr><td align="left"><code>drawPaint</code></td><td align="left"><code>Paint paint</code></td><td align="left">ä½¿ç”¨ [Paint] å¡«å……ç”»å¸ƒ</td></tr><tr><td align="left"><code>drawRect</code></td><td align="left"><code>Rect rect</code>, <code>Paint paint</code></td><td align="left">ç»˜åˆ¶çŸ©å½¢</td></tr><tr><td align="left"><code>drawRRect</code></td><td align="left"><code>RRect rrect</code>, <code>Paint paint</code></td><td align="left">ç»˜åˆ¶å¸¦åœ†è§’çš„çŸ©å½¢</td></tr><tr><td align="left"><code>drawOval</code></td><td align="left"><code>Rect rect</code>, <code>Paint paint</code></td><td align="left">ç»˜åˆ¶æ¤­åœ†</td></tr><tr><td align="left"><code>drawCircle</code></td><td align="left"><code>Offset c</code>, <code>double radius</code>, <code>Paint paint</code></td><td align="left">ç»˜åˆ¶åœ†å½¢</td></tr><tr><td align="left"><code>drawArc</code></td><td align="left"><code>Rect rect</code>, <code>double startAngle</code>, <code>double sweepAngle</code>, <code>bool useCenter</code>, <code>Paint paint</code></td><td align="left">ç»˜åˆ¶å¼§å½¢</td></tr><tr><td align="left"><code>drawPath</code></td><td align="left"><code>Path path</code>, <code>Paint paint</code></td><td align="left">ç»˜åˆ¶è·¯å¾„</td></tr><tr><td align="left"><code>drawImage</code></td><td align="left"><code>Image image</code>, <code>Offset p</code>, <code>Paint paint</code></td><td align="left">ç»˜åˆ¶å›¾åƒ</td></tr><tr><td align="left"><code>drawPoints</code></td><td align="left"><code>PointMode pointMode</code>, <code>List&lt;Offset&gt; points</code>, <code>Paint paint</code></td><td align="left">ç»˜åˆ¶å¤šä¸ªç‚¹</td></tr></tbody></table><p>è¦å°†å›¾å½¢ç»˜åˆ¶åˆ°ç”»å¸ƒä¸Šéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡³ <code>CustomPainter</code> çš„è‡ªå®šä¹‰ç”»ç¬”ï¼Œä¾‹å¦‚ç»˜åˆ¶ä¸€ä¸ªçŸ©å½¢éœ€è¦å®ç°ä¸€ä¸ªç»˜åˆ¶çŸ©å½¢çš„ç”»ç¬” <code>RectanglePainter</code>ï¼Œç„¶ååœ¨ç”»å¸ƒ <code>CustomPaint</code> ä¸Šåº”ç”¨å®ƒã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RectanglePainter</span> <span class="keyword">extends</span> <span class="title">CustomPainter</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªçŸ©å½¢</span></span><br><span class="line">    <span class="keyword">final</span> Rect rect = Rect.fromLTWH(<span class="number">50.0</span>, <span class="number">50.0</span>, <span class="number">100.0</span>, <span class="number">100.0</span>);</span><br><span class="line">    <span class="comment">// æŒ‡å®šç»˜åˆ¶çš„æ ·å¼</span></span><br><span class="line">    <span class="keyword">final</span> Paint paint = Paint()</span><br><span class="line">      ..color = Colors.orange</span><br><span class="line">      ..strokeWidth = <span class="number">4.0</span></span><br><span class="line">      ..style = PaintingStyle.stroke</span><br><span class="line">      ..isAntiAlias = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ drawRect ç»˜åˆ¶çŸ©å½¢</span></span><br><span class="line">    canvas.drawRect(rect, paint);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> shouldRepaint(RectanglePainter oldDelegate) =&gt; <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Center(</span><br><span class="line">      child: CustomPaint(</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ RectanglePainter åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶</span></span><br><span class="line">        painter: RectanglePainter(),</span><br><span class="line">        child: Container(</span><br><span class="line">          width: <span class="number">300</span>,</span><br><span class="line">          height: <span class="number">300</span>,</span><br><span class="line">          decoration: BoxDecoration(</span><br><span class="line">            border: Border.all(</span><br><span class="line">              width: <span class="number">1.0</span>,</span><br><span class="line">              color: Colors.grey[<span class="number">300</span>],</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚å›¾</p><img src="./images/flutter-bar-chart/rect.png" width="520" style="width: 260px"><h2 id="ç»˜åˆ¶æŸ±çŠ¶å›¾è¡¨"><a href="#ç»˜åˆ¶æŸ±çŠ¶å›¾è¡¨" class="headerlink" title="ç»˜åˆ¶æŸ±çŠ¶å›¾è¡¨"></a>ç»˜åˆ¶æŸ±çŠ¶å›¾è¡¨</h2><p>ä»‹ç»å®Œæ¯•ï¼Œä¸‹é¢å¼€å§‹ç»˜åˆ¶æŸ±çŠ¶å›¾è¡¨ï¼Œç¬¬ä¸€æ­¥åˆ›å»º <code>BarChart</code> æ§ä»¶ä»£è¡¨æŸ±çŠ¶å›¾ï¼Œå®ƒæœ‰ä¸¤ä¸ªæ„é€ å‚æ•°ä¸€ä¸ªæ˜¯ <code>data</code> ç”¨æ¥æ¥æ”¶å›¾è¡¨æ•°æ®ï¼Œä»¥åŠ <code>xAxis</code> è¡¨ç¤ºå›¾è¡¨æ¨ªè½´æ ‡è¯†ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BarChart</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">double</span>&gt; data;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; xAxis;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> BarChart(&#123;</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.data,</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.xAxis,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _BarChartState createState() =&gt; _BarChartState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_BarChartState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">BarChart</span>&gt; <span class="title">with</span> <span class="title">TickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">      children: [</span><br><span class="line">        CustomPaint(</span><br><span class="line">          painter: BarChartPainter(</span><br><span class="line">            datas: widget.data,</span><br><span class="line">            xAxis: widget.xAxis,</span><br><span class="line">          ),</span><br><span class="line">          child: Container(width: <span class="number">300</span>, height: <span class="number">300</span>),</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ›å»ºä¸€ä¸ªç”¨æ¥ç»˜åˆ¶çš„è‡ªå®šä¹‰ç”»ç¬” <code>BarChartPainter</code>ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BarChartPainter</span> <span class="keyword">extends</span> <span class="title">CustomPainter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">double</span>&gt; datas;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; xAxis;</span><br><span class="line"></span><br><span class="line">  BarChartPainter(&#123;</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.xAxis,</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.datas,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">   <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> shouldRepaint(BarChartPainter oldDelegate) =&gt; <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> shouldRebuildSemantics(BarChartPainter oldDelegate) =&gt; <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»˜åˆ¶åæ ‡è½´"><a href="#ç»˜åˆ¶åæ ‡è½´" class="headerlink" title="ç»˜åˆ¶åæ ‡è½´"></a>ç»˜åˆ¶åæ ‡è½´</h3><p>åœ¨ <code>BarChartPainter</code> ä¸Šå®šä¹‰ä¸€ä¸ª <code>_drawAxis</code> æ–¹æ³•ç”¨äºç»˜åˆ¶æ¨ªåæ ‡è½´ï¼Œä½¿ç”¨ä¸€ä¸ªç”±å·¦ä¸Šï¼Œå·¦ä¸‹ï¼Œå³ä¸‹ä¸‰ä¸ªç‚¹æ§åˆ¶çš„ <code>Path</code> è·¯å¾„ç»˜åˆ¶ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _drawAxis(Canvas canvas, Size size) &#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> sw = size.width;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> sh = size.height;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨ Paint å®šä¹‰è·¯å¾„çš„æ ·å¼</span></span><br><span class="line">  <span class="keyword">final</span> Paint paint = Paint()</span><br><span class="line">    ..color = Colors.black87</span><br><span class="line">    ..style = PaintingStyle.stroke</span><br><span class="line">    ..strokeWidth = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨ Path å®šä¹‰ç»˜åˆ¶çš„è·¯å¾„ï¼Œä»ç”»å¸ƒçš„å·¦ä¸Šè§’åˆ°å·¦ä¸‹è§’åœ¨åˆ°å³ä¸‹è§’</span></span><br><span class="line">  <span class="keyword">final</span> Path path = Path()</span><br><span class="line">    ..moveTo(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    ..lineTo(<span class="number">0</span>, sh)</span><br><span class="line">    ..lineTo(sw, sh);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨ drawPath æ–¹æ³•ç»˜åˆ¶è·¯å¾„</span></span><br><span class="line">  canvas.drawPath(path, paint);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">  _drawAxis(canvas, size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹</p><img src="./images/flutter-bar-chart/chart-axis.png" width="508" style="width: 260px" alt="chart-axis"><h3 id="ç»˜åˆ¶æ ‡è¯†"><a href="#ç»˜åˆ¶æ ‡è¯†" class="headerlink" title="ç»˜åˆ¶æ ‡è¯†"></a>ç»˜åˆ¶æ ‡è¯†</h3><p>åœ¨ <code>BarChartPainter</code> ä¸Šå®šä¹‰ä¸€ä¸ª <code>_drawLabels</code> æ–¹æ³•ç»˜åˆ¶çºµè½´æ ‡è¯†ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _drawLabels(Canvas canvas, Size size) &#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> gap = <span class="number">50.0</span>;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> sh = size.height;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">double</span>&gt; yAxisLabels = [];</span><br><span class="line"></span><br><span class="line">  Paint paint = Paint()</span><br><span class="line">    ..color = Colors.black87</span><br><span class="line">    ..strokeWidth = <span class="number">2.0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨ 50.0 ä¸ºé—´éš”ç»˜åˆ¶æ¯”ä¼ å…¥æ•°æ®å¤šä¸€ä¸ªçš„æ ‡è¯†</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt;= datas.length; i++) &#123;</span><br><span class="line">    yAxisLabels.add(gap * i);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  yAxisLabels.asMap().forEach(</span><br><span class="line">    (index, label) &#123;</span><br><span class="line">      <span class="comment">// æ ‡è¯†çš„é«˜åº¦ä¸ºç”»å¸ƒé«˜åº¦å‡å»æ ‡è¯†çš„å€¼</span></span><br><span class="line">      <span class="keyword">final</span> <span class="built_in">double</span> top = sh - label;</span><br><span class="line">      <span class="keyword">final</span> rect = Rect.fromLTWH(<span class="number">0</span>, top, <span class="number">4</span>, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">final</span> Offset textOffset = Offset(</span><br><span class="line">        <span class="number">0</span> - labelFontSize * <span class="number">3</span>,</span><br><span class="line">        top - labelFontSize / <span class="number">2</span>,</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ç»˜åˆ¶ Y è½´å³è¾¹çš„çº¿æ¡</span></span><br><span class="line">      canvas.drawRect(rect, paint);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ç»˜åˆ¶æ–‡å­—éœ€è¦ç”¨ `TextPainter`ï¼Œæœ€åè°ƒç”¨ paint æ–¹æ³•ç»˜åˆ¶æ–‡å­—</span></span><br><span class="line">      TextPainter(</span><br><span class="line">        text: TextSpan(</span><br><span class="line">          text: label.toStringAsFixed(<span class="number">0</span>),</span><br><span class="line">          style: TextStyle(fontSize: labelFontSize, color: Colors.black87),</span><br><span class="line">        ),</span><br><span class="line">        textAlign: TextAlign.right,</span><br><span class="line">        textDirection: TextDirection.ltr,</span><br><span class="line">        textWidthBasis: TextWidthBasis.longestLine,</span><br><span class="line">      )</span><br><span class="line">        ..layout(minWidth: <span class="number">0</span>, maxWidth: <span class="number">24</span>)</span><br><span class="line">        ..paint(canvas, textOffset);</span><br><span class="line">    &#125;,</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">  _drawAxis(canvas, size);</span><br><span class="line">  _drawLabels(canvas, size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹</p><img src="./images/flutter-bar-chart/chart-yaxis.png" width="520" style="width: 260px" alt="chart-yaxis"><h3 id="ç»˜åˆ¶æ•°æ®çŸ©å½¢"><a href="#ç»˜åˆ¶æ•°æ®çŸ©å½¢" class="headerlink" title="ç»˜åˆ¶æ•°æ®çŸ©å½¢"></a>ç»˜åˆ¶æ•°æ®çŸ©å½¢</h3><p>ç„¶åå®šä¹‰ä¸€ä¸ª <code>_darwBars</code> æ–¹æ³•å°†å…·ä½“çŸ©å½¢å’Œæ¨ªè½´æ ‡è¯†ç»˜åˆ¶å‡ºæ¥ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span>&lt;Color&gt; colors = [</span><br><span class="line">  Color(<span class="number">0xff8e43e7</span>),</span><br><span class="line">  Color(<span class="number">0xffff4f81</span>),</span><br><span class="line">  Color(<span class="number">0xff1cc7d0</span>),</span><br><span class="line">  Color(<span class="number">0xff00aeff</span>),</span><br><span class="line">  Color(<span class="number">0xff3369e7</span>),</span><br><span class="line">  Color(<span class="number">0xffb84592</span>),</span><br><span class="line">  Color(<span class="number">0xff2dde98</span>),</span><br><span class="line">  Color(<span class="number">0xffff6c5f</span>),</span><br><span class="line">  Color(<span class="number">0xff003666</span>),</span><br><span class="line">  Color(<span class="number">0xffffc168</span>),</span><br><span class="line">  Color(<span class="number">0xff050f2c</span>),</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _darwBars(Canvas canvas, Size size) &#123;</span><br><span class="line">  <span class="keyword">final</span> sh = size.height;</span><br><span class="line">  <span class="keyword">final</span> paint = Paint()..style = PaintingStyle.fill;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; datas.length; i++) &#123;</span><br><span class="line">    <span class="comment">// æ¯ä¸ªçŸ©å½¢ä½¿ç”¨é¢„è®¾çš„ colors æ•°ç»„é‡Œé¢çš„é¢œè‰²</span></span><br><span class="line">    paint.color = colors[i];</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">double</span> textFontSize = <span class="number">14.0</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">double</span> data = datas[i];</span><br><span class="line">    <span class="comment">// çŸ©å½¢çš„ä¸Šè¾¹ç¼˜ä¸ºç”»å¸ƒé«˜åº¦å‡å»æ•°æ®å€¼</span></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">double</span> top = sh - data;</span><br><span class="line">    <span class="comment">// çŸ©å½¢çš„å·¦è¾¹ç¼˜ä¸ºå½“å‰ç´¢å¼•å€¼ä¹˜ä»¥çŸ©å½¢å®½åº¦åŠ ä¸ŠçŸ©å½¢ä¹‹é—´çš„é—´è·</span></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">double</span> left = i * _barWidth + (i * _barGap) + _barGap;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ Rect.fromLTWH æ–¹æ³•åˆ›å»ºè¦ç»˜åˆ¶çš„çŸ©å½¢</span></span><br><span class="line">    <span class="keyword">final</span> rect = Rect.fromLTWH(left, top, _barWidth, data);</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ drawRect æ–¹æ³•ç»˜åˆ¶çŸ©å½¢</span></span><br><span class="line">    canvas.drawRect(rect, paint);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> offset = Offset(</span><br><span class="line">      left + _barWidth / <span class="number">2</span> - textFontSize * <span class="number">1.2</span>,</span><br><span class="line">      top - textFontSize * <span class="number">2</span>,</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ TextPainter ç»˜åˆ¶çŸ©å½¢ä¸Šæ”¾çš„æ•°å€¼</span></span><br><span class="line">    TextPainter(</span><br><span class="line">      text: TextSpan(</span><br><span class="line">        text: data.toStringAsFixed(<span class="number">1</span>),</span><br><span class="line">        style: TextStyle(fontSize: textFontSize, color: paint.color),</span><br><span class="line">      ),</span><br><span class="line">      textAlign: TextAlign.center,</span><br><span class="line">      textDirection: TextDirection.ltr,</span><br><span class="line">    )</span><br><span class="line">      ..layout(</span><br><span class="line">        minWidth: <span class="number">0</span>,</span><br><span class="line">        maxWidth: textFontSize * data.toString().length,</span><br><span class="line">      )</span><br><span class="line">      ..paint(canvas, offset);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> xData = xAxis[i];</span><br><span class="line">    <span class="keyword">final</span> xOffset = Offset(left + _barWidth / <span class="number">2</span> - textFontSize, sh + <span class="number">12</span>);</span><br><span class="line">    <span class="comment">// ç»˜åˆ¶æ¨ªè½´æ ‡è¯†</span></span><br><span class="line">    TextPainter(</span><br><span class="line">      textAlign: TextAlign.center,</span><br><span class="line">      text: TextSpan(</span><br><span class="line">        text: <span class="string">'<span class="subst">$xData</span>'</span>,</span><br><span class="line">        style: TextStyle(fontSize: <span class="number">12</span>, color: Colors.black87),</span><br><span class="line">      ),</span><br><span class="line">      textDirection: TextDirection.ltr,</span><br><span class="line">    )</span><br><span class="line">      ..layout(</span><br><span class="line">        minWidth: <span class="number">0</span>,</span><br><span class="line">        maxWidth: size.width,</span><br><span class="line">      )</span><br><span class="line">      ..paint(canvas, xOffset);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> paint(Canvas canvas, Size size) &#123;</span><br><span class="line">  _drawAxis(canvas, size);</span><br><span class="line">  _drawLabels(canvas, size);</span><br><span class="line">  _darwBars(canvas, size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹</p><img src="./images/flutter-bar-chart/chart-data.png" width="520" style="width: 260px" alt="chart-data"><h3 id="æ·»åŠ è¿åŠ¨åŠ¨ç”»"><a href="#æ·»åŠ è¿åŠ¨åŠ¨ç”»" class="headerlink" title="æ·»åŠ è¿åŠ¨åŠ¨ç”»"></a>æ·»åŠ è¿åŠ¨åŠ¨ç”»</h3><p>æœ€ååœ¨ <code>_BarChartState</code> é‡Œä½¿ç”¨ä¸€ä¸ª <code>AnimationController</code> åˆ›å»ºæŸ±çŠ¶å›¾è¿åŠ¨çš„åŠ¨ç”»ï¼Œå…³äºåŠ¨ç”»æ–¹é¢çš„çŸ¥è¯†å¯ä»¥æŸ¥é˜… <a href="https://coldstone.fun/post/2020/04/26/flutter-animation-from-zero/">ä»é›¶å¼€å§‹çš„ Flutter åŠ¨ç”»</a> è¿™ç¯‡æ–‡ç« ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_BarChartState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">BarChart</span>&gt; <span class="title">with</span> <span class="title">TickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  AnimationController _controller;</span><br><span class="line">  <span class="keyword">final</span> _animations = &lt;<span class="built_in">double</span>&gt;[];</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    <span class="built_in">double</span> begin = <span class="number">0.0</span>;</span><br><span class="line">    <span class="built_in">List</span>&lt;<span class="built_in">double</span>&gt; datas = widget.data;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–åŠ¨ç”»æ§åˆ¶å™¨ï¼Œå¹¶è°ƒç”¨ forward æ–¹æ³•å¯åŠ¨åŠ¨ç”»</span></span><br><span class="line">    _controller = AnimationController(</span><br><span class="line">      vsync: <span class="keyword">this</span>,</span><br><span class="line">      duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">3000</span>),</span><br><span class="line">    )..forward();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; datas.length; i++) &#123;</span><br><span class="line">      <span class="keyword">final</span> <span class="built_in">double</span> end = datas[i];</span><br><span class="line">      <span class="comment">// ä½¿ç”¨ä¸€ä¸ªè¡¥é—´å€¼ Tween åˆ›å»ºæ¯ä¸ªçŸ©å½¢çš„åŠ¨ç”»å€¼</span></span><br><span class="line">      <span class="keyword">final</span> Tween&lt;<span class="built_in">double</span>&gt; tween = Tween(begin: begin, end: end);</span><br><span class="line">      <span class="comment">// åˆå§‹åŒ–æ•°ç»„é‡Œé¢çš„å€¼</span></span><br><span class="line">      _animations.add(begin);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ›å»ºè¡¥é—´åŠ¨ç”»</span></span><br><span class="line">      Animation&lt;<span class="built_in">double</span>&gt; animation = tween.animate(</span><br><span class="line">        CurvedAnimation(</span><br><span class="line">          parent: _controller,</span><br><span class="line">          curve: Curves.ease,</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">      _controller.addListener(() &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ setState æ›´æ–° _animations æ•°ç»„é‡Œé¢çš„åŠ¨ç”»å€¼</span></span><br><span class="line">        setState(() &#123;</span><br><span class="line">          _animations[i] = animation.value;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">      children: [</span><br><span class="line">        CustomPaint(</span><br><span class="line">          <span class="comment">// æœ€åå‘ BarChartPainter ä¼ å…¥ _animations æ•°ç»„ï¼Œå®ç°åŠ¨ç”»</span></span><br><span class="line">          painter: BarChartPainter(</span><br><span class="line">            datas: _animations,</span><br><span class="line">            xAxis: widget.xAxis,</span><br><span class="line">            animation: _controller,</span><br><span class="line">          ),</span><br><span class="line">          child: Container(width: <span class="number">300</span>, height: <span class="number">300</span>),</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤æ•´ä¸ªæŸ±çŠ¶å›¾çš„ç»˜åˆ¶å°±å®Œæˆäº†ï¼Œä¼ å…¥æ•°æ®å³å¯ä½¿ç”¨ ğŸ‰ğŸ‰ğŸ‰</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BarChart(</span><br><span class="line">  data: [<span class="number">180.0</span>, <span class="number">98.0</span>, <span class="number">126.0</span>, <span class="number">64.0</span>, <span class="number">118.0</span>],</span><br><span class="line">  xAxis: [<span class="string">'ä¸€æœˆ'</span>, <span class="string">'äºŒæœˆ'</span>, <span class="string">'ä¸‰æœˆ'</span>, <span class="string">'å››æœˆ'</span>, <span class="string">'äº”æœˆ'</span>],</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç åœ°å€ï¼š<a href="https://github.com/xrr2016/flutter-charts/blob/master/lib/charts/bar_chart.dart" target="_blank" rel="noopener">bar_chart.dart</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡è¯´æ˜äº†ä»€ä¹ˆæ˜¯ <code>CustomPaint</code> å’Œ <code>CustomPainter</code>ã€‚ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬ç»˜åˆ¶ä¸€ä¸ªå¸¦æœ‰åŠ¨ç”»çš„æŸ±çŠ¶å›¾è¡¨ã€‚</p><h2 id="é™„è¨€"><a href="#é™„è¨€" class="headerlink" title="é™„è¨€"></a>é™„è¨€</h2><p>å‡†å¤‡å†™ä¸€ç³»åˆ—å…³äºç”¨ Flutter ç”»å›¾è¡¨çš„æ–‡ç« ï¼Œç”¨æ¥åˆ†äº«è¿™æ–¹é¢çš„çŸ¥è¯†ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯è¿™ä¸ªç³»åˆ—çš„å¼€ç¯‡ï¼Œé¢„è®¡ä¸€å…±ä¼šå†™ 6 ç¯‡ã€‚</p><ol><li><a href="https://coldstone.fun/post/2020/05/31/flutter-bar-chart/">Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆä¸€ï¼‰æŸ±çŠ¶å›¾ğŸ“Š</a>ï¼ˆæœ¬æ–‡ï¼‰</li><li>Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆäºŒï¼‰é¥¼çŠ¶å›¾ğŸª</li><li>Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆä¸‰ï¼‰æŠ˜çº¿å›¾ğŸ“ˆ</li><li>Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆå››ï¼‰é›·è¾¾å›¾ğŸ¯</li><li>Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆäº”ï¼‰ç¯çŠ¶å›¾ğŸ©</li><li>Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆå…­ï¼‰æ¡å½¢å›¾ğŸ“</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡è®²è§£å¦‚ä½•ä½¿ç”¨ Flutter ç»˜åˆ¶ä¸€ä¸ªå¸¦æœ‰åŠ¨ç”»æ•ˆæœçš„æŸ±çŠ¶å›¾è¡¨&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>é€‰æ‹©é€‚åˆçš„ Flutter åŠ¨ç”»æ§ä»¶</title>
    <link href="https://coldstone.fun/post/2020/05/07/flutter-animation-decision/"/>
    <id>https://coldstone.fun/post/2020/05/07/flutter-animation-decision/</id>
    <published>2020-05-07T02:04:58.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>å¦‚ä½•åœ¨ Flutter ä¸­é€‰æ‹©åˆé€‚çš„åŠ¨ç”» Widget ä¸­æ–‡ç¿»è¯‘</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Flutter å›¢é˜Ÿæ¨å‡ºäº†ä¸€ä¸ªå…³äº <a href="https://www.youtube.com/watch?v=GXIJJkq_H8g" target="_blank" rel="noopener">å¦‚ä½•åœ¨ Flutter ä¸­é€‰æ‹©åˆé€‚çš„åŠ¨ç”» Widget</a> çš„è§†é¢‘ä»¥åŠé…å¥—çš„æ–‡ç«  <a href="https://medium.com/flutter/how-to-choose-which-flutter-animation-widget-is-right-for-you-79ecfb7e72b5" target="_blank" rel="noopener">How to Choose Which Flutter Animation Widget is Right for You?</a> éƒ½æŒºæœ‰å¥½çš„ï¼Œæ‰€ä»¥å°†æ–‡ä¸­çš„é€‰æ‹©å›¾ç¿»è¯‘å‡ºæ¥ã€‚</p><h2 id="è‹±æ–‡ç‰ˆ"><a href="#è‹±æ–‡ç‰ˆ" class="headerlink" title="è‹±æ–‡ç‰ˆ"></a>è‹±æ–‡ç‰ˆ</h2><p><img src="./images/flutter-animation-decision/animation-decision-tree.png" alt="animation-decision-tree"></p><h2 id="ä¸­æ–‡ç‰ˆ"><a href="#ä¸­æ–‡ç‰ˆ" class="headerlink" title="ä¸­æ–‡ç‰ˆ"></a>ä¸­æ–‡ç‰ˆ</h2><p><img src="./images/flutter-animation-decision/animation-decision-tree-zh.png" alt="animation-decision-tree-zh"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://medium.com/flutter/how-to-choose-which-flutter-animation-widget-is-right-for-you-79ecfb7e72b5" target="_blank" rel="noopener">How to Choose Which Flutter Animation Widget is Right for You?</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¦‚ä½•åœ¨ Flutter ä¸­é€‰æ‹©åˆé€‚çš„åŠ¨ç”» Widget ä¸­æ–‡ç¿»è¯‘&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
      <category term="Animation" scheme="https://coldstone.fun/tags/Animation/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹çš„ Flutter åŠ¨ç”»</title>
    <link href="https://coldstone.fun/post/2020/04/26/flutter-animation-from-zero/"/>
    <id>https://coldstone.fun/post/2020/04/26/flutter-animation-from-zero/</id>
    <published>2020-04-26T12:00:00.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>Flutter ä¸­çš„åŠ¨ç”»</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åŠ¨ç”»æœ¬è´¨æ˜¯åœ¨ä¸€æ®µæ—¶é—´å†…ä¸æ–­æ”¹å˜å±å¹•ä¸Šæ˜¾ç¤ºçš„å†…å®¹ï¼Œä»è€Œäº§ç”Ÿ<a href="https://zh.wikipedia.org/wiki/%E8%A6%96%E8%A6%BA%E6%9A%AB%E7%95%99" target="_blank" rel="noopener">è§†è§‰æš‚ç•™</a>ç°è±¡ã€‚</p><p>åŠ¨ç”»ä¸€èˆ¬å¯åˆ†ä¸ºä¸¤ç±»ï¼š</p><p><strong>è¡¥é—´åŠ¨ç”»</strong>ï¼šè¡¥é—´åŠ¨ç”»æ˜¯ä¸€ç§é¢„å…ˆå®šä¹‰ç‰©ä½“è¿åŠ¨çš„èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œç‰©ä½“çš„è¿åŠ¨æ–¹å¼ï¼Œè¿åŠ¨æ—¶é—´ï¼Œæ—¶é—´æ›²çº¿ï¼Œç„¶åä»èµ·ç‚¹è¿‡æ¸¡åˆ°ç»ˆç‚¹çš„åŠ¨ç”»ã€‚</p><p><strong>åŸºäºç‰©ç†çš„åŠ¨ç”»</strong>ï¼šåŸºäºç‰©ç†çš„åŠ¨ç”»æ˜¯ä¸€ç§æ¨¡æ‹Ÿç°å®ä¸–ç•Œè¿åŠ¨çš„åŠ¨ç”»ï¼Œé€šè¿‡å»ºç«‹è¿åŠ¨æ¨¡å‹æ¥å®ç°ã€‚ä¾‹å¦‚ä¸€ä¸ªç¯®çƒğŸ€ä»é«˜å¤„è½ä¸‹ï¼Œéœ€è¦æ ¹æ®å…¶ä¸‹è½é«˜åº¦ï¼Œé‡åŠ›åŠ é€Ÿåº¦ï¼Œåœ°é¢åå¼¹åŠ›ç­‰å½±å“å› ç´ æ¥å»ºç«‹è¿åŠ¨æ¨¡å‹ã€‚</p><h2 id="Flutter-ä¸­çš„åŠ¨ç”»"><a href="#Flutter-ä¸­çš„åŠ¨ç”»" class="headerlink" title="Flutter ä¸­çš„åŠ¨ç”»"></a>Flutter ä¸­çš„åŠ¨ç”»</h2><p>Flutter ä¸­æœ‰å¤šç§ç±»å‹çš„åŠ¨ç”»ï¼Œå…ˆä»ä¸€ä¸ªç®€å•çš„ä¾‹å­å¼€å§‹ï¼Œä½¿ç”¨ä¸€ä¸ª <code>AnimatedContainer</code> æ§ä»¶ï¼Œç„¶åè®¾ç½®åŠ¨ç”»æ—¶é•¿ <code>duration</code>ï¼Œæœ€åè°ƒç”¨ <code>setState</code> æ–¹æ³•æ”¹å˜éœ€è¦å˜åŒ–çš„å±æ€§å€¼ï¼Œä¸€ä¸ªåŠ¨ç”»å°±åˆ›å»ºäº†ã€‚</p><img src="./images/flutter-animation-from-zero/animated-container.gif" alt="animated-container" style="width: 240px;" width="240"><p>ä»£ç å¦‚ä¸‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnimatedContainerPage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _AnimatedContainerPageState createState() =&gt; _AnimatedContainerPageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_AnimatedContainerPageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">AnimatedContainerPage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// åˆå§‹çš„å±æ€§å€¼</span></span><br><span class="line">  <span class="built_in">double</span> size = <span class="number">100</span>;</span><br><span class="line">  <span class="built_in">double</span> raidus = <span class="number">25</span>;</span><br><span class="line">  Color color = Colors.yellow;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> _animate() &#123;</span><br><span class="line">    <span class="comment">// æ”¹å˜å±æ€§å€¼</span></span><br><span class="line">    setState(() &#123;</span><br><span class="line">      size = size == <span class="number">100</span> ? <span class="number">200</span> : <span class="number">100</span>;</span><br><span class="line">      raidus = raidus == <span class="number">25</span> ? <span class="number">100</span> : <span class="number">25</span>;</span><br><span class="line">      color = color == Colors.yellow ? Colors.greenAccent : Colors.yellow;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(title: Text(<span class="string">'Animated Container'</span>)),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">          children: [</span><br><span class="line">            <span class="comment">// åœ¨ AnimatedContainer ä¸Šåº”ç”¨å±æ€§å€¼</span></span><br><span class="line">            AnimatedContainer(</span><br><span class="line">              width: size,</span><br><span class="line">              height: size,</span><br><span class="line">              curve: Curves.easeIn,</span><br><span class="line">              padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">20.0</span>),</span><br><span class="line">              decoration: BoxDecoration(</span><br><span class="line">                color: color,</span><br><span class="line">                borderRadius: BorderRadius.circular(raidus),</span><br><span class="line">              ),</span><br><span class="line">              duration: <span class="built_in">Duration</span>(seconds: <span class="number">1</span>),</span><br><span class="line">              child: FlutterLogo(),</span><br><span class="line">            )</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      floatingActionButton: FloatingActionButton(</span><br><span class="line">        onPressed: _animate,</span><br><span class="line">        child: Icon(Icons.refresh),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªéšå¼åŠ¨ç”»ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰æ˜¾å¼åŠ¨ç”»ï¼ŒHreo åŠ¨ç”»ï¼Œäº¤ç»‡åŠ¨ç”»ã€‚</p><h2 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h2><p>Flutter åŠ¨ç”»æ˜¯å»ºç«‹åœ¨ä»¥ä¸‹çš„æ¦‚å¿µä¹‹ä¸Šã€‚</p><p><code>Animation</code></p><p>Flutter ä¸­çš„åŠ¨ç”»ç³»ç»ŸåŸºäº <code>Animation</code> å¯¹è±¡ï¼Œ å®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¿å­˜äº†å½“å‰åŠ¨ç”»çš„å€¼å’ŒçŠ¶æ€ï¼ˆå¼€å§‹ã€æš‚åœã€å‰è¿›ã€å€’é€€ï¼‰ï¼Œä½†ä¸è®°å½•å±å¹•ä¸Šæ˜¾ç¤ºçš„å†…å®¹ã€‚UI å…ƒç´ é€šè¿‡è¯»å– <code>Animation</code> å¯¹è±¡çš„å€¼å’Œç›‘å¬çŠ¶æ€å˜åŒ–è¿è¡Œ <code>build</code> å‡½æ•°ï¼Œç„¶åæ¸²æŸ“åˆ°å±å¹•ä¸Šå½¢æˆåŠ¨ç”»æ•ˆæœã€‚</p><p>ä¸€ä¸ª <code>Animation</code> å¯¹è±¡åœ¨ä¸€æ®µæ—¶é—´å†…ä¼šæŒç»­ç”Ÿæˆä»‹äºä¸¤ä¸ªå€¼ä¹‹é—´çš„å€¼ï¼Œæ¯”è¾ƒå¸¸è§çš„ç±»å‹æ˜¯ <code>Animation&lt;double&gt;</code>ï¼Œé™¤ <code>double</code> ç±»å‹ä¹‹å¤–è¿˜æœ‰ <code>Animation&lt;Color&gt;</code> æˆ–è€… <code>Animation&lt;Size&gt;</code> ç­‰ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Animation</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Listenable</span> <span class="keyword">implements</span> <span class="title">ValueListenable</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AnimationController</code></p><p>å¸¦æœ‰æ§åˆ¶æ–¹æ³•çš„ <code>Animation</code> å¯¹è±¡ï¼Œç”¨æ¥æ§åˆ¶åŠ¨ç”»çš„å¯åŠ¨ï¼Œæš‚åœï¼Œç»“æŸï¼Œè®¾å®šåŠ¨ç”»è¿è¡Œæ—¶é—´ç­‰ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnimationController</span> <span class="keyword">extends</span> <span class="title">Animation</span>&lt;<span class="title">double</span>&gt;</span></span><br><span class="line"><span class="class">  <span class="title">with</span> <span class="title">AnimationEagerListenerMixin</span>, <span class="title">AnimationLocalListenersMixin</span>, <span class="title">AnimationLocalStatusListenersMixin</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AnimationController controller = AnimationController(</span><br><span class="line">  vsync: <span class="keyword">this</span>,</span><br><span class="line">  duration: <span class="built_in">Duration</span>(seconds: <span class="number">10</span>),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><code>Tween</code></p><p>ç”¨æ¥ç”Ÿæˆä¸åŒç±»å‹å’ŒèŒƒå›´çš„åŠ¨ç”»å–å€¼ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tween</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">dynamic</span>&gt; <span class="keyword">extends</span> <span class="title">Animatable</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  Tween(&#123; <span class="keyword">this</span>.begin, <span class="keyword">this</span>.end &#125;);</span><br><span class="line">  <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// double ç±»å‹</span></span><br><span class="line">Tween&lt;<span class="built_in">double</span>&gt; tween = Tween&lt;<span class="built_in">double</span>&gt;(begin: <span class="number">-200</span>, end: <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// color ç±»å‹</span></span><br><span class="line">ColorTween colorTween = ColorTween(begin: Colors.blue, end: Colors.yellow);</span><br><span class="line"></span><br><span class="line"><span class="comment">// border radius ç±»å‹</span></span><br><span class="line">BorderRadiusTween radiusTween = BorderRadiusTween(</span><br><span class="line">  begin: BorderRadius.circular(<span class="number">0.0</span>),</span><br><span class="line">  end: BorderRadius.circular(<span class="number">150.0</span>),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><code>Curve</code></p><p>Flutter åŠ¨ç”»çš„é»˜è®¤åŠ¨ç”»è¿‡ç¨‹æ˜¯åŒ€é€Ÿçš„ï¼Œä½¿ç”¨ <code>CurvedAnimation</code> å¯ä»¥å°†æ—¶é—´æ›²çº¿å®šä¹‰ä¸ºéçº¿æ€§æ›²çº¿ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CurvedAnimation</span> <span class="keyword">extends</span> <span class="title">Animation</span>&lt;<span class="title">double</span>&gt; <span class="title">with</span> <span class="title">AnimationWithParentMixin</span>&lt;<span class="title">double</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Animation animation = CurvedAnimation(parent: controller, curve: Curves.easeIn);</span><br></pre></td></tr></table></figure><p><code>Ticker</code></p><p><code>Ticker</code> ç”¨æ¥æ·»åŠ æ¯æ¬¡å±å¹•åˆ·æ–°çš„å›è°ƒå‡½æ•° <code>TickerCallback</code>ï¼Œæ¯æ¬¡å±å¹•åˆ·æ–°éƒ½ä¼šè°ƒç”¨ã€‚ç±»ä¼¼äº Web é‡Œé¢çš„ <code>requestAnimationFrame</code> æ–¹æ³•ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ticker</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Ticker ticker = Ticker(callback);</span><br></pre></td></tr></table></figure><h2 id="éšå¼åŠ¨ç”»"><a href="#éšå¼åŠ¨ç”»" class="headerlink" title="éšå¼åŠ¨ç”»"></a>éšå¼åŠ¨ç”»</h2><p>éšå¼åŠ¨ç”»ä½¿ç”¨ Flutter æ¡†æ¶å†…ç½®çš„åŠ¨ç”»éƒ¨ä»¶åˆ›å»ºï¼Œé€šè¿‡è®¾ç½®åŠ¨ç”»çš„èµ·å§‹å€¼å’Œæœ€ç»ˆå€¼æ¥è§¦å‘ã€‚å½“ä½¿ç”¨ <code>setState</code> æ–¹æ³•æ”¹å˜éƒ¨ä»¶çš„åŠ¨ç”»å±æ€§å€¼æ—¶ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨è®¡ç®—å‡ºä¸€ä¸ªä»æ—§å€¼è¿‡æ¸¡åˆ°æ–°å€¼çš„åŠ¨ç”»ã€‚</p><p>æ¯”å¦‚ <code>AnimatedOpacity</code> éƒ¨ä»¶ï¼Œæ”¹å˜å®ƒçš„ <code>opacity</code> å€¼å°±å¯ä»¥è§¦å‘åŠ¨ç”»ã€‚</p><img src="./images/flutter-animation-from-zero/opacity-toggle.gif" alt="opacity-toggle" style="width: 240px;" width="240"><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OpacityChangePage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _OpacityChangePageState createState() =&gt; _OpacityChangePageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_OpacityChangePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">OpacityChangePage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">double</span> _opacity = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ”¹å˜ç›®æ ‡å€¼</span></span><br><span class="line">  <span class="keyword">void</span> _toggle() &#123;</span><br><span class="line">    _opacity = _opacity &gt; <span class="number">0</span> ? <span class="number">0.0</span> : <span class="number">1.0</span>;</span><br><span class="line">    setState(() &#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(title: Text(<span class="string">'éšå¼åŠ¨ç”»'</span>)),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: AnimatedOpacity(</span><br><span class="line">          <span class="comment">// ä¼ å…¥ç›®æ ‡å€¼</span></span><br><span class="line">          opacity: _opacity,</span><br><span class="line">          duration: <span class="built_in">Duration</span>(seconds: <span class="number">1</span>),</span><br><span class="line">          child: Container(</span><br><span class="line">            width: <span class="number">200</span>,</span><br><span class="line">            height: <span class="number">200</span>,</span><br><span class="line">            color: Colors.blue,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      floatingActionButton: FloatingActionButton(</span><br><span class="line">        onPressed: _toggle,</span><br><span class="line">        child: Icon(Icons.play_arrow),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤äº† <code>AnimatedOpacity</code> å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„å†…ç½®éšå¼åŠ¨ç”»éƒ¨ä»¶å¦‚ï¼š<code>AnimatedContainer</code>, <code>AnimatedPadding</code>, <code>AnimatedPositioned</code>, <code>AnimatedSwitcher</code>ï¼Œ <code>AnimatedAlign</code> ç­‰ã€‚</p><h2 id="æ˜¾å¼åŠ¨ç”»"><a href="#æ˜¾å¼åŠ¨ç”»" class="headerlink" title="æ˜¾å¼åŠ¨ç”»"></a>æ˜¾å¼åŠ¨ç”»</h2><p>æ˜¾å¼åŠ¨ç”»æŒ‡çš„æ˜¯éœ€è¦æ‰‹åŠ¨è®¾ç½®åŠ¨ç”»çš„æ—¶é—´ï¼Œè¿åŠ¨æ›²çº¿ï¼Œå–å€¼èŒƒå›´çš„åŠ¨ç”»ã€‚å°†å€¼ä¼ é€’ç»™åŠ¨ç”»éƒ¨ä»¶å¦‚: <code>RotationTransition</code>ï¼Œæœ€åä½¿ç”¨ä¸€ä¸ª<code>AnimationController</code> æ§åˆ¶åŠ¨ç”»çš„å¼€å§‹å’Œç»“æŸã€‚</p><img src="./images/flutter-animation-from-zero/explicit-animation.gif" alt="explicit-animation" style="width: 240px;" width="240"><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:math'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RotationAinmationPage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _RotationAinmationPageState createState() =&gt; _RotationAinmationPageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_RotationAinmationPageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">RotationAinmationPage</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">with</span> <span class="title">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  AnimationController _controller;</span><br><span class="line">  Animation&lt;<span class="built_in">double</span>&gt; _turns;</span><br><span class="line">  <span class="built_in">bool</span> _playing = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ§åˆ¶åŠ¨ç”»è¿è¡ŒçŠ¶æ€</span></span><br><span class="line">  <span class="keyword">void</span> _toggle() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_playing) &#123;</span><br><span class="line">      _playing = <span class="keyword">false</span>;</span><br><span class="line">      _controller.stop();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      _controller.forward()..whenComplete(() =&gt; _controller.reverse());</span><br><span class="line">      _playing = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    setState(() &#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–åŠ¨ç”»æ§åˆ¶å™¨ï¼Œè®¾ç½®åŠ¨ç”»æ—¶é—´</span></span><br><span class="line">    _controller = AnimationController(</span><br><span class="line">      vsync: <span class="keyword">this</span>,</span><br><span class="line">      duration: <span class="built_in">Duration</span>(seconds: <span class="number">10</span>),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®åŠ¨ç”»å–å€¼èŒƒå›´å’Œæ—¶é—´æ›²çº¿</span></span><br><span class="line">    _turns = Tween(begin: <span class="number">0.0</span>, end: pi * <span class="number">2</span>).animate(</span><br><span class="line">      CurvedAnimation(parent: _controller, curve: Curves.easeIn),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">    _controller.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(title: Text(<span class="string">'æ˜¾ç¤ºåŠ¨ç”»'</span>)),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: RotationTransition(</span><br><span class="line">          <span class="comment">// ä¼ å…¥åŠ¨ç”»å€¼</span></span><br><span class="line">          turns: _turns,</span><br><span class="line">          child: Container(</span><br><span class="line">            width: <span class="number">200</span>,</span><br><span class="line">            height: <span class="number">200</span>,</span><br><span class="line">            child: Image.asset(</span><br><span class="line">              <span class="string">'assets/images/fan.png'</span>,</span><br><span class="line">              fit: BoxFit.cover,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      floatingActionButton: FloatingActionButton(</span><br><span class="line">        onPressed: _toggle,</span><br><span class="line">        child: Icon(_playing ? Icons.pause : Icons.play_arrow),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤äº† <code>RotationTransition</code> å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„æ˜¾ç¤ºåŠ¨ç”»éƒ¨ä»¶å¦‚ï¼š<code>FadeTransition</code>, <code>ScaleTransition</code>, <code>SizeTransition</code>, <code>SlideTransition</code> ç­‰ã€‚</p><h2 id="Hero-åŠ¨ç”»"><a href="#Hero-åŠ¨ç”»" class="headerlink" title="Hero åŠ¨ç”»"></a>Hero åŠ¨ç”»</h2><p>Hero åŠ¨ç”»æŒ‡çš„æ˜¯åœ¨é¡µé¢åˆ‡æ¢æ—¶ä¸€ä¸ªå…ƒç´ ä»æ—§é¡µé¢è¿åŠ¨åˆ°æ–°é¡µé¢çš„åŠ¨ç”»ã€‚Hero åŠ¨ç”»éœ€è¦ä½¿ç”¨ä¸¤ä¸ª <code>Hero</code> æ§ä»¶å®ç°ï¼šä¸€ä¸ªç”¨æ¥åœ¨æ—§é¡µé¢ä¸­ï¼Œå¦ä¸€ä¸ªåœ¨æ–°é¡µé¢ã€‚ä¸¤ä¸ª <code>Hero</code> æ§ä»¶éœ€è¦ä½¿ç”¨ç›¸åŒçš„ <code>tag</code> å±æ€§ï¼Œå¹¶ä¸”ä¸èƒ½ä¸å…¶ä»–<code>tag</code>é‡å¤ã€‚</p><img src="./images/flutter-animation-from-zero/hero-animation.gif" alt="hero-animation" style="width: 240px;" width="240"><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¡µé¢ 1</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'hero_animation_page2.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">String</span> cake1 = <span class="string">'assets/images/cake01.jpg'</span>;</span><br><span class="line"><span class="built_in">String</span> cake2 = <span class="string">'assets/images/cake02.jpg'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeroAnimationPage1</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  GestureDetector buildRowItem(context, <span class="built_in">String</span> image) &#123;</span><br><span class="line">    <span class="keyword">return</span> GestureDetector(</span><br><span class="line">      onTap: () &#123;</span><br><span class="line">        <span class="comment">// è·³è½¬åˆ°é¡µé¢ 2</span></span><br><span class="line">        Navigator.of(context).push(</span><br><span class="line">          MaterialPageRoute(builder: (ctx) &#123;</span><br><span class="line">            <span class="keyword">return</span> HeroAnimationPage2(image: image);</span><br><span class="line">          &#125;),</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">      child: Container(</span><br><span class="line">        width: <span class="number">100</span>,</span><br><span class="line">        height: <span class="number">100</span>,</span><br><span class="line">        child: Hero(</span><br><span class="line">          <span class="comment">// è®¾ç½® Hero çš„ tag å±æ€§</span></span><br><span class="line">          tag: image,</span><br><span class="line">          child: ClipOval(child: Image.asset(image)),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(title: Text(<span class="string">'é¡µé¢ 1'</span>)),</span><br><span class="line">      body: Column(</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          SizedBox(height: <span class="number">40.0</span>),</span><br><span class="line">          Row(</span><br><span class="line">            mainAxisAlignment: MainAxisAlignment.spaceAround,</span><br><span class="line">            children: &lt;Widget&gt;[</span><br><span class="line">              buildRowItem(context, cake1),</span><br><span class="line">              buildRowItem(context, cake2),</span><br><span class="line">            ],</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡µé¢ 2</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeroAnimationPage2</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> image;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> HeroAnimationPage2(&#123;<span class="meta">@required</span> <span class="keyword">this</span>.image&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: CustomScrollView(</span><br><span class="line">        slivers: &lt;Widget&gt;[</span><br><span class="line">          SliverAppBar(</span><br><span class="line">            expandedHeight: <span class="number">400.0</span>,</span><br><span class="line">            title: Text(<span class="string">'é¡µé¢ 2'</span>),</span><br><span class="line">            backgroundColor: Colors.grey[<span class="number">200</span>],</span><br><span class="line">            flexibleSpace: FlexibleSpaceBar(</span><br><span class="line">              collapseMode: CollapseMode.parallax,</span><br><span class="line">              background: Hero(</span><br><span class="line">                <span class="comment">// ä½¿ç”¨ä»é¡µé¢ 1 ä¼ å…¥çš„ tag å€¼</span></span><br><span class="line">                tag: image,</span><br><span class="line">                child: Container(</span><br><span class="line">                  decoration: BoxDecoration(</span><br><span class="line">                    image: DecorationImage(</span><br><span class="line">                      image: AssetImage(image),</span><br><span class="line">                      fit: BoxFit.cover,</span><br><span class="line">                    ),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          SliverList(</span><br><span class="line">            delegate: SliverChildListDelegate(</span><br><span class="line">              &lt;Widget&gt;[</span><br><span class="line">                Container(height: <span class="number">600.0</span>, color: Colors.grey[<span class="number">200</span>]),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äº¤ç»‡åŠ¨ç”»"><a href="#äº¤ç»‡åŠ¨ç”»" class="headerlink" title="äº¤ç»‡åŠ¨ç”»"></a>äº¤ç»‡åŠ¨ç”»</h2><p>äº¤ç»‡åŠ¨ç”»æ˜¯ç”±ä¸€ç³»åˆ—çš„å°åŠ¨ç”»ç»„æˆçš„åŠ¨ç”»ã€‚æ¯ä¸ªå°åŠ¨ç”»å¯ä»¥æ˜¯è¿ç»­æˆ–é—´æ–­çš„ï¼Œä¹Ÿå¯ä»¥ç›¸äº’é‡å ã€‚å…¶å…³é”®ç‚¹åœ¨äºä½¿ç”¨ <code>Interval</code> éƒ¨ä»¶ç»™æ¯ä¸ªå°åŠ¨ç”»è®¾ç½®ä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œä»¥åŠä¸ºæ¯ä¸ªåŠ¨ç”»çš„è®¾ç½®ä¸€ä¸ªå–å€¼èŒƒå›´ <code>Tween</code>ï¼Œæœ€åä½¿ç”¨ä¸€ä¸ª <code>AnimationController</code> æ§åˆ¶æ€»ä½“çš„åŠ¨ç”»çŠ¶æ€ã€‚</p><p><code>Interval</code> ç»§æ‰¿è‡³ <code>Curve</code> ç±»ï¼Œé€šè¿‡è®¾ç½®å±æ€§ <code>begin</code> å’Œ <code>end</code> æ¥ç¡®å®šè¿™ä¸ªå°åŠ¨ç”»çš„è¿è¡ŒèŒƒå›´ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Interval</span> <span class="keyword">extends</span> <span class="title">Curve</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="markdown">åŠ¨ç”»èµ·å§‹ç‚¹</span></span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> begin;</span><br><span class="line">  <span class="comment">/// <span class="markdown">åŠ¨ç”»ç»“æŸç‚¹</span></span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> end;</span><br><span class="line">  <span class="comment">/// <span class="markdown">åŠ¨ç”»ç¼“åŠ¨æ›²çº¿</span></span></span><br><span class="line">  <span class="keyword">final</span> Curve curve;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="./images/flutter-animation-from-zero/staggered-animation.gif" alt="staggered-animation" style="width: 240px;" width="240"><p>è¿™æ˜¯ä¸€ä¸ªç”± 5 ä¸ªå°åŠ¨ç”»ç»„æˆçš„äº¤ç»‡åŠ¨ç”»ï¼Œå®½åº¦ï¼Œé«˜åº¦ï¼Œé¢œè‰²ï¼Œåœ†è§’ï¼Œè¾¹æ¡†ï¼Œæ¯ä¸ªåŠ¨ç”»éƒ½æœ‰è‡ªå·±çš„åŠ¨ç”»åŒºé—´ã€‚</p><p><img src="./images/flutter-animation-from-zero/staggered-animation-timeline.png" alt="staggered-animation-timeline"></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StaggeredAnimationPage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _StaggeredAnimationPageState createState() =&gt; _StaggeredAnimationPageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_StaggeredAnimationPageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">StaggeredAnimationPage</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">with</span> <span class="title">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  AnimationController _controller;</span><br><span class="line">  Animation&lt;<span class="built_in">double</span>&gt; _width;</span><br><span class="line">  Animation&lt;<span class="built_in">double</span>&gt; _height;</span><br><span class="line">  Animation&lt;Color&gt; _color;</span><br><span class="line">  Animation&lt;<span class="built_in">double</span>&gt; _border;</span><br><span class="line">  Animation&lt;BorderRadius&gt; _borderRadius;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> _play() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_controller.isCompleted) &#123;</span><br><span class="line">      _controller.reverse();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      _controller.forward();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line"></span><br><span class="line">    _controller = AnimationController(</span><br><span class="line">      vsync: <span class="keyword">this</span>,</span><br><span class="line">      duration: <span class="built_in">Duration</span>(seconds: <span class="number">5</span>),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    _width = Tween&lt;<span class="built_in">double</span>&gt;(</span><br><span class="line">      begin: <span class="number">100</span>,</span><br><span class="line">      end: <span class="number">300</span>,</span><br><span class="line">    ).animate(</span><br><span class="line">      CurvedAnimation(</span><br><span class="line">        parent: _controller,</span><br><span class="line">        curve: Interval(</span><br><span class="line">          <span class="number">0.0</span>,</span><br><span class="line">          <span class="number">0.2</span>,</span><br><span class="line">          curve: Curves.ease,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    _height = Tween&lt;<span class="built_in">double</span>&gt;(</span><br><span class="line">      begin: <span class="number">100</span>,</span><br><span class="line">      end: <span class="number">300</span>,</span><br><span class="line">    ).animate(</span><br><span class="line">      CurvedAnimation(</span><br><span class="line">        parent: _controller,</span><br><span class="line">        curve: Interval(</span><br><span class="line">          <span class="number">0.2</span>,</span><br><span class="line">          <span class="number">0.4</span>,</span><br><span class="line">          curve: Curves.ease,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    _color = ColorTween(</span><br><span class="line">      begin: Colors.blue,</span><br><span class="line">      end: Colors.yellow,</span><br><span class="line">    ).animate(</span><br><span class="line">      CurvedAnimation(</span><br><span class="line">        parent: _controller,</span><br><span class="line">        curve: Interval(</span><br><span class="line">          <span class="number">0.4</span>,</span><br><span class="line">          <span class="number">0.6</span>,</span><br><span class="line">          curve: Curves.ease,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    _borderRadius = BorderRadiusTween(</span><br><span class="line">      begin: BorderRadius.circular(<span class="number">0.0</span>),</span><br><span class="line">      end: BorderRadius.circular(<span class="number">150.0</span>),</span><br><span class="line">    ).animate(</span><br><span class="line">      CurvedAnimation(</span><br><span class="line">        parent: _controller,</span><br><span class="line">        curve: Interval(</span><br><span class="line">          <span class="number">0.6</span>,</span><br><span class="line">          <span class="number">0.8</span>,</span><br><span class="line">          curve: Curves.ease,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    _border = Tween&lt;<span class="built_in">double</span>&gt;(</span><br><span class="line">      begin: <span class="number">0</span>,</span><br><span class="line">      end: <span class="number">25</span>,</span><br><span class="line">    ).animate(</span><br><span class="line">      CurvedAnimation(</span><br><span class="line">        parent: _controller,</span><br><span class="line">        curve: Interval(<span class="number">0.8</span>, <span class="number">1.0</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(title: Text(<span class="string">'äº¤ç»‡åŠ¨ç”»'</span>)),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: AnimatedBuilder(</span><br><span class="line">          animation: _controller,</span><br><span class="line">          builder: (BuildContext context, Widget child) &#123;</span><br><span class="line">            <span class="keyword">return</span> Container(</span><br><span class="line">              width: _width.value,</span><br><span class="line">              height: _height.value,</span><br><span class="line">              decoration: BoxDecoration(</span><br><span class="line">                color: _color.value,</span><br><span class="line">                borderRadius: _borderRadius.value,</span><br><span class="line">                border: Border.all(</span><br><span class="line">                  width: _border.value,</span><br><span class="line">                  color: Colors.orange,</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      floatingActionButton: FloatingActionButton(</span><br><span class="line">        onPressed: _play,</span><br><span class="line">        child: Icon(Icons.refresh),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç‰©ç†åŠ¨ç”»"><a href="#ç‰©ç†åŠ¨ç”»" class="headerlink" title="ç‰©ç†åŠ¨ç”»"></a>ç‰©ç†åŠ¨ç”»</h2><p>ç‰©ç†åŠ¨ç”»æ˜¯ä¸€ç§æ¨¡æ‹Ÿç°å®ä¸–ç•Œç‰©ä½“è¿åŠ¨çš„åŠ¨ç”»ã€‚éœ€è¦å»ºç«‹ç‰©ä½“çš„è¿åŠ¨æ¨¡å‹ï¼Œä»¥ä¸€ä¸ªç‰©ä½“ä¸‹è½ä¸ºä¾‹ï¼Œè¿™ä¸ªè¿åŠ¨å—åˆ°ç‰©ä½“çš„ä¸‹è½é«˜åº¦ï¼Œé‡åŠ›åŠ é€Ÿåº¦ï¼Œåœ°é¢çš„åä½œç”¨åŠ›ç­‰å› ç´ çš„å½±å“ã€‚</p><img src="./images/flutter-animation-from-zero/throw-animation.gif" alt="throw-animation" style="width: 240px;" width="240"><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/scheduler.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThrowAnimationPage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _ThrowAnimationPageState createState() =&gt; _ThrowAnimationPageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_ThrowAnimationPageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">ThrowAnimationPage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// çƒå¿ƒé«˜åº¦</span></span><br><span class="line">  <span class="built_in">double</span> y = <span class="number">70.0</span>;</span><br><span class="line">  <span class="comment">// Y è½´é€Ÿåº¦</span></span><br><span class="line">  <span class="built_in">double</span> vy = <span class="number">-10.0</span>;</span><br><span class="line">  <span class="comment">// é‡åŠ›</span></span><br><span class="line">  <span class="built_in">double</span> gravity = <span class="number">0.1</span>;</span><br><span class="line">  <span class="comment">// åœ°é¢åå¼¹åŠ›</span></span><br><span class="line">  <span class="built_in">double</span> bounce = <span class="number">-0.5</span>;</span><br><span class="line">  <span class="comment">// çƒçš„åŠå¾„</span></span><br><span class="line">  <span class="built_in">double</span> radius = <span class="number">50.0</span>;</span><br><span class="line">  <span class="comment">// åœ°é¢é«˜åº¦</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> height = <span class="number">700</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸‹è½æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">void</span> _fall(_) &#123;</span><br><span class="line">    y += vy;</span><br><span class="line">    vy += gravity;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœçƒä½“æ¥è§¦åˆ°åœ°é¢ï¼Œæ ¹æ®åœ°é¢åå¼¹åŠ›æ”¹å˜çƒä½“çš„ Y è½´é€Ÿåº¦</span></span><br><span class="line">    <span class="keyword">if</span> (y + radius &gt; height) &#123;</span><br><span class="line">      y = height - radius;</span><br><span class="line">      vy *= bounce;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (y - radius &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      y = <span class="number">0</span> + radius;</span><br><span class="line">      vy *= bounce;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setState(() &#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ä¸€ä¸ª Ticker åœ¨æ¯æ¬¡æ›´æ–°ç•Œé¢æ—¶è¿è¡Œçƒä½“ä¸‹è½æ–¹æ³•</span></span><br><span class="line">    Ticker(_fall)..start();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="built_in">double</span> screenWidth = MediaQuery.of(context).size.width;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(title: Text(<span class="string">'ç‰©ç†åŠ¨ç”»'</span>)),</span><br><span class="line">      body: Column(</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          Container(</span><br><span class="line">            height: height,</span><br><span class="line">            child: Stack(</span><br><span class="line">              children: &lt;Widget&gt;[</span><br><span class="line">                Positioned(</span><br><span class="line">                  top: y - radius,</span><br><span class="line">                  left: screenWidth / <span class="number">2</span> - radius,</span><br><span class="line">                  child: Container(</span><br><span class="line">                    width: radius * <span class="number">2</span>,</span><br><span class="line">                    height: radius * <span class="number">2</span>,</span><br><span class="line">                    decoration: BoxDecoration(</span><br><span class="line">                      color: Colors.blue,</span><br><span class="line">                      shape: BoxShape.circle,</span><br><span class="line">                    ),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          Expanded(child: Container(color: Colors.blue)),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä»‹ç»äº† Flutter ä¸­å¤šç§ç±»å‹çš„åŠ¨ç”»ï¼Œåˆ†åˆ«æ˜¯</p><ul><li>éšå¼åŠ¨ç”»</li><li>æ˜¾å¼åŠ¨ç”»</li><li>Hero åŠ¨ç”»</li><li>äº¤ç»‡åŠ¨ç”»</li><li>åŸºäºç‰©ç†çš„åŠ¨ç”»</li></ul><p>ä¸€ä¸ªåŠ¨ç”»çš„ä¸»è¦å› ç´ æœ‰</p><ul><li><code>Animation</code> åŠ¨ç”»å¯¹è±¡</li><li><code>AnimationController</code> åŠ¨ç”»æ§åˆ¶å™¨</li><li><code>Tween</code>     åŠ¨ç”»å–å€¼èŒƒå›´</li><li><code>Curve</code>     åŠ¨ç”»è¿åŠ¨æ›²çº¿</li></ul><p>Flutter åŠ¨ç”»åŸºäºç±»å‹åŒ–çš„ <code>Animation</code> å¯¹è±¡ï¼Œ<code>Widgets</code> é€šè¿‡è¯»å–åŠ¨ç”»å¯¹è±¡çš„å½“å‰å€¼å’Œç›‘å¬çŠ¶æ€å˜åŒ–é‡æ–°è¿è¡Œ <code>build</code> å‡½æ•°ï¼Œä¸æ–­å˜åŒ– UI å½¢æˆåŠ¨ç”»æ•ˆæœã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://medium.com/flutter/flutter-animation-basics-with-implicit-animations-95db481c5916" target="_blank" rel="noopener">Flutter animation basics with implicit animations</a></p><p><a href="https://medium.com/flutter/directional-animations-with-built-in-explicit-animations-3e7c5e6fbbd7" target="_blank" rel="noopener">Directional animations with built-in explicit animations</a></p><p><a href="https://flutter.cn/docs/development/ui/animations" target="_blank" rel="noopener">åŠ¨ç”»æ•ˆæœä»‹ç»</a></p><p><a href="https://book.flutterchina.club/chapter9/intro.html" target="_blank" rel="noopener">FlutteråŠ¨ç”»ç®€ä»‹</a></p><p><a href="https://flutter.cn/docs/development/ui/animations/tutorial" target="_blank" rel="noopener">åœ¨ Flutter åº”ç”¨é‡Œå®ç°åŠ¨ç”»æ•ˆæœ</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Flutter ä¸­çš„åŠ¨ç”»&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
      <category term="Animation" scheme="https://coldstone.fun/tags/Animation/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ Flutter é‡Œä½¿ç”¨ Stream</title>
    <link href="https://coldstone.fun/post/2020/04/13/flutter-stream/"/>
    <id>https://coldstone.fun/post/2020/04/13/flutter-stream/</id>
    <published>2020-04-13T04:07:56.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ Flutter ä¸­æœ‰ä¸¤ç§å¤„ç†å¼‚æ­¥æ“ä½œçš„æ–¹å¼ <code>Future</code> å’Œ <code>Stream</code>ï¼Œ<code>Future</code> ç”¨äºå¤„ç†å•ä¸ªå¼‚æ­¥æ“ä½œï¼Œ<code>Stream</code> ç”¨æ¥å¤„ç†è¿ç»­çš„å¼‚æ­¥æ“ä½œ</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ Flutter ä¸­æœ‰ä¸¤ç§å¤„ç†å¼‚æ­¥æ“ä½œçš„æ–¹å¼ <code>Future</code> å’Œ <code>Stream</code>ï¼Œ<code>Future</code> ç”¨äºå¤„ç†å•ä¸ªå¼‚æ­¥æ“ä½œï¼Œ<code>Stream</code> ç”¨æ¥å¤„ç†è¿ç»­çš„å¼‚æ­¥æ“ä½œã€‚æ¯”å¦‚å¾€æ°´æ¯å€’æ°´ï¼Œå°†ä¸€ä¸ªæ°´æ¯å€’æ»¡ä¸ºä¸€ä¸ª <code>Future</code>ï¼Œè¿ç»­çš„å°†å¤šä¸ªæ°´æ¯å€’æ»¡å°±æ˜¯ <code>Stream</code>ã€‚</p><p><img src="./images/flutter-stream/water-fill.png" alt="water-fill"></p><h2 id="Stream-è¯¦è§£"><a href="#Stream-è¯¦è§£" class="headerlink" title="Stream è¯¦è§£"></a>Stream è¯¦è§£</h2><p><code>Stream</code> æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç”¨äºè¡¨ç¤ºä¸€åºåˆ—å¼‚æ­¥æ•°æ®çš„æºã€‚å®ƒæ˜¯ä¸€ç§äº§ç”Ÿè¿ç»­äº‹ä»¶çš„æ–¹å¼ï¼Œå¯ä»¥ç”Ÿæˆæ•°æ®äº‹ä»¶æˆ–è€…é”™è¯¯äº‹ä»¶ï¼Œä»¥åŠæµç»“æŸæ—¶çš„å®Œæˆäº‹ä»¶ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Stream</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  Stream();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Stream</code> åˆ†å•è®¢é˜…æµå’Œå¹¿æ’­æµã€‚</p><p>å•è®¢é˜…æµåœ¨å‘é€å®Œæˆäº‹ä»¶ä¹‹å‰åªå…è®¸è®¾ç½®ä¸€ä¸ªç›‘å¬å™¨ï¼Œå¹¶ä¸”åªæœ‰åœ¨æµä¸Šè®¾ç½®ç›‘å¬å™¨åæ‰å¼€å§‹äº§ç”Ÿäº‹ä»¶ï¼Œå–æ¶ˆç›‘å¬å™¨åå°†åœæ­¢å‘é€äº‹ä»¶ã€‚å³ä½¿å–æ¶ˆäº†ç¬¬ä¸€ä¸ªç›‘å¬å™¨ï¼Œä¹Ÿä¸å…è®¸åœ¨å•è®¢é˜…æµä¸Šè®¾ç½®å…¶ä»–çš„ç›‘å¬å™¨ã€‚å¹¿æ’­æµåˆ™å…è®¸è®¾ç½®å¤šä¸ªç›‘å¬å™¨ï¼Œä¹Ÿå¯ä»¥åœ¨å–æ¶ˆä¸Šä¸€ä¸ªç›‘å¬å™¨åå†æ¬¡æ·»åŠ æ–°çš„ç›‘å¬å™¨ã€‚</p><p><code>Stream</code> æœ‰åŒæ­¥æµå’Œå¼‚æ­¥æµä¹‹åˆ†ã€‚</p><p>å®ƒä»¬çš„åŒºåˆ«åœ¨äºåŒæ­¥æµä¼šåœ¨æ‰§è¡Œ <code>add</code>ï¼Œ<code>addError</code> æˆ– <code>close</code> æ–¹æ³•æ—¶ç«‹å³å‘æµçš„ç›‘å¬å™¨ <code>StreamSubscription</code> å‘é€äº‹ä»¶ï¼Œè€Œå¼‚æ­¥æµæ€»æ˜¯åœ¨äº‹ä»¶é˜Ÿåˆ—ä¸­çš„ä»£ç æ‰§è¡Œå®Œæˆååœ¨å‘é€äº‹ä»¶ã€‚</p><h2 id="Stream-å®¶æ—"><a href="#Stream-å®¶æ—" class="headerlink" title="Stream å®¶æ—"></a><code>Stream</code> å®¶æ—</h2><p><code>StreamController</code></p><p>å¸¦æœ‰æ§åˆ¶æµæ–¹æ³•çš„æµã€‚ å¯ä»¥å‘å®ƒçš„æµå‘é€æ•°æ®ï¼Œé”™è¯¯å’Œå®Œæˆäº‹ä»¶ï¼Œä¹Ÿå¯ä»¥æ£€æŸ¥æ•°æ®æµæ˜¯å¦å·²æš‚åœï¼Œæ˜¯å¦æœ‰ç›‘å¬å™¨ã€‚<code>sync</code> å‚æ•°å†³å®šè¿™ä¸ªæµæ˜¯åŒæ­¥æµè¿˜æ˜¯å¼‚æ­¥æµã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamController</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">StreamSink</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  Stream&lt;T&gt; <span class="keyword">get</span> stream;</span><br><span class="line">  <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">StreamController _streamController = StreamController(</span><br><span class="line">  onCancel: () &#123;&#125;,</span><br><span class="line">  onListen: () &#123;&#125;,</span><br><span class="line">  onPause: () &#123;&#125;,</span><br><span class="line">  onResume: () &#123;&#125;,</span><br><span class="line">  <span class="keyword">sync</span>: <span class="keyword">false</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><code>StreamSink</code></p><p>æµäº‹ä»¶çš„å…¥å£ã€‚æä¾› <code>add</code>ï¼Œ<code>addError</code>ï¼Œ<code>addStream</code> æ–¹æ³•å‘æµå‘é€äº‹ä»¶ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamSink</span>&lt;<span class="title">S</span>&gt; <span class="keyword">implements</span> <span class="title">EventSink</span>&lt;<span class="title">S</span>&gt;, <span class="title">StreamConsumer</span>&lt;<span class="title">S</span>&gt; </span>&#123;</span><br><span class="line">  Future close();</span><br><span class="line">  <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line">  Future <span class="keyword">get</span> done;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>StreamSubscription</code></p><p>æµçš„ç›‘å¬å™¨ã€‚æä¾› <code>cacenl</code>ã€<code>pause</code>, <code>resume</code> ç­‰æ–¹æ³•ç®¡ç†ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamSubscription</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">StreamSubscription subscription = StreamController().stream.listen(<span class="built_in">print</span>);</span><br><span class="line">subscription.onDone(() =&gt; <span class="built_in">print</span>(<span class="string">'done'</span>));</span><br></pre></td></tr></table></figure><p><code>StreamBuilder</code></p><p>ä½¿ç”¨æµæ•°æ®æ¸²æŸ“ UI ç•Œé¢çš„éƒ¨ä»¶ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">StreamBuilder(</span><br><span class="line">  <span class="comment">// æ•°æ®æµ</span></span><br><span class="line">  stream: stream,</span><br><span class="line">  <span class="comment">// åˆå§‹æ•°æ®</span></span><br><span class="line">  initialData: <span class="string">'loading...'</span>,</span><br><span class="line">  builder: (context, AsyncSnapshot snapshot) &#123;</span><br><span class="line">    <span class="comment">// AsyncSnapshot å¯¹è±¡ä¸ºæ•°æ®å¿«ç…§ï¼Œç¼“å­˜äº†å½“å‰æ•°æ®å’ŒçŠ¶æ€</span></span><br><span class="line">    <span class="comment">// snapshot.connectionState</span></span><br><span class="line">    <span class="comment">// snapshot.data</span></span><br><span class="line">    <span class="keyword">if</span> (snapshot.hasData) &#123;</span><br><span class="line">      <span class="built_in">Map</span> data = snapshot.data;</span><br><span class="line">      <span class="keyword">return</span> Text(data),</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> CircularProgressIndicator();</span><br><span class="line">  &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-Stream"><a href="#åˆ›å»º-Stream" class="headerlink" title="åˆ›å»º Stream"></a>åˆ›å»º Stream</h2><p>åœ¨ Dart æœ‰å‡ ç§æ–¹å¼åˆ›å»º <code>Stream</code></p><ol><li>ä»ç°æœ‰çš„ç”Ÿæˆä¸€ä¸ªæ–°çš„æµ <code>Stream</code>ï¼Œä½¿ç”¨ <code>map</code>ï¼Œ<code>where</code>ï¼Œ<code>takeWhile</code> ç­‰æ–¹æ³•ã€‚</li></ol><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ•´æ•°æµ</span></span><br><span class="line">Stream&lt;<span class="built_in">int</span>&gt; intStream = StreamController&lt;<span class="built_in">int</span>&gt;().stream;</span><br><span class="line"><span class="comment">// å¶æ•°æµ</span></span><br><span class="line">Stream&lt;<span class="built_in">int</span>&gt; evenStream = intStream.where((<span class="built_in">int</span> n) =&gt; n.isEven);</span><br><span class="line"><span class="comment">// ä¸¤å€æµ</span></span><br><span class="line">Stream&lt;<span class="built_in">int</span>&gt; doubleStream = intStream.map((<span class="built_in">int</span> n) =&gt; n * <span class="number">2</span>);</span><br><span class="line"><span class="comment">// æ•°å­—å¤§äº 10 çš„æµ</span></span><br><span class="line">Stream&lt;<span class="built_in">int</span>&gt; biggerStream = intStream.takeWhile((<span class="built_in">int</span> n) =&gt; n &gt; <span class="number">10</span>);</span><br></pre></td></tr></table></figure><ol start="2"><li>ä½¿ç”¨ <code>async*</code> å‡½æ•°ã€‚</li></ol><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;<span class="built_in">int</span>&gt; countStream(<span class="built_in">int</span> to) <span class="keyword">async</span>* &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt;= to; i++) &#123;</span><br><span class="line">    <span class="keyword">yield</span> i;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Stream stream = countStream(<span class="number">10</span>);</span><br><span class="line">stream.listen(<span class="built_in">print</span>);</span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨ <code>StreamController</code>ã€‚</li></ol><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">StreamController&lt;<span class="built_in">Map</span>&gt; _streamController = StreamController(</span><br><span class="line">  onCancel: () &#123;&#125;,</span><br><span class="line">  onListen: () &#123;&#125;,</span><br><span class="line">  onPause: () &#123;&#125;,</span><br><span class="line">  onResume: () &#123;&#125;,</span><br><span class="line">  <span class="keyword">sync</span>: <span class="keyword">false</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">Stream _stream = _streamController.stream;</span><br></pre></td></tr></table></figure><ol start="4"><li>ä½¿ç”¨ <code>Future</code> å¯¹è±¡ç”Ÿæˆ</li></ol><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;<span class="built_in">int</span>&gt; _delay(<span class="built_in">int</span> seconds) <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">await</span> Future.delayed(<span class="built_in">Duration</span>(seconds: seconds));</span><br><span class="line">  <span class="keyword">return</span> seconds;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">List</span>&lt;Future&gt; futures = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  futures.add(_delay(<span class="number">3</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Stream _futuresStream = Stream.fromFutures(futures);</span><br></pre></td></tr></table></figure><h2 id="åº”ç”¨-Stream"><a href="#åº”ç”¨-Stream" class="headerlink" title="åº”ç”¨ Stream"></a>åº”ç”¨ Stream</h2><p><em>Stream Counter</em></p><p>æŠŠ Flutter çš„é»˜è®¤é¡¹ç›®æ”¹ç”¨ <code>Stream</code> å®ç°</p><img src="./images/flutter-stream/stream-counter.gif" width="320" style="width: 320px;"><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:async'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StreamCounter</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _StreamCounterState createState() =&gt; _StreamCounterState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_StreamCounterState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">StreamCounter</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸€ä¸ª StreamController</span></span><br><span class="line">  StreamController&lt;<span class="built_in">int</span>&gt; _counterStreamController = StreamController&lt;<span class="built_in">int</span>&gt;(</span><br><span class="line">    onCancel: () &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">'cancel'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    onListen: () &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">'listen'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br><span class="line">  Stream _counterStream;</span><br><span class="line">  StreamSink _counterSink;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨ StreamSink å‘ Stream å‘é€äº‹ä»¶ï¼Œå½“ _counter å¤§äº 9 æ—¶è°ƒç”¨ close æ–¹æ³•å…³é—­æµã€‚</span></span><br><span class="line">  <span class="keyword">void</span> _incrementCounter() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_counter &gt; <span class="number">9</span>) &#123;</span><br><span class="line">      _counterSink.close();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    _counter++;</span><br><span class="line">    _counterSink.add(_counter);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸»åŠ¨å…³é—­æµ</span></span><br><span class="line">  <span class="keyword">void</span> _closeStream() &#123;</span><br><span class="line">    _counterStreamController.close();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _counterSink = _counterStreamController.sink;</span><br><span class="line">    _counterStream = _counterStreamController.stream;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">    _counterSink.close();</span><br><span class="line">    _counterStreamController.close();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'Stream Counter'</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Text(<span class="string">'You have pushed the button this many times:'</span>),</span><br><span class="line">            <span class="comment">// ä½¿ç”¨ StreamBuilder æ˜¾ç¤ºå’Œæ›´æ–° UI</span></span><br><span class="line">            StreamBuilder&lt;<span class="built_in">int</span>&gt;(</span><br><span class="line">              stream: _counterStream,</span><br><span class="line">              initialData: _counter,</span><br><span class="line">              builder: (context, snapshot) &#123;</span><br><span class="line">                <span class="keyword">if</span> (snapshot.connectionState == ConnectionState.done) &#123;</span><br><span class="line">                  <span class="keyword">return</span> Text(</span><br><span class="line">                    <span class="string">'Done'</span>,</span><br><span class="line">                    style: Theme.of(context).textTheme.bodyText2,</span><br><span class="line">                  );</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">int</span> number = snapshot.data;</span><br><span class="line">                <span class="keyword">return</span> Text(</span><br><span class="line">                  <span class="string">'<span class="subst">$number</span>'</span>,</span><br><span class="line">                  style: Theme.of(context).textTheme.bodyText2,</span><br><span class="line">                );</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      floatingActionButton: Row(</span><br><span class="line">        mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          FloatingActionButton(</span><br><span class="line">            onPressed: _incrementCounter,</span><br><span class="line">            tooltip: <span class="string">'Increment'</span>,</span><br><span class="line">            child: Icon(Icons.add),</span><br><span class="line">          ),</span><br><span class="line">          SizedBox(width: <span class="number">24.0</span>),</span><br><span class="line">          FloatingActionButton(</span><br><span class="line">            onPressed: _closeStream,</span><br><span class="line">            tooltip: <span class="string">'Close'</span>,</span><br><span class="line">            child: Icon(Icons.close),</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>NetWork Status</em></p><p>ç›‘å¬æ‰‹æœºçš„ç½‘ç»œé“¾æ¥çŠ¶æ€ï¼Œé¦–å…ˆæ·»åŠ  <code>connectivity</code> æ’ä»¶</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">connectivity:</span> <span class="string">^0.4.8+2</span></span><br></pre></td></tr></table></figure><img src="./images/flutter-stream/network-status.gif" width="320" style="width: 320px;"><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:async'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:connectivity/connectivity.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetWorkStatus</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _NetWorkStatusState createState() =&gt; _NetWorkStatusState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_NetWorkStatusState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">NetWorkStatus</span>&gt; </span>&#123;</span><br><span class="line">  StreamController&lt;ConnectivityResult&gt; _streamController = StreamController();</span><br><span class="line">  StreamSink _streamSink;</span><br><span class="line">  Stream _stream;</span><br><span class="line">  <span class="built_in">String</span> _result;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> _checkStatus() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> ConnectivityResult result = <span class="keyword">await</span> Connectivity().checkConnectivity();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (result == ConnectivityResult.mobile) &#123;</span><br><span class="line">      _result = <span class="string">'mobile'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result == ConnectivityResult.wifi) &#123;</span><br><span class="line">      _result = <span class="string">'wifi'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result == ConnectivityResult.none) &#123;</span><br><span class="line">      _result = <span class="string">'none'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setState(() &#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _stream = _streamController.stream;</span><br><span class="line">    _streamSink = _streamController.sink;</span><br><span class="line">    _checkStatus();</span><br><span class="line">    Connectivity().onConnectivityChanged.listen(</span><br><span class="line">      (ConnectivityResult result) &#123;</span><br><span class="line">        _streamSink.add(result);</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  dispose() &#123;</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">    _streamSink.close();</span><br><span class="line">    _streamController.close();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'Network Status'</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: StreamBuilder&lt;ConnectivityResult&gt;(</span><br><span class="line">          stream: _stream,</span><br><span class="line">          builder: (context, AsyncSnapshot snapshot) &#123;</span><br><span class="line">            <span class="keyword">if</span> (snapshot.hasData) &#123;</span><br><span class="line">              <span class="keyword">if</span> (snapshot.data == ConnectivityResult.mobile) &#123;</span><br><span class="line">                _result = <span class="string">'mobile'</span>;</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (snapshot.data == ConnectivityResult.wifi) &#123;</span><br><span class="line">                _result = <span class="string">'wifi'</span>;</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (snapshot.data == ConnectivityResult.none) &#123;</span><br><span class="line">                <span class="keyword">return</span> Text(<span class="string">'è¿˜æ²¡æœ‰é“¾æ¥ç½‘ç»œ'</span>);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (_result == <span class="keyword">null</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> CircularProgressIndicator();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> ResultText(_result);</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResultText</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> result;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> ResultText(<span class="keyword">this</span>.result);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> RichText(</span><br><span class="line">      text: TextSpan(</span><br><span class="line">        style: TextStyle(color: Colors.black),</span><br><span class="line">        text: <span class="string">'æ­£åœ¨ä½¿ç”¨'</span>,</span><br><span class="line">        children: [</span><br><span class="line">          TextSpan(</span><br><span class="line">            text: <span class="string">' <span class="subst">$result</span> '</span>,</span><br><span class="line">            style: TextStyle(</span><br><span class="line">              color: Colors.red,</span><br><span class="line">              fontSize: <span class="number">20.0</span>,</span><br><span class="line">              fontWeight: FontWeight.bold,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          TextSpan(text: <span class="string">'é“¾æ¥ç½‘ç»œ'</span>),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Random Article</code></p><p>è¯·æ±‚ç½‘ç»œæ•°æ®åˆ›å»ºæµ</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">dio:</span> <span class="string">^3.0.9</span></span><br><span class="line">  <span class="attr">flutter_html:</span> <span class="string">^0.11.1</span></span><br></pre></td></tr></table></figure><img src="./images/flutter-stream/random-article.gif" width="320" style="width: 320px;"><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:async'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:dio/dio.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter_html/flutter_html.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomArticle</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _RandomArticleState createState() =&gt; _RandomArticleState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_RandomArticleState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">RandomArticle</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> Dio _dio = Dio(</span><br><span class="line">    BaseOptions(baseUrl: <span class="string">'https://interface.meiriyiwen.com'</span>),</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> Future&lt;<span class="built_in">Map</span>&gt; _getArticle() <span class="keyword">async</span> &#123;</span><br><span class="line">    Response response = <span class="keyword">await</span> _dio.<span class="keyword">get</span>(</span><br><span class="line">      <span class="string">'/article/random'</span>,</span><br><span class="line">      queryParameters: &#123;<span class="string">"dev"</span>: <span class="number">1</span>&#125;,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> data = response.data[<span class="string">'data'</span>];</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Stream&lt;<span class="built_in">Map</span>&gt; _futuresStream;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="built_in">List</span>&lt;Future&lt;<span class="built_in">Map</span>&gt;&gt; futures = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="comment">// æ·»åŠ  Future</span></span><br><span class="line">      futures.add(_getArticle());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”Ÿæˆ Stream</span></span><br><span class="line">    _futuresStream = Stream&lt;<span class="built_in">Map</span>&gt;.fromFutures(futures);</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(title: Text(<span class="string">'Random Article'</span>)),</span><br><span class="line">      body: SingleChildScrollView(</span><br><span class="line">        child: Center(</span><br><span class="line">          child: StreamBuilder&lt;<span class="built_in">Map</span>&gt;(</span><br><span class="line">            stream: _futuresStream,</span><br><span class="line">            builder: (context, AsyncSnapshot snapshot) &#123;</span><br><span class="line">              <span class="keyword">if</span> (snapshot.hasData) &#123;</span><br><span class="line">                <span class="built_in">Map</span> article = snapshot.data;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> Container(</span><br><span class="line">                  child: Column(</span><br><span class="line">                    children: &lt;Widget&gt;[</span><br><span class="line">                      SizedBox(height: <span class="number">24.0</span>),</span><br><span class="line">                      Text(</span><br><span class="line">                        article[<span class="string">'title'</span>],</span><br><span class="line">                        style: TextStyle(fontSize: <span class="number">24.0</span>),</span><br><span class="line">                      ),</span><br><span class="line">                      Padding(</span><br><span class="line">                        padding: <span class="keyword">const</span> EdgeInsets.only(</span><br><span class="line">                          top: <span class="number">12.0</span>,</span><br><span class="line">                          left: <span class="number">12.0</span>,</span><br><span class="line">                          right: <span class="number">12.0</span>,</span><br><span class="line">                          bottom: <span class="number">60.0</span>,</span><br><span class="line">                        ),</span><br><span class="line">                        child: Html(</span><br><span class="line">                          data: article[<span class="string">'content'</span>],</span><br><span class="line">                        ),</span><br><span class="line">                      ),</span><br><span class="line">                    ],</span><br><span class="line">                  ),</span><br><span class="line">                );</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">return</span> CircularProgressIndicator();</span><br><span class="line">            &#125;,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Broadcast Stream</code></p><p>ä½¿ç”¨å¹¿æ’­æµ</p><img src="./images/flutter-stream/broadcast-stream.gif" width="320" style="width: 320px;"><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:async'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BroadcastStream</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _BroadcastStreamState createState() =&gt; _BroadcastStreamState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_BroadcastStreamState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">BroadcastStream</span>&gt; </span>&#123;</span><br><span class="line">  StreamController&lt;<span class="built_in">int</span>&gt; _streamController = StreamController&lt;<span class="built_in">int</span>&gt;.broadcast();</span><br><span class="line">  StreamSubscription _subscription1;</span><br><span class="line">  StreamSubscription _subscription2;</span><br><span class="line">  StreamSubscription _subscription3;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int</span> _count = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">int</span> _s1 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">int</span> _s2 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">int</span> _s3 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    _subscription1 = _streamController.stream.listen((n) &#123;</span><br><span class="line">      setState(() &#123;</span><br><span class="line">        _s1 += <span class="number">1</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    _subscription2 = _streamController.stream.listen((n) &#123;</span><br><span class="line">      setState(() &#123;</span><br><span class="line">        _s2 += <span class="number">2</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    _subscription3 = _streamController.stream.listen((n) &#123;</span><br><span class="line">      setState(() &#123;</span><br><span class="line">        _s3 -= <span class="number">1</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> _add() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_count &gt; <span class="number">10</span>) &#123;</span><br><span class="line">      <span class="comment">// å¤§äº 10 æ—¶åœæ­¢ç¬¬ä¸€ä¸ªè®¢é˜…</span></span><br><span class="line">      _subscription1.cancel();</span><br><span class="line">    &#125;</span><br><span class="line">    _count++;</span><br><span class="line">    _streamController.add(_count);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">    _streamController.close();</span><br><span class="line">    _subscription1.cancel();</span><br><span class="line">    _subscription2.cancel();</span><br><span class="line">    _subscription3.cancel();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'Broadcast Stream'</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Container(</span><br><span class="line">        width: <span class="built_in">double</span>.infinity,</span><br><span class="line">        height: MediaQuery.of(context).size.height,</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">          crossAxisAlignment: CrossAxisAlignment.center,</span><br><span class="line">          children: [</span><br><span class="line">            Text(<span class="string">'Count: <span class="subst">$_count</span>'</span>),</span><br><span class="line">            SizedBox(height: <span class="number">12.0</span>),</span><br><span class="line">            Text(<span class="string">'S1: <span class="subst">$_s1</span>'</span>),</span><br><span class="line">            SizedBox(height: <span class="number">12.0</span>),</span><br><span class="line">            Text(<span class="string">'S2: <span class="subst">$_s2</span>'</span>),</span><br><span class="line">            SizedBox(height: <span class="number">12.0</span>),</span><br><span class="line">            Text(<span class="string">'S3: <span class="subst">$_s3</span>'</span>),</span><br><span class="line">            SizedBox(height: <span class="number">12.0</span>),</span><br><span class="line">            FloatingActionButton(</span><br><span class="line">              onPressed: _add,</span><br><span class="line">              child: Icon(Icons.plus_one),</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>Stream</code> æ˜¯å¤„ç†å¼‚æ­¥ç¼–ç¨‹çš„æ–¹å¼ä¹‹ä¸€ï¼Œå®ƒæä¾›ä¸€ä¸ªäº†å¼‚æ­¥çš„äº‹ä»¶åºåˆ—ï¼Œå¹¶åœ¨ä½ å‡†å¤‡å¥½æ¥å—æ—¶å‘é€ã€‚åœ¨ Dart ä¸­æµåˆ†ä¸ºåŒæ­¥æµå’Œå¼‚æ­¥æµï¼Œä»¥åŠå•è®¢é˜…æµå’Œå¹¿æ’­æµï¼Œæœ‰å¤šç§æ–¹å¼åˆ›å»º <code>Stream</code>ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://dart.cn/tutorials/language/streams" target="_blank" rel="noopener">å¼‚æ­¥ç¼–ç¨‹ï¼šä½¿ç”¨ stream</a></p><p><a href="https://dart.cn/articles/libraries/creating-streams" target="_blank" rel="noopener">åœ¨ Dart é‡Œä½¿ç”¨ Stream</a></p><p><a href="https://guoshuyu.cn/home/wx/Flutter-11.html" target="_blank" rel="noopener">å…¨é¢æ·±å…¥ç†è§£Stream</a></p><p><a href="https://codingwithjoe.com/flutter-building-a-widget-with-streambuilder/" target="_blank" rel="noopener">Building a Widget with StreamBuilder</a></p><p><a href="https://youtu.be/MkKEWHfy99Y" target="_blank" rel="noopener">StreamBuilder (Flutter æœ¬å‘¨å°éƒ¨ä»¶)</a></p><p><a href="https://youtu.be/nQBpOIHE4eE" target="_blank" rel="noopener">Dart Streams - èšç„¦ Flutter</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ Flutter ä¸­æœ‰ä¸¤ç§å¤„ç†å¼‚æ­¥æ“ä½œçš„æ–¹å¼ &lt;code&gt;Future&lt;/code&gt; å’Œ &lt;code&gt;Stream&lt;/code&gt;ï¼Œ&lt;code&gt;Future&lt;/code&gt; ç”¨äºå¤„ç†å•ä¸ªå¼‚æ­¥æ“ä½œï¼Œ&lt;code&gt;Stream&lt;/code&gt; ç”¨æ¥å¤„ç†è¿ç»­çš„å¼‚æ­¥æ“ä½œ&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter æ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼Ÿ</title>
    <link href="https://coldstone.fun/post/2020/04/03/how-flutter-render/"/>
    <id>https://coldstone.fun/post/2020/04/03/how-flutter-render/</id>
    <published>2020-04-03T04:40:04.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>æ€»ç»“ä¸€ä¸‹å…³äº Flutter æ¸²æŸ“æ–¹é¢çš„çŸ¥è¯†</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä½¿ç”¨ Flutter å¼€å‘ç§»åŠ¨ç«¯æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œæ€»ç»“ä¸€ä¸‹å…³äº UI æ¸²æŸ“æ–¹é¢çš„çŸ¥è¯†ã€‚äº†è§£å…³äº Flutter æ¸²æŸ“æ–¹é¢çš„çŸ¥è¯†è¿˜æ˜¯æœ‰å¿…è¦çš„ï¼Œå¯ä»¥å¸®åŠ©ä½ å¼€å‘æ›´ç¨³å®šï¼Œæ€§èƒ½æ›´é«˜çš„åº”ç”¨ã€‚</p><p>è¦è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆéœ€è¦è®¤è¯†åˆ° Flutter ä¸­æœ‰ä¸‰æ£µæ ‘ï¼š<code>Widget</code> æ ‘ï¼Œ<code>Element</code> æ ‘å’Œ <code>RenderObject</code> æ ‘ã€‚</p><p>å½“åº”ç”¨å¯åŠ¨æ—¶ Flutter ä¼šéå†å¹¶åˆ›å»ºæ‰€æœ‰çš„ <code>Widget</code> å½¢æˆ <code>Widget Tree</code>ï¼ŒåŒæ—¶ä¸ <code>Widget Tree</code> ç›¸å¯¹åº”ï¼Œé€šè¿‡è°ƒç”¨ <code>Widget</code> ä¸Šçš„ <code>createElement()</code> æ–¹æ³•åˆ›å»ºæ¯ä¸ª <code>Element</code> å¯¹è±¡ï¼Œå½¢æˆ <code>Element Tree</code>ã€‚</p><p>æœ€åè°ƒç”¨ <code>Element</code> çš„ <code>createRenderObject()</code> æ–¹æ³•åˆ›å»ºæ¯ä¸ªæ¸²æŸ“å¯¹è±¡ï¼Œå½¢æˆä¸€ä¸ª <code>Render Tree</code>ã€‚</p><p>ç„¶åéœ€è¦çŸ¥é“ <code>Widget</code>ï¼Œ<code>Element</code> å’Œ <code>RenderObject</code> åˆ°åº•æ˜¯å•¥ä»¥åŠå®ƒä»¬æ˜¯å¹²ä»€ä¹ˆçš„ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Widget"><a href="#ä»€ä¹ˆæ˜¯-Widget" class="headerlink" title="ä»€ä¹ˆæ˜¯ Widget"></a>ä»€ä¹ˆæ˜¯ Widget</h2><p><code>Widget</code> æ˜¯ Flutter çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œæ˜¯ç”¨æˆ·ç•Œé¢çš„ä¸å¯å˜æè¿°ä¿¡æ¯ã€‚æ­£å¦‚ Flutter çš„å£å· <code>Everythingâ€™s a widget</code>, ç”¨ Flutter å¼€å‘åº”ç”¨å°±æ˜¯åœ¨å†™ <code>Widget</code> ğŸ¶ã€‚</p><p>Flutter çš„ <code>Widget</code> ä¸åªè¡¨ç¤º UI æ§ä»¶ï¼Œè¿˜è¡¨ç¤ºä¸€äº›åŠŸèƒ½æ€§çš„ç»„ä»¶ï¼Œå¦‚è·¯ç”±è·³è½¬ <code>Navigator</code>ï¼Œæ‰‹åŠ¿æ£€æµ‹ <code>GestureDetector</code> ç»„ä»¶ç­‰ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@immutable</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Widget</span> <span class="keyword">extends</span> <span class="title">DiagnosticableTree</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="markdown">Initializes [key] for subclasses.</span></span></span><br><span class="line">  <span class="keyword">const</span> Widget(&#123; <span class="keyword">this</span>.key &#125;);</span><br><span class="line">  <span class="keyword">final</span> Key key;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  <span class="built_in">Element</span> createElement();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">bool</span> canUpdate(Widget oldWidget, Widget newWidget) &#123;</span><br><span class="line">    <span class="keyword">return</span> oldWidget.runtimeType == newWidget.runtimeType</span><br><span class="line">      &amp;&amp; oldWidget.key == newWidget.key;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Widget</code> çš„ <code>canUpdate</code> æ–¹æ³•é€šè¿‡æ¯”è¾ƒæ–°éƒ¨ä»¶å’Œæ—§éƒ¨ä»¶çš„ <code>runtimeType</code> å’Œ <code>key</code> å±æ€§æ˜¯å¦ç›¸åŒæ¥å†³å®šæ›´æ–°éƒ¨ä»¶å¯¹åº”çš„ <code>Element</code>ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Element"><a href="#ä»€ä¹ˆæ˜¯-Element" class="headerlink" title="ä»€ä¹ˆæ˜¯ Element"></a>ä»€ä¹ˆæ˜¯ Element</h2><p><code>Element</code> æ˜¯å®ä¾‹åŒ–çš„ <code>Widget</code> å¯¹è±¡ï¼Œé€šè¿‡ <code>Widget</code> çš„ <code>createElement()</code> æ–¹æ³•ï¼Œåœ¨ç‰¹å®šä½ç½®ä½¿ç”¨ <code>Widget</code> é…ç½®æ•°æ®ç”Ÿæˆã€‚</p><p><code>Element</code> ç”¨äºç®¡ç†åº”ç”¨ UI çš„æ›´æ–°å’Œæ›´æ”¹ï¼Œç®¡ç†éƒ¨ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¯ä¸ª <code>Element</code> éƒ½åŒ…å«å¯¹ <code>Widget</code> å’Œ <code>RenderObject</code> çš„å¼•ç”¨ã€‚</p><p><img src="./images/how-flutter-render/relationship.png" alt="relationship"></p><p>å½“ <code>Widget</code> å˜åŒ–æ—¶ï¼Œå¦‚æœä¸¤ä¸ª <code>Widget</code> çš„ <code>runtimeType</code> å’Œ <code>key</code> å±æ€§ç›¸åŒçš„ï¼Œé‚£ä¹ˆæ–°çš„ <code>Element</code> ä¼šé€šè¿‡ <code>Element.update()</code> æ›´æ–°æ—§çš„ <code>Element</code>ï¼Œå¦åˆ™æ—§çš„ <code>Element</code> ä¼šè¢«åˆ é™¤ï¼Œæ–°ç”Ÿæˆçš„ <code>Element</code> æ’å…¥åˆ°æ ‘ä¸­ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Element</span> <span class="keyword">extends</span> <span class="title">DiagnosticableTree</span> <span class="keyword">implements</span> <span class="title">BuildContext</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="markdown">Creates an element that uses the given widget as its configuration.</span></span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// <span class="markdown">Typically called by an override of [Widget.createElement].</span></span></span><br><span class="line">  <span class="built_in">Element</span>(Widget widget)</span><br><span class="line">    : <span class="keyword">assert</span>(widget != <span class="keyword">null</span>),</span><br><span class="line">      _widget = widget;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="markdown">Change the widget used to configure this element.</span></span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// <span class="markdown">The framework calls this function when the parent wishes to use a</span></span></span><br><span class="line">  <span class="comment">/// <span class="markdown">different widget to configure this element. The new widget is guaranteed</span></span></span><br><span class="line">  <span class="comment">/// <span class="markdown">to have the same [runtimeType] as the old widget.</span></span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// <span class="markdown">This function is called only during the "active" lifecycle state.</span></span></span><br><span class="line">  <span class="meta">@mustCallSuper</span></span><br><span class="line">  <span class="keyword">void</span> update(<span class="keyword">covariant</span> Widget newWidget) &#123;</span><br><span class="line">    <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="markdown">Creates an instance of the [RenderObject] class that this</span></span></span><br><span class="line">  <span class="comment">/// <span class="markdown">[RenderObjectWidget] represents, using the configuration described by this</span></span></span><br><span class="line">  <span class="comment">/// <span class="markdown">[RenderObjectWidget].</span></span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// <span class="markdown">This method should not do anything with the children of the render object.</span></span></span><br><span class="line">  <span class="comment">/// <span class="markdown">That should instead be handled by the method that overrides</span></span></span><br><span class="line">  <span class="comment">/// <span class="markdown">[RenderObjectElement.mount] in the object rendered by this object's</span></span></span><br><span class="line">  <span class="comment">/// <span class="markdown">[createElement] method. See, for example,</span></span></span><br><span class="line">  <span class="comment">/// <span class="markdown">[SingleChildRenderObjectElement.mount].</span></span></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  RenderObject createRenderObject(BuildContext context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä»€ä¹ˆæ˜¯-RenderObject"><a href="#ä»€ä¹ˆæ˜¯-RenderObject" class="headerlink" title="ä»€ä¹ˆæ˜¯ RenderObject"></a>ä»€ä¹ˆæ˜¯ RenderObject</h2><p><code>RenderObject</code> ç”¨äºåº”ç”¨ç•Œé¢çš„å¸ƒå±€å’Œç»˜åˆ¶ï¼Œä¿å­˜äº†å…ƒç´ çš„å¤§å°ï¼Œå¸ƒå±€ç­‰ä¿¡æ¯ï¼Œå®ä¾‹åŒ–ä¸€ä¸ª <code>RenderObject</code> æ˜¯éå¸¸è€—èƒ½çš„ã€‚</p><p>å½“åº”ç”¨è¿è¡Œæ—¶ Flutter ä½¿ç”¨ <code>RenderObject</code> çš„æ•°æ®ç»˜åˆ¶åº”ç”¨ç•Œé¢ï¼Œæœ€ç»ˆå½¢æˆä¸€ä¸ª <code>Render Tree</code>ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">RenderObject</span> <span class="keyword">extends</span> <span class="title">AbstractNode</span> <span class="title">with</span> <span class="title">DiagnosticableTreeMixin</span> <span class="keyword">implements</span> <span class="title">HitTestTarget</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="markdown">Initializes internal fields for subclasses.</span></span></span><br><span class="line">  RenderObject() &#123;</span><br><span class="line">    _needsCompositing = isRepaintBoundary || alwaysNeedsCompositing;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="markdown">The render object at (or below) this location in the tree.</span></span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// <span class="markdown">If this object is a [RenderObjectElement], the render object is the one at</span></span></span><br><span class="line">  <span class="comment">/// <span class="markdown">this location in the tree. Otherwise, this getter will walk down the tree</span></span></span><br><span class="line">  <span class="comment">/// <span class="markdown">until it finds a [RenderObjectElement].</span></span></span><br><span class="line">  RenderObject <span class="keyword">get</span> renderObject &#123;</span><br><span class="line">    RenderObject result;</span><br><span class="line">    <span class="keyword">void</span> visit(<span class="built_in">Element</span> element) &#123;</span><br><span class="line">      <span class="keyword">assert</span>(result == <span class="keyword">null</span>); <span class="comment">// this verifies that there's only one child</span></span><br><span class="line">      <span class="keyword">if</span> (element <span class="keyword">is</span> RenderObjectElement)</span><br><span class="line">        result = element.renderObject;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        element.visitChildren(visit);</span><br><span class="line">    &#125;</span><br><span class="line">    visit(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> layout(Constraints constraints, &#123; <span class="built_in">bool</span> parentUsesSize = <span class="keyword">false</span> &#125;) &#123;</span><br><span class="line">    <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> paint(PaintingContext context, Offset offset) &#123;</span><br><span class="line">    <span class="comment">/// <span class="markdown">...</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ£µæ ‘"><a href="#ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ£µæ ‘" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ£µæ ‘"></a>ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ£µæ ‘</h2><p>ä½¿ç”¨ä¸‰æ£µæ ‘çš„ç›®çš„æ˜¯å°½å¯èƒ½å¤ç”¨ <code>Element</code>ã€‚</p><p>å¤ç”¨ <code>Element</code> å¯¹æ€§èƒ½éå¸¸é‡è¦ï¼Œå› ä¸º <code>Element</code> æ‹¥æœ‰ä¸¤ä»½å…³é”®æ•°æ®ï¼š<code>Stateful widget</code> çš„çŠ¶æ€å¯¹è±¡åŠåº•å±‚çš„<br><code>RenderObject</code>ã€‚</p><p>å½“åº”ç”¨çš„ç»“æ„å¾ˆç®€å•æ—¶ï¼Œæˆ–è®¸ä½“ç°ä¸å‡ºè¿™ç§ä¼˜åŠ¿ï¼Œä¸€æ—¦åº”ç”¨å¤æ‚èµ·æ¥ï¼Œæ„æˆé¡µé¢çš„å…ƒç´ è¶Šæ¥è¶Šå¤šï¼Œé‡æ–°åˆ›å»º 3 æ£µæ ‘çš„ä»£ä»·æ˜¯å¾ˆé«˜çš„ï¼Œæ‰€ä»¥éœ€è¦æœ€å°åŒ–æ›´æ–°æ“ä½œã€‚</p><p>å½“ Flutter èƒ½å¤Ÿå¤ç”¨ <code>Element</code> æ—¶ï¼Œç”¨æˆ·ç•Œé¢çš„é€»è¾‘çŠ¶æ€ä¿¡æ¯æ˜¯ä¸å˜çš„ï¼Œå¹¶ä¸”å¯ä»¥é‡ç”¨ä¹‹å‰è®¡ç®—çš„å¸ƒå±€ä¿¡æ¯ï¼Œé¿å…éå†æ•´æ£µæ ‘ã€‚</p><h2 id="ä¸¾ä¸ªä¾‹å­è¯´æ˜"><a href="#ä¸¾ä¸ªä¾‹å­è¯´æ˜" class="headerlink" title="ä¸¾ä¸ªä¾‹å­è¯´æ˜"></a>ä¸¾ä¸ªä¾‹å­è¯´æ˜</h2><p>åˆ›å»ºä¸€ä¸ªç®€å•çš„ Flutter åº”ç”¨ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(</span><br><span class="line">    MaterialApp(</span><br><span class="line">      color: Colors.white,</span><br><span class="line">      debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">      builder: (context, child) =&gt; HomePage(),</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _HomePageState createState() =&gt; _HomePageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_HomePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">HomePage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">bool</span> _isWorld = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">  Widget _buildWorld() &#123;</span><br><span class="line">    <span class="keyword">return</span> RichText(</span><br><span class="line">      text: TextSpan(</span><br><span class="line">        text: <span class="string">'Hello world'</span>,</span><br><span class="line">        style: TextStyle(color: Colors.black),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Widget _buildFlutter() &#123;</span><br><span class="line">    <span class="keyword">return</span> RichText(</span><br><span class="line">      text: TextSpan(</span><br><span class="line">        text: <span class="string">'Hello flutter'</span>,</span><br><span class="line">        style: TextStyle(color: Colors.black),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> changeText() &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _isWorld = !_isWorld;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: Column(</span><br><span class="line">        mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          Center(</span><br><span class="line">            child: _isWorld ? _buildWorld() : _buildFlutter(),</span><br><span class="line">          ),</span><br><span class="line">          SizedBox(height: <span class="number">20.0</span>),</span><br><span class="line">          <span class="comment">// Padding(padding: EdgeInsets.only(top: 20.0)),</span></span><br><span class="line">          IconButton(icon: Icon(Icons.refresh), onPressed: changeText)</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºæ•ˆæœ</p><img src="./images/how-flutter-render/simulator-world.png" style="width: 320px;"><p>æ‰“å¼€ <a href="http://127.0.0.1:9100" target="_blank" rel="noopener">Dart DevTools</a>ï¼Œå¯ä»¥çœ‹åˆ°åº”ç”¨çš„ <code>Widget Tree</code>ï¼Œæ­¤æ—¶ <code>RichText</code> æ§ä»¶çš„ <code>RenderObject</code> çš„ ID æ˜¯ <code>#6276a</code></p><p><img src="./images/how-flutter-render/world-id.png" alt="world-id"></p><p>ç‚¹å‡»å›¾æ ‡å°†æ–‡å­—å˜æˆ <code>Hello flutter</code> æ—¶</p><img src="./images/how-flutter-render/simulator-flutter.png" style="width: 320px;"><p>åˆ·æ–°æµè§ˆå™¨é¡µé¢å†æ¬¡æŸ¥çœ‹ <code>RichText</code> çš„ <code>RenderObject</code> çš„ ID ä¾ç„¶æ˜¯ <code>#6276a</code></p><p><img src="./images/how-flutter-render/flutter-id.png" alt="flutter-id"></p><p>å¯ä»¥å‘ç° Flutter åªæ˜¯æ›´æ–°äº†æ–‡å­—æ•°æ®ï¼Œå¤ç”¨äº† <code>RichText</code> å¯¹åº”çš„ <code>Element</code> å’Œ <code>RenderObject</code>ã€‚</p><p>è€Œä½¿ç”¨ <code>SizedBox</code> éƒ¨ä»¶å–ä»£ <code>Padding</code> éƒ¨ä»¶æ—¶ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> Scaffold(</span><br><span class="line">    body: Column(</span><br><span class="line">      mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        Center(</span><br><span class="line">          child: RichText(</span><br><span class="line">            text: TextSpan(</span><br><span class="line">              text: <span class="string">'Hello <span class="subst">$text</span>'</span>,</span><br><span class="line">              style: TextStyle(color: Colors.black),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        SizedBox(height: <span class="number">20.0</span>),</span><br><span class="line">        <span class="comment">// Padding(padding: EdgeInsets.only(top: 20.0)),</span></span><br><span class="line">        IconButton(icon: Icon(Icons.refresh), onPressed: changeText)</span><br><span class="line">      ],</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="./images/how-flutter-render/padding.png" alt="padding"></p><p><code>Padding</code> éƒ¨ä»¶å¯¹åº”çš„  <code>Element</code> å’Œ <code>RenderObject</code> éƒ½ä¼šè¢«ä»æ ‘ä¸­ç§»é™¤ï¼Œä½¿ç”¨ <code>SizedBox</code> æ–°ç”Ÿæˆçš„æ›¿ä»£ã€‚</p><p><img src="./images/how-flutter-render/sizeedbox.png" alt="sizeedbox"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>Widget</code> æ˜¯åº”ç”¨ç•Œé¢çš„å£°æ˜ä¿¡æ¯ã€‚<br><code>Element</code> é“¾æ¥ <code>Widget</code> å’Œ <code>RenderObject</code>ï¼Œç®¡ç†ç•Œé¢çš„æ›´æ–°å’Œä¿®æ”¹ã€‚<br><code>RenderObject</code> ä¿å­˜å…·ä½“çš„å¸ƒå±€ä¿¡æ¯ï¼Œè´Ÿè´£ç»˜åˆ¶ UIã€‚</p><p><img src="./images/how-flutter-render/widget-element-render-object.png" alt="widget-element-render-object"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://youtu.be/996ZgFRENMs" target="_blank" rel="noopener">How Flutter renders Widgets</a> (Video)</p><p><a href="https://medium.com/manabie/how-flutter-renders-widgets-fd6eca945a04" target="_blank" rel="noopener">How Flutter renders Widgets</a></p><p><a href="https://book.flutterchina.club/chapter14/flutter_ui_system.html" target="_blank" rel="noopener">Flutter UIç³»ç»Ÿ</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ€»ç»“ä¸€ä¸‹å…³äº Flutter æ¸²æŸ“æ–¹é¢çš„çŸ¥è¯†&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>PlantUML ç±»å›¾åŠ Flowchart æµç¨‹å›¾ç»˜åˆ¶å…¥é—¨</title>
    <link href="https://coldstone.fun/post/2020/03/26/learn-classchart-flowchart/"/>
    <id>https://coldstone.fun/post/2020/03/26/learn-classchart-flowchart/</id>
    <published>2020-03-26T02:00:00.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>å­¦ä¹  <code>PlantUML</code></p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰æ®µæ—¶é—´è®¾è®¡åç«¯è¡¨ç»“æ„çš„æ—¶å€™æ¥è§¦äº† <code>PlantUML</code>ï¼Œå®ƒèƒ½å¤Ÿç›´è§‚è¡¨ç°å‡ºç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œååº”å‡ºç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»ã€‚ä¹‹å‰æœ‰åŒäº‹å°±æ˜¯ç”¨ <code>PlantUML</code> æ¥åšåç«¯æ•°æ®è¡¨è®¾è®¡å·¥ä½œçš„ï¼Œæ‰€ä»¥æœ‰å¿…è¦å­¦ä¹ ä¸€ä¸‹ã€‚</p><p>æµç¨‹å›¾ <code>Flowchart</code> æ˜¯ç”¨æ¥å±•ç¤ºæ“ä½œè¿‡ç¨‹æˆ–é€»è¾‘æµç¨‹çš„ä¸€ç§å›¾è¡¨ï¼Œè¯­æ³•æ¯”è¾ƒç®€å•ï¼Œæ–¹ä¾¿æ˜“ç”¨ï¼Œä¸€äº›æ¯”è¾ƒå¤æ‚çš„åˆ¤æ–­éƒ½å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæµç¨‹å›¾æ¥ç›´è§‚è¡¨ç°ã€‚</p><h2 id="PlantUML"><a href="#PlantUML" class="headerlink" title="PlantUML"></a>PlantUML</h2><p><a href="https://plantuml.com/zh/" target="_blank" rel="noopener">PlantUML</a> æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ”¯æŒå¿«é€Ÿç»˜åˆ¶æ—¶åºå›¾ã€ç”¨ä¾‹å›¾ã€ç±»å›¾ã€æ´»åŠ¨å›¾ã€ç»„ä»¶å›¾ã€çŠ¶æ€å›¾ã€å¯¹è±¡å›¾ã€éƒ¨ç½²å›¾ç­‰ã€‚åŒæ—¶è¿˜æ”¯æŒé UML å›¾çš„ç”˜ç‰¹å›¾ã€æ¶æ„å›¾ç­‰ã€‚</p><p><code>PlantUML</code> æœ‰ä¸€äº›é€šç”¨è¯­æ³•</p><ul><li>å•è¡Œæ³¨é‡Šï¼šä»¥å•å¼•å· <code>&#39;</code> å¼€å¤´çš„è¯­å¥ã€‚</li><li>å¤šè¡Œæ³¨é‡Šï¼šä»¥ <code>/&#39;</code> å’Œ <code>&#39;/</code> ä½œä¸ºæ³¨é‡Šçš„å¼€å§‹å’Œç»“æŸã€‚</li><li>é¡µçœ‰ï¼šä½¿ç”¨ <code>header</code> å‘½ä»¤åœ¨ç”Ÿæˆçš„å›¾ä¸­å¢åŠ é¡µçœ‰ï¼Œç”¨ <code>center</code>, <code>left</code> æˆ– <code>right</code> å®ç°å±…ä¸­ã€å·¦å¯¹é½å’Œå³å¯¹é½ã€‚</li><li>é¡µè„šï¼šä½¿ç”¨ <code>footer</code> å‘½ä»¤åœ¨ç”Ÿæˆçš„å›¾ä¸­å¢åŠ é¡µçœ‰ï¼Œç”¨ <code>center</code>, <code>left</code> æˆ– <code>right</code> å®ç°å±…ä¸­ã€å·¦å¯¹é½å’Œå³å¯¹é½ã€‚</li><li>ç¼©æ”¾ï¼šä½¿ç”¨ <code>scale</code> å‘½ä»¤ç¼©æ”¾ç”Ÿæˆçš„å›¾åƒã€‚</li><li>æ ‡é¢˜ï¼šä½¿ç”¨ <code>title</code> å…³é”®å­—æ·»åŠ æ ‡é¢˜ã€‚</li><li>å›¾ç‰‡æ ‡é¢˜ï¼šä½¿ç”¨ <code>caption</code> å…³é”®å­—åœ¨å›¾åƒä¸‹æ”¾ç½®ä¸€ä¸ªæ ‡é¢˜.</li><li>å›¾ä¾‹è¯´æ˜: <code>legend</code> å’Œ <code>endlegend</code> ä½œä¸ºå…³é”®è¯ï¼Œä½¿ç”¨ <code>left</code>, <code>right</code>, <code>center</code> ä¸ºè¿™ä¸ªå›¾ä¾‹æŒ‡å®šå¯¹é½æ–¹å¼ã€‚</li></ul><p>ä¸€ä¸ªğŸŒ° <a href="http://www.plantuml.com/plantuml/uml/FO_D2i8m48JlynHxAmZI8eBYGIhU12_Y2uHsRHVo8ytMvtVHj8V0DxERcQJDwYQTWqVkd6Swx9hD_jW0rOMonC4iBv6fIo5mLA2kGFGS9PDae_liLRomuRMiL3M0peWd6jdrFA7iBv9ZNmWgQXNB_AViidkhfBZQHGEF53ZHzaotsJgLJkJJXwtEys2XQu-ZOjWfX5TAzg8ryo_Hsin-_mK0" target="_blank" rel="noopener">æŸ¥çœ‹</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">scale 720*480</span><br><span class="line"></span><br><span class="line">&#39;A single line comment</span><br><span class="line"></span><br><span class="line">&#x2F;&#39;</span><br><span class="line">  This is</span><br><span class="line">  Multilie</span><br><span class="line">  Comment</span><br><span class="line">&#39;&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">center header</span><br><span class="line">This is header</span><br><span class="line">endheader</span><br><span class="line"></span><br><span class="line">title This is title</span><br><span class="line"></span><br><span class="line">caption This is caption</span><br><span class="line"></span><br><span class="line">Romeo -&gt; Juliet : love</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">legend</span><br><span class="line">This is a legend</span><br><span class="line">endlegend</span><br><span class="line"></span><br><span class="line">footer This is footer</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><img style="width: 320px;" alt="base" src="http://www.plantuml.com/plantuml/png/HP3D2i8m48JlynHxAmZI8eBYGIhU12_Y2uHsRHVo8ytMvtUnFrwIRoQp6TWwgnjq31wvSPxfiAis-sC551VA4Zkpl4Ic9eN0KO6o0D6pbqoIZUwZL_72XjSvKfG06YCUg6VNseLvODKSsma15RMI9V1JDkxUAYckzgo1HmgSQ7kcssYjIYVowSC0F7VswR_9qUBOCI7mIacjVibC4hMzsGQ-"><h3 id="ç±»å›¾"><a href="#ç±»å›¾" class="headerlink" title="ç±»å›¾"></a>ç±»å›¾</h3><p>ç”»ç±»å›¾éœ€è¦äº†è§£ç±»ä¸ç±»ä¹‹é—´çš„å‡ ç§ä¸åŒçš„å…³ç³»</p><table><thead><tr><th align="left">å…³ç³»</th><th align="left">æ„æ€</th><th align="left">æ ‡è®°</th></tr></thead><tbody><tr><td align="left">Association å…³ç³»</td><td align="left">ä¸¤ä¸ªç±»ä¹‹é—´æœ‰ç›¸äº’å…³ç³»</td><td align="left"><code>&lt;--</code></td></tr><tr><td align="left">Inheritance ç»§æ‰¿</td><td align="left">å­ç±»ç»§æ‰¿çˆ¶ç±»</td><td align="left"><code>&lt;|--</code></td></tr><tr><td align="left">Composition ç»„åˆ</td><td align="left">ä¸¤ä¸ªç±»ä¹‹é—´ç›¸äº’ä¾èµ–</td><td align="left"><code>*--</code></td></tr><tr><td align="left">Aggregation èšåˆ</td><td align="left">ä¸€ä¸ªç±»å±äºå¦ä¸€ä¸ªç±»</td><td align="left"><code>o--</code></td></tr><tr><td align="left">Implementation å®ç°</td><td align="left">ä¸€ä¸ªç±»å®ç°å¦ä¸€ä¸ªç±»çš„æ–¹æ³•</td><td align="left"><code>&lt;|..</code></td></tr><tr><td align="left">Dependency ä¾èµ–</td><td align="left">ä¸€ä¸ªç±»ä¾èµ–äºå¦ä¸€ä¸ªç±»</td><td align="left"><code>&lt;..</code></td></tr></tbody></table><p><img src="https://miro.medium.com/max/1180/1*EUvDMA1vr0DiucONPzK9kA.png" alt="å…³ç³»å›¾"></p><p>è®¾è®¡ä¸€ä¸ªåšå®¢ç³»ç»ŸğŸ˜œ <a href="http://www.plantuml.com/plantuml/umla/XPBHwjCm58VlynJdSdDs3lL2YiZ4Hn2zh-t11TeKaenTw63Wc5CSSwB3JS4v54MXkn2nEFLfbgQ-XUiQszaXV-X5slFzlfoSj2samsKty8bm7H_XyfNMkKiNMyH59f531nqFETd5WrtyIKS3DNcXbqCrMQfehRzizVODGUOPYX3NTuI0srHG6NAuH-0E3ti2QtNIBwhNkQIkZrcr0TIpWJAPBPskx8IyU7L39f596uJabDqz4jmIU713mwIp9NC2jE5cpWBi7mjwd4eqszKgllg1SCCWG2R_o_IBfhs0icnJ2ppqiTIQ5kfbvKRk_AU27fMLnFdoXCTK9LsXeEp8W2U3g9mX-tGqsIn_cD_L-vPbJcK3wEYjVZfIivV9wqTglFgzU7T1_vYdlsR9_A7-l5BFdgIROHfztzzz-k2dUlpAI9hDuZfjqCy_9kDlQhhPRT-hqIAFbg1f-1JCrUIloBAk5N-G3KaSgsYTiydNQVfXRBn6ToPkx6raNZVm_m00" target="_blank" rel="noopener">ç‚¹å‡»æŸ¥çœ‹</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">center header</span><br><span class="line">ä¸€ä¸ªç®€å•çš„åšå®¢ç³»ç»Ÿ</span><br><span class="line">endheader</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Visitor &#123;</span><br><span class="line"> browse()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Article &#123;</span><br><span class="line"> + id: int</span><br><span class="line"> + author: int</span><br><span class="line"> + content: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class User &#123;</span><br><span class="line">  +id: int</span><br><span class="line">  +name: String</span><br><span class="line"></span><br><span class="line">  - writeArticle(content: string)</span><br><span class="line">  - commentArticle(content: string)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Admin &#123;</span><br><span class="line"> - deleteArticle(id: int)</span><br><span class="line"> - deleteComment(id: int)</span><br><span class="line"> - editArticle(id: int, content: int)</span><br><span class="line"> - editComment(id: int, content: int)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Comment &#123;</span><br><span class="line">  +id: int</span><br><span class="line">  +content: string</span><br><span class="line">  +author: int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">User &lt;|-- Admin : ç®¡ç†å‘˜æœ‰åˆ é™¤&#x2F;ç¼–è¾‘æ–‡ç« å’Œè¯„è®ºçš„èƒ½åŠ›</span><br><span class="line">User &lt;.. Article : ç”¨æˆ·å¯ä»¥å†™æ–‡ç« </span><br><span class="line">User &lt;.. Comment : ç”¨æˆ·å¯ä»¥å†™è¯„è®º</span><br><span class="line">Article --&gt; Visitor : æ¸¸å®¢å¯ä»¥æµè§ˆæ–‡ç« </span><br><span class="line">Comment --&gt; Visitor : æ¸¸å®¢å¯ä»¥æµè§ˆè¯„è®º</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><p><img src="./images/learn-chart/class.png" alt="blog"></p><h2 id="Flowchart"><a href="#Flowchart" class="headerlink" title="Flowchart"></a>Flowchart</h2><p>æµç¨‹å›¾ä½¿ç”¨ <a href="http://flowchart.js.org/" target="_blank" rel="noopener">Flowchart</a> ç»˜åˆ¶ï¼Œè¯­æ³•æ¯”è¾ƒç®€å•ã€‚</p><p>å®šä¹‰ä¸€ä¸ªæµç¨‹å›¾å…ƒç´  <code>name=&gt;type: content:&gt;url</code></p><ul><li>name: å…ƒç´ çš„åç§°</li><li>typeï¼šç±»å‹ï¼ŒåŒ…æ‹¬å¦‚ä¸‹ç±»åˆ«ï¼š<ul><li>start</li><li>end</li><li>operation</li><li>subroutine</li><li>condition</li><li>inputoutput</li><li>parallel</li></ul></li><li>contentï¼šæ–‡æœ¬å†…å®¹</li><li>urlï¼šè¿æ¥</li></ul><p>ç¤ºä¾‹å¦‚ä¸‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">st=&gt;start: è‰°éš¾çš„å¼€å§‹</span><br><span class="line">ge=&gt;end: ä½ æˆåŠŸäº†:&gt;https:<span class="comment">//www.zhihu.com/hot</span></span><br><span class="line">be=&gt;end: ä½ å¤±è´¥äº†:&gt;https:<span class="comment">//bbs.hupu.com/bxj</span></span><br><span class="line"></span><br><span class="line">skill=&gt;condition: æœ‰æŠ€èƒ½å—</span><br><span class="line">money=&gt;condition: æœ‰é’±å—</span><br><span class="line">handsome=&gt;condition: é•¿å¾—å¸…å—</span><br><span class="line"></span><br><span class="line">dream=&gt;operation: åšæ¢¦</span><br><span class="line">imp=&gt;operation: åŠªåŠ›æé«˜è‡ªå·±</span><br><span class="line">work=&gt;operation: å·¥ä½œ/è¯»ä¹¦</span><br><span class="line">make=&gt;operation: æŠ•èµ„ç†è´¢</span><br><span class="line">rich=&gt;operation: æ‰¾å¯Œå©†</span><br><span class="line"></span><br><span class="line">st-&gt;skill</span><br><span class="line">skill(yes)-&gt;work-&gt;ge</span><br><span class="line">skill(no)-&gt;money</span><br><span class="line">money(yes)-&gt;make-&gt;ge</span><br><span class="line">money(no)-&gt;handsome</span><br><span class="line">handsome(yes)-&gt;rich-&gt;ge</span><br><span class="line">handsome(no)-&gt;be</span><br></pre></td></tr></table></figure><p><img src="./images/learn-chart/flow.png" alt="start"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://plantuml.com/zh/" target="_blank" rel="noopener">PlantUML</a></p><p><a href="https://github.com/adrai/flowchart.js" target="_blank" rel="noopener">Flowchart</a></p><p><a href="https://medium.com/@smagid_allThings/uml-class-diagrams-tutorial-step-by-step-520fd83b300b" target="_blank" rel="noopener">UML Class Diagrams Tutorial, Step by Step</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å­¦ä¹  &lt;code&gt;PlantUML&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="å­¦ä¹ " scheme="https://coldstone.fun/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="PlantUML" scheme="https://coldstone.fun/tags/PlantUML/"/>
    
      <category term="Flowchart" scheme="https://coldstone.fun/tags/Flowchart/"/>
    
  </entry>
  
  <entry>
    <title>è®°å½•ä¸¤ä¸ªä½¿ç”¨ Flutter çš„ DropdownButton é—®é¢˜</title>
    <link href="https://coldstone.fun/post/2020/03/24/flutter-dropdown-problem/"/>
    <id>https://coldstone.fun/post/2020/03/24/flutter-dropdown-problem/</id>
    <published>2020-03-24T08:08:27.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸¤ä¸ªå…³äº <code>DropdownButton</code> çš„é—®é¢˜</p><a id="more"></a><p>è¿™å‡ å¤©åœ¨ä½¿ç”¨ <code>Flutter</code> å¼€å‘åº”ç”¨è¿‡ç¨‹ä¸­é‡åˆ°å…³äº <code>DropdownButton</code> ä¸¤ä¸ªé—®é¢˜ï¼Œè®°å½•ä¸€ä¸‹ã€‚</p><p>é—®é¢˜ä¸€ï¼šåœ¨ <code>showModalBottomSheet</code> é‡Œé¢ä½¿ç”¨ <code>DropdownButton</code> æ”¹å˜é€‰æ‹©åç•Œé¢ä¸å˜åŒ–ã€‚</p><p><img src="./images/flutter-dropdown-problem/dropdown-no-change.gif" alt="no-change"></p><p>ä½†æ˜¯ <code>onChanged</code> äº‹ä»¶å·²ç»è§¦å‘</p><p><img src="./images/flutter-dropdown-problem/console.png" alt="console"></p><p>ä»£ç å¦‚ä¸‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> _type = <span class="number">0</span>;</span><br><span class="line">...</span><br><span class="line">IconButton(</span><br><span class="line">  icon: Icon(Icons.filter_list),</span><br><span class="line">  onPressed: () &#123;</span><br><span class="line">    showModalBottomSheet(</span><br><span class="line">      context: context,</span><br><span class="line">      builder: (BuildContext context) &#123;</span><br><span class="line">        <span class="keyword">return</span> Column(</span><br><span class="line">          crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Padding(</span><br><span class="line">              padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">12.0</span>),</span><br><span class="line">              child: Row(</span><br><span class="line">                children: &lt;Widget&gt;[</span><br><span class="line">                  SizedBox(</span><br><span class="line">                    width: <span class="number">80.0</span>,</span><br><span class="line">                    child: Text(<span class="string">'ç±»å‹: '</span>),</span><br><span class="line">                  ),</span><br><span class="line">                  DropdownButton&lt;<span class="built_in">int</span>&gt;(</span><br><span class="line">                    value: _type,</span><br><span class="line">                    onChanged: (<span class="built_in">int</span> newValue) &#123;</span><br><span class="line">                      setState(() &#123;</span><br><span class="line">                        _type = newValue;</span><br><span class="line">                      &#125;);</span><br><span class="line">                      <span class="built_in">print</span>(newValue.toString());</span><br><span class="line">                    &#125;,</span><br><span class="line">                    items: [</span><br><span class="line">                      DropdownMenuItem&lt;<span class="built_in">int</span>&gt;(</span><br><span class="line">                        value: <span class="number">0</span>,</span><br><span class="line">                        child: Text(<span class="string">'ç±»å‹ 1'</span>),</span><br><span class="line">                      ),</span><br><span class="line">                      DropdownMenuItem&lt;<span class="built_in">int</span>&gt;(</span><br><span class="line">                        value: <span class="number">1</span>,</span><br><span class="line">                        child: Text(<span class="string">'ç±»å‹ 2'</span>),</span><br><span class="line">                      ),</span><br><span class="line">                    ],</span><br><span class="line">                  ),</span><br><span class="line">                ],</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">),</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•ï¼šæ·»åŠ ä¸€ä¸ª <code>StatefulBuilder</code> éƒ¨ä»¶åœ¨æœ€å¤–å±‚å³å¯</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">showModalBottomSheet(</span><br><span class="line">  context: context,</span><br><span class="line">  builder: (BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> StatefulBuilder(</span><br><span class="line">      builder: (context, StateSetter setState) &#123;</span><br><span class="line">        <span class="keyword">return</span> Column(</span><br><span class="line">          crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Padding(</span><br><span class="line">              padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">12.0</span>),</span><br><span class="line">              child: Row(</span><br><span class="line">                children: &lt;Widget&gt;[</span><br><span class="line">                  SizedBox(</span><br><span class="line">                    width: <span class="number">80.0</span>,</span><br><span class="line">                    child: Text(<span class="string">'ç±»å‹: '</span>),</span><br><span class="line">                  ),</span><br><span class="line">                  DropdownButton&lt;<span class="built_in">int</span>&gt;(</span><br><span class="line">                    value: _type,</span><br><span class="line">                    onChanged: (<span class="built_in">int</span> newValue) &#123;</span><br><span class="line">                      setState(() &#123;</span><br><span class="line">                        _type = newValue;</span><br><span class="line">                      &#125;);</span><br><span class="line">                      <span class="built_in">print</span>(newValue.toString());</span><br><span class="line">                    &#125;,</span><br><span class="line">                    items: [</span><br><span class="line">                      DropdownMenuItem&lt;<span class="built_in">int</span>&gt;(</span><br><span class="line">                        value: <span class="number">0</span>,</span><br><span class="line">                        child: Text(<span class="string">'ç±»å‹ 1'</span>),</span><br><span class="line">                      ),</span><br><span class="line">                      DropdownMenuItem&lt;<span class="built_in">int</span>&gt;(</span><br><span class="line">                        value: <span class="number">1</span>,</span><br><span class="line">                        child: Text(<span class="string">'ç±»å‹ 2'</span>),</span><br><span class="line">                      ),</span><br><span class="line">                    ],</span><br><span class="line">                  ),</span><br><span class="line">                ],</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>é—®é¢˜äºŒï¼šå½“å¤šä¸ª <code>DropdownMenuItem</code> å€¼ç›¸åŒæ—¶ä¼šæŠ¥é”™</p><p><img src="./images/flutter-dropdown-problem/crash.png" alt="crash"></p><p>è¿™ä¸ªæŠ¥é”™äº§ç”Ÿçš„åŸå› æ˜¯è¿™é‡Œçš„ <code>DropdownMenuItem</code> æ˜¯è¯·æ±‚åç«¯æ¥å£åä¼šç”Ÿæˆå¾ˆå¤šé€‰é¡¹ï¼Œå¦‚æœè®¾ç½®äº† <code>DropdownButton</code> çš„ <code>value</code> å€¼ï¼Œé‚£ä¹ˆ <code>DropdownMenuItem</code> å°±ä¼šæœ‰ç›¸åŒçš„å€¼ï¼Œå‡ºç°è¿™ä¸ªé”™è¯¯ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šä¸è®¾ç½® <code>DropdownButton</code> çš„åˆå§‹ <code>value</code> å€¼</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DropdownButton&lt;<span class="built_in">int</span>&gt;(</span><br><span class="line">  <span class="comment">// value: 0,</span></span><br><span class="line">  onChanged: (<span class="built_in">int</span> newValue) &#123;</span><br><span class="line">    setState(() &#123;&#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  items: types.map(</span><br><span class="line">    (item) &#123;</span><br><span class="line">      <span class="keyword">return</span> DropdownMenuItem&lt;<span class="built_in">int</span>&gt;(</span><br><span class="line">        value: item[<span class="string">"value"</span>],</span><br><span class="line">        child: Text(item[<span class="string">"label"</span>]),</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">  ).toList(),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>psï¼šè¿™ä¸¤ä¸ªé—®é¢˜å¡äº†æˆ‘ä¸¤å¤©ğŸ˜”</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è®°å½•ä¸¤ä¸ªå…³äº &lt;code&gt;DropdownButton&lt;/code&gt; çš„é—®é¢˜&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹äºŒå‰æ ‘</title>
    <link href="https://coldstone.fun/post/2020/03/15/das-tree/"/>
    <id>https://coldstone.fun/post/2020/03/15/das-tree/</id>
    <published>2020-03-15T03:05:00.000Z</published>
    <updated>2021-06-28T09:25:25.301Z</updated>
    
    <content type="html"><![CDATA[<p>äºŒå‰æ ‘æ˜¯ä¸€ç§éçº¿æ€§çš„æ•°æ®ç»“æ„ï¼Œä»¥åˆ†å±‚çš„æ–¹å¼å­˜å‚¨æ•°æ®ã€‚åœ¨äºŒå‰æ ‘ä¸Šè¿›è¡Œæ·»åŠ ï¼ŒæŸ¥æ‰¾å’Œåˆ é™¤æ•°æ®éå¸¸å¿«ã€‚</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>äºŒå‰æ ‘æ˜¯ä¸€ç§éçº¿æ€§çš„æ•°æ®ç»“æ„ï¼Œä»¥åˆ†å±‚çš„æ–¹å¼å­˜å‚¨æ•°æ®ã€‚ç”¨äºå­˜å‚¨æœ‰å±‚çº§å…³ç³»çš„æ•°æ®ï¼Œå¦‚è®¡ç®—æœºæ–‡ä»¶ï¼Œå…¬å¸ç»„ç»‡ç»“æ„ç­‰æ•°æ®ã€‚åœ¨äºŒå‰æ ‘ä¸Šè¿›è¡Œæ·»åŠ ï¼ŒæŸ¥æ‰¾å’Œåˆ é™¤æ•°æ®éå¸¸å¿«ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>è¦å®ç°æ ‘ç»“æ„é¦–å…ˆéœ€è¦ <code>Node</code> èŠ‚ç‚¹ç±»ï¼ŒèŠ‚ç‚¹ä¿å­˜æ•°æ®å’Œå®ƒå·¦å³èŠ‚ç‚¹çš„é“¾æ¥ï¼Œ<code>show</code> æ–¹æ³•è¿”å›èŠ‚ç‚¹æ•°æ®ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Node &#123;</span><br><span class="line">  data: <span class="built_in">number</span></span><br><span class="line">  left: Node = <span class="literal">null</span></span><br><span class="line">  right: Node = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">data: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.data = data</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  show() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°äºŒå‰æ ‘ï¼Œé¦–å…ˆéœ€è¦å‘æ ‘ä¸­æ’å…¥èŠ‚ç‚¹çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å…ˆåˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ¤æ–­æ ‘æ˜¯å¦æœ‰æ ¹èŠ‚ç‚¹ï¼Œæ²¡æœ‰çš„è¯å°†æ–°èŠ‚ç‚¹ä½œä¸ºæ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œå¦åˆ™è¿›è¡Œä¸‹ä¸€æ­¥ï¼›</p><ol><li>è®¾å½“å‰èŠ‚ç‚¹ä¸ºæ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œå¼€å§‹å¾ªç¯</li><li>å¦‚æœæ’å…¥èŠ‚ç‚¹çš„æ•°æ®å°äºå½“å‰èŠ‚ç‚¹çš„æ•°æ®ï¼Œå°†æ–°å½“å‰èŠ‚ç‚¹è®¾ä¸ºåŸå½“å‰èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ï¼Œå¦åˆ™æ‰§è¡Œç¬¬ 4 æ­¥</li><li>å¦‚æœå½“å‰èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ä¸º <code>null</code> ï¼Œå°±å°†æ–°çš„èŠ‚ç‚¹æ’å…¥è¿™ä¸ªä½ç½®ï¼Œé€€å‡ºå¾ªç¯ï¼›å¦åˆ™æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯</li><li>å°†æ–°å½“å‰èŠ‚ç‚¹è®¾ä¸ºåŸå½“å‰èŠ‚ç‚¹çš„å³èŠ‚ç‚¹</li><li>å¦‚æœå½“å‰èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ä¸º <code>null</code> ï¼Œå°±å°†æ–°çš„èŠ‚ç‚¹æ’å…¥è¿™ä¸ªä½ç½®ï¼Œé€€å‡ºå¾ªç¯ï¼›å¦åˆ™æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯</li></ol><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> BST &#123;</span><br><span class="line">  root: Node = <span class="literal">null</span></span><br><span class="line">  length: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ’å…¥èŠ‚ç‚¹</span></span><br><span class="line">  insert(data: <span class="built_in">number</span>) &#123;</span><br><span class="line">    <span class="comment">// å…ˆåˆ›å»ºæ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">const</span> node = <span class="keyword">new</span> Node(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.root === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.root = node</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> originNode</span><br><span class="line">      <span class="comment">// å°†å½“å‰èŠ‚ç‚¹è®¾ä¸ºæ ‘æ ¹èŠ‚ç‚¹</span></span><br><span class="line">      <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.root</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¼€å§‹å¾ªç¯</span></span><br><span class="line">      <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// ä¿å­˜åŸèŠ‚ç‚¹å¼•ç”¨</span></span><br><span class="line">        originNode = currentNode</span><br><span class="line"></span><br><span class="line">        <span class="comment">//  å¦‚æœæ’å…¥èŠ‚ç‚¹çš„æ•°æ®å°äºå½“å‰èŠ‚ç‚¹çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (data &lt; currentNode.data) &#123;</span><br><span class="line">          <span class="comment">// å°†æ–°å½“å‰èŠ‚ç‚¹è®¾ä¸ºåŸå½“å‰èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹</span></span><br><span class="line">          currentNode = currentNode.left</span><br><span class="line">          <span class="comment">// å¦‚æœå½“å‰èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ä¸º `null` ï¼Œå°±å°†æ–°çš„èŠ‚ç‚¹æ’å…¥è¿™ä¸ªä½ç½®ï¼Œé€€å‡ºå¾ªç¯ï¼›å¦åˆ™æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯</span></span><br><span class="line">          <span class="keyword">if</span> (currentNode === <span class="literal">null</span>) &#123;</span><br><span class="line">            originNode.left = node</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// å°†æ–°å½“å‰èŠ‚ç‚¹è®¾ä¸ºåŸå½“å‰èŠ‚ç‚¹çš„å³èŠ‚ç‚¹</span></span><br><span class="line">          currentNode = currentNode.right</span><br><span class="line">          <span class="comment">// å¦‚æœå½“å‰èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ä¸º `null` ï¼Œå°±å°†æ–°çš„èŠ‚ç‚¹æ’å…¥è¿™ä¸ªä½ç½®ï¼Œé€€å‡ºå¾ªç¯ï¼›å¦åˆ™æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯</span></span><br><span class="line">          <span class="keyword">if</span> (currentNode === <span class="literal">null</span>) &#123;</span><br><span class="line">            originNode.right = node</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éå†äºŒå‰æ ‘ï¼Œä¸­åºï¼Œå…ˆåºï¼Œååº</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// ä¸­åºéå†</span></span><br><span class="line">inOrder(node: Node) &#123;</span><br><span class="line">  <span class="keyword">if</span> (node !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.inOrder(node.left)</span><br><span class="line">    node.show()</span><br><span class="line">    <span class="keyword">this</span>.inOrder(node.right)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆåºéå†</span></span><br><span class="line">preOrder(node: Node) &#123;</span><br><span class="line">  <span class="keyword">if</span> (node !== <span class="literal">null</span>) &#123;</span><br><span class="line">    node.show()</span><br><span class="line">    <span class="keyword">this</span>.preOrder(node.left)</span><br><span class="line">    <span class="keyword">this</span>.preOrder(node.right)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ååºéå†</span></span><br><span class="line">postOrder(node: Node) &#123;</span><br><span class="line">  <span class="keyword">if</span> (node !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.postOrder(node.left)</span><br><span class="line">    <span class="keyword">this</span>.postOrder(node.right)</span><br><span class="line">    node.show()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾èŠ‚ç‚¹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">find(data: number): Node &#123;</span><br><span class="line">  <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.root</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (currentNode !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (currentNode.data === data) &#123;</span><br><span class="line">      <span class="keyword">return</span> currentNode</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentNode.data &gt; data) &#123;</span><br><span class="line">      currentNode = currentNode.left</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      currentNode = currentNode.right</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ é™¤èŠ‚ç‚¹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">remove(data: <span class="built_in">number</span>) &#123;</span><br><span class="line">  <span class="keyword">this</span>.root = <span class="keyword">this</span>.removeNode(<span class="keyword">this</span>.root, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">removeNode(node: Node, data: <span class="built_in">number</span>): Node &#123;</span><br><span class="line">  <span class="keyword">if</span> (node === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (data === node.data) &#123;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰å­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (node.left === <span class="literal">null</span> &amp;&amp; node.right === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (node.left === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> node.right</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰å³å­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (node.right === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> node.left</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æœ‰å·¦å³ä¸¤ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">const</span> tempNode = <span class="keyword">this</span>.min(node.right)</span><br><span class="line">    node.data = tempNode.data</span><br><span class="line">    node.right = <span class="keyword">this</span>.removeNode(node.right, tempNode.data)</span><br><span class="line">    <span class="keyword">return</span> node</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.data &gt; data) &#123;</span><br><span class="line">    node.left = <span class="keyword">this</span>.removeNode(node.left, data)</span><br><span class="line">    <span class="keyword">return</span> node</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    node.right = <span class="keyword">this</span>.removeNode(node.right, data)</span><br><span class="line">    <span class="keyword">return</span> node</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€å¤§å€¼ï¼Œæœ€å°å€¼</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ€å°å€¼èŠ‚ç‚¹</span></span><br><span class="line">min(node: Node = <span class="keyword">this</span>.root): Node &#123;</span><br><span class="line">  <span class="keyword">let</span> currentNode = node</span><br><span class="line">  <span class="keyword">while</span> (currentNode.left !== <span class="literal">null</span>) &#123;</span><br><span class="line">    currentNode = currentNode.left</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> currentNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€å¤§å€¼èŠ‚ç‚¹</span></span><br><span class="line">max(node: Node = <span class="keyword">this</span>.root): Node &#123;</span><br><span class="line">  <span class="keyword">let</span> currentNode = node</span><br><span class="line">  <span class="keyword">while</span> (currentNode.right !== <span class="literal">null</span>) &#123;</span><br><span class="line">    currentNode = currentNode.right</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> currentNode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h2><p><code>BST</code> å¯ä»¥ç”¨æ¥è®°å½•ä¸€ç»„æ•°æ®ä¸­æ•°æ®å‡ºç°çš„æ¬¡æ•°ï¼Œé¦–å…ˆåœ¨ <code>Node</code> ç±»ä¸Šæ·»åŠ  <code>count</code> å±æ€§</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Node &#123;</span><br><span class="line">  data: <span class="built_in">number</span></span><br><span class="line">  left: Node = <span class="literal">null</span></span><br><span class="line">  right: Node = <span class="literal">null</span></span><br><span class="line">  count: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">data: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.data = data</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  show() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>BST</code> ç±»ä¸Šæ·»åŠ  <code>update</code> æ–¹æ³•ï¼Œå½“æ’å…¥æ•°æ®ä¸ºæ–°å€¼æ—¶ä½¿ç”¨ <code>insert</code> æ–¹æ³•ï¼Œå½“æ’å…¥å·²ç»å­˜åœ¨çš„å€¼æ—¶ä½¿ç”¨ <code>update</code> æ–¹æ³•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">update(data: <span class="built_in">number</span>): Node &#123;</span><br><span class="line">  <span class="keyword">const</span> node = <span class="keyword">this</span>.find(data)</span><br><span class="line">  <span class="keyword">if</span>(node !== <span class="literal">null</span>) &#123;</span><br><span class="line">    node.count++</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;node.data&#125;</span>: `</span>, node.count)</span><br><span class="line">    <span class="keyword">return</span> node</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bst = <span class="keyword">new</span> BST();</span><br><span class="line"><span class="keyword">const</span> array = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; array.length; index++) &#123;</span><br><span class="line">    <span class="keyword">const</span> num = array[index]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (bst.find(num) !== <span class="literal">null</span>) &#123;</span><br><span class="line">        bst.update(num);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        bst.insert(num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3:  1</span></span><br><span class="line"><span class="comment">// 2:  1</span></span><br><span class="line"><span class="comment">// 5:  1</span></span><br><span class="line"><span class="comment">// 4:  1</span></span><br><span class="line"><span class="comment">// 2:  2</span></span><br><span class="line"><span class="comment">// 5:  2</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;äºŒå‰æ ‘æ˜¯ä¸€ç§éçº¿æ€§çš„æ•°æ®ç»“æ„ï¼Œä»¥åˆ†å±‚çš„æ–¹å¼å­˜å‚¨æ•°æ®ã€‚åœ¨äºŒå‰æ ‘ä¸Šè¿›è¡Œæ·»åŠ ï¼ŒæŸ¥æ‰¾å’Œåˆ é™¤æ•°æ®éå¸¸å¿«ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="DSA" scheme="https://coldstone.fun/tags/DSA/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨ Gitlib æŒç»­å‘å¸ƒ Flutter åº”ç”¨</title>
    <link href="https://coldstone.fun/post/2020/02/27/flutter-gitlab-pineline/"/>
    <id>https://coldstone.fun/post/2020/02/27/flutter-gitlab-pineline/</id>
    <published>2020-02-27T03:01:00.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Gitlib CI/CD æ„å»ºå‘å¸ƒ Flutter åº”ç”¨</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><a href="https://coldstone.fun/post/2020/02/26/flutter-github-actions/">å‰ä¸€ç¯‡æ–‡ç« </a>ä»‹ç»äº†ä½¿ç”¨ Github Actions æŒç»­å‘å¸ƒ Flutter åº”ç”¨ï¼Œæœ¬æ–‡åˆ†äº«ä¸‹å¦‚ä½•ä½¿ç”¨ Gitlib çš„ CI/CD åŠŸèƒ½åŒæ ·å®ç°å‘å¸ƒ Flutter åº”ç”¨ï¼Œå› ä¸ºæœ‰å¾ˆå¤šå…¬å¸æ˜¯ç”¨è‡ªå·±æ­å»ºçš„ Gitlab æ¥ç®¡ç†ä»£ç çš„ã€‚</p><p>è¦ä½¿ç”¨ Gitlib çš„ CI/CD åŠŸèƒ½é¦–å…ˆéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª yml æ ¼å¼çš„é…ç½®æ–‡ä»¶ <code>.gitlab-ci.yml</code>ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶ä¼šå®šä¹‰ä¸€ä¸ªæµæ°´çº¿ Pipelineã€‚ä¸€ä¸ª Pipeline ç”±å¤šä¸ªä»»åŠ¡ Job ç»„æˆï¼Œä»»åŠ¡å°±æ˜¯å…·ä½“è¦åšçš„äº‹æƒ…ï¼Œå¦‚ä»£ç ç¼–è¯‘æˆ–æµ‹è¯•ï¼› Pipeline é‡Œçš„ stages å†³å®šäº†ä»»åŠ¡ä½•æ—¶ä»¥åŠå¦‚ä½•è¿è¡Œã€‚ä»¥ä¸‹å°±æ˜¯ä¸€ä¸ª Pipeline æœ‰ 3 ä¸ª stageï¼Œä¾æ¬¡æ‰§è¡Œ buildï¼Œtest å’Œ deploy ä»»åŠ¡ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job01:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">script:</span> <span class="string">echo</span> <span class="string">'build job'</span></span><br><span class="line"><span class="attr">job02:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">script:</span> <span class="string">echo</span> <span class="string">'test job'</span></span><br><span class="line"><span class="attr">job03:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">script:</span> <span class="string">echo</span> <span class="string">'deploy job'</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>è¦åœ¨ Pipeline é‡Œæ„å»ºæ‰“åŒ… Flutter åº”ç”¨çš„ apkï¼Œé¦–å…ˆéœ€è¦åœ¨æµæ°´çº¿é‡Œé…ç½® Android ä»¥åŠ Flutter ç¯å¢ƒï¼Œæœç´¢ä¸€ç•ªåå‘ç°äº†ä¸€ä¸ª Github ä¸Šçš„ Flutter é•œåƒ <a href="https://github.com/cirruslabs/docker-images-flutter" target="_blank" rel="noopener">docker-images-flutter</a> å¾ˆé€‚åˆï¼Œçœ‹è¿™ä¸ªé•œåƒçš„ <a href="https://github.com/cirruslabs/docker-images-flutter/blob/master/sdk/Dockerfile" target="_blank" rel="noopener">Dockerfile</a> å¯ä»¥å‘ç°å®ƒæ˜¯ä» <code>cirrusci/android-sdk:29</code> è¿™ä¸ª Android sdk é•œåƒå¼€å§‹ï¼Œç„¶åä¸‹è½½ Flutter SDKï¼Œè¿™æ ·å°±æœ‰äº†äº† Android å’Œ Flutter ç¯å¢ƒï¼Œæ¥ä¸‹æ¥åªéœ€è¦è¿è¡Œæµ‹è¯•å’Œæ‰“åŒ…å‘½ä»¤å³å¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">release</span></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">build</span> <span class="string">é˜¶æ®µä½¿ç”¨æ‹¥æœ‰</span> <span class="string">Android</span> <span class="string">ä»¥åŠ</span> <span class="string">Flutter</span> <span class="string">ç¯å¢ƒçš„é•œåƒï¼Œè¿›è¡Œæµ‹è¯•æ‰“åŒ…</span></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">cirrusci/flutter:stable</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="string">//</span> <span class="string">ä¸‹è½½ä¾èµ–åŒ…</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">flutter</span> <span class="string">packages</span> <span class="string">get</span></span><br><span class="line">    <span class="string">//</span> <span class="string">æ‰§è¡Œæµ‹è¯•</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">flutter</span> <span class="string">test</span></span><br><span class="line">    <span class="string">//</span> <span class="string">æ‰“åŒ…</span> <span class="string">apk</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">flutter</span> <span class="string">build</span> <span class="string">apk</span> <span class="string">--release</span></span><br><span class="line">  <span class="string">//</span> <span class="string">è¿™é‡Œå®šä¹‰ä»»åŠ¡ç”Ÿæˆçš„æ–‡ä»¶</span></span><br><span class="line">  <span class="attr">artifacts:</span></span><br><span class="line">    <span class="attr">expire_in:</span> <span class="number">1</span> <span class="string">hour</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">build/app/outputs/apk/release/*.apk</span></span><br><span class="line">  <span class="attr">interruptible:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="å‘å¸ƒ"><a href="#å‘å¸ƒ" class="headerlink" title="å‘å¸ƒ"></a>å‘å¸ƒ</h2><p>è¦å‘å¸ƒ apk æ–‡ä»¶åˆ°ä»“åº“çš„ release è¿˜éœ€è¦ä½¿ç”¨ <a href="https://github.com/inetprocess/gitlab-release" target="_blank" rel="noopener">gitlab-release</a> è¿™ä¸ªé•œåƒè¿›è¡Œå‘å¸ƒæ“ä½œ</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">release</span></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">build</span> <span class="string">é˜¶æ®µä½¿ç”¨æ‹¥æœ‰</span> <span class="string">Android</span> <span class="string">ä»¥åŠ</span> <span class="string">Flutter</span> <span class="string">ç¯å¢ƒçš„é•œåƒï¼Œè¿›è¡Œæµ‹è¯•æ‰“åŒ…</span></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">cirrusci/flutter:stable</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">flutter</span> <span class="string">packages</span> <span class="string">get</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">flutter</span> <span class="string">test</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">flutter</span> <span class="string">build</span> <span class="string">apk</span> <span class="string">--release</span></span><br><span class="line">  <span class="attr">artifacts:</span></span><br><span class="line">    <span class="attr">expire_in:</span> <span class="number">1</span> <span class="string">hour</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">build/app/outputs/apk/release/*.apk</span></span><br><span class="line">  <span class="attr">interruptible:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">å‘å¸ƒåˆ°ä»“åº“çš„</span> <span class="string">release</span></span><br><span class="line"><span class="attr">release:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">inetprocess/gitlab-release</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">release</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">dependencies:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="string">//</span> <span class="string">ä½¿ç”¨æ‰“åŒ…å¥½çš„</span> <span class="string">apk</span> <span class="string">æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">gitlab-release</span> <span class="string">--message</span> <span class="string">'è‡ªåŠ¨å‘å¸ƒ'</span> <span class="string">build/app/outputs/apk/release/*.apk</span></span><br></pre></td></tr></table></figure><p>å‘å¸ƒè¿˜éœ€è¦ä¸€ä¸ª <code>Personal Access Token</code> ç»™ release ä»»åŠ¡æä¾› api æƒé™ï¼Œæœ‰äº† api æƒé™å°±å¯ä»¥è¯·æ±‚ Gitlab çš„ release æ¥å£ä¸Šä¼  apk äº†</p><p><img src="./images/gitlib-token.jpg" alt="token"></p><p>ä½¿ç”¨åˆšæ‰åˆ›å»ºçš„ token åœ¨é¡¹ç›®ä»“åº“é‡Œé…ç½®æµæ°´çº¿çš„ç¯å¢ƒå˜é‡ <code>GITLAB_ACCESS_TOKEN</code></p><p><img src="./images/gitlab-variable.jpg" alt="var"></p><p>æœ€ååˆ›å»ºä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾æ¨é€åˆ° Gitlab ä»“åº“ï¼Œå°±å¯ä»¥çœ‹åˆ°è¿è¡Œä¸­çš„æµæ°´çº¿äº†</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git tag v1.0.0</span><br><span class="line"></span><br><span class="line">git push --tag</span><br></pre></td></tr></table></figure><p><img src="./images/gitlib-pineline.jpg" alt="var"></p><p>æµæ°´çº¿è¿è¡Œå®Œæ¯•ï¼Œä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒæˆåŠŸã€‚</p><p><img src="./images/gitlib-release.jpg" alt="var"></p><h2 id="ä¸Šä¼ "><a href="#ä¸Šä¼ " class="headerlink" title="ä¸Šä¼ "></a>ä¸Šä¼ </h2><p><a href="https://www.pgyer.com/" target="_blank" rel="noopener">è’²å…¬è‹±</a> å¹³å°å¯ä»¥å¯¹åº”ç”¨è¿›è¡Œå†…æµ‹åˆ†å‘ï¼Œä½¿ç”¨è’²å…¬è‹±æä¾›çš„ä¸Šä¼ åº”ç”¨åŒ…çš„æ¥å£ï¼Œå°† <code>CI/CD</code> æ„å»ºå‡ºæ¥çš„åº”ç”¨ <code>apk</code> ç›´æ¥ä¸Šä¼ ï¼Œå…å»æ‰‹åŠ¨å»ç½‘é¡µä¸Šä¸Šä¼ çš„éº»çƒ¦</p><p>æ·»åŠ ä¸€ä¸ª <code>upload</code> ä»»åŠ¡ï¼Œä¾èµ–äº <code>build</code> ä»»åŠ¡ï¼Œå‘è’²å…¬è‹±çš„ä¸Šä¼ æ¥å£å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œ<code>$APK_PATH</code> æ˜¯åº”ç”¨æ‰“åŒ…å‡ºæ¥çš„è·¯å¾„ï¼Œå®šä¹‰ä¸ºä¸€ä¸ªå˜é‡æ–¹ä¾¿ä½¿ç”¨;</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">release</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">upload</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="attr">upload:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">upload</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">dependencies:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">curl</span> <span class="string">-S</span> <span class="string">"http://www.pgyer.com/apiv2/app/upload"</span> <span class="string">-F</span> <span class="string">"file=@$APK_PATH"</span> <span class="string">-F</span> <span class="string">"_api_key=$PGY_API_KEY"</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">uploaded</span></span><br></pre></td></tr></table></figure><p><code>$PGY_API_KEY</code> æ˜¯è’²å…¬è‹±å¹³å°çš„ <code>API Key</code>ï¼Œéœ€è¦æ·»åŠ åˆ° <code>CI/CD</code> çš„ç¯å¢ƒå˜é‡ä¸­</p><p><img src="./images/pgy-api-key.png" alt="api-key"></p><p>åœ¨ä»“åº“çš„è®¾ç½®é‚£é‡Œæ·»åŠ æ–°çš„ç¯å¢ƒå˜é‡</p><p><img src="./images/gitlab-pgy-variable.png" alt="variable"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>æ·»åŠ æµæ°´çº¿é…ç½® <code>.gitlab-ci.yml</code></li><li>åˆ›å»º <code>Personal Access Token</code></li><li>è®¾ç½®ç¯å¢ƒå˜é‡ <code>GITLAB_ACCESS_TOKEN</code></li><li>æ¨é€ç‰ˆæœ¬æ ‡ç­¾</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://github.com/inetprocess/gitlab-release" target="_blank" rel="noopener">Gitlab Release</a></p><p><a href="https://docs.gitlab.com/ee/ci/quick_start/README.html" target="_blank" rel="noopener">Getting started with GitLab CI/CD</a></p><p><a href="https://www.pgyer.com/doc/view/travis_android" target="_blank" rel="noopener">ä½¿ç”¨ Travis CI å®ç°æŒç»­é›†æˆ (Android)</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Gitlib CI/CD æ„å»ºå‘å¸ƒ Flutter åº”ç”¨&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
      <category term="Gitlib" scheme="https://coldstone.fun/tags/Gitlib/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Github Actions æŒç»­å‘å¸ƒ Flutter åº”ç”¨</title>
    <link href="https://coldstone.fun/post/2020/02/26/flutter-github-actions/"/>
    <id>https://coldstone.fun/post/2020/02/26/flutter-github-actions/</id>
    <published>2020-02-26T17:59:06.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡è®²è§£å¦‚ä½•ä½¿ç”¨ Github Actions æ„å»ºå¹¶å‘å¸ƒ Flutter åº”ç”¨</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><a href="https://help.github.com/en/actions" target="_blank" rel="noopener">Github Actions</a> æ˜¯ Github æä¾›çš„ä¸€ç§ CI/CD æœåŠ¡ï¼Œå¦‚æœä½ çš„ Flutter åº”ç”¨ä»£ç æ”¾åœ¨ Github ä¸Šï¼Œé‚£å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæœåŠ¡è‡ªåŠ¨åŒ–è¿›è¡Œåº”ç”¨æµ‹è¯•ï¼Œæ„å»ºï¼Œå‘å¸ƒå·¥ä½œäº†ã€‚</p><p>å…ˆè¯´ä¸‹ Github Actions å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œæ„Ÿè§‰è¿˜æ˜¯æŒºæ˜“æ‡‚çš„ï¼Œä¸å¾—ä¸è¯´ Github Actions çš„è®¾è®¡å¾ˆå‰å®³ ğŸ˜„</p><p><strong><code>Workflow file</code></strong></p><p>é…ç½®å·¥ä½œæµç¨‹çš„æ–‡ä»¶ï¼ŒYAML æ ¼å¼ï¼Œæ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ <code>.github/workflows</code> ç›®å½•å†…</p><p><strong><code>Workflow</code></strong></p><p>ç”±é…ç½®æ–‡ä»¶å®šä¹‰çš„ä¸€ä¸ªå·¥ä½œæµç¨‹ï¼Œç”±ä¸€ç³»åˆ—çš„çš„ä»»åŠ¡ç»„æˆ</p><p><strong><code>Job</code></strong></p><p>å·¥ä½œæµç¨‹ä¸­çš„ä¸€ä¸ªä»»åŠ¡ï¼Œç”±ä¸€ç³»åˆ—çš„æ­¥éª¤ Step ç»„æˆ</p><p><strong><code>Step</code></strong></p><p>ä¸€ä¸ªä»»åŠ¡å…¶ä¸­çš„ä¸€ä¸ªæ‰§è¡Œæ­¥éª¤ï¼Œæ‰§è¡Œä¸€äº›å‘½ä»¤æˆ–è€… Action</p><p><strong><code>Action</code></strong></p><p>ä¸€ä¸ªæ­¥éª¤ä¸­çš„å…·ä½“è¦è¿›è¡Œæ“ä½œï¼Œå¦‚æ‹‰å–ä»£ç ï¼Œå‘é€è¯·æ±‚ç­‰ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå·±æˆ–ç¤¾åŒºå…±äº«çš„ Action</p><p><strong><code>Event</code></strong></p><p>è§¦å‘å·¥ä½œæµç¨‹è¿è¡Œçš„äº‹ä»¶ï¼Œæ¯”å¦‚æ¨é€ä»£ç åˆ°ä»“åº“ pushï¼Œåˆ›å»ºä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾ tag ç­‰</p><p><strong><code>Artifact</code></strong></p><p>å·¥ç¨‹æµç¨‹æ‰§è¡Œæ—¶äº§ç”Ÿçš„ä¸œè¥¿</p><p><strong><code>Runner</code></strong></p><p>å°±æ˜¯å·¥ä½œæµç¨‹è¿è¡Œçš„åœ°æ–¹ï¼ŒGithub æä¾›çš„æœåŠ¡å™¨</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>ä¸‹é¢ç”¨ä¸€ä¸ªç¤ºä¾‹é¡¹ç›®æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ Github Actions å‘å¸ƒ Flutter åº”ç”¨ï¼Œå…ˆæ”¾æˆæœ <a href="https://github.com/xrr2016/flutter-github-gitlab/releases" target="_blank" rel="noopener">åœ°å€</a></p><p><img src="./images/flutter-release.jpg" alt="main.yml"></p><ol><li>é¦–å…ˆåˆ›å»ºä¸€ä¸ª Flutter é¡¹ç›®</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter create flutter_github_actions</span><br></pre></td></tr></table></figure><ol start="2"><li>æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶ <code>.github/workflows/main.yml</code></li></ol><p><img src="./images/main-yml.jpg" alt="main.yml"></p><ol start="3"><li>é…ç½®å·¥ä½œæµç¨‹ï¼Œå°†ä»£ç æ¨é€åˆ° Github</li></ol><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å·¥ä½œæµç¨‹çš„åå­—</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">Test,</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">Release</span> <span class="string">apk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å·¥ä½œæµç¨‹è§¦å‘çš„æ—¶æœºï¼Œè¿™é‡Œæ˜¯å½“ä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾æ¨é€åˆ°ä»“åº“æ—¶è§¦å‘</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">tags:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">v*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸ªå·¥ä½œæµç¨‹éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">process:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">all</span> <span class="string">process</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="comment"># è¿™ä¸ªä»»åŠ¡çš„æ­¥éª¤</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="comment"># æ‹‰å–é¡¹ç›®ä»£ç </span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">      <span class="comment"># å»ºç«‹ java ç¯å¢ƒ</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Java</span> <span class="string">JDK</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-java@v1.3.0</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">java-version:</span> <span class="string">"12.x"</span></span><br><span class="line">      <span class="comment"># å»ºç«‹ Flutter ç¯å¢ƒ</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Flutter</span> <span class="string">action</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">subosito/flutter-action@v1.1.1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">channel:</span> <span class="string">"stable"</span></span><br><span class="line">          <span class="attr">flutter-version:</span> <span class="string">"1.12.x"</span></span><br><span class="line">      <span class="comment"># ä¸‹è½½é¡¹ç›®ä¾èµ–</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">flutter</span> <span class="string">pub</span> <span class="string">get</span></span><br><span class="line">      <span class="comment"># æ‰§è¡Œæµ‹è¯•</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">flutter</span> <span class="string">test</span></span><br><span class="line">      <span class="comment"># æ‰“åŒ… APK</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">flutter</span> <span class="string">build</span> <span class="string">apk</span> <span class="string">--release</span></span><br><span class="line">      <span class="comment"># å‘å¸ƒåˆ° Release</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Release</span> <span class="string">apk</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">ncipollo/release-action@v1.5.0</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">artifacts:</span> <span class="string">"build/app/outputs/apk/release/*.apk"</span></span><br><span class="line">          <span class="attr">token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_RElEASE_TOKEN</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure><ol start="4"><li>åˆ›å»º Token</li></ol><p>è¦æŠŠæ„å»ºå‡ºæ¥çš„ apk å‘å¸ƒåˆ°ä»“åº“çš„ Releaseï¼Œè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ª  <a href="https://github.com/settings/tokens" target="_blank" rel="noopener">Personal access token</a> æä¾›å‘å¸ƒ action è®¿é—®å’Œæ“ä½œä»£ç ä»“åº“çš„æƒé™ï¼Œæ³¨æ„ä¸è¦å…³é—­æµè§ˆå™¨æ ‡ç­¾ï¼Œå› ä¸ºè¿™ä¸ª token åªæœ‰åœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºçš„æ—¶å€™å¯è§ã€‚</p><p><img src="./images/flutter-gtihub-token.jpg" alt="token"></p><ol start="5"><li>æ·»åŠ ç¯å¢ƒå˜é‡</li></ol><p>æœ€åä¸ºäº†èƒ½åœ¨å·¥ä½œæµç¨‹ä¸­åˆ›å»ºçš„ tokenï¼Œéœ€è¦åœ¨ä»“åº“çš„ secrets é‡Œæ·»åŠ ä¸€ä¸ªç¯å¢ƒå˜é‡ <code>GITHUB_RElEASE_TOKEN</code> æ¥å‚¨å­˜ token å€¼</p><p><img src="./images/github-secrets.jpg" alt="secrets"></p><ol start="6"><li>è§¦å‘æ„å»º</li></ol><p>æœ€ååˆ›å»ºä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾ï¼Œæ¨é€åˆ°ä»“åº“è§¦å‘å·¥ä½œæµç¨‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git tag v1.0.0</span><br><span class="line"></span><br><span class="line">git push --tag</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥åœ¨ä»“åº“çš„ Actions é‡Œé¢çœ‹åˆ°æ­£åœ¨è¿è¡Œçš„å·¥ä½œæµç¨‹äº†</p><p><img src="./images/github-workflow.jpg" alt="workflow"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ä»¥ä¸‹ 4 ä¸ªæ­¥éª¤</p><ol><li>åˆ›å»ºä¸€ä¸ªå·¥ä½œæµç¨‹çš„é…ç½®æ–‡ä»¶ <code>.github/workflows/main.yml</code></li><li>åˆ›å»ºä¸€ä¸ª Personnal access token</li><li>åœ¨é¡¹ç›®çš„ serect é‡Œé¢æ·»åŠ ä¸€ä¸ªç¯å¢ƒå˜é‡ <code>GITHUB_RElEASE_TOKEN</code></li><li>æ¨é€ä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾ğŸ·ï¸ï¼Œè§¦å‘å·¥ä½œæµç¨‹</li></ol><p>ä¹‹åå°±å¯ä»¥åœ¨æ¯æ¬¡å‘å¸ƒæ ‡ç­¾åè‡ªåŠ¨å‘å¸ƒäº†</p><h2 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h2><p>æ„å»º Web åº”ç”¨ï¼Œå‘å¸ƒåˆ° Gihub Pages</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯ç”¨ Flutter web</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Enable</span> <span class="string">flutter</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">flutter</span> <span class="string">config</span> <span class="string">--enable-web</span></span><br><span class="line"><span class="comment"># æ„å»º web åº”ç”¨</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">Web</span> <span class="string">App</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">flutter</span> <span class="string">build</span> <span class="string">web</span></span><br><span class="line"><span class="comment"># éƒ¨ç½²åˆ° Github Pages</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">peaceiris/actions-gh-pages@v3</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">github_token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">publish_dir:</span> <span class="string">./build/web</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡è®²è§£å¦‚ä½•ä½¿ç”¨ Github Actions æ„å»ºå¹¶å‘å¸ƒ Flutter åº”ç”¨&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
      <category term="Github Actions" scheme="https://coldstone.fun/tags/Github-Actions/"/>
    
  </entry>
  
  <entry>
    <title>MySQL å…¥é—¨ç¬”è®° ğŸ“’</title>
    <link href="https://coldstone.fun/post/2020/02/12/mysql-getting-start/"/>
    <id>https://coldstone.fun/post/2020/02/12/mysql-getting-start/</id>
    <published>2020-02-12T07:37:26.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>å·¥ä½œéœ€æ±‚å­¦ä¹ ä¸€ä¸‹ MySQL æ•°æ®åº“</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»€ä¹ˆæ˜¯ MySQLï¼Ÿå¼•ç”¨å®˜æ–¹è¯´æ˜</p><blockquote><p>MySQL is the worldâ€™s most popular open source database. Whether you are a fast growing web property, technology ISV or large enterprise, MySQL can cost-effectively help you deliver high performance, scalable database applications.</p><p>MySQL æ˜¯ä¸–ç•Œä¸Šæœ€å—æ¬¢è¿çš„å¼€æºæ•°æ®åº“ã€‚æ— è®ºæ‚¨æ˜¯å¿«é€Ÿå¢é•¿çš„ Web èµ„äº§ï¼ŒæŠ€æœ¯ ISV è¿˜æ˜¯å¤§å‹ä¼ä¸šï¼ŒMySQL éƒ½èƒ½ç»æµé«˜æ•ˆåœ°å¸®åŠ©æ‚¨äº¤ä»˜é«˜æ€§èƒ½ï¼Œå¯æ‰©å±•çš„æ•°æ®åº“åº”ç”¨ç¨‹åºã€‚</p></blockquote><p>MySQL æ˜¯ç›®å‰æœ€æµè¡Œçš„å…³ç³»å‹æ•°æ®åº“ï¼Œå›½å†…å¤–å¾ˆå¤šå…¬å¸éƒ½åœ¨ä½¿ç”¨ï¼Œä½œä¸ºä¸€ä¸ªåº”ç”¨å¼€å‘äººå‘˜è¿˜æ˜¯æœ‰å¿…è¦å­¦ä¹ ä¸€ä¸‹ MySQL çš„åŸºæœ¬çŸ¥è¯†çš„ã€‚</p><h2 id="åŸºç¡€æ“ä½œ"><a href="#åŸºç¡€æ“ä½œ" class="headerlink" title="åŸºç¡€æ“ä½œ"></a>åŸºç¡€æ“ä½œ</h2><p>ä½¿ç”¨ Docker è¿è¡Œä¸€ä¸ª MySQL å®¹å™¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name my-mysql -e MYSQL_ROOT_PASSWORD&#x3D;1234 -d -v volume_folder -p 3306:3306 mysql:5</span><br></pre></td></tr></table></figure><p>å‘½ä»¤è¡Œç™»å½• MySQL</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it my-mysql bash</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ•°æ®åº“</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> db-<span class="keyword">name</span>;</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºæ•°æ®åº“åˆ—è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br></pre></td></tr></table></figure><p>é€‰æ‹©æ•°æ®åº“</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> dbname;</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºæ•°æ®è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ•°æ®è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`user`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span></span><br><span class="line">(</span><br><span class="line">    <span class="string">`id`</span>                 <span class="built_in">bigint</span>(<span class="number">11</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    <span class="string">`user_id`</span>            <span class="built_in">bigint</span>(<span class="number">11</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç”¨æˆ·id'</span>,</span><br><span class="line">    <span class="string">`username`</span>           <span class="built_in">varchar</span>(<span class="number">45</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'çœŸå®å§“å'</span>,</span><br><span class="line">    <span class="string">`email`</span>              <span class="built_in">varchar</span>(<span class="number">30</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç”¨æˆ·é‚®ç®±'</span>,</span><br><span class="line">    <span class="string">`nickname`</span>           <span class="built_in">varchar</span>(<span class="number">45</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æ˜µç§°'</span>,</span><br><span class="line">    <span class="string">`avatar`</span>             <span class="built_in">int</span>(<span class="number">11</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'å¤´åƒ'</span>,</span><br><span class="line">    <span class="string">`birthday`</span>           <span class="built_in">date</span>         <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç”Ÿæ—¥'</span>,</span><br><span class="line">    <span class="string">`gender`</span>                <span class="built_in">tinyint</span>(<span class="number">4</span>)   <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'æ€§åˆ«'</span>,</span><br><span class="line">    <span class="string">`bio`</span>    <span class="built_in">varchar</span>(<span class="number">150</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ä¸€å¥è¯ä»‹ç»è‡ªå·±ï¼Œæœ€å¤š150ä¸ªæ±‰å­—'</span>,</span><br><span class="line">    <span class="string">`user_resume`</span>        <span class="built_in">varchar</span>(<span class="number">300</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç”¨æˆ·æäº¤çš„ç®€å†å­˜æ”¾åœ°å€'</span>,</span><br><span class="line">    <span class="string">`user_register_ip`</span>   <span class="built_in">int</span>          <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç”¨æˆ·æ³¨å†Œæ—¶çš„æºip'</span>,</span><br><span class="line">    <span class="string">`create_time`</span>        <span class="built_in">timestamp</span>    <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç”¨æˆ·è®°å½•åˆ›å»ºçš„æ—¶é—´'</span>,</span><br><span class="line">    <span class="string">`update_time`</span>        <span class="built_in">timestamp</span>    <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç”¨æˆ·èµ„æ–™ä¿®æ”¹çš„æ—¶é—´'</span>,</span><br><span class="line">    <span class="string">`user_review_status`</span> <span class="built_in">tinyint</span>      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç”¨æˆ·èµ„æ–™å®¡æ ¸çŠ¶æ€ï¼Œ1ä¸ºé€šè¿‡ï¼Œ2ä¸ºå®¡æ ¸ä¸­ï¼Œ3ä¸ºæœªé€šè¿‡ï¼Œ4ä¸ºè¿˜æœªæäº¤å®¡æ ¸'</span>,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">    <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`idx_user_id`</span> (<span class="string">`user_id`</span>),</span><br><span class="line">    <span class="keyword">KEY</span> <span class="string">`idx_username`</span> (<span class="string">`username`</span>),</span><br><span class="line">    <span class="keyword">KEY</span> <span class="string">`idx_create_time`</span> (<span class="string">`create_time`</span>, <span class="string">`user_review_status`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_unicode_ci <span class="keyword">COMMENT</span> =<span class="string">'ç½‘ç«™ç”¨æˆ·åŸºæœ¬ä¿¡æ¯'</span>;</span><br></pre></td></tr></table></figure><p>æ’å…¥æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name ( field1, field2 ) <span class="keyword">VALUES</span> ( value1, value2 );</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name <span class="keyword">SET</span> field1=<span class="number">1</span>,field2=<span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username <span class="keyword">FROM</span> table_name <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">limit</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>æ›´æ–°æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> table_name <span class="keyword">set</span> username=<span class="string">'update'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>åˆ é™¤æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> table_name <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>WHERE æœ‰æ¡ä»¶åœ°ä»è¡¨ä¸­é€‰å–æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> field1, field2,...fieldN <span class="keyword">FROM</span> table_name1, table_name2...</span><br><span class="line">[<span class="keyword">WHERE</span> condition1 [<span class="keyword">AND</span> [<span class="keyword">OR</span>]] condition2.....</span><br></pre></td></tr></table></figure><p>LIKE æœ‰æ¡ä»¶åœ°ä»è¡¨ä¸­é€‰å–æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> field1, field2,...fieldN</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> field1 <span class="keyword">LIKE</span> condition1 [<span class="keyword">AND</span> [<span class="keyword">OR</span>]] filed2 = <span class="string">'somevalue'</span></span><br></pre></td></tr></table></figure><p>UNION è¿æ¥ SELECT è¯­å¥çš„ç»“æœç»„åˆåˆ°ä¸€ä¸ªç»“æœé›†åˆä¸­</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> expression1, expression2, ... expression_n</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">tables</span></span><br><span class="line">[<span class="keyword">WHERE</span> conditions]</span><br><span class="line"><span class="keyword">UNION</span> [<span class="keyword">ALL</span> | <span class="keyword">DISTINCT</span>]</span><br><span class="line"><span class="keyword">SELECT</span> expression1, expression2, ... expression_n</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">tables</span></span><br><span class="line">[<span class="keyword">WHERE</span> conditions];</span><br></pre></td></tr></table></figure><p>JOIN æ ¹æ®ä¸¤ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­çš„åˆ—ä¹‹é—´çš„å…³ç³»ä»ä¸­æŸ¥è¯¢æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Persons.LastName, Persons.FirstName, Orders.OrderNo</span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> Orders</span><br><span class="line"><span class="keyword">ON</span> Persons.Id_P = Orders.Id_P</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> Persons.LastName;</span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾è¡¨ä¸­å¤šä½™çš„é‡å¤è®°å½•ï¼Œé‡å¤è®°å½•æ˜¯æ ¹æ®å•ä¸ªå­—æ®µï¼ˆpeopleIdï¼‰æ¥åˆ¤æ–­</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> people</span><br><span class="line"><span class="keyword">where</span> peopleId <span class="keyword">in</span> (<span class="keyword">select</span> peopleId <span class="keyword">from</span> people <span class="keyword">group</span> <span class="keyword">by</span> peopleId <span class="keyword">having</span> <span class="keyword">count</span>(peopleId) &gt; <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>åˆ é™¤è¡¨ä¸­å¤šä½™çš„é‡å¤è®°å½•ï¼Œé‡å¤è®°å½•æ˜¯æ ¹æ®å•ä¸ªå­—æ®µï¼ˆpeopleIdï¼‰æ¥åˆ¤æ–­</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> people</span><br><span class="line"><span class="keyword">where</span> peopleId <span class="keyword">in</span> (<span class="keyword">select</span> peopleId <span class="keyword">from</span> people <span class="keyword">group</span> <span class="keyword">by</span> peopleId <span class="keyword">having</span> <span class="keyword">count</span>(peopleId) &gt; <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºæ•°æ®è¡¨çš„ç»“æ„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">describe</span> table_name;</span><br></pre></td></tr></table></figure><p>æ·»åŠ åˆ—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="keyword">add</span> åˆ—å åˆ—æ•°æ®ç±»å‹ [<span class="keyword">after</span> æ’å…¥ä½ç½®];</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹åˆ—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="keyword">change</span> åˆ—åç§° åˆ—æ–°åç§° æ–°æ•°æ®ç±»å‹;</span><br></pre></td></tr></table></figure><p>åˆ é™¤åˆ—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="keyword">drop</span> åˆ—åç§°;</span><br></pre></td></tr></table></figure><p>é‡å‘½åè¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="keyword">rename</span> æ–°è¡¨å;</span><br></pre></td></tr></table></figure><p>æ¸…ç©ºæ•°æ®è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> table_name;</span><br></pre></td></tr></table></figure><p>åˆ é™¤æ•°æ®è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> table_name;</span><br></pre></td></tr></table></figure><p>åˆ é™¤æ•°æ®åº“</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> dbname;</span><br></pre></td></tr></table></figure><p>é€€å‡º MySQL</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure><h2 id="SQL-æ‰§è¡Œæµç¨‹"><a href="#SQL-æ‰§è¡Œæµç¨‹" class="headerlink" title="SQL æ‰§è¡Œæµç¨‹"></a>SQL æ‰§è¡Œæµç¨‹</h2><ol><li>å½“å®¢æˆ·ç«¯è¿æ¥åˆ°MySQLæœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨å¯¹å…¶è¿›è¡Œè®¤è¯ã€‚å¯ä»¥é€šè¿‡ç”¨æˆ·åä¸å¯†ç è®¤è¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡SSLè¯ä¹¦è¿›è¡Œè®¤è¯ã€‚ç™»å½•è®¤è¯åï¼ŒæœåŠ¡å™¨è¿˜ä¼šéªŒè¯å®¢æˆ·ç«¯æ˜¯å¦æœ‰æ‰§è¡ŒæŸä¸ªæŸ¥è¯¢çš„æ“ä½œæƒé™ã€‚</li><li>åœ¨æ­£å¼æŸ¥è¯¢ä¹‹å‰ï¼ŒæœåŠ¡å™¨ä¼šæ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœèƒ½æ‰¾åˆ°å¯¹åº”çš„æŸ¥è¯¢ï¼Œåˆ™ä¸å¿…è¿›è¡ŒæŸ¥è¯¢è§£æï¼Œä¼˜åŒ–ï¼Œæ‰§è¡Œç­‰è¿‡ç¨‹ï¼Œç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„ç»“æœé›†ã€‚</li><li>MySQLçš„è§£æå™¨ä¼šæ ¹æ®æŸ¥è¯¢è¯­å¥ï¼Œæ„é€ å‡ºä¸€ä¸ªè§£ææ ‘ï¼Œä¸»è¦ç”¨äºæ ¹æ®è¯­æ³•è§„åˆ™æ¥éªŒè¯è¯­å¥æ˜¯å¦æ­£ç¡®ï¼Œæ¯”å¦‚SQLçš„å…³é”®å­—æ˜¯å¦æ­£ç¡®ï¼Œå…³é”®å­—çš„é¡ºåºæ˜¯å¦æ­£ç¡®ã€‚è€Œé¢„å¤„ç†å™¨ä¸»è¦æ˜¯è¿›ä¸€æ­¥æ ¡éªŒï¼Œæ¯”å¦‚è¡¨åï¼Œå­—æ®µåæ˜¯å¦æ­£ç¡®ç­‰</li><li>æŸ¥è¯¢ä¼˜åŒ–å™¨å°†è§£ææ ‘è½¬åŒ–ä¸ºæŸ¥è¯¢è®¡åˆ’ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€æ¡æŸ¥è¯¢å¯ä»¥æœ‰å¾ˆå¤šç§æ‰§è¡Œæ–¹å¼ï¼Œæœ€ç»ˆè¿”å›ç›¸åŒçš„ç»“æœï¼Œä¼˜åŒ–å™¨å°±æ˜¯æ ¹æ®æˆæœ¬æ‰¾åˆ°è¿™å…¶ä¸­æœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’</li><li>æ‰§è¡Œè®¡åˆ’è°ƒç”¨æŸ¥è¯¢æ‰§è¡Œå¼•æ“ï¼Œè€ŒæŸ¥è¯¢å¼•æ“é€šè¿‡ä¸€ç³»åˆ—APIæ¥å£æŸ¥è¯¢åˆ°æ•°æ®</li><li>å¾—åˆ°æ•°æ®ä¹‹åï¼Œåœ¨è¿”å›ç»™å®¢æˆ·ç«¯çš„åŒæ—¶ï¼Œä¼šå°†æ•°æ®å­˜åœ¨æŸ¥è¯¢ç¼“å­˜ä¸­</li></ol><h2 id="ä½¿ç”¨-MySQL"><a href="#ä½¿ç”¨-MySQL" class="headerlink" title="ä½¿ç”¨ MySQL"></a>ä½¿ç”¨ MySQL</h2><p>ä½¿ç”¨ DataGrip é“¾æ¥ MySQL</p><p><img src="/images/mysql-datagrip.jpg" alt="folder"></p><p>åœ¨ Egg.js ä¸­ä½¿ç”¨ MySQL æ•°æ®åº“</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    sequelize: &#123;</span><br><span class="line">      dialect: <span class="string">'mysql'</span>,</span><br><span class="line">      database: <span class="string">'database-name'</span>,</span><br><span class="line">      host: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">      port: <span class="string">'3306'</span>,</span><br><span class="line">      username: <span class="string">'root'</span>,</span><br><span class="line">      password: <span class="string">'my-secret-pw'</span>,</span><br><span class="line">      pool: &#123;</span><br><span class="line">        max: <span class="number">8</span>, <span class="comment">// æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">        min: <span class="number">0</span>, <span class="comment">// æœ€å°è¿æ¥æ•°</span></span><br><span class="line">        idle: <span class="number">10000</span>, <span class="comment">// connectioné‡Šæ”¾å‰çš„æœ€å¤§ç©ºé—²æ—¶é—´</span></span><br><span class="line">      &#125;,</span><br><span class="line">      timezone: <span class="string">'+08:00'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="MySQL-ç´¢å¼•"><a href="#MySQL-ç´¢å¼•" class="headerlink" title="MySQL ç´¢å¼•"></a>MySQL ç´¢å¼•</h2><p>MySQL å®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼šç´¢å¼•ï¼ˆIndexï¼‰æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ã€‚æ˜¯é’ˆå¯¹è¡¨è€Œå»ºç«‹çš„ï¼Œå®ƒæ˜¯ç”±æ•°æ®é¡µé¢ä»¥å¤–çš„ç´¢å¼•é¡µé¢ç»„æˆï¼Œæ¯ä¸ªç´¢å¼•é¡µä¸­çš„è¡Œéƒ½å«æœ‰é€»è¾‘æŒ‡é’ˆï¼Œä»¥ä¾¿åŠ é€Ÿæ£€ç´¢ç‰©ç†æ•°æ®ï¼Œåˆ›å»ºç´¢å¼•çš„ç›®çš„åœ¨äºæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p><p>MyISAM</p><p>MyISAM å¼•æ“ä½¿ç”¨ B+Tree ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œå¶èŠ‚ç‚¹çš„dataåŸŸå­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€ã€‚MyISAM ä¸­ç´¢å¼•æ£€ç´¢çš„ç®—æ³•ä¸ºé¦–å…ˆæŒ‰ç…§ B+Tree æœç´¢ç®—æ³•æœç´¢ç´¢å¼•ï¼Œå¦‚æœæŒ‡å®šçš„ Key å­˜åœ¨ï¼Œåˆ™å–å‡ºå…¶ data åŸŸçš„å€¼ï¼Œç„¶åä»¥ data åŸŸçš„å€¼ä¸ºåœ°å€ï¼Œè¯»å–ç›¸åº”æ•°æ®è®°å½•ã€‚MyISAMçš„ç´¢å¼•æ–¹å¼ä¹Ÿå«åšâ€œéèšé›†â€çš„ï¼Œä¹‹æ‰€ä»¥è¿™ä¹ˆç§°å‘¼æ˜¯ä¸ºäº†ä¸InnoDBçš„èšé›†ç´¢å¼•åŒºåˆ†ã€‚</p><p>InnoDB</p><p>åœ¨ InnoDB ä¸­ï¼Œè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰B+Treeç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æ„ï¼Œè¿™æ£µæ ‘çš„å¶èŠ‚ç‚¹dataåŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ä¸ªç´¢å¼•çš„keyæ˜¯æ•°æ®è¡¨çš„ä¸»é”®ï¼Œå› æ­¤InnoDBè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸»ç´¢å¼•ã€‚InnoDB çš„è¾…åŠ©ç´¢å¼• data åŸŸå­˜å‚¨ç›¸åº”è®°å½•ä¸»é”®çš„å€¼è€Œä¸æ˜¯åœ°å€ã€‚</p><p>åˆ›å»ºä½¿ç”¨ç´¢å¼•çš„åŸåˆ™</p><p>1ã€ç´¢å¼•å°½é‡å°‘ï¼Œç´¢å¼•è¿‡å¤šï¼Œå½±å“å†™é€Ÿåº¦<br>2ã€å»ºç«‹ç´¢å¼•å°½é‡æ»¡è¶³å·¦åŒ¹é…ï¼Œç´¢å¼•åªèƒ½å‘½ä¸­æœ€å·¦è¾¹çš„èŒƒå›´æŸ¥è¯¢ï¼Œæ¯”å¦‚å­˜åœ¨ç´¢å¼•idx_a_b_c_d,  æŸ¥è¯¢å¦‚select * from table where a=1 and b=2 and c&gt;3 and d&lt;4ï¼Œåˆ™åªèƒ½ç”¨åˆ°a,b,c<br>3ã€ä½¿ç”¨explainæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œéœ€æ±‚æ‰€æœ‰çš„æŸ¥è¯¢è‡³å°‘åˆ°è¾¾rangeçº§åˆ«<br>4ã€åŒºåˆ†åº¦ä¸é«˜çš„å­—æ®µä¸å»ºç´¢å¼•ï¼Œæ¯”å¦‚æ€§åˆ«ï¼Œåªæœ‰ç”·å’Œå¥³ï¼Œè¿™ç§å­—æ®µä¸éœ€è¦å»ºç´¢å¼•<br>5ã€è¡¨å¿…é¡»æœ‰ä¸»é”®ç´¢å¼•ï¼ŒPRIMARY KEY (<code>id</code>)<br>6ã€å»ºç«‹ç´¢å¼•æ—¶ï¼ŒæŠŠåŒºåˆ†åº¦é«˜çš„å­—æ®µæ”¾åœ¨å‰é¢</p><h2 id="å»ºè¡¨ä¸‰èŒƒå¼"><a href="#å»ºè¡¨ä¸‰èŒƒå¼" class="headerlink" title="å»ºè¡¨ä¸‰èŒƒå¼"></a>å»ºè¡¨ä¸‰èŒƒå¼</h2><ol><li>è¦æ±‚æœ‰ä¸»é”®ï¼Œå¹¶ä¸”è¦æ±‚æ¯ä¸€ä¸ªå­—æ®µåŸå­æ€§ä¸å¯å†åˆ†</li><li>ç¬¬ä¸€èŒƒå¼åŸºç¡€ä¸Šï¼Œè¦æ±‚æ‰€æœ‰éä¸»é”®å­—æ®µå®Œå…¨ä¾èµ–ä¸»é”®ï¼Œä¸èƒ½äº§ç”Ÿéƒ¨åˆ†ä¾èµ–</li><li>åœ¨ç¬¬äºŒèŒƒå¼åŸºç¡€ä¸Šï¼Œæ‰€æœ‰éä¸»é”®å­—æ®µå’Œä¸»é”®å­—æ®µä¹‹é—´ä¸èƒ½äº§ç”Ÿä¼ é€’ä¾èµ–</li></ol><h2 id="å»ºè¡¨è§„èŒƒ"><a href="#å»ºè¡¨è§„èŒƒ" class="headerlink" title="å»ºè¡¨è§„èŒƒ"></a>å»ºè¡¨è§„èŒƒ</h2><p>å‘½åè§„èŒƒ</p><ul><li>è¡¨åä¸ä½¿ç”¨å¤æ•°åè¯</li><li>åº“åã€è¡¨åã€å­—æ®µåä½¿ç”¨å°å†™å­—æ¯ï¼Œä¸‹åˆ’çº¿ â€œ_â€ åˆ†å‰²</li><li>åº“åã€è¡¨åã€å­—æ®µåä¸è¶…è¿‡ 12 ä¸ªå­—ç¬¦</li><li>è¡¨åä¸ä½¿ç”¨å¤æ•°åè¯</li><li>åº“åã€è¡¨åã€å­—æ®µåè§åçŸ¥æ„, å°½é‡ä½¿ç”¨åè¯ä¸æ˜¯åŠ¨è¯</li><li>ä¸ä½¿ç”¨æ•°æ®åº“ä¿ç•™å­—æ¯”å¦‚ï¼škeyï¼Œdescï¼Œdeleteï¼Œorderâ€¦â€¦</li><li>è¡¨çš„å‘½åä½¿ç”¨ â€œç»Ÿä¸€å‰ç¼€_ä¸šåŠ¡åç§°_è¡¨çš„ä½œç”¨â€ æ¨¡å¼ï¼Œå¦‚ï¼štb_plan, tb_task, tb_target</li></ul><p>è®¾è®¡è§„èŒƒ</p><ul><li>ä½¿ç”¨å¸ƒå°”å€¼ç±»å‹å­˜å‚¨æ˜¯/å¦ç±»å­—æ®µ</li><li>ç¦æ­¢åœ¨è¡¨ä¸­å»ºç«‹é¢„ç•™å­—æ®µ</li><li>æ‰€æœ‰è¡¨å’Œå­—æ®µéƒ½éœ€æ·»åŠ æ³¨é‡Š</li><li>ç¦æ­¢åœ¨æ•°æ®åº“å­˜å‚¨å›¾ç‰‡ã€æ–‡ä»¶ç­‰äºŒè¿›åˆ¶æ•°æ®</li><li>å­˜å‚¨å¼•æ“é€‰æ‹© InnoDBï¼Œè¡¨å­—ç¬¦é›†é€‰æ‹© utf8mb4</li><li>å°†å¤§å­—æ®µæ‹†åˆ†å€¼å…¶ä»–è¡¨ä¸­</li><li>å­—æ®µå°å†™å‘½åï¼Œç¦æ­¢å‡ºç°å¤§å†™</li><li>å°½å¯èƒ½æŠŠæ‰€æœ‰åˆ—å®šä¹‰ä¸º NOT NULLï¼Œå› ä¸º NULL åœ¨ MySQL ä¸­å¾—ç‰¹æ®Šå¤„ç†ã€å¾ˆéš¾ä¼˜åŒ–</li><li>ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°æ•°æ®ç±»å‹</li><li>å¯¹äºéè´Ÿæ•´æ•°ï¼Œä¼˜å…ˆä½¿ç”¨æ— ç¬¦å·æ•´å‹å­˜å‚¨ï¼ˆidï¼‰</li><li>é¿å…ä½¿ç”¨ TEXTã€BLOB æ•°æ®ç±»å‹ï¼Œéç”¨ä¸å¯çš„æƒ…å†µï¼Œå¯ä»¥æŠŠ BLOB å’Œ TEXT æ‹†åˆ†åˆ°å•ç‹¬çš„æ‹“å±•è¡¨ä¸­</li><li>ä½¿ç”¨ TIMESTAMP æˆ– DATETIME ç±»å‹å­˜å‚¨æ—¶é—´<ul><li>TIMESTAMPï¼ˆ4BYTEï¼‰1970-01-01 00:00:01 - 2038-01-19 03:14:07</li><li>DATETIMEï¼ˆ8BYTEï¼‰1000-01-01 00:00:00â€™ -  9999-12-31 23:59:59</li></ul></li><li>ç”¨ decimal æ¥å­˜å‚¨é‡‘é¢å­—æ®µï¼Œä¸è¦ç”¨ float å’Œ doubleï¼Œä¼šå‡ºç°æ•°æ®ç²¾åº¦ä¸¢å¤±</li><li>ä½¿ç”¨ INT UNSIGNED å­˜å‚¨ IPï¼ŒIP è½¬æ•°å­—å‡½æ•° inet_aton()ã€æ•°å­—è½¬ IP å‡½æ•° inet_ntoa()</li><li>VARCHAR(N) ä¸­çš„ N è¡¨ç¤ºå­—ç¬¦æ•°(ä¸æ˜¯å­—èŠ‚æ•°ã€æ¯”å¦‚ VARCHAR(N) èƒ½å­˜å‚¨ N ä¸ªæ±‰å­—)ã€æ»¡è¶³éœ€æ±‚çš„æƒ…å†µä¸‹ N è¶Šå°è¶Šå¥½ã€æœ€å¤§é•¿åº¦65535ä¸ªå­—èŠ‚</li><li>å¯¹äºå®šé•¿çš„å­—ç¬¦ç±»å‹ã€æ¯”å¦‚å¯†ç  MD5 å€¼ç­‰ã€å»ºè®®ç”¨ char ç±»å‹ï¼Œæ•ˆç‡å¯ä»¥å¾—åˆ°æå‡</li></ul><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><ul><li>Optimize Your Queries For the Query Cache</li><li>EXPLAIN Your SELECT Queries</li><li>LIMIT 1 When Getting a Unique Row</li><li>Index the Search Fields</li><li>Index and Use Same Column Types for Joins</li><li>Avoid SELECT *</li><li>Almost Always Have an id Field</li><li>Use ENUM over VARCHAR</li><li>Get Suggestions with PROCEDURE ANALYSE()</li><li>Use NOT NULL If You Can</li><li>Prepared Statements</li><li>Unbuffered Queries</li><li>Fixed-length(Static) Tables are Faster</li><li>Vertical Partitioning</li><li>Split the Big DELETE or INSERT Queries</li><li>Smaller Columns Are Faster</li><li>Choose the Right Storage Engine</li><li>Use an Object Relational Mapper</li><li>åœ¨ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„éœ€è¦ï¼Œè¯·æ°¸è¿œä½¿ç”¨ä¸€ä¸ªä¸ä¸šåŠ¡æ— å…³çš„è‡ªå¢å­—æ®µä½œä¸ºä¸»é”®ã€‚</li><li>ç¦æ­¢ä»å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒç›´è¿ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://www.runoob.com/mysql/mysql-tutorial.html" target="_blank" rel="noopener">MySQL æ•™ç¨‹</a></p><p><a href="https://www.kancloud.cn/xuying/sql/269824" target="_blank" rel="noopener">æ•°æ®åº“ç»éªŒå°ç»“</a></p><p><a href="https://github.com/jaywcjlove/mysql-tutorial/blob/master/21-minutes-MySQL-basic-entry.md" target="_blank" rel="noopener">21åˆ†é’ŸMySQLåŸºç¡€å…¥é—¨</a></p><p><a href="https://www.jianshu.com/p/3e97c2a1687b" target="_blank" rel="noopener">MySqlâ€“æ•°æ®åº“è®¾è®¡ä¸‰èŒƒå¼</a></p><p><a href="http://blog.codinglabs.org/articles/theory-of-mysql-index.html" target="_blank" rel="noopener">MySQLç´¢å¼•èƒŒåçš„æ•°æ®ç»“æ„åŠç®—æ³•åŸç†</a></p><p><a href="https://www.cnblogs.com/enein/archive/2012/11/29/2794896.html" target="_blank" rel="noopener">Top 20+ MySQL Best Practices(20æ¡MySQLæœ€ä½³å®è·µ)</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å·¥ä½œéœ€æ±‚å­¦ä¹ ä¸€ä¸‹ MySQL æ•°æ®åº“&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="MySQL" scheme="https://coldstone.fun/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Codemagic æŒç»­éƒ¨ç½² Flutter åº”ç”¨</title>
    <link href="https://coldstone.fun/post/2020/02/03/flutter-cicd/"/>
    <id>https://coldstone.fun/post/2020/02/03/flutter-cicd/</id>
    <published>2020-02-03T14:36:16.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>Codemagic æŒç»­éƒ¨ç½² Flutter åº”ç”¨</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²èƒ½å¤Ÿè‡ªåŠ¨åŒ–åº”ç”¨å¼€å‘çš„æµ‹è¯•ï¼Œæ„å»ºå’Œéƒ¨ç½²è¿‡ç¨‹ï¼Œå¦‚æœåœ¨åº”ç”¨å¼€å‘åˆæœŸè§£å†³äº†è¿™ä¸ªé—®é¢˜æ— ç–‘æå‡åº”ç”¨çš„å¼€å‘ï¼Œäº¤ä»˜æ•ˆç‡ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Codemagic"><a href="#ä»€ä¹ˆæ˜¯-Codemagic" class="headerlink" title="ä»€ä¹ˆæ˜¯ Codemagic"></a>ä»€ä¹ˆæ˜¯ <code>Codemagic</code></h2><p><a href="https://codemagic.io" target="_blank" rel="noopener">Codemagic</a> æ˜¯ä¸€ä¸ªä¸º <code>Flutter</code> é¡¹ç›®ä»¥åŠå…¶å®ƒç§»åŠ¨ç«¯é¡¹ç›®æä¾› CI/CD æœåŠ¡çš„å¹³å°ã€‚</p><p>å¯ä»¥ä½¿ç”¨ Github è´¦å·æ³¨å†Œç™»å½•ï¼Œç™»å½•åå®ƒä¼šè¦æ±‚è·å¾—ä½ ä»“åº“çš„è¯»/å†™æƒé™ï¼Œç„¶ååœ¨ <a href="https://codemagic.io/apps" target="_blank" rel="noopener">apps</a> é¡µé¢æ˜¾ç¤ºä½ éœ€è¦è¿›è¡Œæ„å»ºçš„é¡¹ç›®ã€‚</p><p><img src="./images/code-apps.jpg" alt="code-apps"></p><h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨-Codemagic"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨-Codemagic" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ Codemagic"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ <code>Codemagic</code></h2><p>å¥½çš„ <code>CI/CD</code> æœ‰åŠ©äºæ›´å¿«åœ°æ„å»ºï¼Œæµ‹è¯•ä»¥åŠéƒ¨ç½²å‘å¸ƒåº”ç”¨ã€‚åœ¨ <code>Flutter</code> çš„å®˜æ–¹æ–‡æ¡£ <a href="https://flutter.cn/docs/deployment/cd" target="_blank" rel="noopener">Flutter é‡Œçš„æŒç»­éƒ¨ç½²</a> é‡Œä»‹ç»äº†ä½¿ç”¨ <code>fastlane</code> å·¥å…·è¿›è¡Œæœ¬åœ°éƒ¨ç½²ä»¥åŠå¦‚ä½•å°† <code>fastlane</code> æ•´åˆåˆ° <code>Travis</code>ï¼Œ<code>Cirrus</code>ï¼Œ<code>Bitrise</code> ç­‰æŒç»­äº¤ä»˜çš„æœåŠ¡ä¸­ï¼Œä½†æ˜¯å¯¹äº <code>Flutter</code> é¡¹ç›®æ¥è¯´æœ€æ–¹ä¾¿çš„ <code>CI/CD</code> æœåŠ¡åº”è¯¥è¿˜æ˜¯ <code>Codemagic</code>ï¼Œå®ƒå¯ä»¥ç›´æ¥åœ¨ç½‘é¡µä¸Šå°±é…ç½®å‡ºå®Œæ•´çš„åº”ç”¨äº¤ä»˜æµç¨‹ã€‚</p><h2 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h2><p>é€‰æ‹©éœ€è¦æ„å»ºçš„ <code>Fluter</code> é¡¹ç›®ï¼Œç‚¹å‡» <code>Start your first build</code> æŒ‰é’®ï¼Œåˆ›å»ºä¸€ä¸ªå·¥ä½œæµç¨‹ <code>Workflow</code>ã€‚<br>ä¸€ä¸ª <code>Workflow</code> æŒ‡çš„æ˜¯æ¯æ¬¡æ„å»ºè¦åšçš„ä»»åŠ¡ï¼Œå¦‚æ‰§è¡Œæ„å»ºï¼Œæµ‹è¯•ä»¥åŠå‘å¸ƒä»»åŠ¡ã€‚</p><p>å¯¹äº <code>Flutter</code> é¡¹ç›®å¯ä»¥åœ¨ç½‘é¡µä¸Šé…ç½®æˆ–ä½¿ç”¨ <code>codemagic.yaml</code> é…ç½®æ–‡ä»¶ï¼Œå…¶å®ƒé¡¹ç›®åªèƒ½ä½¿ç”¨ <code>codemagic.yaml</code> é…ç½®ã€‚</p><p><img src="./images/workflow.jpg" alt="workflow"></p><p>ä¸€ä¸ª <code>Workflow</code> ç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆ</p><ol><li><code>Build triggers</code> â€“&gt; æŒ‡å®šçš„æ„å»ºåˆ†æ”¯å’Œè§¦å‘æ„å»ºçš„æ—¶æœº</li></ol><p><img src="./images/build-triggers.jpg" alt="build-triggers"></p><ol start="2"><li><code>Environment variables</code> â€“&gt; è®¾ç½®æ„å»ºæ—¶çš„ç¯å¢ƒå˜é‡</li></ol><p><img src="https://docs.codemagic.io/uploads/env_vars.PNG" alt="env_vars"></p><ol start="3"><li><code>Dependency caching</code> â€“&gt; è®¾ç½®æ„å»ºæ—¶çš„ä¾èµ–ç¼“å­˜æ–‡ä»¶ç›®å½•ï¼ŒåŠ å¿«æ„å»ºé€Ÿåº¦</li></ol><p><img src="https://docs.codemagic.io/uploads/2019/04/caching_enabled.PNG" alt="caching"></p><ol start="4"><li><code>Test</code> â€“&gt; æ‰§è¡Œåº”ç”¨çš„å•å…ƒï¼Œé›†æˆå’Œéƒ¨ä»¶æµ‹è¯•ï¼Œä»¥åŠé™æ€ä»£ç åˆ†æ</li></ol><p><img src="./images/code-test.jpg" alt="code-test"></p><ol start="5"><li><code>Build</code> â€“&gt; é…ç½®åº”ç”¨æ„å»ºæ—¶çš„ Flutter ç‰ˆæœ¬ï¼Œæ„å»ºç›®æ ‡ï¼Œæ„å»ºå‚æ•°</li></ol><p><img src="./images/code-build.jpg" alt="code-build"></p><ol start="6"><li><code>Publish</code> â€“&gt; é€‰æ‹©éœ€è¦å‘å¸ƒåº”ç”¨çš„ç›®æ ‡ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©äº† <code>Google play</code></li></ol><p><img src="./images/code-publish.jpg" alt="code-publish"></p><h2 id="ä»£ç ç­¾å"><a href="#ä»£ç ç­¾å" class="headerlink" title="ä»£ç ç­¾å"></a>ä»£ç ç­¾å</h2><p>è¦å°†åº”ç”¨å‘å¸ƒåˆ° <code>Apple store</code> æˆ–è€… <code>Goople play</code> ä¸Šå°±å¿…é¡»å¯¹ä½ çš„åº”ç”¨è¿›è¡Œä»£ç ç­¾åï¼Œä»£ç ç­¾åç›®çš„æ˜¯ä¸ºäº†è¯†åˆ«è°å¼€å‘äº†è¯¥åº”ç”¨ç¨‹åºï¼Œå¹¶ç¡®ä¿è¯¥åº”ç”¨ç¨‹åºçš„æ‰€æœ‰æ›´æ–°å‡æ¥è‡ªè¿™ä¸ªäººã€‚</p><p>å¯¹äº Android æ¥è¯´æœ‰ä¸¤ç§ç­¾åï¼šå‘å¸ƒç­¾åå’Œä¸Šä¼ ç­¾åã€‚æœ€ç»ˆç”¨æˆ·ä¸‹è½½çš„ <code>.aab/.apk</code> æ–‡ä»¶ä½¿ç”¨å‘å¸ƒç­¾åã€‚ä¸Šä¼ ç­¾åæä¾›ç»™å¼€å‘è€…ä¸Šä¼ åˆ° <code>Google Play</code> å•†åº—çš„è®¤è¯ã€‚ä¸Šä¼ åï¼Œ<code>Google Play</code> ä¼šé‡æ–°ä½¿ç”¨å‘å¸ƒç­¾åå¯¹ <code>.aab/.apk</code> æ–‡ä»¶ç­¾åã€‚</p><p>åœ¨é…ç½® <code>Workflow</code> æ—¶ï¼Œæˆ‘é€‰æ‹©å‘å¸ƒåˆ° <code>Goople play</code> æ‰€ä»¥éœ€è¦å¯¹ Android åº”ç”¨è¿›è¡Œä»£ç ç­¾åï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼è¿›è¡Œç­¾åï¼Œé€‰æ‹©å…¶ä¸€å³å¯ã€‚</p><ol><li>ä½¿ç”¨ <code>Android Studio</code> <a href="https://developer.android.google.cn/studio/publish/app-signing#sign-apk" target="_blank" rel="noopener">ä¸ºæ‚¨çš„åº”ç”¨ç­¾å</a></li><li>ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·è¿›è¡Œç­¾å <a href="https://flutter.cn/docs/deployment/android#signing-the-app" target="_blank" rel="noopener">ä¸º app ç­¾å</a></li></ol><p>ç­¾ååéœ€è¦åšçš„æ˜¯æŠŠç­¾åä¿¡æ¯å­˜åˆ°å·¥ä½œæµç¨‹ <code>Workflow</code> å†…ï¼Œ<a href="https://docs.codemagic.io/code-signing/android-code-signing/" target="_blank" rel="noopener">Android code signing</a>ã€‚</p><h2 id="åˆ›å»º-Service-Account"><a href="#åˆ›å»º-Service-Account" class="headerlink" title="åˆ›å»º Service Account"></a>åˆ›å»º <code>Service Account</code></h2><p><code>Service Account</code> æ˜¯ç»™ <code>CI/CD</code> å¹³å°å‘å¸ƒæ„å»ºååº”ç”¨ç”¨çš„ï¼Œæ ¹æ®æŒ‡å¼•åˆ›å»º <a href="https://docs.codemagic.io/publishing/publishing-to-google-play/#setting-up-a-service-account-in-google-play-console" target="_blank" rel="noopener">Setting up a service account in Google Play Console</a>ï¼Œåˆ›å»ºåéœ€åšçš„ä¸Šä¼ ä½ çš„å‡­è¯ JSON æ–‡ä»¶</p><p><img src="./images/code-google-play.jpg" alt="code-google-play"></p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><ol><li>åœ¨ä½¿ç”¨ <code>CI/CD</code> æœåŠ¡å‰é¦–å…ˆè¦äººå·¥çš„ä¸Šä¼ åº”ç”¨åˆ° <code>Google Play</code> ä¸€æ¬¡ã€‚</li><li>æ¯æ¬¡ä¸Šä¼ åˆ° <code>Google Play</code> çš„åº”ç”¨æ„å»ºç‰ˆæœ¬ä¸èƒ½é‡å¤ï¼Œå¦åˆ™ä¼šé‡åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Google Play responded with: APK specifies a version code that has already been used.</span><br></pre></td></tr></table></figure><p>æœç´¢ä¸€ç•ªåå‘ç°é—®é¢˜æ˜¯åº”ç”¨æ„å»ºçš„ç‰ˆæœ¬å·é‡å¤ï¼Œéœ€è¦æ›´æ–° <code>pubspec.yaml</code> æ–‡ä»¶çš„ <code>version</code> å­—æ®µçš„å€¼ï¼Œè¯¦ç»†è¯´æ˜å¯ä»¥æŸ¥é˜…è¿™ç¯‡æ–‡ç«  <a href="https://flutter.cn/docs/deployment/android#updating-the-apps-version-number" target="_blank" rel="noopener">æ›´æ–°åº”ç”¨ç‰ˆæœ¬å·</a></p><ol start="3"><li>ä¸Šä¼  <code>Google Play</code> éœ€è¦æ·»åŠ ä¸€ä¸ªç¯å¢ƒå˜é‡ <code>FCI_KEYSTORE_FILE</code>ï¼Œè¿™ä¸ªå˜é‡éœ€è¦ç”¨ base64 encode ä¸€ä¸‹ï¼Œéœ€è¦ç”¨åˆ°çš„å‘½ä»¤æ˜¯</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">base64 input-file-path -o output.txt</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä½¿ç”¨ <code>Codemagic</code> å‘å¸ƒ Flutter åº”ç”¨çš„æµç¨‹å¤§è‡´å¦‚ä¸‹</p><ol><li>é€‰æ‹©æ„å»ºé¡¹ç›®</li><li>é…ç½®æ„å»ºæµç¨‹</li><li>è¿›è¡Œä»£ç ç­¾å</li><li>åˆ›å»º Service Account</li><li>è§¦å‘æ„å»º</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://blog.codemagic.io/getting-started-with-codemagic/" target="_blank" rel="noopener">å°é¢å›¾ç‰‡åœ°å€</a></p><p><a href="https://flutter.cn/docs/deployment/cd" target="_blank" rel="noopener">Flutter é‡Œçš„æŒç»­éƒ¨ç½²</a></p><p><a href="https://docs.codemagic.io/" target="_blank" rel="noopener">Codemagic Documentation</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Codemagic æŒç»­éƒ¨ç½² Flutter åº”ç”¨&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
      <category term="Codemagic" scheme="https://coldstone.fun/tags/Codemagic/"/>
    
      <category term="Google Play" scheme="https://coldstone.fun/tags/Google-Play/"/>
    
  </entry>
  
  <entry>
    <title>ä¸º Flutter åº”ç”¨æ·»åŠ æœç´¢åŠŸèƒ½</title>
    <link href="https://coldstone.fun/post/2020/01/26/flutter-show-search/"/>
    <id>https://coldstone.fun/post/2020/01/26/flutter-show-search/</id>
    <published>2020-01-26T09:34:54.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨ <code>SearchDelegate</code> ç»™ Flutter åº”ç”¨æ·»åŠ æœç´¢åŠŸèƒ½</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><code>SearchDelegate</code> æ˜¯ Flutter æ¡†æ¶æä¾›çš„ä¸€ä¸ªå®ç°æœç´¢åŠŸèƒ½çš„ç±»ï¼Œä½¿ç”¨å®ƒå¯ä»¥å¿«é€Ÿå®ç°æœç´¢åŠŸèƒ½ï¼Œæœ¬æ–‡è¯´æ˜å¦‚ä½•ä½¿ç”¨å®ƒæ¥å®ç°æœç´¢åŠŸèƒ½ã€‚</p><p>æœ€ç»ˆæ•ˆæœå¦‚ä¸‹</p><div>  <video src="videos/show_search.mov" controls width="240" autoplay muted loop /></div><p>åˆ›å»ºæ–°é¡¹ç›®ï¼Œåˆå§‹åŒ–ä»£ç å¦‚ä¸‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">'Search App'</span>,</span><br><span class="line">      home: HomePage(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'Search App'</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ˜¾ç¤ºæœç´¢é¡µé¢"><a href="#æ˜¾ç¤ºæœç´¢é¡µé¢" class="headerlink" title="æ˜¾ç¤ºæœç´¢é¡µé¢"></a>æ˜¾ç¤ºæœç´¢é¡µé¢</h2><p><code>showSearch</code> æ–¹æ³•æ˜¯ Flutter é‡Œç”¨æ¥æ˜¾ç¤ºä¸€ä¸ªæœç´¢é¡µé¢çš„æ–¹æ³•ï¼Œè¿™ä¸ªé¡µé¢ç”±ä¸€ä¸ªå¸¦æœ‰æœç´¢æ¡†çš„ <code>AppBar</code> å’Œæ˜¾ç¤ºæœç´¢å»ºè®®æˆ–æœç´¢ç»“æœçš„ <code>body</code> ç»„æˆã€‚å®ƒæœ‰ä¸¤ä¸ªå¿…è¦å‚æ•° <code>context</code> å’Œ <code>delegate</code>ï¼Œ<code>context</code> å³ä¸ºå½“å‰çš„åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œ<code>delegate</code> æ˜¯ä¸€ä¸ªå®ç°äº† <code>SearchDelegate</code> æŠ½è±¡ç±»è‡ªå®šä¹‰çš„éƒ¨ä»¶ï¼Œè¿™ä¸ªè‡ªå®šä¹‰éƒ¨ä»¶å®šä¹‰äº†å¦‚ä½•æ˜¾ç¤ºæœç´¢é¡µé¢ï¼Œå…³é—­æœç´¢é¡µé¢æ—¶è¿”å›ç”¨æˆ·é€‰æ‹©çš„æœç´¢ç»“æœã€‚</p><p>åœ¨ <code>AppBar</code> çš„ <code>actions</code> æ•°ç»„é‡Œé¢æ·»åŠ ä¸€ä¸ª <code>IconButton</code>ï¼ŒæŒ‰ä¸‹æ—¶è°ƒç”¨ <code>showSearch</code> æ–¹æ³•ï¼Œè¿›å…¥æœç´¢é¡µé¢ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'Search App'</span>),</span><br><span class="line">        actions: &lt;Widget&gt;[</span><br><span class="line">          IconButton(</span><br><span class="line">            icon: Icon(Icons.search),</span><br><span class="line">            onPressed: () &#123;</span><br><span class="line">              showSearch(context: context, delegate: CustomSearchDelegate());</span><br><span class="line">            &#125;,</span><br><span class="line">          )</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–ä¸€ä¸ªç»§æ‰¿äº† <code>SearchDelegate</code> çš„ <code>CustomSearchDelegate</code>ï¼Œç±»çš„åå­—æ˜¯è‡ªå®šä¹‰çš„ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomSearchDelegate</span> <span class="keyword">extends</span> <span class="title">SearchDelegate</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">List</span>&lt;Widget&gt; buildActions(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement buildActions</span></span><br><span class="line">    <span class="keyword">throw</span> UnimplementedError();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget buildLeading(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement buildLeading</span></span><br><span class="line">    <span class="keyword">throw</span> UnimplementedError();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget buildResults(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement buildResults</span></span><br><span class="line">    <span class="keyword">throw</span> UnimplementedError();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget buildSuggestions(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement buildSuggestions</span></span><br><span class="line">    <span class="keyword">throw</span> UnimplementedError();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®ç°-CustomSearchDelegate"><a href="#å®ç°-CustomSearchDelegate" class="headerlink" title="å®ç° CustomSearchDelegate"></a>å®ç° <code>CustomSearchDelegate</code></h2><p>è‡ªå®šä¹‰çš„ <code>CustomSearchDelegate</code> éœ€è¦å®ç°å››ä¸ªæ–¹æ³•</p><ul><li><code>buildLeading</code>     æ˜¾ç¤ºåœ¨è¾“å…¥æ¡†ä¹‹å‰çš„éƒ¨ä»¶ï¼Œä¸€èˆ¬æ˜¾ç¤ºè¿”å›å‰ä¸€ä¸ªé¡µé¢ç®­å¤´æŒ‰é’®</li><li><code>buildActions</code>     æ˜¾ç¤ºåœ¨è¾“å…¥æ¡†ä¹‹åçš„éƒ¨ä»¶</li><li><code>buildResults</code>     æ˜¾ç¤ºæœç´¢ç»“æœ</li><li><code>buildSuggestions</code> æ˜¾ç¤ºæœç´¢å»ºè®®</li></ul><p>å…ˆå®ç° <code>buildActions</code> å’Œ <code>buildLeading</code>ï¼Œ<code>buildActions</code> æ˜¾ç¤ºä¸€ä¸ªæ¸…é™¤æŒ‰é’®ï¼Œå¯ä»¥æŠŠå½“å‰çš„ <code>query</code> æŸ¥è¯¢å‚æ•°æ¸…ç©ºï¼Œå¹¶æ˜¾ç¤ºæœç´¢å»ºè®®ã€‚<code>buildLeading</code> æ˜¾ç¤ºä¸€ä¸ªç®­å¤´çš„æŒ‰é’®ï¼Œä½¿ç”¨ <code>close</code> æ–¹æ³•å…³é—­æœç´¢é¡µé¢ï¼Œ<code>close</code> æ–¹æ³•ç¬¬äºŒä¸ªå‚æ•°æ˜¯é€‰å®šçš„æœç´¢ç»“æœï¼Œå¦‚æœä½¿ç”¨ç³»ç»Ÿåé€€æŒ‰é’®å…³é—­æœç´¢é¡µé¢ï¼Œåˆ™è¿”å› <code>null</code> å€¼ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span>&lt;Widget&gt; buildActions(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    IconButton(</span><br><span class="line">      tooltip: <span class="string">'Clear'</span>,</span><br><span class="line">      icon: <span class="keyword">const</span> Icon(Icons.clear),</span><br><span class="line">      onPressed: () &#123;</span><br><span class="line">        query = <span class="string">''</span>;</span><br><span class="line">        showSuggestions(context);</span><br><span class="line">      &#125;,</span><br><span class="line">    )</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget buildLeading(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> IconButton(</span><br><span class="line">    tooltip: <span class="string">'Back'</span>,</span><br><span class="line">    icon: AnimatedIcon(</span><br><span class="line">      icon: AnimatedIcons.menu_arrow,</span><br><span class="line">      progress: transitionAnimation,</span><br><span class="line">    ),</span><br><span class="line">    onPressed: () &#123;</span><br><span class="line">      close(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget buildResults(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> ListView();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget buildSuggestions(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> ListView();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="images/search_01.png" width="240" style="width: 240px;"><p>ç„¶åå®ç° <code>buildResults</code> å’Œ <code>buildSuggestions</code>ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ç”¨æ¥å±•ç¤ºæœç´¢é¡µé¢å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„éƒ¨æ˜¾ç¤ºï¼Œè¿™é‡Œä½¿ç”¨ <code>ListView</code> éƒ¨ä»¶ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget buildResults(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> ListView.builder(</span><br><span class="line">    itemCount: Random().nextInt(<span class="number">10</span>),</span><br><span class="line">    itemBuilder: (context, index) &#123;</span><br><span class="line">      <span class="keyword">return</span> ListTile(</span><br><span class="line">        title: Text(<span class="string">'result <span class="subst">$index</span>'</span>),</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget buildSuggestions(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> ListView(</span><br><span class="line">    children: &lt;Widget&gt;[</span><br><span class="line">      ListTile(title: Text(<span class="string">'Suggest 01'</span>)),</span><br><span class="line">      ListTile(title: Text(<span class="string">'Suggest 02'</span>)),</span><br><span class="line">      ListTile(title: Text(<span class="string">'Suggest 03'</span>)),</span><br><span class="line">      ListTile(title: Text(<span class="string">'Suggest 04'</span>)),</span><br><span class="line">      ListTile(title: Text(<span class="string">'Suggest 05'</span>)),</span><br><span class="line">    ],</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœç´¢ç»“æœ</p><img src="images/search_result.png" width="240" style="width: 240px;"><p>æœç´¢å»ºè®®</p><img src="images/search_suggestion.png" width="240" style="width: 240px;"><h2 id="è·å–è¿œç¨‹æ•°æ®"><a href="#è·å–è¿œç¨‹æ•°æ®" class="headerlink" title="è·å–è¿œç¨‹æ•°æ®"></a>è·å–è¿œç¨‹æ•°æ®</h2><p>æœç´¢åŠŸèƒ½ä¸€èˆ¬éœ€è¦è¯·æ±‚åç«¯çš„æœç´¢æ¥å£æ¥è·å–æ•°æ®ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ <code>FutureBuilder</code> éƒ¨ä»¶æ¥è¯·æ±‚æ•°æ®ç„¶åæ¸²æŸ“ç»“æœã€‚é¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªè¯·æ±‚æ¥å£çš„æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª <code>Future</code>ï¼Œç„¶ååœ¨ <code>buildResults</code> æ–¹æ³•ä¸­ä½¿ç”¨ <code>FutureBuilder</code> æ¥å±•ç¤ºç»“æœã€‚</p><p>å…ˆæ·»åŠ  <code>http</code> åŒ…ï¼Œç”¨æ¥å‘é€ http è¯·æ±‚ï¼Œç„¶åå¼•å…¥éœ€è¦çš„ä¾èµ–åŒ…</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">http:</span> <span class="string">&lt;latest_version&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:convert'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:http/http.dart'</span> <span class="keyword">as</span> http;</span><br></pre></td></tr></table></figure><p>å°†é”®ç›˜è¾“å…¥ç±»å‹è®¾ç½®ä¸ºæ•°å­—ï¼Œå®šä¹‰ä¸€ä¸ª <code>_fetchPosts</code> æ–¹æ³•ç”¨æ¥è·å–è¿œç«¯æ•°æ®ï¼Œåœ¨ <code>buildResults</code> æ–¹æ³•é‡Œä½¿ç”¨ <code>FutureBuilder</code> æ¸²æŸ“æœç´¢ç»“æœã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">TextInputType <span class="keyword">get</span> keyboardType =&gt; TextInputType.number;</span><br><span class="line"></span><br><span class="line">Future _fetchPosts() <span class="keyword">async</span> &#123;</span><br><span class="line">  http.Response response =</span><br><span class="line">      <span class="keyword">await</span> http.<span class="keyword">get</span>(<span class="string">'https://jsonplaceholder.typicode.com/posts/<span class="subst">$query</span>'</span>);</span><br><span class="line">  <span class="keyword">final</span> data = <span class="keyword">await</span> json.decode(response.body);</span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget buildResults(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">int</span>.tryParse(query) &gt;= <span class="number">100</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> Center(child: Text(<span class="string">'è¯·è¾“å…¥å°äº 100 çš„æ•°å­—'</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> FutureBuilder(</span><br><span class="line">    future: _fetchPosts(),</span><br><span class="line">    builder: (context, AsyncSnapshot snapshot) &#123;</span><br><span class="line">      <span class="keyword">if</span> (snapshot.hasData) &#123;</span><br><span class="line">        <span class="keyword">final</span> post = snapshot.data;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ListTile(</span><br><span class="line">          title: Text(post[<span class="string">'title'</span>], maxLines: <span class="number">1</span>),</span><br><span class="line">          subtitle: Text(post[<span class="string">'body'</span>], maxLines: <span class="number">3</span>),</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> Center(child: CircularProgressIndicator());</span><br><span class="line">    &#125;,</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="images/search_server.png" width="240" style="width: 240px;"><p>ä½¿ç”¨ <code>FutureBuilder</code> éƒ¨ä»¶è·å–äº†è¿œç¨‹çš„æ•°æ®ï¼Œä½†æ˜¯é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæœç´¢ç»“æœå¯èƒ½æ˜¯åˆ†é¡µæ˜¾ç¤ºçš„ï¼Œä¸€å¼€å§‹åªè·å–äº†ç¬¬ä¸€é¡µçš„æ•°æ®ï¼Œæƒ³è¿½åŠ ä¸‹ä¸€é¡µæ•°æ®æ—¶éœ€è¦åƒ <code>stateFullWidget</code> é‚£æ ·ä½¿ç”¨ <code>setState</code> æ–¹æ³•æ›´æ–°é¡µé¢ï¼Œä½†æ˜¯åœ¨ <code>SearchDelegate</code> é‡Œæ— æ³•ä½¿ç”¨â€¦æš‚æ—¶æ²¡æƒ³åˆ°è§£å†³æ–¹æ³•ã€‚</p><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:convert'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:http/http.dart'</span> <span class="keyword">as</span> http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">'Search App'</span>,</span><br><span class="line">      home: HomePage(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'Search App'</span>),</span><br><span class="line">        actions: &lt;Widget&gt;[</span><br><span class="line">          IconButton(</span><br><span class="line">            icon: Icon(Icons.search),</span><br><span class="line">            onPressed: () &#123;</span><br><span class="line">              showSearch(context: context, delegate: CustomSearchDelegate());</span><br><span class="line">            &#125;,</span><br><span class="line">          )</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomSearchDelegate</span> <span class="keyword">extends</span> <span class="title">SearchDelegate</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">List</span>&lt;Widget&gt; buildActions(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      IconButton(</span><br><span class="line">        tooltip: <span class="string">'Clear'</span>,</span><br><span class="line">        icon: <span class="keyword">const</span> Icon(Icons.clear),</span><br><span class="line">        onPressed: () &#123;</span><br><span class="line">          query = <span class="string">''</span>;</span><br><span class="line">          showSuggestions(context);</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">    ];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget buildLeading(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> IconButton(</span><br><span class="line">      tooltip: <span class="string">'Back'</span>,</span><br><span class="line">      icon: AnimatedIcon(</span><br><span class="line">        icon: AnimatedIcons.menu_arrow,</span><br><span class="line">        progress: transitionAnimation,</span><br><span class="line">      ),</span><br><span class="line">      onPressed: () &#123;</span><br><span class="line">        <span class="keyword">this</span>.close(context, <span class="keyword">null</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  TextInputType <span class="keyword">get</span> keyboardType =&gt; TextInputType.number;</span><br><span class="line"></span><br><span class="line">  Future _fetchPosts() <span class="keyword">async</span> &#123;</span><br><span class="line">    http.Response response =</span><br><span class="line">        <span class="keyword">await</span> http.<span class="keyword">get</span>(<span class="string">'https://jsonplaceholder.typicode.com/posts/<span class="subst">$query</span>'</span>);</span><br><span class="line">    <span class="keyword">final</span> data = <span class="keyword">await</span> json.decode(response.body);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget buildResults(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">int</span>.parse(query) &gt;= <span class="number">100</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> Center(child: Text(<span class="string">'è¯·è¾“å…¥å°äº 100 çš„æ•°å­—'</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> FutureBuilder(</span><br><span class="line">      future: _fetchPosts(),</span><br><span class="line">      builder: (context, AsyncSnapshot snapshot) &#123;</span><br><span class="line">        <span class="keyword">if</span> (snapshot.hasData) &#123;</span><br><span class="line">          <span class="keyword">final</span> post = snapshot.data;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> ListTile(</span><br><span class="line">            title: Text(post[<span class="string">'title'</span>], maxLines: <span class="number">1</span>),</span><br><span class="line">            subtitle: Text(post[<span class="string">'body'</span>], maxLines: <span class="number">3</span>),</span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Center(child: CircularProgressIndicator());</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget buildSuggestions(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> ListView(</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        ListTile(title: Text(<span class="string">'Suggest 01'</span>)),</span><br><span class="line">        ListTile(title: Text(<span class="string">'Suggest 02'</span>)),</span><br><span class="line">        ListTile(title: Text(<span class="string">'Suggest 03'</span>)),</span><br><span class="line">        ListTile(title: Text(<span class="string">'Suggest 04'</span>)),</span><br><span class="line">        ListTile(title: Text(<span class="string">'Suggest 05'</span>)),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä½¿ç”¨ &lt;code&gt;SearchDelegate&lt;/code&gt; ç»™ Flutter åº”ç”¨æ·»åŠ æœç´¢åŠŸèƒ½&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter åˆ›å»ºè‡ªå®šä¹‰è·¯ç”±è¿‡æ¸¡åŠ¨ç”»</title>
    <link href="https://coldstone.fun/post/2019/12/10/flutter-route-transition/"/>
    <id>https://coldstone.fun/post/2019/12/10/flutter-route-transition/</id>
    <published>2019-12-10T08:37:52.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>Flutter åº”ç”¨è¿›è¡Œè·¯ç”±è·³è½¬çš„æ—¶å€™æœ‰é»˜è®¤çš„è¿‡æ¸¡åŠ¨ç”»ï¼Œä½†æ˜¯è‡ªå®šä¹‰çš„è·³è½¬åŠ¨ç”»ä¼šè®©åº”ç”¨æ›´å…·ç‰¹è‰²</p><a id="more"></a><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ol><li>ä½¿ç”¨ <code>PageRouteBuilder</code> åˆ›å»ºè‡ªå®šä¹‰è·¯ç”±</li><li>åœ¨ <code>transitionsBuilder</code> æ–¹æ³•é‡Œåˆ›å»ºè¿‡æ¸¡åŠ¨ç”»</li><li>è¿‡æ¸¡åŠ¨ç”»ç¤ºä¾‹</li><li>å®šä¹‰å…¨å±€è·¯ç”±è¿‡æ¸¡åŠ¨ç”»</li><li>å°è£…è‡ªå®šä¹‰è·¯ç”±</li></ol><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ <code>Flutter</code> ä¸­ä½¿ç”¨ <code>Navigator.of(context).push(Route route);</code> æ–¹æ³•è¿›è¡Œè·¯ç”±è·³è½¬æ—¶å°±éœ€è¦ä¼ ä¸€ä¸ª <code>Route</code> å¯¹è±¡ï¼Œé€šå¸¸ä½¿ç”¨ <code>MaterialPageRoute(builder: () {});</code> åˆ›å»ºï¼Œä½¿ç”¨æ—¶ä¼šåœ¨è·¯ç”±è·³è½¬è¿‡ç¨‹ä¸­æ·»åŠ é»˜è®¤çš„è¿‡æ¸¡åŠ¨ç”»ã€‚å½“éœ€è¦è‡ªå®šä¹‰è·¯ç”±è¿‡æ¸¡åŠ¨ç”»æ—¶ï¼Œå°±è¦ä½¿ç”¨ <code>PageRouteBuilder</code>ï¼Œå®ƒæ˜¯ <code>Flutter</code> æä¾›çš„ç”¨æ¥åˆ›å»ºè‡ªå®šä¹‰çš„è·¯ç”±çš„ä¸€ä¸ªç±»ï¼Œå®ä¾‹åŒ–è¿™ä¸ªç±»ä¼šå¾—åˆ°ä¸€ä¸ªè·¯ç”±å¯¹è±¡ <code>Route</code>ï¼Œè¦åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>Route</code>ã€‚</p><h2 id="PageRouteBuilder"><a href="#PageRouteBuilder" class="headerlink" title="PageRouteBuilder"></a>PageRouteBuilder</h2><p>ä½¿ç”¨ <code>PageRouteBuilder</code> åˆ›å»ºè‡ªå®šä¹‰è·¯ç”±è¿‡æ¸¡åŠ¨ç”»æ—¶éœ€è¦ä¼ å…¥ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œä¸€ä¸ªå¿…è¦å‚æ•° <code>pageBuilder</code>ï¼Œè¿™ä¸ªå‡½æ•°ç”¨æ¥åˆ›å»ºè·³è½¬çš„é¡µé¢ï¼Œå¦ä¸€ä¸ªå‡½æ•° <code>transitionsBuilder</code>ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯å®ç°è¿‡æ¸¡åŠ¨ç”»çš„åœ°æ–¹ã€‚</p><blockquote><p><code>transitionsBuilder</code> çš„ <code>child</code> å‚æ•°æ˜¯ <code>pageBuilder</code> å‡½æ•°è¿”å›çš„ä¸€ä¸ª <code>transitionsBuilder widget</code> éƒ¨ä»¶ï¼Œ <code>pageBuilder</code> æ–¹æ³•ä»…ä¼šåœ¨ç¬¬ä¸€æ¬¡æ„å»ºè·¯ç”±çš„æ—¶å€™è¢«è°ƒç”¨ï¼Œ<code>Flutter</code> èƒ½å¤Ÿè‡ªåŠ¨é¿å…åšé¢å¤–çš„å·¥ä½œï¼Œæ•´ä¸ªè¿‡æ¸¡æœŸé—´ <code>child</code> ä¿å­˜äº†åŒä¸€ä¸ªå®ä¾‹ã€‚</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PageRouteBuilder(</span><br><span class="line">  pageBuilder: (</span><br><span class="line">      BuildContext context,</span><br><span class="line">      Animation&lt;<span class="built_in">double</span>&gt; animation,</span><br><span class="line">      Animation&lt;<span class="built_in">double</span>&gt; secondaryAnimation,</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> widget;</span><br><span class="line">    &#125;,</span><br><span class="line">    transitionsBuilder: (</span><br><span class="line">      BuildContext context,</span><br><span class="line">      Animation&lt;<span class="built_in">double</span>&gt; animation,</span><br><span class="line">      Animation&lt;<span class="built_in">double</span>&gt; secondaryAnimation,</span><br><span class="line">      Widget child,</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> child;</span><br><span class="line">    &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>åˆ›å»ºè‡ªå®šä¹‰è·¯ç”±éœ€è¦ç»§æ‰¿ <code>PageRouteBuilder</code>ï¼Œç„¶åå®ç°è‡ªå®šä¹‰è·¯ç”±çš„æ„é€ å‡½æ•°ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YourRoute</span> <span class="keyword">extends</span> <span class="title">PageRouteBuilder</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Widget page;</span><br><span class="line"></span><br><span class="line">  YourRoute(<span class="keyword">this</span>.page)</span><br><span class="line">      : <span class="keyword">super</span>(</span><br><span class="line">          pageBuilder: (</span><br><span class="line">            context,</span><br><span class="line">            animation,</span><br><span class="line">            secondaryAnimation,</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span> page;</span><br><span class="line">          &#125;,</span><br><span class="line">          transitionsBuilder: (</span><br><span class="line">            context,</span><br><span class="line">            animation,</span><br><span class="line">            secondaryAnimation,</span><br><span class="line">            child,</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span> child;</span><br><span class="line">          &#125;,</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line">Navigator.of(context).push(YourRoute(NewPage()));</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>ä½¿ç”¨ <code>FirstPage</code> å’Œ <code>SecondPage</code> ä¸¤ä¸ªé¡µé¢å±•ç¤ºæ•ˆæœ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">      home: FirstPage(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FirstPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'First Page'</span>),</span><br><span class="line">        elevation: <span class="number">0.0</span>,</span><br><span class="line">        backgroundColor: Colors.purple,</span><br><span class="line">      ),</span><br><span class="line">      body: Column(</span><br><span class="line">        mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          Center(</span><br><span class="line">            child: RaisedButton(</span><br><span class="line">              onPressed: () &#123;</span><br><span class="line">                Navigator.of(context).push(</span><br><span class="line">                  MaterialPageRoute(builder: (context) =&gt; SecondPage()),</span><br><span class="line">                );</span><br><span class="line">              &#125;,</span><br><span class="line">              child: Text(<span class="string">'Next Page'</span>),</span><br><span class="line">            ),</span><br><span class="line">          )</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">      backgroundColor: Colors.purple,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SecondPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'Second Page'</span>),</span><br><span class="line">        elevation: <span class="number">0.0</span>,</span><br><span class="line">        backgroundColor: Colors.deepPurpleAccent,</span><br><span class="line">      ),</span><br><span class="line">      body: Column(</span><br><span class="line">        mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          Center(</span><br><span class="line">            child: RaisedButton(</span><br><span class="line">              onPressed: () &#123;</span><br><span class="line">                Navigator.pop(context);</span><br><span class="line">              &#125;,</span><br><span class="line">              child: Text(<span class="string">'Go Back'</span>),</span><br><span class="line">            ),</span><br><span class="line">          )</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">      backgroundColor: Colors.deepPurpleAccent,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="FadeTransition"><a href="#FadeTransition" class="headerlink" title="FadeTransition"></a><code>FadeTransition</code></h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FadeRoute</span> <span class="keyword">extends</span> <span class="title">PageRouteBuilder</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Widget page;</span><br><span class="line"></span><br><span class="line">  FadeRoute(<span class="keyword">this</span>.page)</span><br><span class="line">      : <span class="keyword">super</span>(</span><br><span class="line">          pageBuilder: (</span><br><span class="line">            context,</span><br><span class="line">            animation,</span><br><span class="line">            secondaryAnimation,</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span> page;</span><br><span class="line">          &#125;,</span><br><span class="line">          transitionsBuilder: (</span><br><span class="line">            context,</span><br><span class="line">            animation,</span><br><span class="line">            secondaryAnimation,</span><br><span class="line">            child,</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span> FadeTransition(</span><br><span class="line">              opacity: animation,</span><br><span class="line">              child: child,</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div>  <video src="videos/fade_transition.mov" controls width="320" autoplay muted loop /></div><h3 id="ScaleTransition"><a href="#ScaleTransition" class="headerlink" title="ScaleTransition"></a><code>ScaleTransition</code></h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScaleRoute</span> <span class="keyword">extends</span> <span class="title">PageRouteBuilder</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Widget page;</span><br><span class="line"></span><br><span class="line">  ScaleRoute(<span class="keyword">this</span>.page)</span><br><span class="line">      : <span class="keyword">super</span>(</span><br><span class="line">          pageBuilder: (</span><br><span class="line">            context,</span><br><span class="line">            animation,</span><br><span class="line">            secondaryAnimation,</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span> page;</span><br><span class="line">          &#125;,</span><br><span class="line">          transitionsBuilder: (</span><br><span class="line">            context,</span><br><span class="line">            animation,</span><br><span class="line">            secondaryAnimation,</span><br><span class="line">            child,</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span> ScaleTransition(</span><br><span class="line">              alignment: Alignment.bottomLeft,</span><br><span class="line">              scale: Tween(</span><br><span class="line">                begin: <span class="number">0.0</span>,</span><br><span class="line">                end: <span class="number">1.0</span>,</span><br><span class="line">              ).animate(</span><br><span class="line">                CurvedAnimation(</span><br><span class="line">                  parent: animation,</span><br><span class="line">                  curve: Curves.easeInOut,</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">              child: child,</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">          transitionDuration: <span class="built_in">Duration</span>(seconds: <span class="number">1</span>),</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Navigator.of(context).push(ScaleRoute(SecondPage()));</span><br></pre></td></tr></table></figure><div>  <video src="videos/scale_transition.mov" controls width="320" autoplay muted loop /></div><h3 id="RotationTransition"><a href="#RotationTransition" class="headerlink" title="RotationTransition"></a><code>RotationTransition</code></h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RotationRoute</span> <span class="keyword">extends</span> <span class="title">PageRouteBuilder</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Widget page;</span><br><span class="line"></span><br><span class="line">  RotationRoute(<span class="keyword">this</span>.page)</span><br><span class="line">      : <span class="keyword">super</span>(</span><br><span class="line">          pageBuilder: (</span><br><span class="line">            context,</span><br><span class="line">            animation,</span><br><span class="line">            secondaryAnimation,</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span> page;</span><br><span class="line">          &#125;,</span><br><span class="line">          transitionsBuilder: (</span><br><span class="line">            context,</span><br><span class="line">            animation,</span><br><span class="line">            secondaryAnimation,</span><br><span class="line">            child,</span><br><span class="line">          ) &#123;</span><br><span class="line">            Animation myAnimation = CurvedAnimation(</span><br><span class="line">              parent: animation,</span><br><span class="line">              curve: Curves.easeInBack,</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> RotationTransition(</span><br><span class="line">              turns: myAnimation,</span><br><span class="line">              child: child,</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">          transitionDuration: <span class="built_in">Duration</span>(seconds: <span class="number">1</span>),</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Navigator.of(context).push(RotationRoute(SecondPage()));</span><br></pre></td></tr></table></figure><div>  <video src="videos/rotation_transition.mov" controls width="320" autoplay muted loop /></div><h3 id="ScaleRotationRoute"><a href="#ScaleRotationRoute" class="headerlink" title="ScaleRotationRoute"></a><code>ScaleRotationRoute</code></h3><p>ç»“åˆä¸¤ä¸ªè¿‡æ¸¡åŠ¨ç”»</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScaleRotationRoute</span> <span class="keyword">extends</span> <span class="title">PageRouteBuilder</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Widget page;</span><br><span class="line"></span><br><span class="line">  ScaleRotationRoute(<span class="keyword">this</span>.page)</span><br><span class="line">      : <span class="keyword">super</span>(</span><br><span class="line">          pageBuilder: (</span><br><span class="line">            context,</span><br><span class="line">            animation,</span><br><span class="line">            secondaryAnimation,</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span> page;</span><br><span class="line">          &#125;,</span><br><span class="line">          transitionsBuilder: (</span><br><span class="line">            context,</span><br><span class="line">            animation,</span><br><span class="line">            secondaryAnimation,</span><br><span class="line">            child,</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span> ScaleTransition(</span><br><span class="line">              scale: animation,</span><br><span class="line">              child: RotationTransition(</span><br><span class="line">                turns: Tween(</span><br><span class="line">                  begin: <span class="number">0.0</span>,</span><br><span class="line">                  end: <span class="number">1.0</span>,</span><br><span class="line">                ).animate(</span><br><span class="line">                  CurvedAnimation(parent: animation, curve: Curves.linear),</span><br><span class="line">                ),</span><br><span class="line">                child: child,</span><br><span class="line">              ),</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">          transitionDuration: <span class="built_in">Duration</span>(milliseconds: <span class="number">800</span>),</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Navigator.of(context).push(ScaleRotationRoute(SecondPage()));</span><br></pre></td></tr></table></figure><div>  <video src="videos/scale_rotation_transition.mov" controls width="320" autoplay muted loop /></div><h3 id="TransformRoute"><a href="#TransformRoute" class="headerlink" title="TransformRoute"></a><code>TransformRoute</code></h3><p>ä½¿ç”¨ <code>Transform</code> éƒ¨ä»¶åˆ›é€  <code>3D</code> æ•ˆæœ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:math'</span> <span class="keyword">show</span> pi;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TransformRoute</span> <span class="keyword">extends</span> <span class="title">PageRouteBuilder</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Widget page;</span><br><span class="line"></span><br><span class="line">  TransformRoute(<span class="keyword">this</span>.page)</span><br><span class="line">      : <span class="keyword">super</span>(</span><br><span class="line">          pageBuilder: (</span><br><span class="line">            context,</span><br><span class="line">            animation,</span><br><span class="line">            secondaryAnimation,</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span> page;</span><br><span class="line">          &#125;,</span><br><span class="line">          transitionsBuilder: (</span><br><span class="line">            context,</span><br><span class="line">            animation,</span><br><span class="line">            secondaryAnimation,</span><br><span class="line">            child,</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span> Transform(</span><br><span class="line">              transform: Matrix4.identity()</span><br><span class="line">                <span class="comment">// ç±»ä¼¼äº CSS é‡Œé¢ `perspective` å±æ€§ï¼Œç¡®å®š z=0 å¹³é¢ä¸ç”¨æˆ·ä¹‹é—´çš„è·ç¦»</span></span><br><span class="line">                ..setEntry(<span class="number">3</span>, <span class="number">2</span>, <span class="number">0.0001</span>)</span><br><span class="line">                ..rotateX(animation.value * pi * <span class="number">2</span>)</span><br><span class="line">                ..rotateY(animation.value * pi * <span class="number">2</span>),</span><br><span class="line">              alignment: FractionalOffset.center,</span><br><span class="line">              child: child,</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">          transitionDuration: <span class="built_in">Duration</span>(seconds: <span class="number">2</span>),</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Navigator.of(context).push(TransformRoute(SecondPage()));</span><br></pre></td></tr></table></figure><div>  <video src="videos/transform_transition.mov" controls width="320" autoplay muted loop /></div><h3 id="EnterExitRoute"><a href="#EnterExitRoute" class="headerlink" title="EnterExitRoute"></a><code>EnterExitRoute</code></h3><p>åŒæ—¶ä¸ºè¿›å…¥é¡µé¢å’Œé€€å‡ºé¡µé¢æ·»åŠ åŠ¨ç”»</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EnterExitRoute</span> <span class="keyword">extends</span> <span class="title">PageRouteBuilder</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Widget enterPage;</span><br><span class="line">  <span class="keyword">final</span> Widget exitPage;</span><br><span class="line"></span><br><span class="line">  EnterExitRoute(<span class="keyword">this</span>.enterPage, <span class="keyword">this</span>.exitPage)</span><br><span class="line">      : <span class="keyword">super</span>(</span><br><span class="line">          pageBuilder: (</span><br><span class="line">            context,</span><br><span class="line">            animation,</span><br><span class="line">            secondaryAnimation,</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span> exitPage;</span><br><span class="line">          &#125;,</span><br><span class="line">          transitionsBuilder: (</span><br><span class="line">            context,</span><br><span class="line">            animation,</span><br><span class="line">            secondaryAnimation,</span><br><span class="line">            child,</span><br><span class="line">          ) =&gt;</span><br><span class="line">              Stack(</span><br><span class="line">            children: [</span><br><span class="line">              SlideTransition(</span><br><span class="line">                position: Tween&lt;Offset&gt;(</span><br><span class="line">                  begin: Offset(<span class="number">0.0</span>, <span class="number">0.0</span>),</span><br><span class="line">                  end: Offset(<span class="number">-1.0</span>, <span class="number">0.0</span>),</span><br><span class="line">                ).animate(</span><br><span class="line">                  CurvedAnimation(parent: animation, curve: Curves.easeIn),</span><br><span class="line">                ),</span><br><span class="line">                child: enterPage,</span><br><span class="line">              ),</span><br><span class="line">              SlideTransition(</span><br><span class="line">                position: Tween&lt;Offset&gt;(</span><br><span class="line">                  begin: Offset(<span class="number">1.0</span>, <span class="number">0.0</span>),</span><br><span class="line">                  end: Offset.zero,</span><br><span class="line">                ).animate(</span><br><span class="line">                  CurvedAnimation(parent: animation, curve: Curves.easeInOut),</span><br><span class="line">                ),</span><br><span class="line">                child: exitPage,</span><br><span class="line">              )</span><br><span class="line">            ],</span><br><span class="line">          ),</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Navigator.of(context).push(</span><br><span class="line">  EnterExitRoute(FirstPage(), SecondPage()),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><div>  <video src="videos/enter_exist_transition.mov" controls width="320" autoplay muted loop /></div><h2 id="ä½¿ç”¨-Navigator-pushNamed-æ–¹æ³•è·³è½¬"><a href="#ä½¿ç”¨-Navigator-pushNamed-æ–¹æ³•è·³è½¬" class="headerlink" title="ä½¿ç”¨ Navigator.pushNamed æ–¹æ³•è·³è½¬"></a>ä½¿ç”¨ <code>Navigator.pushNamed</code> æ–¹æ³•è·³è½¬</h2><p>åœ¨ <code>onGenerateRoute</code> å¯¹è·³è½¬è·¯ç”±çš„ <code>name</code> è¿›è¡Œåˆ¤æ–­ï¼Œå¯¹ç‰¹å®šçš„è·¯ç”±æ·»åŠ è¿‡æ¸¡åŠ¨ç”»ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">      home: FirstPage(),</span><br><span class="line">      onGenerateRoute: (settings) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (settings.name) &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">'/second'</span>:</span><br><span class="line">            <span class="keyword">return</span> ScaleRoute(SecondPage());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Navigator.pushNamed(context, <span class="string">'/second'</span>, arguments: &#123;&#125;);</span><br></pre></td></tr></table></figure><h2 id="è®¾ç½®å…¨å±€çš„è·¯ç”±è¿‡æ¸¡åŠ¨ç”»"><a href="#è®¾ç½®å…¨å±€çš„è·¯ç”±è¿‡æ¸¡åŠ¨ç”»" class="headerlink" title="è®¾ç½®å…¨å±€çš„è·¯ç”±è¿‡æ¸¡åŠ¨ç”»"></a>è®¾ç½®å…¨å±€çš„è·¯ç”±è¿‡æ¸¡åŠ¨ç”»</h2><p><code>Flutter</code> çš„é»˜è®¤è·¯ç”±è¿‡æ¸¡åŠ¨ç”»æ˜¯ç”± <code>buildTransitions</code> æ–¹æ³•åˆ›å»ºçš„ï¼Œå®ƒä½¿ç”¨çš„æ˜¯ <code>Theme.of(context).pageTransitionsTheme</code>æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥å®šä¹‰å…¨å±€çš„è·¯ç”±è·³è½¬è¿‡æ¸¡åŠ¨ç”»ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget buildTransitions(context, animation, secondaryAnimation, child) &#123;</span><br><span class="line">    <span class="keyword">final</span> PageTransitionsTheme theme = Theme.of(context).pageTransitionsTheme;</span><br><span class="line">    <span class="keyword">return</span> theme.buildTransitions&lt;T&gt;(<span class="keyword">this</span>, context, animation, secondaryAnimation, child);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè‡ªå®šä¹‰ä¸€ä¸ª <code>TransitionBuilder</code>ï¼Œ <code>buildTransitions</code> æ–¹æ³•è¿”å›è·³è½¬é¡µé¢ã€‚ç„¶åé…ç½® <code>theme</code> çš„ <code>pageTransitionsTheme</code>ï¼Œè®¾ç½®å¯¹åº”çš„å¹³å°ï¼Œæœ€ååœ¨ä½¿ç”¨ <code>MaterialPageRoute</code> æˆ–è€… <code>CupertinoPageRoute</code> è¿›è¡Œé¡µé¢è·³è½¬æ—¶å°±ä¼šæœ‰è‡ªå®šä¹‰çš„è¿‡æ¸¡åŠ¨ç”»äº†ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScaleTransitionBuilder</span> <span class="keyword">extends</span> <span class="title">PageTransitionsBuilder</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget buildTransitions&lt;T&gt;(</span><br><span class="line">    route,</span><br><span class="line">    context,</span><br><span class="line">    animation,</span><br><span class="line">    secondaryAnimation,</span><br><span class="line">    child,</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> ScaleTransition(</span><br><span class="line">      scale: CurvedAnimation(parent: animation, curve: Curves.easeIn),</span><br><span class="line">      child: child,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">      home: FirstPage(),</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        pageTransitionsTheme: PageTransitionsTheme(</span><br><span class="line">          builders: &#123;</span><br><span class="line">            TargetPlatform.android: ScaleTransitionBuilder(),</span><br><span class="line">            TargetPlatform.iOS: ScaleTransitionBuilder(),</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Navigator.push(context, MaterialPageRoute(builder: (ctx) =&gt; SecondPage()));</span><br></pre></td></tr></table></figure><h2 id="å°†åŠ¨ç”»å°è£…æˆä¸€ä¸ªåº“"><a href="#å°†åŠ¨ç”»å°è£…æˆä¸€ä¸ªåº“" class="headerlink" title="å°†åŠ¨ç”»å°è£…æˆä¸€ä¸ªåº“"></a>å°†åŠ¨ç”»å°è£…æˆä¸€ä¸ªåº“</h2><p>å°†è‡ªå®šä¹‰çš„è·¯ç”±è¿‡æ¸¡åŠ¨ç”»å°è£…èµ·æ¥æ–¹ä¾¿ä½¿ç”¨ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> TransitionType &#123;</span><br><span class="line">  fade,</span><br><span class="line">  scale,</span><br><span class="line">  rotate,</span><br><span class="line">  transform,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageTransition</span> <span class="keyword">extends</span> <span class="title">PageRouteBuilder</span> </span>&#123;</span><br><span class="line">  PageTransition(TransitionType type, Widget page, <span class="built_in">Duration</span> time)</span><br><span class="line">      : <span class="keyword">super</span>(</span><br><span class="line">          pageBuilder: (</span><br><span class="line">            context,</span><br><span class="line">            animation,</span><br><span class="line">            secondaryAnimation,</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span> page;</span><br><span class="line">          &#125;,</span><br><span class="line">          transitionsBuilder: (</span><br><span class="line">            context,</span><br><span class="line">            animation,</span><br><span class="line">            secondaryAnimation,</span><br><span class="line">            child,</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">              <span class="keyword">case</span> TransitionType.fade:</span><br><span class="line">                <span class="keyword">return</span> FadeTransition(opacity: animation, child: child);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> TransitionType.scale:</span><br><span class="line">                <span class="keyword">return</span> ScaleTransition(</span><br><span class="line">                  scale: Tween(begin: <span class="number">0.0</span>, end: <span class="number">1.0</span>).animate(</span><br><span class="line">                    CurvedAnimation(parent: animation, curve: Curves.easeInOut),</span><br><span class="line">                  ),</span><br><span class="line">                  child: child,</span><br><span class="line">                );</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> TransitionType.rotate:</span><br><span class="line">                <span class="keyword">return</span> RotationTransition(</span><br><span class="line">                  turns: CurvedAnimation(</span><br><span class="line">                    parent: animation,</span><br><span class="line">                    curve: Curves.easeInBack,</span><br><span class="line">                  ),</span><br><span class="line">                  child: child,</span><br><span class="line">                );</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> TransitionType.transform:</span><br><span class="line">                <span class="keyword">return</span> Transform(</span><br><span class="line">                  transform: Matrix4.identity()</span><br><span class="line">                    ..setEntry(<span class="number">3</span>, <span class="number">2</span>, <span class="number">0.0001</span>)</span><br><span class="line">                    ..rotateX(animation.value * pi * <span class="number">2</span>)</span><br><span class="line">                    ..rotateY(animation.value * pi * <span class="number">2</span>),</span><br><span class="line">                  alignment: FractionalOffset.center,</span><br><span class="line">                  child: child,</span><br><span class="line">                );</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> child;</span><br><span class="line">            &#125;;</span><br><span class="line">          &#125;,</span><br><span class="line">          transitionDuration: time,</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line">Navigator.push(</span><br><span class="line">  context,</span><br><span class="line">  PageTransition(</span><br><span class="line">    TransitionType.rotate,</span><br><span class="line">    SecondPage(),</span><br><span class="line">    <span class="built_in">Duration</span>(milliseconds: <span class="number">800</span>),</span><br><span class="line">  ),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://flutter.cn/docs/cookbook/animation/page-route-animation" target="_blank" rel="noopener">ä¸ºé¡µé¢åˆ‡æ¢åŠ å…¥åŠ¨ç”»æ•ˆæœ</a></p><p><a href="https://medium.com/flutter-community/everything-you-need-to-know-about-flutter-page-route-transition-9ef5c1b32823" target="_blank" rel="noopener">Everything you need to know about Flutter page route transition</a></p><p><a href="https://medium.com/flutter/perspective-on-flutter-6f832f4d912e" target="_blank" rel="noopener">Perspective on Flutter</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Flutter åº”ç”¨è¿›è¡Œè·¯ç”±è·³è½¬çš„æ—¶å€™æœ‰é»˜è®¤çš„è¿‡æ¸¡åŠ¨ç”»ï¼Œä½†æ˜¯è‡ªå®šä¹‰çš„è·³è½¬åŠ¨ç”»ä¼šè®©åº”ç”¨æ›´å…·ç‰¹è‰²&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Egg.js ä¸Šä¼ æ¥å£å¼€å‘æ€»ç»“</title>
    <link href="https://coldstone.fun/post/2019/12/05/egg-api-dev/"/>
    <id>https://coldstone.fun/post/2019/12/05/egg-api-dev/</id>
    <published>2019-12-05T12:00:00.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>æ€»ç»“ä¸€ä¸‹ä¹‹å‰ç”¨ Egg.js å¼€å‘çš„æ–‡ä»¶ä¸Šä¼ æ¥å£çš„ä»»åŠ¡</p><a id="more"></a><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>è¦åœ¨æµè§ˆå™¨ç«¯å°†æ–‡ä»¶ä¸Šä¼ åˆ°é˜¿é‡Œçš„ OSS å¯¹è±¡å­˜å‚¨ï¼Œéœ€è¦ç”¨åˆ°é˜¿é‡Œäº‘æä¾›çš„ <a href="https://github.com/ali-sdk/ali-oss" target="_blank" rel="noopener">SDK</a>ï¼Œä½†æ˜¯è¿™æ ·ä¼šåœ¨å‰ç«¯æš´éœ² OSS çš„ <code>accessKeyId</code> å’Œ <code>accessKeySecret</code>ï¼Œè¿™æ˜¯ä¸å®‰å…¨çš„ã€‚æ‰€ä»¥éœ€è¦ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ¥å£æŠŠå‰ç«¯ä¼ è¿‡æ¥çš„æ–‡ä»¶ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨é‡Œé¢ï¼Œæœ€åˆåªæ”¯æŒé˜¿é‡Œäº‘ï¼Œä¹‹åå¯èƒ½ä¼šæ”¯æŒå…¶å®ƒçš„äº‘æœåŠ¡å•†æ¯”å¦‚ä¸ƒç‰›äº‘ã€‚</p><h2 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h2><p>åç«¯æ¡†æ¶ç”¨çš„æ˜¯ Egg.jsï¼Œå› ä¸ºæ¯”è¾ƒç†Ÿæ‚‰ã€‚ç„¶åè¿™åªæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„æœåŠ¡ï¼Œä¸€ä¸ªè·¯ç”±å°±è¡Œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">`/<span class="subst">$&#123;app.name&#125;</span>/v1/upload`</span>, controller.oss.upload)</span><br></pre></td></tr></table></figure><p>ç„¶åå®ç°å¯¹åº”çš„ <code>OssController</code> çš„ <code>upload</code> æ–¹æ³•ï¼Œä¸€èˆ¬çš„å®è·µæ˜¯åœ¨ <code>Controller</code> å±‚è¿›è¡Œå‚æ•°æ ¡éªŒï¼Œè¿™é‡Œç”¨å†…ç½®çš„æ˜¯ <code>egg-validate</code> æ’ä»¶è¿›è¡Œæ ¡éªŒã€‚å‡å¦‚æœ‰ä¸¤ä¸ªå‚æ•° <code>folder</code> å’Œ <code>bucket</code> ä»£è¡¨æ–‡ä»¶ä¸Šä¼ çš„ç›®å½•å’Œ <code>bucket</code>ï¼Œé‚£ä¹ˆéªŒè¯ä»£ç å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> body = ctx.request.body</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rules = &#123;</span><br><span class="line">  folder: &#123; <span class="attr">type</span>: <span class="string">'string'</span>, <span class="attr">required</span>: <span class="literal">false</span>, <span class="attr">default</span>: <span class="string">'/'</span>, <span class="attr">trim</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  bucket: &#123; <span class="attr">type</span>: <span class="string">'string'</span>, <span class="attr">required</span>: <span class="literal">false</span>, <span class="attr">default</span>:  <span class="string">'you-bucket-name'</span> &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> ctx.validate(rules, body)</span><br></pre></td></tr></table></figure><p>æ¥å—å‰ç«¯çš„ä¸Šä¼ æ–‡ä»¶ç”¨çš„æ˜¯ <a href="https://github.com/eggjs/egg-multipart" target="_blank" rel="noopener">egg-multipart</a> æ’ä»¶ï¼Œè¿™ä¸ªæ’ä»¶æœ‰ä¸¤ç§æ¨¡å¼ <code>file</code> å’Œ <code>stream</code>ï¼Œ<code>file</code> æ¨¡å¼é€‚åˆç®€å•çš„æ–‡ä»¶ä¸Šä¼ ï¼Œè¿™ç§æ¨¡å¼ä¼šå…ˆå°†å‰ç«¯ä¼ æ¥çš„å›¾ç‰‡å­˜åˆ°æœåŠ¡å™¨ä¸Šï¼Œæ‰§è¡Œå®Œæ“ä½œåéœ€è¦ç”¨ <code>ctx.cleanupRequestFiles()</code> æ–¹æ³•å°†æ–‡ä»¶åˆ é™¤ã€‚ <code>stream</code> æ¨¡å¼é€‚åˆåœ¨å¯¹ä¸Šä¼ æ–‡ä»¶è¿›ä¸€æ­¥å¤„ç†çš„æ—¶å€™ä½¿ç”¨ï¼Œå¦‚å‹ç¼©ï¼Œè§£å‹ç­‰ï¼Œå¦‚æœä¸Šä¼ æ–‡ä»¶æ˜¯å›¾ç‰‡é‚£ä¹ˆå¯ä»¥å°†è¿™ä¸ªæµä¼ é€’ç»™å¤„ç†å›¾ç‰‡çš„åº“è¿›è¡Œå¤„ç†ã€‚</p><p>åœ¨ <code>config.default.js</code> é…ç½® <code>egg-multipart</code> æ’ä»¶ï¼Œåœ¨ <code>fileExtensions</code> æ–°å¢éœ€è¦æ·»åŠ çš„æ–‡ä»¶ç±»å‹æ‰©å±•åï¼Œ<code>cleanSchedule</code> é…ç½®å®šæ—¶æ¸…é™¤é›¶æ—¶ä¿å­˜çš„æ–‡ä»¶ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">config.multipart = &#123;</span><br><span class="line">  mode: <span class="string">'file'</span>,</span><br><span class="line">  fileSize: <span class="string">'50mb'</span>,</span><br><span class="line">  tmpdir: path.join(os.tmpdir(), <span class="string">'egg-multipart-tmp'</span>, appInfo.name),</span><br><span class="line">  cleanSchedule: &#123;</span><br><span class="line">    cron: <span class="string">'0 30 4 * * *'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  fileExtensions: [ <span class="string">'.pdf'</span>, <span class="string">'.doc'</span>, <span class="string">'.docx'</span> ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åç”¨ <code>ctx.request.files</code> è·å–è¯·æ±‚è¿‡æ¥çš„æ–‡ä»¶ï¼Œè¿™é‡Œä¹Ÿéœ€è¦è¿›è¡ŒéªŒè¯è¯·æ±‚æ˜¯å¦æœ‰æ–‡ä»¶ï¼Œæ ¡éªŒå¥½è¯·æ±‚å‚æ•°åå°±æŠŠè¯·æ±‚å‚æ•°ä¼ åˆ° <code>Services</code> å±‚é‡Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> files = ctx.request.files</span><br><span class="line"><span class="keyword">const</span> body = ctx.request.body</span><br><span class="line">...</span><br><span class="line">ctx.body = <span class="keyword">await</span> ctx.service.oss.upload(body, files)</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„ <code>OssService</code> æ˜¯è´Ÿè´£ä¸»è¦çš„ä»»åŠ¡åœ°æ–¹ï¼Œæ–°å»º <code>OSS</code> å®ä¾‹å¯¹è±¡ï¼Œä¸Šä¼ æ–‡ä»¶ï¼Œè®¾ç½®ä¸Šä¼ æ–‡ä»¶çš„è¯·æ±‚å¤´ï¼Œè¿”å›ä¸Šä¼ ç»“æœã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> fs <span class="keyword">from</span> <span class="string">'fs'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> OSS <span class="keyword">from</span> <span class="string">'ali-oss'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ONE_YEAR = <span class="number">3600</span> * <span class="number">24</span> * <span class="number">365</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * OssService</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> OssService <span class="keyword">extends</span> Service &#123;</span><br><span class="line">  <span class="keyword">private</span> client</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> createClient(option) &#123;</span><br><span class="line">      <span class="keyword">this</span>.client = <span class="keyword">new</span> OSS(&#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">async</span> uploadFile(dir, file) &#123;</span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> filename = file.filename.replace(<span class="regexp">/\.(\w+)$/</span>, <span class="string">`-<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>.$1`</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      result = <span class="keyword">await</span> <span class="keyword">this</span>.client.put(<span class="string">`<span class="subst">$&#123;dir&#125;</span><span class="subst">$&#123;filename&#125;</span>`</span>, file.filepath, &#123;</span><br><span class="line">        headers: &#123; <span class="string">'Cache-Control'</span>: <span class="string">`max-age=<span class="subst">$&#123;ONE_YEAR&#125;</span>`</span>, <span class="string">'Content-Disposition'</span>: <span class="string">''</span> &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">this</span>.ctx.logger.error(<span class="keyword">new</span> <span class="built_in">Error</span>(e.message))</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(e.message)</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      fs.unlink(file.filepath, <span class="function"><span class="params">()</span> =&gt;</span> <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">async</span> upload(parmas, files) &#123;</span><br><span class="line">    <span class="keyword">this</span>.createClient(parmas)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (files.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      result = []</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> file of files) &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="keyword">this</span>.uploadFile(parmas.dir, file)</span><br><span class="line"></span><br><span class="line">        result.push(&#123; url: res.url &#125;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> file = files[<span class="number">0</span>]</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="keyword">this</span>.uploadFile(parmas.dir, file)</span><br><span class="line"></span><br><span class="line">      result = &#123; url: res.url &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ä¸Šä¼ æ–‡ä»¶åˆ° OSS æ¥å£åŸºæœ¬å®Œæˆäº†</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>Egg.js é›†æˆäº† <a href="https://github.com/visionmedia/supertest" target="_blank" rel="noopener">SuperTest</a> æµ‹è¯•æ¡†æ¶ï¼Œæ‰€ä»¥å†™æ¥å£çš„å•å…ƒæµ‹è¯•å¾ˆæ–¹ä¾¿ã€‚è¿™ä¸ªæ¥å£ä¸»è¦æ˜¯å¯¹ <code>Controller</code> å±‚è¯·æ±‚å‚æ•°è¿›è¡Œæµ‹è¯•ã€‚æµ‹è¯•ä»£ç å†™åœ¨é¡¹ç›®ç›®å½• <code>test/app/controller/oss.test.ts</code> æ–‡ä»¶å†…ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; app, assert &#125; <span class="keyword">from</span> <span class="string">'egg-mock/bootstrap'</span></span><br><span class="line"></span><br><span class="line">describe(<span class="string">'æµ‹è¯• oss controller'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">'ä¸å†ç™½åå•çš„ bucket åè¿”å›é”™è¯¯'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> app.httpRequest()</span><br><span class="line">      .post(<span class="string">'/upload-server/v1/upload'</span>)</span><br><span class="line">      .set(<span class="string">'Content-type'</span>, <span class="string">'multipart/form-data; boundary=--------------------------820317025826519383208825'</span>)</span><br><span class="line">      .field(<span class="string">'bucket'</span>, <span class="string">'wrong-bucket'</span>)</span><br><span class="line">      .expect(<span class="number">403</span>)</span><br><span class="line"></span><br><span class="line">    assert(result.body)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'ä¸Šä¼ æ–‡ä»¶æˆåŠŸ'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> app.httpRequest()</span><br><span class="line">      .post(<span class="string">'/upload-server/v1/upload'</span>)</span><br><span class="line">      .set(<span class="string">'Content-type'</span>, <span class="string">'multipart/form-data; boundary=--------------------------820317025826519383208825'</span>)</span><br><span class="line">      .field(<span class="string">'dir'</span>, <span class="string">'images'</span>)</span><br><span class="line">      .attach(<span class="string">'avatar'</span>, <span class="string">'test/app/controller/avatar.png'</span>)</span><br><span class="line">      .expect(<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">    assert(result.body)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p>Egg.js æœ¬èº«éƒ¨ç½²ååˆ†çš„æ–¹ä¾¿ï¼Œåªéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egg-scripts start --daemon --env=prod --title=upload-server</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å°†è¿™ä¸ªæœåŠ¡å˜æˆä¸€ä¸ª <code>Docker</code> <code>iamge</code> å°±æ›´æ–¹ä¾¿äº†</p><blockquote><p>æ³¨æ„:<br>è¦ç”¨ <code>Docker</code> è¿è¡Œ Egg æœåŠ¡éœ€è¦å°† <code>package.json</code> ä¸­ <code>scripts</code> çš„ <code>start</code> å‘½ä»¤å»æ‰ <code>--daemon</code> å‚æ•°ï¼Œå˜æˆ<br><code>egg-scripts start --env=prod --title=upload-server</code><br>å› ä¸ºåœ¨ <code>Docker</code> è¿è¡Œ Egg åº”ç”¨éœ€è¦æ˜¯å‰å°æ¨¡å¼è¿è¡Œ</p></blockquote><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:lts-alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ—¶åŒº</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apk --update add tzdata \</span></span><br><span class="line"><span class="bash">    &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">"Asia/Shanghai"</span> &gt; /etc/timezone \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apk del tzdata</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /upload-server</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> package*.json ./</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm install --registry=https://registry.npm.taobao.org</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . /upload-server</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm run tsc &amp;&amp; npm prune --production</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> npm start</span></span><br></pre></td></tr></table></figure><p>æœ‰äº†é•œåƒåï¼Œå†™ä¸€ä¸ªè¿è¡Œå®¹å™¨çš„è„šæœ¬ï¼Œæ·»åŠ å¯æ‰§è¡Œçš„æƒé™ï¼Œä¹‹åå¯åŠ¨æœåŠ¡å°±å¯ä»¥åªç”¨è¿è¡Œè¿™ä¸ªè„šæœ¬å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line">IMAGE_NAME=<span class="string">"upload-server"</span></span><br><span class="line">CONTAINER_NAME=<span class="string">"upload-server"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'æ‹‰å–ä»£ç '</span></span><br><span class="line"></span><br><span class="line">git pull origin master</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'è¿è¡Œå®¹å™¨'</span></span><br><span class="line"></span><br><span class="line">docker rm -f <span class="variable">$&#123;CONTAINER_NAME&#125;</span> || <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">docker build -t <span class="variable">$&#123;IMAGE_NAME&#125;</span> .</span><br><span class="line"></span><br><span class="line">docker run -d -p 7001:7001 --env-file .env --name=<span class="variable">$&#123;CONTAINER_NAME&#125;</span> <span class="variable">$&#123;IMAGE_NAME&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x ./deploy.sh</span><br></pre></td></tr></table></figure><p>è¿è¡Œè„šæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./deploy.sh</span><br></pre></td></tr></table></figure><h2 id="è¯·æ±‚é¢‘ç‡é™åˆ¶"><a href="#è¯·æ±‚é¢‘ç‡é™åˆ¶" class="headerlink" title="è¯·æ±‚é¢‘ç‡é™åˆ¶"></a>è¯·æ±‚é¢‘ç‡é™åˆ¶</h2><p>ä¸ºäº†é˜²æ­¢æ¥å£è¢«æ»¥ç”¨éœ€è¦é™åˆ¶è¯·æ±‚æ¥å£çš„é¢‘ç‡ï¼Œåœ¨ Github æ‰¾åˆ°ä¸€ä¸ª <a href="https://github.com/koajs/ratelimit" target="_blank" rel="noopener">koa-ratelimit</a> çš„ä»“åº“ï¼Œç”±äº Egg.js æ”¯æŒ Koa çš„æ’ä»¶ï¼Œæ‰€ä»¥ä¹Ÿé€‚åˆã€‚</p><p>å‚è€ƒè¿™ä¸ªä»“åº“çš„æ–‡æ¡£ï¼Œåœ¨é¡¹ç›® <code>middleware</code> æ–‡ä»¶æ·»åŠ ä¸€ä¸ª <code>ratelimit.ts</code>ï¼Œç”¨è¿™ä¸ªä¸­é—´ä»¶æ¥æ§åˆ¶ï¼Œä¸€å¼€å§‹ä½¿ç”¨çš„ <code>redis</code> ä½œä¸º <code>driver</code> å¯æ˜¯é‡åˆ°ä¸€ä¸ª <code>docker-compose</code> ç½‘ç»œé“¾æ¥é—®é¢˜å§‹ç»ˆæ— æ³•è§£å†³ï¼Œé‚æ”¾å¼ƒï¼Œæ”¹ç”¨å†…å­˜æ¨¡å¼ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Redis <span class="keyword">from</span> <span class="string">'ioredis'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ratelimit <span class="keyword">from</span> <span class="string">'koa-ratelimit'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> db = <span class="keyword">new</span> Map();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> ratelimit(&#123;</span><br><span class="line">    db: db,</span><br><span class="line">    driver: <span class="string">'memory'</span>,</span><br><span class="line">    duration: <span class="number">60000</span>,</span><br><span class="line">    errorMessage: <span class="string">'è¯·æ±‚æ¬¡æ•°è¶…è¿‡é™åˆ¶'</span>,</span><br><span class="line">    id: <span class="function"><span class="params">ctx</span> =&gt;</span> ctx.ip,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      remaining: <span class="string">'Upload-Limit-Remaining'</span>,</span><br><span class="line">      reset: <span class="string">'Uplaod-Limit-Reset'</span>,</span><br><span class="line">      total: <span class="string">'Upload-Limit-Total'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    max: <span class="number">300</span>,</span><br><span class="line">    disableHeader: <span class="literal">false</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p><strong><em>ä¸Šä¼ åˆ° OSS çš„å›¾ç‰‡åœ¨æµè§ˆå™¨æ— æ³•é¢„è§ˆå˜ä¸ºä¸‹è½½</em></strong></p><p>é¦–å…ˆé˜¿é‡Œäº‘è§„å®š</p><blockquote><p>å¯¹äºå›¾ç‰‡æ–‡ä»¶ï¼ˆåœ¨æœªä¿®æ”¹æ–‡ä»¶httpå¤´çš„æƒ…å†µä¸‹ï¼‰ï¼š<br>è‹¥æ‚¨çš„Bucketæ˜¯2019å¹´9æœˆ23æ—¥å‰åˆ›å»ºçš„ï¼Œä½¿ç”¨OSSé»˜è®¤è®¿é—®åŸŸåæˆ–è‡ªæœ‰åŸŸåç”Ÿæˆçš„æ–‡ä»¶URLä»æµè§ˆå™¨è®¿é—®æ—¶å¯ä»¥é¢„è§ˆæ–‡ä»¶å†…å®¹ã€‚<br>è‹¥æ‚¨çš„Bucketæ˜¯2019å¹´9æœˆ23æ—¥ååˆ›å»ºçš„ï¼Œä½¿ç”¨OSSé»˜è®¤åŸŸåç”Ÿæˆçš„æ–‡ä»¶URLä»æµè§ˆå™¨è®¿é—®æ—¶ä¼šä»¥é™„ä»¶å½¢å¼ä¸‹è½½ï¼›ä½¿ç”¨è‡ªæœ‰åŸŸåç”Ÿæˆçš„æ–‡ä»¶URLè®¿é—®æ—¶ï¼Œå¯ä»¥é¢„è§ˆ&gt; æ–‡ä»¶å†…å®¹ã€‚ç»‘å®šè‡ªæœ‰åŸŸåæ­¥éª¤è¯·å‚è§ç»‘å®šè‡ªå®šä¹‰åŸŸåã€‚</p></blockquote><p>ç„¶åæ˜¯ä¸Šä¼ çš„å›¾ç‰‡ä¸èƒ½æ·»åŠ  <code>Content-Disposition</code> è¿”å›å¤´ä¿¡æ¯ï¼Œç»™æ–‡ä»¶æ·»åŠ äº†è¿™ä¸ª http è¿”å›å¤´ï¼Œä¹Ÿä¼šè®©å›¾ç‰‡å˜æˆä¸‹è½½ã€‚</p><hr><p><strong><em><code>egg-multipart</code> æ’ä»¶ä½¿ç”¨ <code>stream</code> æ¨¡å¼æ— æ³•è·å–è¯·æ±‚ä½“ä¼ è¿‡æ¥çš„å‚æ•°</em></strong></p><p>ç”¨ <code>file</code> æ¨¡å¼èƒ½å¤Ÿæ­£ç¡®çš„æ‹¿åˆ° <code>ctx.request.body</code> é‡Œçš„è¯·æ±‚å‚æ•°ï¼Œä½†æ˜¯å°†ä½¿ç”¨ <code>stream</code> æ¨¡å¼å°±æ— æ³•è·å–ï¼Œæœç´¢äº†ä¸€ä¸‹åå‘ç°ä½¿ç”¨ <code>stream</code> æ¨¡å¼éœ€è¦å°†ä¸Šä¼ æ–‡ä»¶æ”¾åˆ°è¡¨å•çš„æœ€åä¸€é¡¹å»ï¼Œä¸ç„¶æ‹¿ä¸åˆ°å…¶å®ƒå‚æ•°ã€‚</p><blockquote><p><a href="https://eggjs.org/zh-cn/basics/controller.html#%E8%8E%B7%E5%8F%96%E4%B8%8A%E4%BC%A0%E7%9A%84%E6%96%87%E4%BB%B6" target="_blank" rel="noopener">https://eggjs.org/zh-cn/basics/controller.html#%E8%8E%B7%E5%8F%96%E4%B8%8A%E4%BC%A0%E7%9A%84%E6%96%87%E4%BB%B6</a><br>åªæ”¯æŒä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ã€‚<br>ä¸Šä¼ æ–‡ä»¶å¿…é¡»åœ¨æ‰€æœ‰å…¶ä»–çš„ fields åé¢ï¼Œå¦åˆ™åœ¨æ‹¿åˆ°æ–‡ä»¶æµæ—¶å¯èƒ½è¿˜è·å–ä¸åˆ° fieldsã€‚</p></blockquote><hr><p><strong><em>Redis æ— æ³•é“¾æ¥é—®é¢˜</em></strong></p><p>ç”¨ä»¥ä¸‹çš„ <code>docker-compose.yml</code> æ–‡ä»¶å¯åŠ¨ Egg.js åº”ç”¨å’Œä¸€ä¸ª <code>Redis</code> æœåŠ¡ï¼Œç„¶åæƒ³åœ¨ä¸Šä¼ æ¥å£çš„è¯·æ±‚é¢‘ç‡é™åˆ¶çš„ä¸­é—´ä»¶ä¸­ä½¿ç”¨è¿™ä¸ª <code>Redis</code> æœåŠ¡ï¼Œç„¶åä¸€ç›´æŠ¥é“¾æ¥å¤±è´¥â€¦Google ä¹‹åè¯•äº†å‡ ç§æ–¹æ³•ä¾ç„¶æ²¡æœ‰æˆåŠŸ :sad:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"6379:6379"</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">upload-server-network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">upload_server:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">upload_server</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">EGG_SERVER_ENV:prod</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7001</span><span class="string">:7001</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">upload-server-network</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">upload-server-network:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line"></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure><hr><p><strong><em>Egg.js å…¨å±€é”™è¯¯å¤„ç†è¿”å›æ ¼å¼é—®é¢˜</em></strong></p><p>Egg.js æœ¬èº«æœ‰ä¸€ä¸ªå…¨å±€é”™è¯¯å¤„ç†çš„æ’ä»¶ <a href="https://github.com/eggjs/egg-onerror" target="_blank" rel="noopener">egg-onerror</a>ï¼Œä½†æ˜¯ç”¨è¿™ä¸ªæ’ä»¶åœ¨å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„å¼‚å¸¸æ—¶ï¼Œç›´æ¥ <code>throw</code> é”™è¯¯ï¼Œè¿”å›ç»™å‰ç«¯çš„æ•°æ®æ ¼å¼æ˜¯æ–‡æœ¬ç±»å‹çš„ï¼Œä¸æ˜¯ json æ ¼å¼ï¼Œé™¤éå‰ç«¯åœ¨å‘é€è¯·æ±‚çš„æ·»åŠ  <code>Accept: application/json</code> è¯·æ±‚å¤´ä¿¡æ¯ã€‚<br>åªèƒ½åœ¨ <code>config.default.js</code> ä½¿ç”¨ <code>all</code> è¿›è¡Œæ•è·å¼‚å¸¸ï¼Œç„¶åç”¨ <code>JSON.stringify</code> æ–¹æ³•åœ¨å¤„ç†ä¸€éï¼Œè¿™æ · <code>throw new Error(e.message)</code> çš„æ—¶å€™è¿”å›ç»™å‰ç«¯çš„æ‰æ˜¯ jsonã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">config.onerror = &#123;</span><br><span class="line">  all(err, ctx) &#123;</span><br><span class="line">    ctx.status = err.status || <span class="number">500</span></span><br><span class="line"></span><br><span class="line">    ctx.body = <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">      code: ctx.status,</span><br><span class="line">      success: <span class="literal">false</span>,</span><br><span class="line">      message: err.message,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆè¿˜æ˜¯æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼Œè‡ªå·±æ·»åŠ äº†ä¸€ä¸ªæ–¹æ³•ï¼Œè¿›è¡Œå¼‚å¸¸æ•è·ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> error(msg) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; ctx &#125; = <span class="keyword">this</span></span><br><span class="line"></span><br><span class="line">  ctx.status = <span class="number">400</span></span><br><span class="line">  ctx.body = &#123;</span><br><span class="line">    code: ctx.status,</span><br><span class="line">    success: <span class="literal">false</span>,</span><br><span class="line">    message: msg,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.error(<span class="string">'é”™è¯¯çš„ bucket'</span>)</span><br><span class="line"><span class="keyword">return</span></span><br></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ€»ç»“ä¸€ä¸‹ä¹‹å‰ç”¨ Egg.js å¼€å‘çš„æ–‡ä»¶ä¸Šä¼ æ¥å£çš„ä»»åŠ¡&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Node" scheme="https://coldstone.fun/tags/Node/"/>
    
      <category term="Egg.js" scheme="https://coldstone.fun/tags/Egg-js/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Flutter å®ç°ä¸€ä¸ªèµ°é©¬ç¯å¸ƒå±€</title>
    <link href="https://coldstone.fun/post/2019/11/20/flutter-carousel/"/>
    <id>https://coldstone.fun/post/2019/11/20/flutter-carousel/</id>
    <published>2019-11-20T07:55:26.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>èµ°é©¬ç¯æ˜¯ä¸€ç§å¸¸è§çš„æ•ˆæœï¼Œæœ¬æ–‡è®²ä¸€ä¸‹å¦‚ä½•ç”¨ <code>PageView</code> åœ¨ <code>Flutter</code> é‡Œå®ç°ä¸€ä¸ªèµ°é©¬ç¯</p><a id="more"></a><h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p>å®ç°çš„æ•ˆæœå¦‚ä¸‹ï¼Œå½“å‰é¡µé¢çš„é«˜åº¦æ¯”å…¶å®ƒé¡µé¢é«˜ï¼Œåˆ‡æ¢é¡µé¢çš„æ—¶å€™æœ‰ä¸€ä¸ªé«˜åº¦å˜åŒ–çš„åŠ¨ç”»ã€‚å®ç°è¿™æ ·çš„æ•ˆæœä¸»è¦ç”¨åˆ°çš„æ˜¯ <code>PageView.builder</code> éƒ¨ä»¶ã€‚</p><div>  <video src="videos/heroes.mp4" controls width="320" autoplay muted /></div><h2 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h2><h3 id="åˆ›å»ºé¦–é¡µ"><a href="#åˆ›å»ºé¦–é¡µ" class="headerlink" title="åˆ›å»ºé¦–é¡µ"></a>åˆ›å»ºé¦–é¡µ</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>IndexPage</code> éƒ¨ä»¶ï¼Œè¿™ä¸ªéƒ¨ä»¶ç”¨æ¥æ”¾ <code>PageView</code>ï¼Œå› ä¸ºéœ€è¦ä½¿ç”¨ <code>setState</code> æ–¹æ³•æ›´æ–° UIï¼Œæ‰€ä»¥å®ƒæ˜¯ stateful çš„ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexPage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _IndexPageState createState() =&gt; _IndexPageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_IndexPageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">IndexPage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        elevation: <span class="number">0.0</span>,</span><br><span class="line">        backgroundColor: Colors.white,</span><br><span class="line">      ),</span><br><span class="line">      body: Column(</span><br><span class="line">        children: &lt;Widget&gt;[],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨éƒ¨ä»¶å†…ç”³æ˜ä¸€ä¸ª <code>_pageIndex</code> å˜é‡ç”¨æ¥ä¿å­˜å½“å‰æ˜¾ç¤ºçš„é¡µé¢çš„ indexï¼Œåœ¨ <code>initState</code> ç”Ÿå‘½å‘¨æœŸé‡Œé¢åˆå§‹åŒ–ä¸€ä¸ª <code>PageController</code> ç”¨æ¥é…ç½® <code>PageView</code> éƒ¨ä»¶ã€‚</p><p>åœ¨ <code>body</code> çš„ <code>Column</code> é‡Œé¢åˆ›å»ºä¸€ä¸ª <code>PageView.builder</code>ï¼Œä½¿ç”¨ä¸€ä¸ª <code>SizedBox</code> éƒ¨ä»¶æŒ‡å®š <code>PageView</code> çš„é«˜åº¦ï¼Œå°† <code>controller</code> è®¾ç½®ä¸º <code>_pageController</code>ï¼Œåœ¨ <code>onPageChanged</code> äº‹ä»¶é‡Œå°†å½“å‰æ˜¾ç¤ºé¡µé¢çš„ <code>index</code> å€¼èµ‹å€¼ç»™ <code>_pageIndex</code> å˜é‡ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> _pageIndex = <span class="number">0</span>;</span><br><span class="line">PageController _pageController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> initState() &#123;</span><br><span class="line">  <span class="keyword">super</span>.initState();</span><br><span class="line">  _pageController = PageController(</span><br><span class="line">    initialPage: <span class="number">0</span>,</span><br><span class="line">    viewportFraction: <span class="number">0.8</span>,</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">body: Column(</span><br><span class="line">  children: &lt;Widget&gt;[</span><br><span class="line">    SizedBox(</span><br><span class="line">      height: <span class="number">580.0</span>,</span><br><span class="line">      child: PageView.builder(</span><br><span class="line">        itemCount: <span class="number">3</span>,</span><br><span class="line">        pageSnapping: <span class="keyword">true</span>,</span><br><span class="line">        controller: _pageController,</span><br><span class="line">        onPageChanged: (<span class="built_in">int</span> index) &#123;</span><br><span class="line">          setState(() &#123;</span><br><span class="line">            _pageIndex = index;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        itemBuilder: (BuildContext ctx, <span class="built_in">int</span> index) &#123;</span><br><span class="line">          <span class="keyword">return</span> _buildItem(_pageIndex, index);</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">  ],</span><br><span class="line">),</span><br></pre></td></tr></table></figure><blockquote><p>å…³é”®ç‚¹: è®¾ç½® <code>PageController</code> çš„ <code>viewportFraction</code> å‚æ•°å°äº 1ï¼Œè¿™ä¸ªå€¼æ˜¯ç”¨æ¥è®¾ç½®æ¯ä¸ªé¡µé¢åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„æ¯”ä¾‹ï¼Œå°äº 1 çš„è¯ï¼Œå°±å¯ä»¥åœ¨å½“å‰é¡µé¢åŒæ—¶æ˜¾ç¤ºå…¶å®ƒé¡µé¢çš„å†…å®¹äº†ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// <span class="markdown">The fraction of the viewport that each page should occupy.</span></span></span><br><span class="line"><span class="comment">/// <span class="markdown">Defaults to 1.0, which means each page fills the viewport in the scrolling direction.</span></span></span><br><span class="line"><span class="keyword">final</span> <span class="built_in">double</span> viewportFraction;</span><br></pre></td></tr></table></figure></blockquote><h3 id="å®ç°-buildItem"><a href="#å®ç°-buildItem" class="headerlink" title="å®ç° _buildItem"></a>å®ç° <code>_buildItem</code></h3><p>æ¥ç€å®ç° <code>_buildItem</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯è¿”å› <code>PageView.builder</code> é‡Œæ¯ä¸€ä¸ªé¡µé¢æ¸²æŸ“çš„å†…å®¹ï¼Œç¬¬ä¸€ä¸ªå‚æ•° <code>activeIndex</code> æ˜¯å½“å‰æ˜¾ç¤ºåœ¨å±å¹•ä¸Šé¡µé¢çš„ <code>index</code>ï¼Œç¬¬äºŒä¸ªå‚æ•° <code>index</code> æ˜¯æ¯ä¸€é¡¹è‡ªå·±çš„ <code>index</code>ã€‚</p><p>ä½¿ç”¨ä¸€ä¸ª <code>Center</code> éƒ¨ä»¶è®©å†…å®¹å±…ä¸­æ˜¾ç¤ºï¼Œç„¶åç”¨ä¸€ä¸ª <code>AnimatedContainer</code> æ·»åŠ é¡µé¢åˆ‡æ¢æ—¶çš„é«˜åº¦å˜åŒ–çš„åŠ¨ç”»æ•ˆæœï¼Œåˆ‡æ¢é¡µé¢çš„æ—¶å€™ä½¿ç”¨äº†<code>setState</code> æ–¹æ³•æ”¹å˜äº† <code>_pageIndex</code>ï¼Œ<code>Flutter</code> é‡æ–°ç»˜åˆ¶æ¯ä¸€é¡¹ã€‚å…³é”®ç‚¹åœ¨äºåˆ¤æ–­å½“å‰é¡µé¢æ˜¯å¦ä¸ºæ­£åœ¨æ˜¾ç¤ºçš„é¡µé¢ï¼Œæ˜¯çš„è¯å®ƒçš„é«˜åº¦å°±æ˜¯ 500 ä¸æ˜¯çš„è¯å°±æ˜¯ 450ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">_buildItem(activeIndex, index) &#123;</span><br><span class="line">  <span class="keyword">return</span> Center(</span><br><span class="line">    child: AnimatedContainer(</span><br><span class="line">      curve: Curves.easeInOut,</span><br><span class="line">      duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">300</span>),</span><br><span class="line">      height: activeIndex == index ? <span class="number">500.0</span> : <span class="number">450.0</span>,</span><br><span class="line">      margin: EdgeInsets.symmetric(vertical: <span class="number">20.0</span>, horizontal: <span class="number">10.0</span>),</span><br><span class="line">      decoration: BoxDecoration(</span><br><span class="line">        color: heroes[index].color,</span><br><span class="line">        borderRadius: BorderRadius.all(Radius.circular(<span class="number">12.0</span>)),</span><br><span class="line">      ),</span><br><span class="line">      child: Stack(),</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="images/empty00.jpg" width="320"  style="width: 320px;"/><h3 id="æ·»åŠ å†…å®¹"><a href="#æ·»åŠ å†…å®¹" class="headerlink" title="æ·»åŠ å†…å®¹"></a>æ·»åŠ å†…å®¹</h3><p>ç„¶åç»™ <code>AnimatedContainer</code> æ·»åŠ æ¯ä¸€é¡¹çš„å†…å®¹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">child: Stack(</span><br><span class="line">  fit: StackFit.expand,</span><br><span class="line">  children: &lt;Widget&gt;[</span><br><span class="line">    ClipRRect(</span><br><span class="line">      borderRadius: BorderRadius.all(</span><br><span class="line">        Radius.circular(<span class="number">12.0</span>),</span><br><span class="line">      ),</span><br><span class="line">      child: Image.network(</span><br><span class="line">        heroes[index].image,</span><br><span class="line">        fit: BoxFit.cover,</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">    Align(</span><br><span class="line">      alignment: Alignment.bottomCenter,</span><br><span class="line">      child: Row(</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          Expanded(</span><br><span class="line">            child: Container(</span><br><span class="line">              padding: EdgeInsets.all(<span class="number">12.0</span>),</span><br><span class="line">              decoration: BoxDecoration(</span><br><span class="line">                color: Colors.black26,</span><br><span class="line">                borderRadius: BorderRadius.only(</span><br><span class="line">                  bottomRight: Radius.circular(<span class="number">12.0</span>),</span><br><span class="line">                  bottomLeft: Radius.circular(<span class="number">12.0</span>),</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">              child: Text(</span><br><span class="line">                heroes[index].title,</span><br><span class="line">                textAlign: TextAlign.center,</span><br><span class="line">                style: TextStyle(</span><br><span class="line">                  fontSize: <span class="number">20.0</span>,</span><br><span class="line">                  fontWeight: FontWeight.bold,</span><br><span class="line">                  color: Colors.white,</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          )</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">  ],</span><br><span class="line">),</span><br></pre></td></tr></table></figure><h3 id="å®ç°æŒ‡ç¤ºå™¨"><a href="#å®ç°æŒ‡ç¤ºå™¨" class="headerlink" title="å®ç°æŒ‡ç¤ºå™¨"></a>å®ç°æŒ‡ç¤ºå™¨</h3><p>ç„¶åå®ç°é¡µé¢çš„æŒ‡ç¤ºå™¨ï¼Œåˆ›å»ºä¸€ä¸ª <code>PageIndicator</code> éƒ¨ä»¶ï¼Œéœ€è¦ä¼ å…¥ <code>pageCount</code> è¡¨ç¤ºæ€»é¡µæ•°ï¼Œä»¥åŠ <code>currentIndex</code> è¡¨ç¤ºå½“å‰æ˜¾ç¤ºçš„é¡µæ•°ç´¢å¼•ã€‚æŠŠæ‰€æœ‰æŒ‡ç¤ºå™¨æ”¾åœ¨ä¸€ä¸ª <code>Row</code> éƒ¨ä»¶é‡Œï¼Œåˆ¤æ–­å½“å‰æŒ‡ç¤ºå™¨çš„ <code>index</code> æ˜¯å¦ä¸ºæ­£åœ¨æ˜¾ç¤ºé¡µé¢çš„ <code>index</code>ï¼Œæ˜¯çš„è¯æ˜¾ç¤ºè¾ƒæ·±çš„é¢œè‰²ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageIndicator</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> pageCount;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> currentIndex;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> PageIndicator(<span class="keyword">this</span>.currentIndex, <span class="keyword">this</span>.pageCount);</span><br><span class="line"></span><br><span class="line">  Widget _indicator(<span class="built_in">bool</span> isActive) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      width: <span class="number">6.0</span>,</span><br><span class="line">      height: <span class="number">6.0</span>,</span><br><span class="line">      margin: EdgeInsets.symmetric(horizontal: <span class="number">3.0</span>),</span><br><span class="line">      decoration: BoxDecoration(</span><br><span class="line">        color: isActive ? Color(<span class="number">0xff666a84</span>) : Color(<span class="number">0xffb9bcca</span>),</span><br><span class="line">        shape: BoxShape.circle,</span><br><span class="line">        boxShadow: [</span><br><span class="line">          BoxShadow(</span><br><span class="line">            color: Colors.black12,</span><br><span class="line">            offset: Offset(<span class="number">0.0</span>, <span class="number">3.0</span>),</span><br><span class="line">            blurRadius: <span class="number">3.0</span>,</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">List</span>&lt;Widget&gt; _buildIndicators() &#123;</span><br><span class="line">    <span class="built_in">List</span>&lt;Widget&gt; indicators = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; pageCount; i++) &#123;</span><br><span class="line">      indicators.add(i == currentIndex ? _indicator(<span class="keyword">true</span>) : _indicator(<span class="keyword">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> indicators;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Row(</span><br><span class="line">      mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">      children: _buildIndicators(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ·»åŠ  <code>PageIndicator</code> åˆ° <code>SizedBox</code> ä¸‹æ”¾</p><h3 id="å°è£…-Carousel"><a href="#å°è£…-Carousel" class="headerlink" title="å°è£… Carousel"></a>å°è£… <code>Carousel</code></h3><p>æœ€åçš„æœ€åä¼˜åŒ–ä¸€ä¸‹ä»£ç ï¼ŒæŠŠéƒ¨ä»¶å°è£…ä¸€ä¸‹ï¼Œè®©å®ƒæˆä¸ºä¸€ä¸ªå•ç‹¬çš„éƒ¨ä»¶ï¼Œåˆ›å»ºä¸€ä¸ª <code>Carousel</code> éƒ¨ä»¶ï¼Œå¯¹å¤–æš´éœ² <code>items</code> å’Œ <code>height</code> ä¸¤ä¸ªå±æ€§ï¼Œåˆ†åˆ«é…ç½®æ•°æ®å’Œé«˜åº¦ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Carousel</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span> items;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> height;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> Carousel(&#123;</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.items,</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.height,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _CarouselState createState() =&gt; _CarouselState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_CarouselState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">Carousel</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _pageIndex = <span class="number">0</span>;</span><br><span class="line">  PageController _pageController;</span><br><span class="line"></span><br><span class="line">  Widget _buildItem(activeIndex, index) &#123;</span><br><span class="line">    <span class="keyword">final</span> items = widget.items;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Center(</span><br><span class="line">      child: AnimatedContainer(</span><br><span class="line">        curve: Curves.easeInOut,</span><br><span class="line">        duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">300</span>),</span><br><span class="line">        height: activeIndex == index ? <span class="number">500.0</span> : <span class="number">450.0</span>,</span><br><span class="line">        margin: EdgeInsets.symmetric(vertical: <span class="number">20.0</span>, horizontal: <span class="number">10.0</span>),</span><br><span class="line">        decoration: BoxDecoration(</span><br><span class="line">          color: items[index].color,</span><br><span class="line">          borderRadius: BorderRadius.all(Radius.circular(<span class="number">12.0</span>)),</span><br><span class="line">        ),</span><br><span class="line">        child: Stack(</span><br><span class="line">          fit: StackFit.expand,</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            ClipRRect(</span><br><span class="line">              borderRadius: BorderRadius.all(</span><br><span class="line">                Radius.circular(<span class="number">12.0</span>),</span><br><span class="line">              ),</span><br><span class="line">              child: Image.network(</span><br><span class="line">                items[index].image,</span><br><span class="line">                fit: BoxFit.cover,</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">            Align(</span><br><span class="line">              alignment: Alignment.bottomCenter,</span><br><span class="line">              child: Row(</span><br><span class="line">                children: &lt;Widget&gt;[</span><br><span class="line">                  Expanded(</span><br><span class="line">                    child: Container(</span><br><span class="line">                      padding: EdgeInsets.all(<span class="number">12.0</span>),</span><br><span class="line">                      decoration: BoxDecoration(</span><br><span class="line">                        color: Colors.black26,</span><br><span class="line">                        borderRadius: BorderRadius.only(</span><br><span class="line">                          bottomRight: Radius.circular(<span class="number">12.0</span>),</span><br><span class="line">                          bottomLeft: Radius.circular(<span class="number">12.0</span>),</span><br><span class="line">                        ),</span><br><span class="line">                      ),</span><br><span class="line">                      child: Text(</span><br><span class="line">                        items[index].title,</span><br><span class="line">                        textAlign: TextAlign.center,</span><br><span class="line">                        style: TextStyle(</span><br><span class="line">                          fontSize: <span class="number">20.0</span>,</span><br><span class="line">                          fontWeight: FontWeight.bold,</span><br><span class="line">                          color: Colors.white,</span><br><span class="line">                        ),</span><br><span class="line">                      ),</span><br><span class="line">                    ),</span><br><span class="line">                  )</span><br><span class="line">                ],</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _pageController = PageController(</span><br><span class="line">      initialPage: <span class="number">0</span>,</span><br><span class="line">      viewportFraction: <span class="number">0.8</span>,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        Container(</span><br><span class="line">          height: widget.height,</span><br><span class="line">          child: PageView.builder(</span><br><span class="line">            pageSnapping: <span class="keyword">true</span>,</span><br><span class="line">            itemCount: heroes.length,</span><br><span class="line">            controller: _pageController,</span><br><span class="line">            onPageChanged: (<span class="built_in">int</span> index) &#123;</span><br><span class="line">              setState(() &#123;</span><br><span class="line">                _pageIndex = index;</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            itemBuilder: (BuildContext ctx, <span class="built_in">int</span> index) &#123;</span><br><span class="line">              <span class="keyword">return</span> _buildItem(_pageIndex, index);</span><br><span class="line">            &#125;,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        PageIndicator(_pageIndex, widget.items.length),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹ååœ¨ <code>IndexPage</code> éƒ¨ä»¶é‡Œå°±åªç”¨å®ä¾‹åŒ–ä¸€ä¸ª <code>Carousel</code> äº†ï¼ŒåŒæ—¶ç”±äº <code>IndexPage</code> ä¸ç”¨ç®¡ç†éƒ¨ä»¶çŠ¶æ€äº†ï¼Œå¯ä»¥å°†å®ƒå˜æˆ <code>StatelessWidget</code>ã€‚</p><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Color color;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> image;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> title;</span><br><span class="line"></span><br><span class="line">  Hero(&#123;</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.color,</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.image,</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.title,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">List</span> heroes = [</span><br><span class="line">  Hero(</span><br><span class="line">    color: Color(<span class="number">0xFF86F3FB</span>),</span><br><span class="line">    image: <span class="string">"https://game.gtimg.cn/images/lol/act/img/skin/big22009.jpg"</span>,</span><br><span class="line">    title: <span class="string">'å¯’å†°å°„æ‰‹-è‰¾å¸Œ'</span>,</span><br><span class="line">  ),</span><br><span class="line">  Hero(</span><br><span class="line">    color: Color(<span class="number">0xFF7D6588</span>),</span><br><span class="line">    image: <span class="string">"https://game.gtimg.cn/images/lol/act/img/skin/big39006.jpg"</span>,</span><br><span class="line">    title: <span class="string">'åˆ€é”‹èˆè€…-è‰¾ç‘è‰å¨…'</span>,</span><br><span class="line">  ),</span><br><span class="line">  Hero(</span><br><span class="line">    color: Color(<span class="number">0xFF4C314D</span>),</span><br><span class="line">    image: <span class="string">"https://game.gtimg.cn/images/lol/act/img/skin/big103015.jpg"</span>,</span><br><span class="line">    title: <span class="string">'ä¹å°¾å¦–ç‹-é˜¿ç‹¸'</span>,</span><br><span class="line">  ),</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Carousel</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span> items;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> height;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> Carousel(&#123;</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.items,</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.height,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _CarouselState createState() =&gt; _CarouselState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_CarouselState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">Carousel</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _pageIndex = <span class="number">0</span>;</span><br><span class="line">  PageController _pageController;</span><br><span class="line"></span><br><span class="line">  Widget _buildItem(activeIndex, index) &#123;</span><br><span class="line">    <span class="keyword">final</span> items = widget.items;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Center(</span><br><span class="line">      child: AnimatedContainer(</span><br><span class="line">        curve: Curves.easeInOut,</span><br><span class="line">        duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">300</span>),</span><br><span class="line">        height: activeIndex == index ? <span class="number">500.0</span> : <span class="number">450.0</span>,</span><br><span class="line">        margin: EdgeInsets.symmetric(vertical: <span class="number">20.0</span>, horizontal: <span class="number">10.0</span>),</span><br><span class="line">        decoration: BoxDecoration(</span><br><span class="line">          color: items[index].color,</span><br><span class="line">          borderRadius: BorderRadius.all(Radius.circular(<span class="number">12.0</span>)),</span><br><span class="line">        ),</span><br><span class="line">        child: Stack(</span><br><span class="line">          fit: StackFit.expand,</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            ClipRRect(</span><br><span class="line">              borderRadius: BorderRadius.all(</span><br><span class="line">                Radius.circular(<span class="number">12.0</span>),</span><br><span class="line">              ),</span><br><span class="line">              child: Image.network(</span><br><span class="line">                items[index].image,</span><br><span class="line">                fit: BoxFit.cover,</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">            Align(</span><br><span class="line">              alignment: Alignment.bottomCenter,</span><br><span class="line">              child: Row(</span><br><span class="line">                children: &lt;Widget&gt;[</span><br><span class="line">                  Expanded(</span><br><span class="line">                    child: Container(</span><br><span class="line">                      padding: EdgeInsets.all(<span class="number">12.0</span>),</span><br><span class="line">                      decoration: BoxDecoration(</span><br><span class="line">                        color: Colors.black26,</span><br><span class="line">                        borderRadius: BorderRadius.only(</span><br><span class="line">                          bottomRight: Radius.circular(<span class="number">12.0</span>),</span><br><span class="line">                          bottomLeft: Radius.circular(<span class="number">12.0</span>),</span><br><span class="line">                        ),</span><br><span class="line">                      ),</span><br><span class="line">                      child: Text(</span><br><span class="line">                        items[index].title,</span><br><span class="line">                        textAlign: TextAlign.center,</span><br><span class="line">                        style: TextStyle(</span><br><span class="line">                          fontSize: <span class="number">20.0</span>,</span><br><span class="line">                          fontWeight: FontWeight.bold,</span><br><span class="line">                          color: Colors.white,</span><br><span class="line">                        ),</span><br><span class="line">                      ),</span><br><span class="line">                    ),</span><br><span class="line">                  )</span><br><span class="line">                ],</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _pageController = PageController(</span><br><span class="line">      initialPage: <span class="number">0</span>,</span><br><span class="line">      viewportFraction: <span class="number">0.8</span>,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        Container(</span><br><span class="line">          height: widget.height,</span><br><span class="line">          child: PageView.builder(</span><br><span class="line">            pageSnapping: <span class="keyword">true</span>,</span><br><span class="line">            itemCount: heroes.length,</span><br><span class="line">            controller: _pageController,</span><br><span class="line">            onPageChanged: (<span class="built_in">int</span> index) &#123;</span><br><span class="line">              setState(() &#123;</span><br><span class="line">                _pageIndex = index;</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            itemBuilder: (BuildContext ctx, <span class="built_in">int</span> index) &#123;</span><br><span class="line">              <span class="keyword">return</span> _buildItem(_pageIndex, index);</span><br><span class="line">            &#125;,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        PageIndicator(_pageIndex, widget.items.length),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageIndicator</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> currentIndex;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> pageCount;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> PageIndicator(<span class="keyword">this</span>.currentIndex, <span class="keyword">this</span>.pageCount);</span><br><span class="line"></span><br><span class="line">  Widget _indicator(<span class="built_in">bool</span> isActive) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      width: <span class="number">6.0</span>,</span><br><span class="line">      height: <span class="number">6.0</span>,</span><br><span class="line">      margin: EdgeInsets.symmetric(horizontal: <span class="number">3.0</span>),</span><br><span class="line">      decoration: BoxDecoration(</span><br><span class="line">        color: isActive ? Color(<span class="number">0xff666a84</span>) : Color(<span class="number">0xffb9bcca</span>),</span><br><span class="line">        shape: BoxShape.circle,</span><br><span class="line">        boxShadow: [</span><br><span class="line">          BoxShadow(</span><br><span class="line">            color: Colors.black12,</span><br><span class="line">            offset: Offset(<span class="number">0.0</span>, <span class="number">3.0</span>),</span><br><span class="line">            blurRadius: <span class="number">3.0</span>,</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">List</span>&lt;Widget&gt; _buildIndicators() &#123;</span><br><span class="line">    <span class="built_in">List</span>&lt;Widget&gt; indicators = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; pageCount; i++) &#123;</span><br><span class="line">      indicators.add(i == currentIndex ? _indicator(<span class="keyword">true</span>) : _indicator(<span class="keyword">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> indicators;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Row(</span><br><span class="line">      mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">      children: _buildIndicators(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        elevation: <span class="number">0.0</span>,</span><br><span class="line">        backgroundColor: Colors.white,</span><br><span class="line">      ),</span><br><span class="line">      body: Carousel(</span><br><span class="line">        height: <span class="number">540</span>,</span><br><span class="line">        items: heroes,</span><br><span class="line">      ),</span><br><span class="line">      backgroundColor: Colors.white,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæ•´ä¸ªå¸ƒå±€å°±å®Œæˆäº†ï¼ ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;èµ°é©¬ç¯æ˜¯ä¸€ç§å¸¸è§çš„æ•ˆæœï¼Œæœ¬æ–‡è®²ä¸€ä¸‹å¦‚ä½•ç”¨ &lt;code&gt;PageView&lt;/code&gt; åœ¨ &lt;code&gt;Flutter&lt;/code&gt; é‡Œå®ç°ä¸€ä¸ªèµ°é©¬ç¯&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†äº«ä¸¤é“é¢è¯•é¢˜</title>
    <link href="https://coldstone.fun/post/2019/11/15/two-interview-question/"/>
    <id>https://coldstone.fun/post/2019/11/15/two-interview-question/</id>
    <published>2019-11-15T02:33:15.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>å‰å‡ å¤©é‡åˆ°ä¸¤ä¸ªå‰ç«¯é¢è¯•é¢˜ï¼Œè¦å†™ä»£ç çš„é‚£ç§ï¼Œç„¶åæˆ‘éƒ½æ²¡åšå¯¹â€¦è®°å½•ä¸€ä¸‹</p><a id="more"></a><p>å‰å‡ å¤©é‡åˆ°ä¸¤ä¸ªå‰ç«¯é¢è¯•é¢˜ï¼Œè¦å†™ä»£ç çš„é‚£ç§ï¼Œç„¶åæˆ‘éƒ½æ²¡åšå¯¹â€¦è®°å½•ä¸€ä¸‹</p><h2 id="ç¬¬ä¸€é¢˜"><a href="#ç¬¬ä¸€é¢˜" class="headerlink" title="ç¬¬ä¸€é¢˜"></a>ç¬¬ä¸€é¢˜</h2><blockquote><p>JavaScript é‡‡ç”¨åŸå‹ç»§æ‰¿ï¼Œå³ä¸€ä¸ªå¯¹è±¡ç»§æ‰¿è‡ªå¦å¤–ä¸€ä¸ªå¯¹è±¡ï¼Œå¦å¤–ä¸€ä¸ªå¯¹è±¡å†ç»§æ‰¿è‡ªåˆ«çš„å¯¹è±¡ï¼Œä¾æ­¤å¾€å¤ã€‚è¯·å†™ä¸€ä¸ªé€šç”¨çš„ JavaScript å‡½æ•°ï¼Œæ¥æ‰¾å‡ºæŸä¸ªå¯¹è±¡èº«ä¸Šçš„æŸä¸ªå±æ€§ç»§æ‰¿è‡ªå“ªä¸ªå¯¹è±¡ã€‚</p></blockquote><p>è§£ç­”: å®é™…ä¸Šæ˜¯åœ¨è€ƒå¯Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡ä¸Šçš„å±æ€§æ˜¯æœ¬èº«çš„è¿˜æ˜¯é€šè¿‡ç»§æ‰¿æ¥çš„ï¼Œä½¿ç”¨ <code>hasOwnProperty</code> å’Œ <code>getPrototypeOf</code> æ–¹æ³•å³å¯</p><figure class="highlight javascript"><figcaption><span>get-prototype.js</span><a href="/code/get-prototype.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPrototype</span>(<span class="params">obj, key</span>) </span>{</span><br><span class="line">  <span class="keyword">if</span> (obj.hasOwnProperty(key)) {</span><br><span class="line">    <span class="keyword">return</span> obj</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> getPrototype(<span class="built_in">Object</span>.getPrototypeOf(obj), key)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = { <span class="attr">a</span>: <span class="string">'a'</span> }</span><br><span class="line"><span class="keyword">const</span> o1 = <span class="built_in">Object</span>.create(obj)</span><br><span class="line">o1.b = <span class="string">'b'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(o1.a) <span class="comment">// a</span></span><br><span class="line"><span class="built_in">console</span>.log(o1.b) <span class="comment">// b</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(o1.hasOwnProperty(<span class="string">'a'</span>)) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(o1.hasOwnProperty(<span class="string">'b'</span>)) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(getPrototype(o1, <span class="string">'a'</span>)) <span class="comment">// { a: 'a' }</span></span><br><span class="line"><span class="built_in">console</span>.log(getPrototype(o1, <span class="string">'b'</span>)) <span class="comment">// { b: 'b' }</span></span><br></pre></td></tr></table></figure><p>ç›¸å…³æ–‡ç« </p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain" target="_blank" rel="noopener">ç»§æ‰¿ä¸åŸå‹é“¾</a></p><h2 id="ç¬¬äºŒé¢˜"><a href="#ç¬¬äºŒé¢˜" class="headerlink" title="ç¬¬äºŒé¢˜"></a>ç¬¬äºŒé¢˜</h2><blockquote><p><code>URLSearchParams()</code>  å¯ä»¥è§£æå’Œå¤„ç†URLå‚æ•°ï¼Œç›®å‰å…¼å®¹æ€§ä¸€èˆ¬ï¼Œè¯·å®ç° <code>class URLSearchParams</code> çš„ polyfillã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">searchParams = <span class="keyword">new</span> URLSearchParams(<span class="string">"foo=1&amp;bar=2"</span>)</span><br><span class="line"><span class="comment">// æˆ–è€…è¿™æ ·ä¼ å…¥</span></span><br><span class="line">searchParams = <span class="keyword">new</span> URLSearchParams(&#123;<span class="attr">foo</span>: <span class="string">"1"</span>, <span class="attr">bar</span>: <span class="string">"2"</span>&#125;)</span><br><span class="line"><span class="comment">// å®ä¾‹æ”¯æŒ get()ã€set()ã€has()ã€append() å››ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="comment">// æ”¯æŒä»¥ä¸‹æ–¹å¼</span></span><br><span class="line">searchParams.get(<span class="string">"foo"</span>) <span class="comment">// 1</span></span><br><span class="line">searchParams.set(<span class="string">"foo"</span>, <span class="string">"10"</span>)</span><br><span class="line">searchParams.has(<span class="string">"bar"</span>)</span><br><span class="line">searchParams.append(<span class="string">"foo"</span>, <span class="string">"100"</span>)</span><br></pre></td></tr></table></figure></blockquote><p>è§£ç­”ï¼šç®€å•å®ç°äº†ä¸‹ï¼Œçœ‹äº† Github ä¸Š <code>URLSearchParams</code> çš„ polyfill ä»£ç ï¼Œå‘ç°è¿™ä¸ªè¿˜æ˜¯æœ‰ç‚¹å¤æ‚çš„</p><figure class="highlight javascript"><figcaption><span>url-search-params.js</span><a href="/code/url-search-params.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">URLSearchParams</span> </span>{</span><br><span class="line">  <span class="keyword">constructor</span> (query) {</span><br><span class="line">    <span class="keyword">this</span>._query = {}</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> query === <span class="string">'string'</span>) {</span><br><span class="line">      <span class="keyword">if</span> (query.startsWith(<span class="string">'?'</span>, <span class="number">0</span>)) {</span><br><span class="line">        query = query.slice(<span class="number">1</span>)</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      query.split(<span class="string">'&amp;'</span>).forEach(<span class="function"><span class="params">pair</span> =&gt;</span> {</span><br><span class="line">        <span class="keyword">const</span> params = pair.split(<span class="string">'='</span>)</span><br><span class="line">        <span class="keyword">const</span> key = params[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">const</span> val = params[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>._query[key] = val</span><br><span class="line">      })</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> <span class="built_in">Object</span>.entries(query)) {</span><br><span class="line">        <span class="keyword">this</span>._query[key] = query[key]</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> (key) {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.has(key) ? <span class="keyword">this</span>._query[key] : <span class="literal">null</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> (key, val) {</span><br><span class="line">    <span class="keyword">this</span>._query[key] = <span class="built_in">encodeURIComponent</span>(val)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  has (key) {</span><br><span class="line">    <span class="keyword">return</span> key <span class="keyword">in</span> <span class="keyword">this</span>._query</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  append (key, val) {</span><br><span class="line">    <span class="keyword">const</span> value = <span class="built_in">Array</span>.isArray(val) ? val.join(<span class="string">','</span>) : val</span><br><span class="line">    <span class="keyword">if</span> (key <span class="keyword">in</span> <span class="keyword">this</span>._query) {</span><br><span class="line">      <span class="keyword">this</span>._query[key].push(value)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="keyword">this</span>._query[key] = value</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._query[key]</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mysp1 = <span class="keyword">new</span> URLSearchParams(<span class="string">'a=aaa&amp;b=bbb'</span>)</span><br><span class="line"><span class="keyword">const</span> mysp2 = <span class="keyword">new</span> URLSearchParams({ <span class="attr">c</span>: <span class="string">'ccc'</span>, <span class="attr">d</span>: <span class="string">'ddd'</span> })</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(mysp1) <span class="comment">// URLSearchParams { _query: { a: 'aaa', b: 'bbb' } }</span></span><br><span class="line"><span class="built_in">console</span>.log(mysp1.get(<span class="string">'a'</span>)) <span class="comment">// aaa</span></span><br><span class="line"><span class="built_in">console</span>.log(mysp1.set(<span class="string">'c'</span>, <span class="string">'ccc'</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(mysp1.has(<span class="string">'d'</span>)) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(mysp1.append(<span class="string">'e'</span>, <span class="string">'eee'</span>)) <span class="comment">// eee</span></span><br><span class="line"><span class="built_in">console</span>.log(mysp1) <span class="comment">// { _query: { a: 'aaa', b: 'bbb', c: 'ccc', e: 'eee' } }</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(mysp2) <span class="comment">// URLSearchParams { _query: { c: 'ccc', d: 'ddd' } }</span></span><br><span class="line"><span class="built_in">console</span>.log(mysp2.get(<span class="string">'c'</span>)) <span class="comment">// ccc</span></span><br><span class="line"><span class="built_in">console</span>.log(mysp2.set(<span class="string">'d'</span>, <span class="string">'ddd2'</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(mysp2.has(<span class="string">'d'</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(mysp2.append(<span class="string">'f'</span>, <span class="string">'fff'</span>)) <span class="comment">// fff</span></span><br><span class="line"><span class="built_in">console</span>.log(mysp2) <span class="comment">// URLSearchParams { _query: { c: 'ccc', d: 'ddd2', f: 'fff' } }</span></span><br></pre></td></tr></table></figure><p>ç›¸å…³æ–‡ç« </p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/URLSearchParams" target="_blank" rel="noopener">URLSearchParams docs</a></p><p><a href="https://github.com/ungap/url-search-params" target="_blank" rel="noopener">URLSearchParams polyfill</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è‡ªå·±å¤ªèœäº†ï¼ŒåŸºç¡€çŸ¥è¯†ç”±äºæ²¡æœ‰å»å›é¡¾æ‰€ä»¥å¿˜çš„å¾ˆå¤šï¼Œç»§ç»­åŠ æ²¹å§ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰å‡ å¤©é‡åˆ°ä¸¤ä¸ªå‰ç«¯é¢è¯•é¢˜ï¼Œè¦å†™ä»£ç çš„é‚£ç§ï¼Œç„¶åæˆ‘éƒ½æ²¡åšå¯¹â€¦è®°å½•ä¸€ä¸‹&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢è¯•" scheme="https://coldstone.fun/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
      <category term="Interview" scheme="https://coldstone.fun/tags/Interview/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ FFmpeg è½¬æ¢è§†é¢‘æ ¼å¼</title>
    <link href="https://coldstone.fun/post/2019/11/11/simple-use-ffmpeg/"/>
    <id>https://coldstone.fun/post/2019/11/11/simple-use-ffmpeg/</id>
    <published>2019-11-11T12:12:26.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>ç”¨ B ç«™ä¸‹è½½åŠ©æ‰‹ ä¸‹è½½ä¸‹æ¥çš„è§†é¢‘æ ¼å¼æ˜¯ <code>flv</code>ï¼Œç”¨ QuickTime çœ‹ä¸äº†ä¹Ÿä¸èƒ½å¯¼å…¥ iMovie è¿›è¡Œç¼–è¾‘ï¼Œæ‰€ä»¥éœ€è¦è½¬æ¢ä¸€ä¸‹è§†é¢‘æ ¼å¼</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç”¨ B ç«™ä¸‹è½½åŠ©æ‰‹ ä¸‹è½½ä¸‹æ¥çš„è§†é¢‘æ ¼å¼æ˜¯ <code>flv</code>ï¼Œç”¨ QuickTime çœ‹ä¸äº†ä¹Ÿä¸èƒ½å¯¼å…¥ iMovie è¿›è¡Œç¼–è¾‘ï¼Œæ‰€ä»¥éœ€è¦è½¬æ¢ä¸€ä¸‹è§†é¢‘æ ¼å¼ã€‚åœ¨æœç´¢äº†å¾ˆå¤šè§†é¢‘æ ¼å¼è½¬æ¢å·¥å…·åï¼Œå‘ç°å®ƒä»¬å¤§å¤šåº•å±‚æ˜¯ç”¨ <a href="https://www.ffmpeg.org/" target="_blank" rel="noopener">FFmpeg</a> è¿™ä¸ªå¼€æºå·¥å…·è¿›è¡Œè½¬æ¢çš„ï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ <code>FFmpeg</code> å®ƒæœ¬èº«å‘¢ã€‚</p><h2 id="å…³äº-FFmpeg"><a href="#å…³äº-FFmpeg" class="headerlink" title="å…³äº FFmpeg"></a>å…³äº FFmpeg</h2><p>å®˜æ–¹æè¿°ï¼šFFmpeg æ˜¯ä¸€ç§éå¸¸å¿«é€Ÿçš„è§†é¢‘å’ŒéŸ³é¢‘è½¬æ¢å™¨ï¼Œä¹Ÿå¯ä»¥ä»å®æ—¶éŸ³é¢‘/è§†é¢‘æºä¸­è·å–ã€‚ å®ƒè¿˜å¯ä»¥åœ¨ä»»æ„é‡‡æ ·ç‡ä¹‹é—´è½¬æ¢ï¼Œå¹¶ä½¿ç”¨é«˜è´¨é‡çš„å¤šç›¸æ»¤æ³¢å™¨å³æ—¶è°ƒæ•´è§†é¢‘å¤§å°ã€‚</p><p>è½¬æ¢æµç¨‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> _______              ______________</span><br><span class="line">|       |            |              |</span><br><span class="line">| input |  demuxer   | encoded data |   decoder</span><br><span class="line">| file  | ---------&gt; | packets      | -----+</span><br><span class="line">|_______|            |______________|      |</span><br><span class="line">                                           v</span><br><span class="line">                                       _________</span><br><span class="line">                                      |         |</span><br><span class="line">                                      | decoded |</span><br><span class="line">                                      | frames  |</span><br><span class="line">                                      |_________|</span><br><span class="line"> ________             ______________       |</span><br><span class="line">|        |           |              |      |</span><br><span class="line">| output | &lt;-------- | encoded data | &lt;----+</span><br><span class="line">| file   |   muxer   | packets      |   encoder</span><br><span class="line">|________|           |______________|</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>é¦–å…ˆå®‰è£… <code>FFmpeg</code>ï¼ŒmacOS å¯ä»¥ä½¿ç”¨ <code>homebrew</code> å®‰è£…</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install ffmpeg</span><br></pre></td></tr></table></figure><p>Windows åˆ° <code>https://ffmpeg.zeranoe.com/builds</code> è¿™é‡Œä¸‹è½½ zip åŒ…ï¼Œç„¶åå°† <code>bin</code> ç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ <code>PATH</code> ä¸­ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ <code>ffmpeg</code> å‘½ä»¤ï¼Œå‡ºç°æç¤ºè¯­å³è¡¨ç¤ºå®‰è£…æˆåŠŸ</p><p><img src="images/ffmpeg-hint.jpg" alt="hint"></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>åªéœ€ä¸€æ¡å‘½ä»¤å³å¯å¯¹è§†é¢‘è¿›è¡Œæ ¼å¼è½¬æ¢ï¼Œ<code>-i</code> å‚æ•°è¡¨ç¤ºéœ€è¦è½¬æ¢çš„è§†é¢‘ï¼Œå€¼æ˜¯è§†é¢‘è·¯å¾„ï¼Œåé¢çš„æ˜¯è½¬æ¢åçš„è§†é¢‘æ–‡ä»¶åã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mp4 output.avi</span><br></pre></td></tr></table></figure><p>è½¬æ¢è¿‡ç¨‹ä¸­ä¼šå‡ºç°è¿›åº¦æç¤º</p><p><img src="images/ffmpeg-running.jpg" alt="running"></p><ul><li><code>frame</code> è¡¨ç¤ºæ˜¯è½¬ç æ‰€è¿›è¡Œåˆ°çš„å¸§æ•°ã€‚</li><li><code>fps</code> è¡¨ç¤ºä¸­çš„ FPS å°±æ˜¯ Frame per Second ï¼Œæ˜¯ç°åœ¨ç”µè„‘æ¯ç§’æ‰€å¤„ç†çš„å¸§çš„æ•°é‡ï¼Œè¿™ä¸ªæ•°å­—è·Ÿè§†é¢‘çš„å¸§ç‡æ— å…³ã€‚</li><li><code>size</code> è¡¨ç¤ºå·²ç»è½¬æ¢å‡ºæ¥çš„è§†é¢‘çš„ä½“ç§¯ã€‚</li><li><code>time</code> è¡¨ç¤ºç»è½¬æ¢å‡ºæ¥çš„è§†é¢‘çš„æ—¶é—´ã€‚</li></ul><h2 id="è½¬æ¢å‚æ•°"><a href="#è½¬æ¢å‚æ•°" class="headerlink" title="è½¬æ¢å‚æ•°"></a>è½¬æ¢å‚æ•°</h2><p><code>-r</code></p><p>è¿™ä¸ªé€‰é¡¹è®¾ç½®è§†é¢‘å¸§ç‡, å•ä½æ˜¯ Hzï¼Œä¹Ÿå°±æ˜¯å¸§æ¯ç§’ FPSï¼Œå¦‚ <code>-r 30</code> å³ä»£è¡¨è¾“å‡ºè§†é¢‘çš„å¸§ç‡ä¸ºæ¯ç§’ 30 å¸§ï¼Œé™ä½å¸§ç‡å¯ä»¥å‡å°è§†é¢‘çš„ä½“ç§¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -r 30 output.mp4</span><br></pre></td></tr></table></figure><p><code>-s</code></p><p>é»˜è®¤è¾“å‡ºçš„è§†é¢‘å°ºå¯¸ä¸åŸè§†é¢‘ç›¸åŒï¼Œ<code>-s 720x480</code> é€‰é¡¹å¯ä»¥æŒ‡å®šè¾“å‡ºè§†é¢‘çš„å°ºå¯¸ï¼Œä»¥åƒç´ ä¸ºå•ä½ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -s 720x480 output.mp4</span><br></pre></td></tr></table></figure><p><code>-t</code></p><p>ç”¨æ¥æŒ‡å®šè¾“å‡ºæ–‡ä»¶çš„æŒç»­æ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œå¦‚æˆªå– input.mp4 çš„å‰ 30 ç§’å¹¶ä¿å­˜ä¸º output.mp4ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -t 30 output.mp4</span><br></pre></td></tr></table></figure><p><code>-c</code></p><p>ç”¨æ¥æŒ‡å®šè¾“å‡ºæ–‡ä»¶çš„ç¼–ç ï¼Œè®¾ç½® <code>-c copy</code> è®© <code>FFmpeg</code> åœ¨è½¬æ¢éŸ³è§†é¢‘æ—¶ä¸é‡æ–°è¿›è¡Œç¼–ç ï¼Œå‡å°‘è½¬æ¢è€—æ—¶ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -c copy -t 30 output.mp4</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ help å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°æ›´å¤šå…³äºè§†é¢‘è½¬æ¢çš„é€‰é¡¹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -<span class="built_in">help</span></span><br></pre></td></tr></table></figure><p><img src="images/ffmpeg-video-opt.jpg" alt="video-options"></p><ul><li><code>-vframes</code> è®¾ç½®è¦è¾“å‡ºçš„è§†é¢‘å¸§æ•°</li><li><code>-r</code> é€Ÿç‡è®¾ç½®å¸§é€Ÿç‡ï¼ˆHzå€¼ï¼Œåˆ†æ•°æˆ–ç¼©å†™ï¼‰</li><li><code>-s</code> sizeè®¾ç½®å¸§å¤§å°ï¼ˆWxHæˆ–ç¼©å†™ï¼‰</li><li><code>-aspect</code> å®½é«˜æ¯”è®¾ç½®çš„å®½é«˜æ¯”ï¼ˆ4ï¼š3ã€16ï¼š9æˆ–1.3333ã€1.7777ï¼‰</li><li><code>-bits_per_raw_sample</code> è®¾ç½®æ¯ä¸ªåŸå§‹æ ·æœ¬çš„ä½æ•°</li><li><code>-vn</code> ç¦ç”¨è§†é¢‘</li><li><code>-vcodec</code> ç¼–è§£ç å™¨å¼ºåˆ¶è§†é¢‘ç¼–è§£ç å™¨ï¼ˆâ€œå¤åˆ¶â€ä»¥å¤åˆ¶æµï¼‰</li><li><code>-timecode</code> å•ä½ hhï¼šmmï¼šss [ï¼š;ã€‚] ffè®¾ç½®åˆå§‹ TimeCode å€¼ã€‚</li><li><code>-pass n</code> é€‰æ‹©é€šè¿‡æ¬¡æ•°ï¼ˆ1åˆ°3ï¼‰</li><li><code>-vf filter_graph</code> è®¾ç½®è§†é¢‘è¿‡æ»¤å™¨</li><li><code>-ab</code> æ¯”ç‰¹ç‡éŸ³é¢‘æ¯”ç‰¹ç‡ï¼ˆè¯·ä½¿ç”¨-bï¼šaï¼‰</li><li><code>-b</code> æ¯”ç‰¹ç‡è§†é¢‘æ¯”ç‰¹ç‡ï¼ˆè¯·ä½¿ç”¨-bï¼švï¼‰</li><li><code>-dn</code> ç¦ç”¨æ•°æ®</li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.ffmpeg.org/documentation.html" target="_blank" rel="noopener">FFmpeg Documentation</a></p><p><a href="https://wiki.fiveyellowmice.com/wiki/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8_FFmpeg_%E8%BF%9B%E8%A1%8C%E8%A7%86%E9%A2%91%E8%BD%AC%E7%A0%81:%E9%A6%96%E9%A1%B5" target="_blank" rel="noopener">å¦‚ä½•ä½¿ç”¨_FFmpeg_è¿›è¡Œè§†é¢‘è½¬ç </a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç”¨ B ç«™ä¸‹è½½åŠ©æ‰‹ ä¸‹è½½ä¸‹æ¥çš„è§†é¢‘æ ¼å¼æ˜¯ &lt;code&gt;flv&lt;/code&gt;ï¼Œç”¨ QuickTime çœ‹ä¸äº†ä¹Ÿä¸èƒ½å¯¼å…¥ iMovie è¿›è¡Œç¼–è¾‘ï¼Œæ‰€ä»¥éœ€è¦è½¬æ¢ä¸€ä¸‹è§†é¢‘æ ¼å¼&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="FFmpeg" scheme="https://coldstone.fun/tags/FFmpeg/"/>
    
  </entry>
  
  <entry>
    <title>å¯¹ Egg.js è¿›è¡Œå•å…ƒæµ‹è¯•</title>
    <link href="https://coldstone.fun/post/2019/11/01/eggjs-test/"/>
    <id>https://coldstone.fun/post/2019/11/01/eggjs-test/</id>
    <published>2019-11-01T04:35:00.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>ä¼˜ç§€çš„ä»£ç éœ€è¦æœ‰å•å…ƒæµ‹è¯•è¿›è¡Œè´¨é‡ä¿è¯ï¼Œæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½ç»™åº”ç”¨çš„ç¨³å®šæ€§æä¾›äº†ä¸€å±‚ä¿éšœï¼Œæœ¬æ–‡è¯´ä¸€ä¸‹å¦‚ä½•å¯¹ä½¿ç”¨ egg.js å†™çš„æ¥å£è¿›è¡Œå•å…ƒæµ‹è¯•</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¼˜ç§€çš„ä»£ç éœ€è¦æœ‰å•å…ƒæµ‹è¯•è¿›è¡Œè´¨é‡ä¿è¯ï¼Œæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½ç»™åº”ç”¨çš„ç¨³å®šæ€§æä¾›äº†ä¸€å±‚ä¿éšœã€‚</p><h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p>egg.js å·¥ç¨‹çš„æµ‹è¯•ä»£ç éƒ½æ˜¯æ”¾åœ¨å·¥ç¨‹çš„ test ç›®å½•ä¸‹ï¼Œå‘½åçš„æ–¹å¼ä¸º <code>${filename}.test.js</code>ï¼Œæ¯”å¦‚æˆ‘æƒ³æµ‹è¯•é¡¹ç›®çš„ <code>user</code> <code>controller</code> å°±åœ¨ <code>test</code> ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª <code>controller/user.test.js</code>ï¼ŒåŒç†è¦æµ‹ <code>service</code> å°±æ˜¯åˆ›å»ºä¸€ä¸ª <code>service</code> ç›®å½•ï¼Œç„¶åå°±æ˜¯å†™å…·ä½“çš„æµ‹è¯•ä»£ç äº†ã€‚</p><p>å‡è®¾ç°åœ¨éœ€è¦å¯¹ä¸€ä¸ª <code>UserService</code> è¿›è¡Œæµ‹è¯•ï¼Œé¦–å…ˆåœ¨ <code>user.test.js</code> ä¸­å¼•å…¥ <code>egg-mock</code> æ¨¡å—ç”¨æ¥åˆ›å»ºä¸€ä¸ª <code>app</code> å®ä¾‹ä»¥åŠä¸€ä¸ª <code>ctx</code> å¯¹è±¡ï¼Œä¸€èˆ¬åœ¨è¯·æ±‚æ¥å£çš„æ—¶å€™ä¼šåœ¨ <code>ctx</code> å¯¹è±¡ä¸Šæºå¸¦è¿™æ¬¡è¯·æ±‚çš„å‚æ•°å’Œæ˜¯ç”¨æˆ·ä¿¡æ¯ï¼Œéœ€è¦åœ¨åˆ›å»º <code>ctx</code> çš„æ—¶å€™æ·»åŠ æ‰€è¦çš„æ•°æ®ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯ <code>before</code> å‡½æ•°ä¸­ï¼Œå°†è¿™äº›æ•°æ®é™„åŠ åˆ° <code>ctx</code> ä¸Šã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, assert &#125; = <span class="built_in">require</span>(<span class="string">'egg-mock/bootstrap'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ctx</span><br><span class="line"></span><br><span class="line">before(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  ctx = app.mockContext(&#123;</span><br><span class="line">    user: &#123;</span><br><span class="line">      name: <span class="string">'your-name'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿˜éœ€è¦æ·»åŠ è¯·æ±‚å¤´ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·çš„ <code>token</code> å¯ä»¥è¿™æ ·æ·»åŠ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ctx.request.headers = &#123;</span><br><span class="line">  authorization: yourToken</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡†å¤‡å®Œæ¯•ï¼Œæ¥ä¸‹æ¥ç¼–å†™å…·ä½“çš„æµ‹è¯•ä»£ç äº†ï¼Œå‡å¦‚ <code>UserService</code> æœ‰ä¸€ä¸ª <code>create</code> æ–¹æ³•ï¼Œä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>user</code>ï¼Œå‚æ•°æ˜¯è¯·æ±‚ä½“ä¼ è¿‡æ¥çš„æ–°å»ºç”¨æˆ·æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·å†™æµ‹è¯•ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">'create æ–¹æ³•è¿”å›æ–°å¢ç”¨æˆ·æˆåŠŸä¿¡æ¯'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> data = &#123;</span><br><span class="line">    name: <span class="string">'user name'</span> + <span class="built_in">Date</span>.now(),</span><br><span class="line">    age: <span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random() * <span class="number">60</span>),</span><br><span class="line">    gender: <span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span> ? <span class="string">'male'</span> : <span class="string">'female'</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> ctx.service.user.create(data)</span><br><span class="line"></span><br><span class="line">  assert(response.success === <span class="literal">true</span>)</span><br><span class="line">  assert(response.payload.length &gt; <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å®Œæ•´çš„ä»£ç </p><figure class="highlight javascript"><figcaption><span>user.test.js</span><a href="/code/user.test.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> { app, assert } = <span class="built_in">require</span>(<span class="string">'egg-mock/bootstrap'</span>);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'ç”¨æˆ·æœåŠ¡æµ‹è¯•'</span>, () =&gt; {</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> ctx</span><br><span class="line"></span><br><span class="line">  before(<span class="function"><span class="params">()</span> =&gt;</span> {</span><br><span class="line">    ctx = app.mockContext({</span><br><span class="line">      user: {</span><br><span class="line">        name: <span class="string">'your-name'</span>,</span><br><span class="line">      },</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    ctx.request.headers = {</span><br><span class="line">      authorization: yourToken</span><br><span class="line">    };</span><br><span class="line">  })</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'create æ–¹æ³•è¿”å›æ–°å¢ç”¨æˆ·æˆåŠŸä¿¡æ¯'</span>, <span class="keyword">async</span> () =&gt; {</span><br><span class="line">    <span class="keyword">const</span> data = {</span><br><span class="line">      name: <span class="string">'user name'</span> + <span class="built_in">Date</span>.now(),</span><br><span class="line">      age: <span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random() * <span class="number">60</span>),</span><br><span class="line">      gender: <span class="built_in">Math</span>.random() &gt; <span class="number">.5</span> ? <span class="string">'male'</span> : <span class="string">'female'</span></span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> ctx.service.user.create(data);</span><br><span class="line"></span><br><span class="line">    assert(response.success === <span class="literal">true</span>);</span><br><span class="line">    assert(response.payload.length &gt; <span class="number">0</span>);</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">})</span><br></pre></td></tr></table></figure><p>æ–­è¨€è¿”å›å€¼çš„ <code>success</code> ä¸º <code>true</code>ï¼Œ<code>payload</code> çš„ <code>length</code> å±æ€§é•¿åº¦å¤§äº 0ï¼Œå½“ç„¶è¿™éœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡æ¥å†™ï¼Œä¸€ä¸ª <code>service</code> å¯èƒ½ä¼šæœ‰å¾ˆå¤šçš„æ–¹æ³•ï¼Œéœ€è¦å°½å¯èƒ½å¤šçš„å¯¹è¿™äº›æ–¹æ³•è¿›è¡Œæµ‹è¯•ã€‚</p><p>æœ€åå°±æ˜¯æ‰§è¡Œæµ‹è¯•ä»£ç äº†</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡å‘½ä»¤ <code>npm run test</code> æ‰§è¡Œ <code>egg-bin test</code>ï¼Œæˆ–è€…åœ¨ <code>Idea</code> æ·»åŠ ä¸€ä¸ªæµ‹è¯•çš„ <code>configuration</code> ç‚¹å‡»æ‰§è¡Œå³å¯ï¼Œè¿™æ · <code>test</code> ç›®å½•ä¸‹çš„æ‰€æœ‰æµ‹è¯•éƒ½ä¼šè¿è¡Œã€‚è¿è¡Œå…¨éƒ¨çš„æµ‹è¯•è€—æ—¶å¯èƒ½ä¼šå¾ˆé•¿æˆ–è€…æœ‰æ—¶åªéœ€è¦å¯¹ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶è¿›è¡Œæµ‹è¯•ï¼Œè¿™æ—¶é€šè¿‡æŒ‡å®šæµ‹è¯•æ–‡ä»¶çš„è·¯å¾„å³å¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run <span class="built_in">test</span> &lt;TestFilePath&gt;</span><br></pre></td></tr></table></figure><p>è¿è¡Œæµ‹è¯•çš„æ—¶å€™ä¼šåŠ è½½ <code>config.unittest.js</code> é‡Œé¢çš„é…ç½®ï¼Œè¿è¡Œå®Œæ¯•ï¼Œæ²¡æœ‰é€šè¿‡çš„æµ‹è¯•ä¼šæ˜¾ç¤ºå…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼Œå¯ä»¥æ–¹ä¾¿çš„å®šä½é”™è¯¯ï¼Œå¦‚æœæµ‹è¯•éƒ½é€šè¿‡äº†å°±ä¼šå‡ºç°æµ‹è¯•é€šè¿‡çš„ä»¥åŠè€—æ—¶ä¿¡æ¯</p><p><img src="images/egg-test.jpg" alt="test"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://eggjs.org/zh-cn/core/unittest.html" target="_blank" rel="noopener">å•å…ƒæµ‹è¯•</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¼˜ç§€çš„ä»£ç éœ€è¦æœ‰å•å…ƒæµ‹è¯•è¿›è¡Œè´¨é‡ä¿è¯ï¼Œæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½ç»™åº”ç”¨çš„ç¨³å®šæ€§æä¾›äº†ä¸€å±‚ä¿éšœï¼Œæœ¬æ–‡è¯´ä¸€ä¸‹å¦‚ä½•å¯¹ä½¿ç”¨ egg.js å†™çš„æ¥å£è¿›è¡Œå•å…ƒæµ‹è¯•&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Node" scheme="https://coldstone.fun/tags/Node/"/>
    
      <category term="Egg" scheme="https://coldstone.fun/tags/Egg/"/>
    
  </entry>
  
  <entry>
    <title>Docker ARG vs ENV</title>
    <link href="https://coldstone.fun/post/2019/10/25/docker-arg-vs-env/"/>
    <id>https://coldstone.fun/post/2019/10/25/docker-arg-vs-env/</id>
    <published>2019-10-25T06:12:19.000Z</published>
    <updated>2021-06-28T09:25:25.301Z</updated>
    
    <content type="html"><![CDATA[<p>æ„å»º Docker é•œåƒçš„çš„æ—¶å€™æœ‰ä¸¤ç§ç¯å¢ƒå˜é‡ <code>ARG</code> å’Œ <code>ENV</code>, ä¸€ç§æ˜¯åœ¨è¿è¡Œ build å‘½ä»¤æ—¶é€šè¿‡ <code>--build-arg</code> å‚æ•°è®¾ç½®çš„ build-time variables ä»¥åŠé€šè¿‡åœ¨ <code>dockerfile</code> é‡Œé¢è®¾ç½® <code>ENV</code> æŒ‡ä»¤é…ç½®çš„ç¯å¢ƒå˜é‡ã€‚</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ„å»º Docker é•œåƒçš„çš„æ—¶å€™æœ‰ä¸¤ç§ç¯å¢ƒå˜é‡ <code>ARG</code> å’Œ <code>ENV</code>, ä¸€ç§æ˜¯åœ¨è¿è¡Œ build å‘½ä»¤æ—¶é€šè¿‡ <code>--build-arg</code> å‚æ•°è®¾ç½®çš„ build-time variables ä»¥åŠé€šè¿‡åœ¨ <code>dockerfile</code> é‡Œé¢è®¾ç½® <code>ENV</code> æŒ‡ä»¤é…ç½®çš„ç¯å¢ƒå˜é‡ï¼Œæœ¬æ–‡è¯´æ˜å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚</p><h2 id="ARG"><a href="#ARG" class="headerlink" title="ARG"></a>ARG</h2><p>Dockerfile é‡Œé¢çš„ ARG æŒ‡ä»¤å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œåœ¨è¿è¡Œ <code>docker build</code> å‘½ä»¤æ—¶ä½¿ç”¨ <code>--build-arg &lt;varname&gt; = &lt;value&gt;</code> å‚æ•°å°†å…¶ä¼ é€’ç»™æ„å»ºå™¨ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> &lt;name&gt;[=&lt;default value&gt;]</span><br></pre></td></tr></table></figure><p>è¿™ç§å˜é‡åªå­˜åœ¨äºé•œåƒæ„å»ºçš„æ—¶å€™ï¼Œä¸€æ—¦é•œåƒæ„å»ºå®Œæˆå°±å¤±æ•ˆäº†ï¼Œä¸è¦ä½¿ç”¨æ„å»ºæ—¶å˜é‡æ¥ä¼ é€’è¯¸å¦‚ github å¯†é’¥ï¼Œç”¨æˆ·å‡­æ®ç­‰æœºå¯†æ•°æ®ï¼Œæ„å»ºæ—¶å˜é‡å€¼å¯ä»¥ä½¿ç”¨ docker history å‘½ä»¤æŸ¥çœ‹ã€‚</p><h2 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h2><p>Dockerfile é‡Œé¢çš„ ENV æŒ‡ä»¤å°†ç¯å¢ƒå˜é‡ <key> è®¾ç½®ä¸ºå€¼ <value>ï¼Œè¿™ä¸ªå˜é‡å°†åœ¨æ„å»ºé˜¶æ®µä¸­æ‰€æœ‰åç»­æŒ‡ä»¤çš„ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> &lt;key&gt; &lt;value&gt;</span><br><span class="line"><span class="keyword">ENV</span> &lt;key&gt;=&lt;value&gt; ...</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ ENV è®¾ç½®çš„ç¯å¢ƒå˜é‡å°†ä¸€ç›´å­˜åœ¨äºæ„å»ºé•œåƒæ—¶ä»¥åŠé•œåƒå®¹å™¨è¿è¡Œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ docker inspect æŸ¥çœ‹è®¾ç½®æ‰“çš„å˜é‡ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>docker run --env &lt;key&gt; = &lt;value&gt;</code> æ¥æ›´æ”¹å®ƒä»¬ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>å¦‚æœåªæ˜¯éœ€è¦æ„å»ºé•œåƒæ—¶çš„ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨ <code>ARG</code>ï¼Œå¦‚æœè¿™ä¸ªå˜é‡åœ¨å®¹å™¨è¿è¡Œæ—¶ä¹Ÿæœ‰ç”¨åˆ°å°±éœ€è¦ç”¨ <code>ENV</code>ï¼Œæ³¨æ„ä½¿ç”¨ <code>ENV</code> æŒ‡ä»¤å®šä¹‰çš„ç¯å¢ƒå˜é‡ä¼šè¦†ç›–åŒåçš„ <code>ARG</code> æŒ‡ä»¤å®šä¹‰çš„å˜é‡ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ„å»º Docker é•œåƒçš„çš„æ—¶å€™æœ‰ä¸¤ç§ç¯å¢ƒå˜é‡ &lt;code&gt;ARG&lt;/code&gt; å’Œ &lt;code&gt;ENV&lt;/code&gt;, ä¸€ç§æ˜¯åœ¨è¿è¡Œ build å‘½ä»¤æ—¶é€šè¿‡ &lt;code&gt;--build-arg&lt;/code&gt; å‚æ•°è®¾ç½®çš„ build-time variables ä»¥åŠé€šè¿‡åœ¨ &lt;code&gt;dockerfile&lt;/code&gt; é‡Œé¢è®¾ç½® &lt;code&gt;ENV&lt;/code&gt; æŒ‡ä»¤é…ç½®çš„ç¯å¢ƒå˜é‡ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Docker" scheme="https://coldstone.fun/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯ä»£ç è§„èŒƒ</title>
    <link href="https://coldstone.fun/post/2019/10/10/code-standard/"/>
    <id>https://coldstone.fun/post/2019/10/10/code-standard/</id>
    <published>2019-10-10T09:59:04.000Z</published>
    <updated>2021-06-28T09:25:25.301Z</updated>
    
    <content type="html"><![CDATA[<p>è‰¯å¥½çš„ä»£ç è§„èŒƒæœ‰åˆ©äºæé«˜é¡¹ç›®å¼€å‘æ•ˆç‡ä»¥åŠå‡å°‘é˜…è¯»ä»£ç çš„å›°éš¾ï¼Œæœ¬è§„èŒƒç»“åˆäº†(chaoxi)å¤šä¸ªæµè¡Œçš„ä»£ç è§„èŒƒä»¥åŠå‰äººçš„å¼€å‘ç»éªŒè€Œæˆï¼Œå‚è€ƒè§„èŒƒè¿›è¡Œå¼€å‘æé«˜ä»£ç è´¨é‡</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è‰¯å¥½çš„ä»£ç è§„èŒƒæœ‰åˆ©äºæé«˜é¡¹ç›®å¼€å‘æ•ˆç‡ä»¥åŠå‡å°‘é˜…è¯»ä»£ç çš„å›°éš¾ï¼Œæœ¬è§„èŒƒç»“åˆäº†(chaoxi)å¤šä¸ªæµè¡Œçš„ä»£ç è§„èŒƒä»¥åŠå‰äººçš„å¼€å‘ç»éªŒè€Œæˆï¼Œå‚è€ƒè§„èŒƒè¿›è¡Œå¼€å‘æé«˜ä»£ç è´¨é‡</p><h2 id="HTML-è§„èŒƒ"><a href="#HTML-è§„èŒƒ" class="headerlink" title="HTML è§„èŒƒ"></a>HTML è§„èŒƒ</h2><p>è®¾ç½®æ ‡å‡†æ¨¡å¼çš„æ–‡æ¡£ç±»å‹</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è®¾ç½®é¡µé¢è¯­è¨€</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è®¾ç½®é¡µé¢å­—ç¬¦ç¼–ç </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¯­ä¹‰åŒ–çš„æ ‡ç­¾å‡†ç¡®åœ°æè¿°ç½‘é¡µçš„å†…å®¹</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">article</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>published: <span class="tag">&lt;<span class="name">time</span> <span class="attr">datetime</span>=<span class="string">"2015-02-21"</span>&gt;</span>21st Feb, 2015<span class="tag">&lt;/<span class="name">time</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>content<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aside</span>&gt;</span>...<span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span>&gt;</span>...<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç¡®ä¿é¡µé¢å¯è®¿é—®æ€§</p><ul><li>ç»™ <code>img</code>  æ ‡ç­¾æ·»åŠ æ­£ç¡®çš„ <code>alt</code>  å±æ€§</li><li>ä½¿ç”¨ <code>label</code>  æ ‡ç­¾å¯¹è¡¨å•è¿›è¡Œæ§åˆ¶</li></ul><p>ä½¿ç”¨å­—ç¬¦å®ä½“æ›¿ä»£ç‰¹æ®Šå­—ç¬¦</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="symbol">&amp;gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="symbol">&amp;copy;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="symbol">&amp;lt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸¤ä¸ªç©ºæ ¼ç¼©è¿›</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æŒ‰ç‰¹å®šé¡ºåºä¹¦å†™æ ‡ç­¾å±æ€§</p><ol><li><code>class</code></li><li><code>id</code>, <code>name</code></li><li><code>data-*</code></li><li><code>src</code>, <code>for</code>, <code>type</code>, <code>href</code>, <code>value</code></li><li><code>title</code>, <code>alt</code></li><li><code>role</code>, <code>aria-*</code></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç¤ºä¾‹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"link"</span> <span class="attr">id</span>=<span class="string">"link"</span> <span class="attr">data-toggle</span>=<span class="string">"modal"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"example.jpg"</span> <span class="attr">alt</span>=<span class="string">"dog"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸å¯¹å¸ƒå°”å±æ€§èµ‹å€¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç¤ºä¾‹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">disabled</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"1"</span> <span class="attr">checked</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"1"</span> <span class="attr">selected</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="CSS-è§„èŒƒ"><a href="#CSS-è§„èŒƒ" class="headerlink" title="CSS è§„èŒƒ"></a>CSS è§„èŒƒ</h2><p>å…¨å±€è®¾ç½®ç›’å­æ¨¡å‹</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç®€æ´çš„ class å‘½å</p><p>class çš„å‘½ååº”è¯¥å°½é‡ç®€æ´ã€æ˜ç¡®ï¼Œä»¥å­—æ¯å¼€å¤´å‘½åï¼Œä¸”å…¨éƒ¨å­—æ¯ä¸ºå°å†™ï¼Œå•è¯ä¹‹é—´ä½¿ç”¨è¿å­—ç¬¦ â€œ-â€  è¿æ¥ã€‚<br />æ¯ä¸ªæ¨¡å—ä½¿ç”¨ä¸€ä¸ªæ¨¡å—å‘½åï¼Œå­å…ƒç´ ä½¿ç”¨æ¨¡å—å + å…ƒç´ ä½œç”¨åå</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç¤ºä¾‹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"header-title"</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¸¸ç”¨çš„ class å‘½å</p><p><strong>åŒ…è£¹ç±»ï¼š</strong> container, wrapper, outer, inner, box, header, footer, main, content, aside, page, section, block</p><p><strong>çŠ¶æ€ç±»ï¼š</strong> primary, secondary, success, danger, warning, info, error, link, light, dark, disabled, active,         checked, loading</p><p><strong>å°ºå¯¸ç±»ï¼š</strong> large, middle, small, bigger, smaller</p><p><strong>ç»„ä»¶ç±»ï¼š</strong> card, list, picture, carousel, swiper, menu, navs, badge, hint, modal, dialog</p><p><strong>ä½ç½®ç±»ï¼š</strong> first, last, current, prev, next, forward, back</p><p><strong>æ–‡æœ¬ç±»ï¼š</strong> title, desc, content, date, author, categoryï¼Œlabelï¼Œtag</p><p><strong>äººç‰©ç±»ï¼š</strong> avatar, name, age, post, intro</p><table><thead><tr><th align="left">Class Name</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td align="left">about</td><td align="left">å…³äº</td></tr><tr><td align="left">account</td><td align="left">è´¦æˆ·</td></tr><tr><td align="left">arrow</td><td align="left">ç®­å¤´å›¾æ ‡</td></tr><tr><td align="left">article</td><td align="left">æ–‡ç« </td></tr><tr><td align="left">aside</td><td align="left">è¾¹æ </td></tr><tr><td align="left">audio</td><td align="left">éŸ³é¢‘</td></tr><tr><td align="left">avatar</td><td align="left">å¤´åƒ</td></tr><tr><td align="left">bg,background</td><td align="left">èƒŒæ™¯</td></tr><tr><td align="left">bar</td><td align="left">æ ï¼ˆå·¥å…·ç±»ï¼‰</td></tr><tr><td align="left">branding</td><td align="left">å“ç‰ŒåŒ–</td></tr><tr><td align="left">crumb,breadcrumbs</td><td align="left">é¢åŒ…å±‘</td></tr><tr><td align="left">btn,button</td><td align="left">æŒ‰é’®</td></tr><tr><td align="left">caption</td><td align="left">æ ‡é¢˜ï¼Œè¯´æ˜</td></tr><tr><td align="left">category</td><td align="left">åˆ†ç±»</td></tr><tr><td align="left">chart</td><td align="left">å›¾è¡¨</td></tr><tr><td align="left">clearfix</td><td align="left">æ¸…é™¤æµ®åŠ¨</td></tr><tr><td align="left">close</td><td align="left">å…³é—­</td></tr><tr><td align="left">col,column</td><td align="left">åˆ—</td></tr><tr><td align="left">comment</td><td align="left">è¯„è®º</td></tr><tr><td align="left">community</td><td align="left">ç¤¾åŒº</td></tr><tr><td align="left">container</td><td align="left">å®¹å™¨</td></tr><tr><td align="left">content</td><td align="left">å†…å®¹</td></tr><tr><td align="left">copyright</td><td align="left">ç‰ˆæƒ</td></tr><tr><td align="left">current</td><td align="left">å½“å‰æ€ï¼Œé€‰ä¸­æ€</td></tr><tr><td align="left">default</td><td align="left">é»˜è®¤</td></tr><tr><td align="left">description</td><td align="left">æè¿°</td></tr><tr><td align="left">details</td><td align="left">ç»†èŠ‚</td></tr><tr><td align="left">disabled</td><td align="left">ä¸å¯ç”¨</td></tr><tr><td align="left">entry</td><td align="left">æ–‡ç« ï¼Œåšæ–‡</td></tr><tr><td align="left">error</td><td align="left">é”™è¯¯</td></tr><tr><td align="left">even</td><td align="left">å¶æ•°ï¼Œå¸¸ç”¨äºå¤šè¡Œåˆ—è¡¨æˆ–è¡¨æ ¼ä¸­</td></tr><tr><td align="left">fail</td><td align="left">å¤±è´¥ï¼ˆæç¤ºï¼‰</td></tr><tr><td align="left">feature</td><td align="left">ä¸“é¢˜</td></tr><tr><td align="left">fewer</td><td align="left">æ”¶èµ·</td></tr><tr><td align="left">field</td><td align="left">ç”¨äºè¡¨å•çš„è¾“å…¥åŒºåŸŸ</td></tr><tr><td align="left">figure</td><td align="left">å›¾</td></tr><tr><td align="left">filter</td><td align="left">ç­›é€‰</td></tr><tr><td align="left">first</td><td align="left">ç¬¬ä¸€ä¸ªï¼Œå¸¸ç”¨äºåˆ—è¡¨ä¸­</td></tr><tr><td align="left">footer</td><td align="left">é¡µè„š</td></tr><tr><td align="left">forum</td><td align="left">è®ºå›</td></tr><tr><td align="left">gallery</td><td align="left">ç”»å»Š</td></tr><tr><td align="left">group</td><td align="left">æ¨¡å—ï¼Œæ¸…é™¤æµ®åŠ¨</td></tr><tr><td align="left">header</td><td align="left">é¡µå¤´</td></tr><tr><td align="left">help</td><td align="left">å¸®åŠ©</td></tr><tr><td align="left">hide</td><td align="left">éšè—</td></tr><tr><td align="left">hightlight</td><td align="left">é«˜äº®</td></tr><tr><td align="left">home</td><td align="left">ä¸»é¡µ</td></tr><tr><td align="left">icon</td><td align="left">å›¾æ ‡</td></tr><tr><td align="left">info,information</td><td align="left">ä¿¡æ¯</td></tr><tr><td align="left">last</td><td align="left">æœ€åä¸€ä¸ªï¼Œå¸¸ç”¨äºåˆ—è¡¨ä¸­</td></tr><tr><td align="left">links</td><td align="left">é“¾æ¥</td></tr><tr><td align="left">login</td><td align="left">ç™»å½•</td></tr><tr><td align="left">logout</td><td align="left">é€€å‡º</td></tr><tr><td align="left">logo</td><td align="left">æ ‡å¿—</td></tr><tr><td align="left">main</td><td align="left">ä¸»ä½“</td></tr><tr><td align="left">menu</td><td align="left">èœå•</td></tr><tr><td align="left">meta</td><td align="left">ä½œè€…ã€æ›´æ–°æ—¶é—´ç­‰ä¿¡æ¯æ ï¼Œä¸€èˆ¬ä½äºæ ‡é¢˜ä¹‹ä¸‹</td></tr><tr><td align="left">module</td><td align="left">æ¨¡å—</td></tr><tr><td align="left">more</td><td align="left">æ›´å¤šï¼ˆå±•å¼€ï¼‰</td></tr><tr><td align="left">msg,message</td><td align="left">æ¶ˆæ¯</td></tr><tr><td align="left">nav,navigation</td><td align="left">å¯¼èˆª</td></tr><tr><td align="left">next</td><td align="left">ä¸‹ä¸€é¡µ</td></tr><tr><td align="left">nub</td><td align="left">å°å—</td></tr><tr><td align="left">odd</td><td align="left">å¥‡æ•°ï¼Œå¸¸ç”¨äºå¤šè¡Œåˆ—è¡¨æˆ–è¡¨æ ¼ä¸­</td></tr><tr><td align="left">off</td><td align="left">é¼ æ ‡ç¦»å¼€</td></tr><tr><td align="left">on</td><td align="left">é¼ æ ‡ç§»è¿‡</td></tr><tr><td align="left">output</td><td align="left">è¾“å‡º</td></tr><tr><td align="left">pagination</td><td align="left">åˆ†é¡µ</td></tr><tr><td align="left">pop,popup</td><td align="left">å¼¹çª—</td></tr><tr><td align="left">preview</td><td align="left">é¢„è§ˆ</td></tr><tr><td align="left">previous</td><td align="left">ä¸Šä¸€é¡µ</td></tr><tr><td align="left">primary</td><td align="left">ä¸»è¦</td></tr><tr><td align="left">progress</td><td align="left">è¿›åº¦æ¡</td></tr><tr><td align="left">promotion</td><td align="left">ä¿ƒé”€</td></tr><tr><td align="left">rcommd,recommendations</td><td align="left">æ¨è</td></tr><tr><td align="left">reg,register</td><td align="left">æ³¨å†Œ</td></tr><tr><td align="left">save</td><td align="left">ä¿å­˜</td></tr><tr><td align="left">search</td><td align="left">æœç´¢</td></tr><tr><td align="left">secondary</td><td align="left">æ¬¡è¦</td></tr><tr><td align="left">section</td><td align="left">åŒºå—</td></tr><tr><td align="left">selected</td><td align="left">å·²é€‰</td></tr><tr><td align="left">share</td><td align="left">åˆ†äº«</td></tr><tr><td align="left">show</td><td align="left">æ˜¾ç¤º</td></tr><tr><td align="left">sidebar</td><td align="left">è¾¹æ ï¼Œä¾§æ </td></tr><tr><td align="left">slide</td><td align="left">å¹»ç¯ç‰‡ï¼Œå›¾ç‰‡åˆ‡æ¢</td></tr><tr><td align="left">sort</td><td align="left">æ’åº</td></tr><tr><td align="left">sub</td><td align="left">æ¬¡çº§çš„ï¼Œå­çº§çš„</td></tr><tr><td align="left">submit</td><td align="left">æäº¤</td></tr><tr><td align="left">subscribe</td><td align="left">è®¢é˜…</td></tr><tr><td align="left">subtitle</td><td align="left">å‰¯æ ‡é¢˜</td></tr><tr><td align="left">success</td><td align="left">æˆåŠŸï¼ˆæç¤ºï¼‰</td></tr><tr><td align="left">summary</td><td align="left">æ‘˜è¦</td></tr><tr><td align="left">tab</td><td align="left">æ ‡ç­¾é¡µ</td></tr><tr><td align="left">table</td><td align="left">è¡¨æ ¼</td></tr><tr><td align="left">txt,text</td><td align="left">æ–‡æœ¬</td></tr><tr><td align="left">thumbnail</td><td align="left">ç¼©ç•¥å›¾</td></tr><tr><td align="left">time</td><td align="left">æ—¶é—´</td></tr><tr><td align="left">tips</td><td align="left">æç¤º</td></tr><tr><td align="left">title</td><td align="left">æ ‡é¢˜</td></tr><tr><td align="left">video</td><td align="left">è§†é¢‘</td></tr><tr><td align="left">wrap</td><td align="left">å®¹å™¨ï¼ŒåŒ…ï¼Œä¸€èˆ¬ç”¨äºæœ€å¤–å±‚</td></tr><tr><td align="left">wrapper</td><td align="left">å®¹å™¨ï¼ŒåŒ…ï¼Œä¸€èˆ¬ç”¨äºæœ€å¤–å±‚</td></tr></tbody></table><p>ä¸ä½¿ç”¨ ID é€‰æ‹©å™¨</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// bad</span><br><span class="line"><span class="selector-id">#title</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// good</span><br><span class="line"><span class="selector-class">.title</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¦ä¸º  <code>0</code>  å€¼è®¾ç½®å•ä½</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// bad</span><br><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// good</span><br><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éµå¾ªä»¥ä¸‹çš„æ ·å¼ä¹¦å†™é¡ºåº</p><ol><li>å¸ƒå±€å®šä½å±æ€§ï¼šposition / display / float / clear / visibility / overflow</li><li>ç›’å±æ€§ï¼šwidth / height / margin / padding / border / background</li><li>æ–‡æœ¬å±æ€§ï¼šcolor / font / text-decoration / text-align / vertical-align / white- space / break-word</li><li>è§†è§‰å±æ€§ï¼šbackground-color / border / border-radius / box-shadow</li><li>å…¶ä»–å±æ€§ï¼šcontent / cursor /  text-shadow / background:linear-gradient</li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="comment">/* Positioning */</span></span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Box-model */</span></span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">float</span>: right;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Typography */</span></span><br><span class="line">  <span class="attribute">font</span>: normal <span class="number">13px</span> <span class="string">'Helvetica Neue'</span>, sans-serif;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.5</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Visual */</span></span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f5f5f5</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#e5e5e5</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Misc */</span></span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åµŒå¥—é€‰æ‹©å™¨çš„æ·±åº¦ä¸è¦è¶…è¿‡ 3 å±‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  .content &#123;</span><br><span class="line">    <span class="selector-class">.profile</span> &#123;</span><br><span class="line">      <span class="comment">/* STOP! */</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¦ä½¿ç”¨ <code>@import</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/* bad */ @import url("other.css"); /* good */</span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"other.css"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>å°†åª’ä½“æŸ¥è¯¢è¯­å¥æ”¾åœ¨é è¿‘ç›¸å…³è§„åˆ™æœ€è¿‘çš„ä½ç½®</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.element</span> &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.element-avatar</span> &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.element-selected</span> &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-width:</span> <span class="number">480px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.element</span> &#123;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.element-avatar</span> &#123;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.element-selected</span> &#123;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç®€çŸ­çš„ç”³æ˜è¯­å¥</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// bad</span><br><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// good</span><br><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ stylelint æ£€æŸ¥æ ·å¼ä»£ç </p><p><a href="https://github.com/shinnn/vscode-stylelint" target="_blank" rel="noopener">https://github.com/shinnn/vscode-stylelint</a></p><h2 id="JS-è§„èŒƒ"><a href="#JS-è§„èŒƒ" class="headerlink" title="JS è§„èŒƒ"></a>JS è§„èŒƒ</h2><p>ä½¿ç”¨ const ä¼˜äº letï¼Œå¼ƒç”¨ var</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">'jack'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myVariable = <span class="string">'myVariable'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">const</span> FIRST_US_PRESIDENT = <span class="string">'George Washington'</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å­—é¢é‡åˆ›å»ºå¯¹è±¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> <span class="built_in">Object</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;&#125;</span><br></pre></td></tr></table></figure><p>å‡½æ•°åæˆ–æ–¹æ³•åä½¿ç”¨åŠ¨å®¾çŸ­è¯­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">userInfo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserInfo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘½åæ‰€æœ‰çš„æ–¹æ³•åŒ…å«é—­åŒ…å’Œå›è°ƒ, é¿å…åŒ¿åæ–¹æ³•</p><p>å‘½åæ–¹æ³•å’Œå‡½æ•°å¯ä»¥è®©ä½ åœ¨ä»£ç è¿è¡Œå‡ºé”™æ—¶æ›´å¿«çš„æ‰¾åˆ°é”™è¯¯</p><p>å¸ƒå°”å€¼å˜é‡ä½¿ç”¨ is å¼€å¤´çš„è¯ç»„</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">const</span> finished = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">const</span> isFinished = <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>é¿å…é‡å¤çš„æè¿°å¯¹è±¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">const</span> car = &#123;</span><br><span class="line">  carMake: <span class="string">'Honda'</span>,</span><br><span class="line">  carModel: <span class="string">'Accord'</span>,</span><br><span class="line">  carColor: <span class="string">'Blue'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">const</span> Car = &#123;</span><br><span class="line">  make: <span class="string">'Honda'</span>,</span><br><span class="line">  model: <span class="string">'Accord'</span>,</span><br><span class="line">  color: <span class="string">'Blue'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æœ‰æ„ä¹‰å¯è¯»æ€§å¥½çš„å˜é‡å</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">const</span> yyyymmdstr = moment().format(<span class="string">'YYYY/MM/DD'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">525600</span>; i++) &#123;</span><br><span class="line">  runCronJob()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">const</span> yearMonthDay = moment().format(<span class="string">'YYYY/MM/DD'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MINUTES_IN_A_YEAR = <span class="number">525600</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; MINUTES_IN_A_YEAR; i++) &#123;</span><br><span class="line">  runCronJob()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†å‡½æ•°å‚æ•°é™åˆ¶ 2 ä¸ªä»¥å†…</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMenu</span>(<span class="params">title, body, buttonText, cancellable</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">const</span> menuConfig = &#123;</span><br><span class="line">  title: <span class="string">'Foo'</span>,</span><br><span class="line">  body: <span class="string">'Bar'</span>,</span><br><span class="line">  buttonText: <span class="string">'Baz'</span>,</span><br><span class="line">  cancellable: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMenu</span>(<span class="params">menuConfig</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°è£…åˆ¤æ–­æ¡ä»¶</p><p>å°†å¤šä¸ªæ¡ä»¶çš„åˆ¤æ–­ç»“æœèµ‹å€¼ç»™ä¸€ä¸ªå˜é‡æˆ–ä½¿ç”¨ä¸€ä¸ªå‡½æ•°è¿”å›</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">if</span> (fsm.state === <span class="string">'fetching'</span> &amp;&amp; isEmpty(listNode)) &#123;</span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shouldShowSpinner</span>(<span class="params">fsm, listNode</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> fsm.state === <span class="string">'fetching'</span> &amp;&amp; isEmpty(listNode)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (shouldShowSpinner(fsmInstance, listNodeInstance)) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¿å…å¦å®šæƒ…å†µçš„åˆ¤æ–­</p><p>å°½å¯èƒ½åªä½¿ç”¨æ­£å‘çš„åˆ¤æ–­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">if</span>(!isLoading) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">if</span>(isLoading) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ é™¤æ— æ•ˆçš„ä»£ç </p><p>åŠæ—¶åˆ é™¤ä¸å†è¢«è°ƒç”¨çš„ä»£ç ï¼Œé¿å…ç»™é˜…è¯»ä»£ç å¸¦æ¥å›°æ‰°</p><p>ä½¿ç”¨ <code>try/catch</code>  è¯­å¥æ•è·å¯èƒ½å‡ºç°çš„é”™è¯¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  functionThatMightThrow()</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  <span class="comment">// ä¸å•å•åªæ˜¯ä½¿ç”¨ console</span></span><br><span class="line">  <span class="built_in">console</span>.error(error)</span><br><span class="line">  <span class="comment">// æ›´å¤šçš„é”™è¯¯å¤„ç†</span></span><br><span class="line">  notifyUserOfError(error)</span><br><span class="line">  <span class="comment">// æŠ¥å‘Šé”™è¯¯</span></span><br><span class="line">  reportErrorToService(error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªæ³¨é‡Šä¸šåŠ¡é€»è¾‘å¤æ‚æ€§çš„ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hashIt</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> hash = <span class="number">0</span></span><br><span class="line">  <span class="keyword">var</span> length = data.length</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> char = data.charCodeAt(i)</span><br><span class="line">    hash = (hash &lt;&lt; <span class="number">5</span>) - hash + char</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Convert to 32-bit integer</span></span><br><span class="line">    hash = hash &amp; hash</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Vue-è§„èŒƒ"><a href="#Vue-è§„èŒƒ" class="headerlink" title="Vue è§„èŒƒ"></a>Vue è§„èŒƒ</h2><p>å°†ç»„ä»¶åå‘½åä¸ºå¤šä¸ªå•è¯</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line">todo.vue</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line">todo-item.vue</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ PascalCase æˆ–è€… kebab-case å‘½åç»„ä»¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- bad  --&gt;</span></span><br><span class="line">components/ |- mycomponent.vue components/ |- myComponent.vue</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- good --&gt;</span></span><br><span class="line">components/ |- MyComponent.vue components/ |- my-component.vue</span><br></pre></td></tr></table></figure><p>è¯¦ç»†å®šä¹‰ç»„ä»¶çš„  Prop</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line">props: [<span class="string">'status'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line">props: &#123;</span><br><span class="line">   status: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ v-for å¾ªç¯ä¸ŠåŠ  key</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- bad --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"todo in todos"</span>&gt;</span></span><br><span class="line">  &#123;&#123; todo.text &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- good --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"todo in todos"</span> <span class="attr">:key</span>=<span class="string">"todo.id"</span>&gt;</span></span><br><span class="line">  &#123;&#123; todo.text &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸è¦æŠŠ  v-if  å’Œ  v-for  åŒæ—¶ç”¨åœ¨åŒä¸€ä¸ªå…ƒç´ ä¸Š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- bad --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"user in users"</span> <span class="attr">v-if</span>=<span class="string">"shouldShowUsers"</span> <span class="attr">:key</span>=<span class="string">"user.id"</span>&gt;</span></span><br><span class="line">    &#123;&#123; user.name &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- good --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">v-if</span>=<span class="string">"shouldShowUsers"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"user in users"</span> <span class="attr">:key</span>=<span class="string">"user.id"</span>&gt;</span></span><br><span class="line">    &#123;&#123; user.name &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸ºç»„ä»¶æ ·å¼è®¾ç½®ä½œç”¨åŸŸ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- bad --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-close"</span>&gt;</span>X<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.btn-close</span> &#123;</span></span><br><span class="line">    background-color: red;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--  good --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"c-button c-button--close"</span>&gt;</span>X<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨ BEM çº¦å®š --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.c-button</span> &#123;</span></span><br><span class="line">    border: none;</span><br><span class="line">    border-radius: 2px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">  <span class="selector-class">.c-button--close</span> &#123;</span></span><br><span class="line">    background-color: red;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ç»„ä»¶å’Œå®ä¾‹çš„é€‰é¡¹ä½¿ç”¨ç»Ÿä¸€çš„é¡ºåº</strong></p><ol><li><strong>å‰¯ä½œç”¨</strong>(è§¦å‘ç»„ä»¶å¤–çš„å½±å“)</li></ol><ul><li><code>el</code></li></ul><ol start="2"><li><strong>å…¨å±€æ„ŸçŸ¥</strong>(è¦æ±‚ç»„ä»¶ä»¥å¤–çš„çŸ¥è¯†)</li></ol><ul><li><code>name</code></li><li><code>parent</code></li></ul><ol start="3"><li><strong>ç»„ä»¶ç±»å‹</strong>(æ›´æ”¹ç»„ä»¶çš„ç±»å‹)</li></ol><ul><li><code>functional</code></li></ul><ol start="4"><li><strong>æ¨¡æ¿ä¿®æ”¹å™¨</strong>(æ”¹å˜æ¨¡æ¿çš„ç¼–è¯‘æ–¹å¼)</li></ol><ul><li><code>delimiters</code></li><li><code>comments</code></li></ul><ol start="5"><li><strong>æ¨¡æ¿ä¾èµ–</strong>(æ¨¡æ¿å†…ä½¿ç”¨çš„èµ„æº)</li></ol><ul><li><code>components</code></li><li><code>directives</code></li><li><code>filters</code></li></ul><ol start="6"><li><strong>ç»„åˆ</strong>(å‘é€‰é¡¹é‡Œåˆå¹¶å±æ€§)</li></ol><ul><li><code>extends</code></li><li><code>mixins</code></li></ul><ol start="7"><li><strong>æ¥å£</strong>(ç»„ä»¶çš„æ¥å£)</li></ol><ul><li><code>inheritAttrs</code></li><li><code>model</code></li><li><code>props</code>/<code>propsData</code></li></ul><ol start="8"><li><strong>æœ¬åœ°çŠ¶æ€</strong>(æœ¬åœ°çš„å“åº”å¼å±æ€§)</li></ol><ul><li><code>data</code></li><li><code>computed</code></li></ul><ol start="9"><li><strong>äº‹ä»¶</strong>(é€šè¿‡å“åº”å¼äº‹ä»¶è§¦å‘çš„å›è°ƒ)</li></ol><ul><li><code>watch</code></li><li>ç”Ÿå‘½å‘¨æœŸé’©å­ (æŒ‰ç…§å®ƒä»¬è¢«è°ƒç”¨çš„é¡ºåº)<ul><li><code>beforeCreate</code></li><li><code>created</code></li><li><code>beforeMount</code></li><li><code>mounted</code></li><li><code>beforeUpdate</code></li><li><code>updated</code></li><li><code>activated</code></li><li><code>deactivated</code></li><li><code>beforeDestroy</code></li><li><code>destroyed</code></li></ul></li></ul><ol start="10"><li><strong>éå“åº”å¼çš„å±æ€§</strong>(ä¸ä¾èµ–å“åº”ç³»ç»Ÿçš„å®ä¾‹å±æ€§)</li></ol><ul><li><code>methods</code></li></ul><ol start="11"><li><strong>æ¸²æŸ“</strong>(ç»„ä»¶è¾“å‡ºçš„å£°æ˜å¼æè¿°)</li></ol><ul><li><code>template</code>/<code>render</code></li><li><code>renderError</code></li></ul><p><strong>å…ƒç´ å’Œç»„ä»¶çš„ç‰¹æ€§ä½¿ç”¨ç»Ÿä¸€çš„é¡ºåº</strong></p><ol><li><strong>å®šä¹‰</strong>(æä¾›ç»„ä»¶çš„é€‰é¡¹)</li></ol><ul><li><code>is</code></li></ul><ol start="2"><li><strong>åˆ—è¡¨æ¸²æŸ“</strong>(åˆ›å»ºå¤šä¸ªå˜åŒ–çš„ç›¸åŒå…ƒç´ )</li></ol><ul><li><code>v-for</code></li></ul><ol start="3"><li><strong>æ¡ä»¶æ¸²æŸ“</strong>(å…ƒç´ æ˜¯å¦æ¸²æŸ“/æ˜¾ç¤º)</li></ol><ul><li><code>v-if</code></li><li><code>v-else-if</code></li><li><code>v-else</code></li><li><code>v-show</code></li><li><code>v-cloak</code></li></ul><ol start="4"><li><strong>æ¸²æŸ“æ–¹å¼</strong>(æ”¹å˜å…ƒç´ çš„æ¸²æŸ“æ–¹å¼)</li></ol><ul><li><code>v-pre</code></li><li><code>v-once</code></li></ul><ol start="5"><li><strong>å…¨å±€æ„ŸçŸ¥</strong>(éœ€è¦è¶…è¶Šç»„ä»¶çš„çŸ¥è¯†)</li></ol><ul><li><code>id</code></li></ul><ol start="6"><li><strong>å”¯ä¸€çš„ç‰¹æ€§</strong>(éœ€è¦å”¯ä¸€å€¼çš„ç‰¹æ€§)</li></ol><ul><li><code>ref</code></li><li><code>key</code></li><li><code>slot</code></li></ul><ol start="7"><li><strong>åŒå‘ç»‘å®š</strong>(æŠŠç»‘å®šå’Œäº‹ä»¶ç»“åˆèµ·æ¥)</li></ol><ul><li><code>v-model</code></li></ul><ol start="8"><li><strong>å…¶å®ƒç‰¹æ€§</strong> (æ‰€æœ‰æ™®é€šçš„ç»‘å®šæˆ–æœªç»‘å®šçš„ç‰¹æ€§)<br /></li><li><strong>äº‹ä»¶</strong>(ç»„ä»¶äº‹ä»¶ç›‘å¬å™¨)</li></ol><ul><li><code>v-on</code></li></ul><ol start="10"><li><strong>å†…å®¹</strong>(è¦†å†™å…ƒç´ çš„å†…å®¹)</li></ol><ul><li><code>v-html</code></li><li><code>v-text</code></li></ul><p>ä¿è¯ä¸€ä¸ªç»„ä»¶ä¸“æ³¨äºè§£å†³ä¸€ä¸ªé—®é¢˜</p><p>ç¡®ä¿ä¸€ä¸ªç»„ä»¶æ˜¯ç‹¬ç«‹çš„ã€å¯å¤ç”¨çš„ã€å¾®å°çš„å’Œå¯æµ‹è¯•çš„</p><p>å°†è¡Œå†…è¡¨è¾¾å¼è½¬ä¸º  computed</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// bad</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">    &#123;&#123; (new Date()).getUTCFullYear() &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// good</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">    &#123;&#123; year &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    computed: &#123;</span><br><span class="line">      year() &#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>().getUTCFullYear()</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å°½å¯èƒ½ä½¿ç”¨ mixins</p><p>Mixins å°è£…å¯é‡ç”¨çš„ä»£ç ï¼Œé¿å…äº†é‡å¤ã€‚å¦‚æœä¸¤ä¸ªç»„ä»¶å…±äº«æœ‰ç›¸åŒçš„åŠŸèƒ½ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ mixin</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HelloMixin = &#123;</span><br><span class="line">methods: &#123;</span><br><span class="line">  hello() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'hello'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CompA</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">import</span> HelloMixin <span class="keyword">from</span> <span class="string">'./HelloMixin'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">'CompA'</span>,</span><br><span class="line">    mixins: [HelloMixin]</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ CompB</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  import HelloMixin from './</span>HelloMixin<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  export default &#123;</span></span><br><span class="line"><span class="string">    name: '</span>CompB<span class="string">',</span></span><br><span class="line"><span class="string">    mixins: [HelloMixin]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Node-è§„èŒƒ"><a href="#Node-è§„èŒƒ" class="headerlink" title="Node è§„èŒƒ"></a>Node è§„èŒƒ</h2><p>require æ–‡ä»¶å¤¹ï¼Œè€Œä¸æ˜¯æ–‡ä»¶</p><p>åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­å¼€å‘åº“/æ¨¡å—ï¼Œæ”¾ç½®ä¸€ä¸ªæ–‡ä»¶ index.js æš´éœ²æ¨¡å—çš„å†…éƒ¨</p><p>ä½¿ç”¨ .npmrc é”ä½ä¾èµ–ç‰ˆæœ¬</p><p>ä»£ç å¿…é¡»åœ¨æ‰€æœ‰çš„ç¯å¢ƒä¸­æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯ Npm é»˜è®¤æƒ…å†µä¸‹ä¼šæ‹¿åŒ…çš„æœ€æ–°ç‰ˆæœ¬ï¼Œé…ç½® .npmrc é”å®šä¾èµ–ç‰ˆæœ¬</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">save-exact=true</span><br></pre></td></tr></table></figure><p>åœ¨ Node å¤–ç®¡ç†å‰ç«¯èµ„æº</p><p>ä½¿ç”¨ä¸“é—¨çš„ä¸­é—´ä»¶ï¼ˆnginxï¼ŒS3ï¼ŒCDNï¼‰æœåŠ¡å‰ç«¯å†…å®¹ï¼Œè¿™æ˜¯å› ä¸ºåœ¨å¤„ç†å¤§é‡é™æ€æ–‡ä»¶çš„æ—¶å€™ï¼Œç”±äº node çš„å•çº¿ç¨‹æ¨¡å‹ï¼Œå®ƒçš„æ€§èƒ½å¾ˆå—å½±å“</p><p>ä½¿ç”¨ä¸­é—´ä»¶é™åˆ¶å¹¶å‘è¯·æ±‚</p><p>DOS æ”»å‡»éå¸¸æµè¡Œè€Œä¸”ç›¸å¯¹å®¹æ˜“å¤„ç†ã€‚ä½¿ç”¨å¤–éƒ¨æœåŠ¡ï¼Œæ¯”å¦‚ cloud è´Ÿè½½å‡è¡¡, cloud é˜²ç«å¢™, nginx, æˆ–è€…ï¼ˆå¯¹äºå°çš„ï¼Œä¸æ˜¯é‚£ä¹ˆé‡è¦çš„ appï¼‰ä¸€ä¸ªé€Ÿç‡é™åˆ¶ä¸­é—´ä»¶(æ¯”å¦‚<a href="https://www.npmjs.com/package/express-rate-limit" target="_blank" rel="noopener">express-rate-limit</a>)ï¼Œæ¥å®ç°é€Ÿç‡é™åˆ¶ã€‚å¦åˆ™åº”ç”¨ç¨‹åºå¯èƒ½å—åˆ°æ”»å‡», å¯¼è‡´æ‹’ç»æœåŠ¡, åœ¨è¿™ç§æƒ…å†µä¸‹, çœŸå®ç”¨æˆ·ä¼šé­å—æœåŠ¡é™çº§æˆ–ä¸å¯ç”¨ã€‚</p><p>éªŒè¯ä¼ å…¥çš„ JSON schemas</p><p>éªŒè¯ä¼ å…¥è¯·æ±‚çš„ body payloadï¼Œå¹¶ç¡®ä¿å…¶ç¬¦åˆé¢„æœŸè¦æ±‚, å¦‚æœæ²¡æœ‰, åˆ™å¿«é€ŸæŠ¥é”™ã€‚ä¸ºäº†é¿å…æ¯ä¸ªè·¯ç”±ä¸­ç¹ççš„éªŒè¯ç¼–ç , æ‚¨å¯ä»¥ä½¿ç”¨åŸºäº JSON çš„è½»é‡çº§éªŒè¯æ¶æ„ï¼Œæ¯”å¦‚  <a href="https://www.npmjs.com/package/jsonschema" target="_blank" rel="noopener">jsonschema</a> or <a href="https://www.npmjs.com/package/joi" target="_blank" rel="noopener">joi</a>ï¼Œå¦åˆ™æ‚¨ç–å¿½å’Œå®½æ¾çš„æ–¹æ³•å¤§å¤§å¢åŠ äº†æ”»å‡»é¢, å¹¶é¼“åŠ±æ”»å‡»è€…å°è¯•è®¸å¤šè¾“å…¥, ç›´åˆ°ä»–ä»¬æ‰¾åˆ°ä¸€äº›ç»„åˆ, ä½¿åº”ç”¨ç¨‹åºå´©æºƒã€‚</p><p>ä½¿ç”¨é root ç”¨æˆ·è¿è¡Œ Node.js</p><p>Node.js ä½œä¸ºä¸€ä¸ªå…·æœ‰æ— é™æƒé™çš„ root ç”¨æˆ·è¿è¡Œï¼Œè¿™æ˜¯ä¸€ç§æ™®éçš„æƒ…æ™¯ã€‚ä¾‹å¦‚ï¼Œåœ¨ Docker å®¹å™¨ä¸­ï¼Œè¿™æ˜¯é»˜è®¤è¡Œä¸ºã€‚å»ºè®®åˆ›å»ºä¸€ä¸ªé root ç”¨æˆ·ï¼Œå¹¶ä¿å­˜åˆ° Docker é•œåƒä¸­ï¼ˆä¸‹é¢ç»™å‡ºäº†ç¤ºä¾‹ï¼‰ï¼Œæˆ–è€…é€šè¿‡è°ƒç”¨å¸¦æœ‰â€-u usernameâ€ çš„å®¹å™¨æ¥ä»£è¡¨æ­¤ç”¨æˆ·è¿è¡Œè¯¥è¿›ç¨‹ï¼Œå¦åˆ™åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œè„šæœ¬çš„æ”»å‡»è€…åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šè·å¾—æ— é™åˆ¶çš„æƒåˆ© (ä¾‹å¦‚ï¼Œæ”¹å˜ iptableï¼Œå¼•æµåˆ°ä»–çš„æœåŠ¡å™¨ä¸Š)</p><h2 id="å…¶å®ƒè§„èŒƒ"><a href="#å…¶å®ƒè§„èŒƒ" class="headerlink" title="å…¶å®ƒè§„èŒƒ"></a>å…¶å®ƒè§„èŒƒ</h2><p>ä½¿ç”¨ jest è¿›è¡Œå•å…ƒæµ‹è¯•</p><p>é€šå¸¸åªè¦æ±‚å¯¹ä¸€äº›åŸºç¡€/åº•å±‚çš„ç»„ä»¶ã€å‡½æ•°è¿›è¡Œæµ‹è¯•, è§†æƒ…å†µè€ƒè™‘æ˜¯å¦è¦æµ‹è¯•ä¸šåŠ¡ä»£ç </p><p>ä½¿ç”¨ <a href="https://link.juejin.im/?target=https%3A%2F%2Fprettier.io">Prettier</a>  æ ¼å¼åŒ–ä»£ç </p><p><br />æ‰€æœ‰ä»£ç æ ¼å¼ç›¸å…³çš„å·¥ä½œéƒ½å¯ä»¥äº¤ç»™ Prettier æ¥åš</p><p>åˆç†çš„å›¾ç‰‡å‘½å</p><p>å›¾ç‰‡ä¸šåŠ¡ + å›¾ç‰‡åŠŸèƒ½ç±»åˆ« + å›¾ç‰‡æ¨¡å—åç§° + å›¾ç‰‡ç²¾åº¦</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://codeguide.co" target="_blank" rel="noopener">Code Guide</a></li><li><a href="https://guide.aotu.io/" target="_blank" rel="noopener">O2 å‰ç«¯è§„èŒƒæ–‡æ¡£</a></li><li><a href="https://github.com/alivebao/clean-code-js" target="_blank" rel="noopener">JavaScript é£æ ¼æŒ‡å—</a></li><li><a href="https://cn.vuejs.org/v2/style-guide/" target="_blank" rel="noopener">Vue  é£æ ¼æŒ‡å—</a></li><li><a href="https://github.com/pablohpsilva/vuejs-component-style-guide/blob/master/README-CN.md" target="_blank" rel="noopener">Vue.js ç»„ä»¶ç¼–ç è§„èŒƒ</a></li><li><a href="https://github.com/goldbergyoni/nodebestpractices/blob/master/README.chinese.md" target="_blank" rel="noopener">Node.js æœ€ä½³å®è·µ</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è‰¯å¥½çš„ä»£ç è§„èŒƒæœ‰åˆ©äºæé«˜é¡¹ç›®å¼€å‘æ•ˆç‡ä»¥åŠå‡å°‘é˜…è¯»ä»£ç çš„å›°éš¾ï¼Œæœ¬è§„èŒƒç»“åˆäº†(chaoxi)å¤šä¸ªæµè¡Œçš„ä»£ç è§„èŒƒä»¥åŠå‰äººçš„å¼€å‘ç»éªŒè€Œæˆï¼Œå‚è€ƒè§„èŒƒè¿›è¡Œå¼€å‘æé«˜ä»£ç è´¨é‡&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Standard" scheme="https://coldstone.fun/tags/Standard/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Intl å¯¹è±¡è¿›è¡Œæ—¥æœŸæ—¶é—´æ ¼å¼åŒ–</title>
    <link href="https://coldstone.fun/post/2019/10/05/js-intl/"/>
    <id>https://coldstone.fun/post/2019/10/05/js-intl/</id>
    <published>2019-10-05T04:04:00.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦è¯´æ˜å¦‚ä½•ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦çš„ Intl å¯¹è±¡è¿›è¡Œæ—¥æœŸæ—¶é—´çš„æ ¼å¼åŒ–</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¹³æ—¶é¡¹ç›®ä¸­è¦å¯¹æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–é€šå¸¸ä¼šä½¿ç”¨å¦‚ <a href="https://github.com/iamkun/dayjs" target="_blank" rel="noopener">dayjs</a>ï¼Œ<a href="https://github.com/date-fns/date-fns" target="_blank" rel="noopener">date-fns</a>ï¼Œ<a href="https://github.com/moment/moment" target="_blank" rel="noopener">moment</a> è¿™äº›ç¬¬ä¸‰æ–¹åº“ï¼Œä½†æ˜¯æˆ‘ä»¬å¯èƒ½åªéœ€è¦æŸå‡ ä¸ªæ–¹æ³•ï¼Œå´å®‰è£…äº†ä¸€æ•´ä¸ªåº“ï¼Œå¤§å¤§å¢åŠ äº†é¡¹ç›®çš„ä½“ç§¯ï¼Œå…·ä½“å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« çš„æ•°æ® <a href="https://github.com/you-dont-need/You-Dont-Need-Momentjs" target="_blank" rel="noopener">You-Dont-Need-Momentjs</a>ã€‚æœ¬æ–‡ä¸»è¦è¯´æ˜å¦‚ä½•ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦çš„ Intl å¯¹è±¡è¿›è¡Œæ—¥æœŸæ—¶é—´çš„æ ¼å¼åŒ–</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Intl" target="_blank" rel="noopener">MDN</a></p><blockquote><p>Intl å¯¹è±¡æ˜¯ ECMAScript å›½é™…åŒ– API çš„ä¸€ä¸ªå‘½åç©ºé—´ï¼Œå®ƒæä¾›äº†ç²¾ç¡®çš„å­—ç¬¦ä¸²å¯¹æ¯”ã€æ•°å­—æ ¼å¼åŒ–ï¼Œå’Œæ—¥æœŸæ—¶é—´æ ¼å¼åŒ–ã€‚Collatorï¼ŒNumberFormat å’Œ DateTimeFormat å¯¹è±¡çš„æ„é€ å‡½æ•°æ˜¯ Intl å¯¹è±¡çš„å±æ€§ã€‚æœ¬é¡µæ–‡æ¡£å†…å®¹åŒ…æ‹¬äº†è¿™äº›å±æ€§ï¼Œä»¥åŠå›½é™…åŒ–ä½¿ç”¨çš„æ„é€ å™¨å’Œå…¶ä»–è¯­è¨€çš„æ–¹æ³•ç­‰å¸¸è§çš„åŠŸèƒ½ã€‚</p></blockquote><h2 id="æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–"><a href="#æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–" class="headerlink" title="æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–"></a>æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–</h2><p>è¦å¯¹æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–å°±è¦ä½¿ç”¨ <code>Intl.DateTimeFormat</code> å¯¹è±¡ï¼Œå®ƒæ˜¯æ ¹æ®è¯­è¨€æ¥æ ¼å¼åŒ–æ—¥æœŸå’Œæ—¶é—´çš„æ„é€ å‡½æ•°ã€‚</p><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¯­è¨€ä»£ç ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ„é€ å‡½æ•°çš„é€‰é¡¹ï¼Œéƒ½æ˜¯å¯é€‰çš„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Intl</span>.DateTimeFormat([locales[, options]])</span><br></pre></td></tr></table></figure><h3 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Intl</span>.DateTimeFormat(<span class="string">'en-US'</span>).format(date))</span><br><span class="line"><span class="comment">// "10/8/2019"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Intl</span>.DateTimeFormat(<span class="string">'zh-CN'</span>).format(date))</span><br><span class="line"><span class="comment">// "2019/10/8"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Intl</span>.DateTimeFormat(<span class="string">'zh-CN'</span>, &#123;</span><br><span class="line">    year: <span class="string">'numeric'</span>,</span><br><span class="line">    month: <span class="string">'numeric'</span>,</span><br><span class="line">    day: <span class="string">'numeric'</span>,</span><br><span class="line">    weekday: <span class="string">'long'</span>,</span><br><span class="line">    hour: <span class="string">'numeric'</span>,</span><br><span class="line">    minute: <span class="string">'numeric'</span>,</span><br><span class="line">    second: <span class="string">'numeric'</span>,</span><br><span class="line">    hour12: <span class="literal">false</span></span><br><span class="line">  &#125;).format(date)</span><br><span class="line">)</span><br><span class="line"><span class="comment">// "2019å¹´10æœˆ8æ—¥æ˜ŸæœŸäºŒ 15:07:04"</span></span><br></pre></td></tr></table></figure><h3 id="è¯¦ç»†ä½¿ç”¨"><a href="#è¯¦ç»†ä½¿ç”¨" class="headerlink" title="è¯¦ç»†ä½¿ç”¨"></a>è¯¦ç»†ä½¿ç”¨</h3><p>å‚è€ƒæ–‡æ¡£ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/DateTimeFormat" target="_blank" rel="noopener">Intl.DateTimeFormat</a></p><h2 id="ç›¸å¯¹æ—¶é—´æ ¼å¼åŒ–"><a href="#ç›¸å¯¹æ—¶é—´æ ¼å¼åŒ–" class="headerlink" title="ç›¸å¯¹æ—¶é—´æ ¼å¼åŒ–"></a>ç›¸å¯¹æ—¶é—´æ ¼å¼åŒ–</h2><p>ä½¿ç”¨ Intl.RelativeTimeFormat å¯¹ç›¸å¯¹æ—¶é—´è¿›è¡Œæ ¼å¼åŒ–</p><h3 id="è¯­æ³•-1"><a href="#è¯­æ³•-1" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><p>åŒä¸Šï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¯­è¨€ä»£ç ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ„é€ å‡½æ•°çš„é€‰é¡¹ï¼Œéƒ½æ˜¯å¯é€‰çš„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Intl</span>.RelativeTimeFormat([locales[, options]])</span><br></pre></td></tr></table></figure><h3 id="ç®€å•ä½¿ç”¨-1"><a href="#ç®€å•ä½¿ç”¨-1" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> rtf = <span class="keyword">new</span> <span class="built_in">Intl</span>.RelativeTimeFormat(<span class="string">'zh-CN'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(rtf.format(<span class="number">-3</span>, <span class="string">'day'</span>))</span><br><span class="line"><span class="comment">// "3å¤©å‰"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(rtf.format(<span class="number">3</span>, <span class="string">'day'</span>))</span><br><span class="line"><span class="comment">// "3å¤©å"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(rtf.format(<span class="number">3</span>, <span class="string">'minute'</span>))</span><br><span class="line"><span class="comment">// "3åˆ†é’Ÿå"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(rtf.format(<span class="number">-3</span>, <span class="string">'second'</span>))</span><br><span class="line"><span class="comment">// "3ç§’é’Ÿå‰"</span></span><br></pre></td></tr></table></figure><h3 id="è¯¦ç»†ä½¿ç”¨-1"><a href="#è¯¦ç»†ä½¿ç”¨-1" class="headerlink" title="è¯¦ç»†ä½¿ç”¨"></a>è¯¦ç»†ä½¿ç”¨</h3><p>å‚è€ƒæ–‡æ¡£ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RelativeTimeFormat#%E5%8F%82%E6%95%B0" target="_blank" rel="noopener">Intl.RelativeTimeFormat</a></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.zhangxinxu.com/wordpress/2019/09/js-intl-zh/" target="_blank" rel="noopener">Intl</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Intl" target="_blank" rel="noopener">JS Intl å¯¹è±¡å®Œæ•´ç®€ä»‹åŠåœ¨ä¸­æ–‡ä¸­çš„åº”ç”¨</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ä¸»è¦è¯´æ˜å¦‚ä½•ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦çš„ Intl å¯¹è±¡è¿›è¡Œæ—¥æœŸæ—¶é—´çš„æ ¼å¼åŒ–&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="JS" scheme="https://coldstone.fun/tags/JS/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹é›†åˆ</title>
    <link href="https://coldstone.fun/post/2019/10/01/dsa-set/"/>
    <id>https://coldstone.fun/post/2019/10/01/dsa-set/</id>
    <published>2019-10-01T02:46:48.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>é›†åˆæ˜¯ä¸€ç§åŒ…å«ä¸åŒå…ƒç´ çš„æ•°æ®ç»“æ„ï¼Œé›†åˆä¸­çš„å…ƒç´ ç§°ä¹‹ä¸ºæˆå‘˜ã€‚é›†åˆæœ‰ä¸¤ä¸ªé‡è¦çš„ç‰¹æ€§ï¼Œä¸€æ˜¯é›†åˆä¸­çš„æˆå‘˜æ˜¯æ— åºçš„ï¼Œå…¶æ¬¡é›†åˆä¸­ä¸å­˜åœ¨ç›¸åŒçš„æˆå‘˜ã€‚</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é›†åˆæ˜¯ä¸€ç§åŒ…å«ä¸åŒå…ƒç´ çš„æ•°æ®ç»“æ„ï¼Œé›†åˆä¸­çš„å…ƒç´ ç§°ä¹‹ä¸ºæˆå‘˜ã€‚é›†åˆæœ‰ä¸¤ä¸ªé‡è¦çš„ç‰¹æ€§ï¼Œä¸€æ˜¯é›†åˆä¸­çš„æˆå‘˜æ˜¯æ— åºçš„ï¼Œå…¶æ¬¡é›†åˆä¸­ä¸å­˜åœ¨ç›¸åŒçš„æˆå‘˜ã€‚</p><h2 id="å…³äºé›†åˆ"><a href="#å…³äºé›†åˆ" class="headerlink" title="å…³äºé›†åˆ"></a>å…³äºé›†åˆ</h2><p>ä¸åŒ…å«ä»»ä½•æˆå‘˜çš„é›†åˆç§°ä¸ºç©ºé›†ï¼Œå…¨é›†åˆ™æ˜¯åŒ…å«å¯èƒ½ä¸€åˆ‡æˆå‘˜çš„é›†åˆã€‚<br>å¦‚æœä¸¤ä¸ªé›†åˆçš„æˆå‘˜å®Œå…¨ç›¸ç­‰ï¼Œåˆ™ä¸¤ä¸ªé›†åˆç›¸ç­‰ã€‚<br>å¦‚æœä¸€ä¸ªé›†åˆçš„æ‰€æœ‰æˆå‘˜éƒ½å±äºå¦ä¸€ä¸ªé›†åˆï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªé›†åˆæ˜¯å¦ä¸€ä¸ªé›†åˆçš„å­é›†ã€‚<br>å¹¶é›†-å°†ä¸¤ä¸ªé›†åˆçš„æˆå‘˜åˆå¹¶çš„æ“ä½œã€‚<br>äº¤é›†-å°†ä¸¤ä¸ªé›†åˆå…±æœ‰çš„æˆå‘˜ç»„æˆä¸€ä¸ªæ–°çš„é›†åˆã€‚<br>è¡¥é›†-å±äºä¸€ä¸ªé›†åˆè€Œä¸å±äºå¦ä¸€ä¸ªé›†åˆçš„æˆå‘˜ã€‚</p><h2 id="å®ç°é›†åˆ"><a href="#å®ç°é›†åˆ" class="headerlink" title="å®ç°é›†åˆ"></a>å®ç°é›†åˆ</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> MySet &#123;</span><br><span class="line">  data = &lt;<span class="built_in">any</span>&gt;[]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> size() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data.length</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  add(element: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.data.indexOf(element) &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.data.push(element)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  remove(element: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> index = <span class="keyword">this</span>.data.indexOf(element)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.data.splice(index, <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  contains(element: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.data.indexOf(element) &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¹¶é›†</span></span><br><span class="line">  uinon(<span class="keyword">set</span>: MySet) &#123;</span><br><span class="line">    <span class="keyword">const</span> newSet = <span class="keyword">new</span> MySet()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.data.forEach(<span class="function">(<span class="params">e: <span class="built_in">any</span></span>) =&gt;</span> newSet.add(e))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="keyword">set</span>.data.length; index++) &#123;</span><br><span class="line">      <span class="keyword">const</span> ele = <span class="keyword">set</span>.data[index]</span><br><span class="line">      <span class="keyword">if</span> (!newSet.contains(ele)) &#123;</span><br><span class="line">        newSet.add(ele)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> newSet</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// äº¤é›†</span></span><br><span class="line">  intersect(<span class="keyword">set</span>: MySet) &#123;</span><br><span class="line">    <span class="keyword">const</span> newSet = <span class="keyword">new</span> MySet()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.data.forEach(<span class="function">(<span class="params">ele: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">set</span>.contains(ele)) &#123;</span><br><span class="line">        newSet.add(ele)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> newSet</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯è¡¥é›†</span></span><br><span class="line">  subset(<span class="keyword">set</span>: MySet) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.size &gt; <span class="keyword">set</span>.size) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="keyword">this</span>.data.length; index++) &#123;</span><br><span class="line">        <span class="keyword">const</span> element = <span class="keyword">this</span>.data[index]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">set</span>.contains(element)) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›é›†åˆä¸­ä¸åŒçš„æˆå‘˜</span></span><br><span class="line">  difference(<span class="keyword">set</span>: MySet) &#123;</span><br><span class="line">    <span class="keyword">const</span> newSet = <span class="keyword">new</span> MySet()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="keyword">this</span>.data.length; index++) &#123;</span><br><span class="line">      <span class="keyword">const</span> element = <span class="keyword">this</span>.data[index]</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">set</span>.contains(element)) &#123;</span><br><span class="line">        newSet.add(element)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> newSet</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  show() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data.forEach(<span class="function">(<span class="params">e: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">console</span>.log(e))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> setOne = <span class="keyword">new</span> MySet()</span><br><span class="line"></span><br><span class="line">setOne.add(<span class="string">'a'</span>)</span><br><span class="line">setOne.add(<span class="string">'b'</span>)</span><br><span class="line">setOne.add(<span class="string">'c'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setTwo = <span class="keyword">new</span> MySet()</span><br><span class="line"></span><br><span class="line">setTwo.add(<span class="string">'c'</span>)</span><br><span class="line">setTwo.add(<span class="string">'d'</span>)</span><br><span class="line">setTwo.add(<span class="string">'e'</span>)</span><br><span class="line">setTwo.add(<span class="string">'f'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setThree = setOne.uinon(setTwo)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'åˆé›†'</span>)</span><br><span class="line">setThree.show()</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆé›†</span></span><br><span class="line"><span class="comment">// a b c d e f</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setFour = setOne.intersect(setTwo)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'äº¤é›†'</span>)</span><br><span class="line">setFour.show()</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº¤é›†</span></span><br><span class="line"><span class="comment">// c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isSubset = setOne.subset(setTwo)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'æ˜¯å¦æ˜¯è¡¥é›†'</span>, isSubset)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¯å¦æ˜¯è¡¥é›† false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setSix = setOne.difference(setTwo)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'æŸ¥çœ‹é›†åˆä¸­ä¸åŒçš„æˆå‘˜'</span>)</span><br><span class="line">setSix.show()</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥çœ‹é›†åˆä¸­ä¸åŒçš„æˆå‘˜</span></span><br><span class="line"><span class="comment">// a b</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é›†åˆæ˜¯ä¸€ç§åŒ…å«ä¸åŒå…ƒç´ çš„æ•°æ®ç»“æ„ï¼Œé›†åˆä¸­çš„å…ƒç´ ç§°ä¹‹ä¸ºæˆå‘˜ã€‚é›†åˆæœ‰ä¸¤ä¸ªé‡è¦çš„ç‰¹æ€§ï¼Œä¸€æ˜¯é›†åˆä¸­çš„æˆå‘˜æ˜¯æ— åºçš„ï¼Œå…¶æ¬¡é›†åˆä¸­ä¸å­˜åœ¨ç›¸åŒçš„æˆå‘˜ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="DSA" scheme="https://coldstone.fun/tags/DSA/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Provider ç®¡ç† Flutter åº”ç”¨çŠ¶æ€ (ä¸‹)</title>
    <link href="https://coldstone.fun/post/2019/09/23/flutter-provider-todos-02/"/>
    <id>https://coldstone.fun/post/2019/09/23/flutter-provider-todos-02/</id>
    <published>2019-09-23T08:17:17.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸ºäº†å­˜å‚¨æ•°æ®å¯ä»¥å°†æ•°æ®å­˜åˆ°æ‰‹æœºçš„å­˜å‚¨é‡Œé¢æˆ–è€…å­˜åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œæœ¬æ–‡å°±å®ç°å¦‚ä½•ä½¿ç”¨ dio å°†æ•°æ®å­˜åˆ°æœåŠ¡å™¨</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç´§æ¥ä¸Šç¯‡ï¼Œå¯¹äºä¸€ä¸ªä»£åŠäº‹é¡¹çš„æ–°å¢ï¼Œä¿®æ”¹ï¼Œåˆ é™¤åŠŸèƒ½éƒ½å·²ç»å®Œæˆäº†ï¼Œä½†æ˜¯æ•°æ®éƒ½æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œé‡æ–°å¯åŠ¨åº”ç”¨æ•°æ®å°±é‡ç½®äº†ï¼Œä¸ºäº†å­˜å‚¨æ•°æ®å¯ä»¥å°†æ•°æ®å­˜åˆ°æ‰‹æœºçš„å­˜å‚¨é‡Œé¢æˆ–è€…å­˜åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œæœ¬æ–‡å°±å®ç°å¦‚ä½•ä½¿ç”¨ <a href="https://github.com/flutterchina/dio" target="_blank" rel="noopener">dio</a> å°†æ•°æ®å­˜åˆ°æœåŠ¡å™¨</p><p><a href="https://github.com/xrr2016/flutter_provider_todos/tree/http" target="_blank" rel="noopener">æºç åœ°å€</a></p><h2 id="å¼€å‘å‡†å¤‡"><a href="#å¼€å‘å‡†å¤‡" class="headerlink" title="å¼€å‘å‡†å¤‡"></a>å¼€å‘å‡†å¤‡</h2><p>åœ¨ <code>pubspec.yaml</code> æ·»åŠ  dio ä¾èµ–ï¼›ä¸€ä¸ªå­˜å‚¨æ•°æ®çš„æœåŠ¡ï¼Œæˆ‘ç”¨çš„æ˜¯ <a href="https://jsonbox.io/" target="_blank" rel="noopener">jsonbox</a></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">dio:</span> <span class="string">^3.0.1</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®-dio"><a href="#é…ç½®-dio" class="headerlink" title="é…ç½® dio"></a>é…ç½® dio</h2><p>ç”±äºè¿™ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ªæœåŠ¡åœ°å€ï¼Œæ‰€ä»¥åˆ›å»ºä¸€ä¸ª dio çš„å•ä¾‹æ¥è¿›è¡Œè¯·æ±‚å°±å¾ˆå¥½äº†ï¼Œæ–°å»ºä¸€ä¸ª request.dart æ–‡ä»¶é…ç½® dioï¼Œä½¿ç”¨ä¸€ä¸ªå‡½æ•°è¿”å›åˆ›å»ºçš„ dio å®ä¾‹</p><ul><li>è®¾ç½®åŸºç¡€çš„è¯·æ±‚åœ°å€</li><li>è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´</li><li>è®¾ç½®åœ¨è°ƒè¯•æ§åˆ¶å°è¾“å‡ºè¯·æ±‚å“åº”ä½“æ–¹ä¾¿æŸ¥çœ‹è¯·æ±‚</li></ul><p>åŸºæœ¬è®¾ç½®ä¸‹å°±å¯ä»¥ç”¨äº†ï¼Œå…¶å®ƒè®¾ç½®å¯ä»¥æŸ¥çœ‹ dio çš„<a href="https://pub.flutter-io.cn/packages/dio" target="_blank" rel="noopener">æ–‡æ¡£</a></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:dio/dio.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> DB_URL = <span class="string">'https://jsonbox.io/box_7ea9df49e805cf99509b'</span>;</span><br><span class="line"></span><br><span class="line">Dio craeteDio() &#123;</span><br><span class="line">  BaseOptions options = BaseOptions(</span><br><span class="line">    baseUrl: DB_URL,</span><br><span class="line">    connectTimeout: <span class="number">5000</span>,</span><br><span class="line">    receiveTimeout: <span class="number">3000</span>,</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  Dio dio = Dio(options);</span><br><span class="line"></span><br><span class="line">  dio.interceptors.add(LogInterceptor(</span><br><span class="line">    error: <span class="keyword">true</span>,</span><br><span class="line">    request: <span class="keyword">false</span>,</span><br><span class="line">    responseBody: <span class="keyword">true</span>,</span><br><span class="line">    responseHeader: <span class="keyword">false</span>,</span><br><span class="line">    requestHeader: <span class="keyword">false</span>,</span><br><span class="line">  ));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> dio;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹-Todo-æ¨¡å‹"><a href="#ä¿®æ”¹-Todo-æ¨¡å‹" class="headerlink" title="ä¿®æ”¹ Todo æ¨¡å‹"></a>ä¿®æ”¹ Todo æ¨¡å‹</h2><p>ç”±äºéœ€è¦ä»æœåŠ¡å™¨ä¸Šè·å– todo æ•°æ®ï¼ŒæœåŠ¡è¿”å›çš„æ•°æ®æ˜¯ json æ ¼å¼ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ‹¿åˆ°æ•°æ®çš„æ—¶å€™å°†å•ä¸ª todo çš„ json æ•°æ®è½¬æˆ Todo å®ä¾‹ï¼Œæ–°å»ºä¸€ä¸ª model/todo.dart æ–‡ä»¶ï¼Œæ¯”ä¹‹å‰å¤šçš„æ˜¯ä¸¤ä¸ªæ–¹æ³•è€Œå·²ï¼Œ<code>fromJson</code> è¿™ä¸ªå·¥å‚å‡½æ•°ä½œç”¨æ˜¯ä½¿ç”¨ json æ•°æ®å®ä¾‹åŒ–ä¸€ä¸ª Todoï¼Œ<code>toJson</code> æ–¹æ³•ç”¨æ¥å°†ä¸€ä¸ª Todo è½¬æˆä¸€ä¸ª Map ç»“æ„çš„æ•°æ®</p><p>å¦‚æœä¸€ä¸ªæ¨¡å‹çš„å­—æ®µè¾ƒå°‘å¯ä»¥æ‰‹å†™ï¼Œä½†æ˜¯å½“å­—æ®µè¾ƒå¤šæ¯”è¾ƒå¤æ‚çš„æ—¶å€™å°±éœ€è¦ä½¿ç”¨å·¥å…·æ¥å¸®åŠ©ç”Ÿæˆä»£ç äº†ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ <a href="https://app.quicktype.io/" target="_blank" rel="noopener">quicktype</a> è¿™ä¸ªå·¥å…·</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span> </span>&#123;</span><br><span class="line">  <span class="built_in">String</span> id;</span><br><span class="line">  <span class="built_in">bool</span> finish;</span><br><span class="line">  <span class="built_in">String</span> thing;</span><br><span class="line"></span><br><span class="line">  Todo(&#123;</span><br><span class="line">    <span class="keyword">this</span>.id,</span><br><span class="line">    <span class="keyword">this</span>.thing,</span><br><span class="line">    <span class="keyword">this</span>.finish,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> Todo.fromJson(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; json) =&gt; Todo(</span><br><span class="line">        id: json[<span class="string">"_id"</span>].toString(),</span><br><span class="line">        thing: json[<span class="string">"thing"</span>],</span><br><span class="line">        finish: json[<span class="string">"finish"</span>],</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; toJson() =&gt; &#123;</span><br><span class="line">        <span class="string">"id"</span>: id,</span><br><span class="line">        <span class="string">"thing"</span>: thing,</span><br><span class="line">        <span class="string">"finish"</span>: finish,</span><br><span class="line">      &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‘é€è¯·æ±‚"><a href="#å‘é€è¯·æ±‚" class="headerlink" title="å‘é€è¯·æ±‚"></a>å‘é€è¯·æ±‚</h2><p>é…ç½®å¥½ dio å°±å¯ä»¥åœ¨ todos.dart å‘æœåŠ¡å™¨å‘é€è¯·æ±‚äº†ï¼Œä¿®æ”¹ store/todos.dartï¼Œç»™ Todos ç±»æ·»åŠ äº†ä¸€ä¸ª _dio å±æ€§ç”¨æ¥å‘é€è¯·æ±‚ï¼Œä¸€ä¸ª getTodos æ–¹æ³•ç”¨æ¥è·å–å…¨éƒ¨ todo çš„åˆ—è¡¨æ•°æ®ï¼Œç„¶åä¿®æ”¹ addTodoï¼ŒremoveTodoï¼ŒeditTodo æ–¹æ³•ä½¿ç”¨ _dio å‘æœåŠ¡å™¨å‘é€ postï¼Œdeleteï¼Œput è¯·æ±‚ã€‚</p><p>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯å°† json è½¬æ¢æˆå®ä¾‹çš„é—®é¢˜ï¼Œå¾ˆå®¹æ˜“å°±ä¼šå‡ºç°ç±»ä¼¼</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type <span class="string">'List&lt;dynamic&gt;'</span> <span class="keyword">is</span> not a subtype of type <span class="string">'List&lt;Todo&gt;'</span></span><br></pre></td></tr></table></figure><p>è¿™ç§é”™è¯¯ï¼Œè¿™ç§éƒ½æ˜¯ç±»å‹è½¬æ¢çš„é—®é¢˜ï¼Œæˆ‘çœ‹äº†ä¸€ç¯‡æ–‡ç« åæ‰ç®—å¼„æ‡‚äº†ä¸€ç‚¹ <a href="https://medium.com/flutter-community/parsing-complex-json-in-flutter-747c46655f51" target="_blank" rel="noopener">parsing-complex-json-in-flutter</a></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:dio/dio.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/foundation.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'../request.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'../model/todo.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todos</span> <span class="keyword">extends</span> <span class="title">ChangeNotifier</span> </span>&#123;</span><br><span class="line">  <span class="built_in">List</span>&lt;Todo&gt; _items = [];</span><br><span class="line"></span><br><span class="line">  Dio _dio = craeteDio();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> items &#123;</span><br><span class="line">    <span class="keyword">return</span> [..._items];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> refresh() &#123;</span><br><span class="line">    notifyListeners();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future&lt;<span class="built_in">List</span>&gt; getTodos() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Response response = <span class="keyword">await</span> _dio.<span class="keyword">get</span>(<span class="string">'/todos'</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">final</span> list = response.data <span class="keyword">as</span> <span class="built_in">List</span>;</span><br><span class="line">      _items = <span class="built_in">List</span>&lt;Todo&gt;.from(list.map((i) =&gt; Todo.fromJson(i)).toList());</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> items;</span><br><span class="line">    &#125; <span class="keyword">on</span> DioError <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> err;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future addTodo(<span class="built_in">String</span> thing) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Response response = <span class="keyword">await</span> _dio.post(<span class="string">'/todos'</span>, data: &#123;</span><br><span class="line">        <span class="string">"thing"</span>: thing,</span><br><span class="line">        <span class="string">"finish"</span>: <span class="keyword">false</span>,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      Todo todo = Todo(</span><br><span class="line">        thing: thing,</span><br><span class="line">        id: response.data[<span class="string">"_id"</span>],</span><br><span class="line">        finish: response.data[<span class="string">"finish"</span>],</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      _items.insert(<span class="number">0</span>, todo);</span><br><span class="line">      refresh();</span><br><span class="line">    &#125; <span class="keyword">on</span> DioError <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> err;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future removeTodo(<span class="built_in">int</span> index) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="built_in">String</span> todoId = _items[index].id;</span><br><span class="line">      <span class="keyword">await</span> _dio.delete(<span class="string">"/todos/<span class="subst">$todoId</span>"</span>);</span><br><span class="line">      _items.removeAt(index);</span><br><span class="line">      refresh();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> err;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future editTodo(<span class="built_in">int</span> index, <span class="built_in">String</span> thing, <span class="built_in">bool</span> finish) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="built_in">String</span> todoId = _items[index].id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> _dio.put(<span class="string">"/todos/<span class="subst">$todoId</span>"</span>, data: &#123;</span><br><span class="line">        <span class="string">"thing"</span>: thing,</span><br><span class="line">        <span class="string">"finish"</span>: finish,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      Todo todo = _items[index];</span><br><span class="line">      todo.thing = thing;</span><br><span class="line">      todo.finish = finish;</span><br><span class="line">      refresh();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> toggleFinish(<span class="built_in">int</span> index) &#123;</span><br><span class="line">    <span class="keyword">final</span> todo = _items[index];</span><br><span class="line">    todo.finish = !todo.finish;</span><br><span class="line"></span><br><span class="line">    refresh();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span> isTodoExist(<span class="built_in">String</span> thing) &#123;</span><br><span class="line">    <span class="built_in">bool</span> isExist = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; _items.length; i++) &#123;</span><br><span class="line">      <span class="keyword">final</span> todo = _items[i];</span><br><span class="line">      <span class="keyword">if</span> (todo.thing == thing) &#123;</span><br><span class="line">        isExist = <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> isExist;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨æ•°æ®"><a href="#ä½¿ç”¨æ•°æ®" class="headerlink" title="ä½¿ç”¨æ•°æ®"></a>ä½¿ç”¨æ•°æ®</h2><p>æœ‰äº†æ•°æ®åå°±å¯ä»¥åœ¨åˆ—è¡¨é¡µä½¿ç”¨äº†ï¼Œç”±äºç°åœ¨æ•°æ®æ˜¯ä»æœåŠ¡å™¨è¿”å›çš„ï¼Œä¼šæœ‰è¯·æ±‚è€—æ—¶ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ <code>FutureBuilder</code> è¿™ä¸ªéƒ¨ä»¶æ¸²æŸ“åˆ—è¡¨ï¼Œ<code>FutureBuilder</code> éœ€è¦ä¸€ä¸ªè®¾ç½®ä¸€ä¸ª future æ¥åˆ¤æ–­çŠ¶æ€ï¼Œè¿™é‡Œè‡ªç„¶æ˜¯ Todos ç±»çš„ <code>getTodos</code> æ–¹æ³•è¿”å›çš„ Future å¯¹è±¡ï¼Œç„¶å builder å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ context ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯ snapshot å¯¹è±¡ï¼Œè¡¨ç¤ºçš„æ˜¯è¿™ä¸ª future çš„çŠ¶æ€ã€‚</p><p>åœ¨ builder æ–¹æ³•é‡Œé¢ç”¨ä¸€ä¸ª switch è¯­å¥åˆ¤æ–­è¿™ä¸ª future çš„çŠ¶æ€ï¼Œæ ¹æ®çŠ¶æ€è¿”å›éœ€è¦æ¸²æŸ“çš„éƒ¨ä»¶ï¼Œæœ‰ä»¥ä¸‹å‡ ç§çŠ¶æ€ noneï¼ˆçŠ¶æ€ä¸å­˜åœ¨ï¼‰ï¼Œactiveï¼ˆè¿è¡Œä¸­ï¼‰ï¼Œwaitingï¼ˆç­‰å¾…ä¸­ï¼‰ï¼Œdoneï¼ˆå®Œæˆï¼‰ï¼Œå¦‚æœéƒ½ä¸åŒ¹é…å°±ï¼Œè¿”å›ä¸€ä¸ª null å€¼ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:provider/provider.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'store/todos.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'widget/add_todo_button.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'widget/edit_todo_button.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'widget/remove_todo_button.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodosPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(title: Text(<span class="string">'Flutter Provider Todos'</span>)),</span><br><span class="line">      body: FutureBuilder(</span><br><span class="line">        future: Provider.of&lt;Todos&gt;(context).getTodos(),</span><br><span class="line">        builder: (context, snapshot) &#123;</span><br><span class="line">          <span class="keyword">switch</span> (snapshot.connectionState) &#123;</span><br><span class="line">            <span class="keyword">case</span> ConnectionState.none:</span><br><span class="line">              <span class="keyword">return</span> Text(<span class="string">'Press button to start.'</span>);</span><br><span class="line">            <span class="keyword">case</span> ConnectionState.active:</span><br><span class="line">            <span class="keyword">case</span> ConnectionState.waiting:</span><br><span class="line">              <span class="keyword">return</span> Center(child: CircularProgressIndicator());</span><br><span class="line">            <span class="keyword">case</span> ConnectionState.done:</span><br><span class="line">              <span class="keyword">if</span> (snapshot.hasError) &#123;</span><br><span class="line">                <span class="built_in">print</span>(snapshot.error);</span><br><span class="line">                <span class="keyword">return</span> Center(</span><br><span class="line">                  child: Text(</span><br><span class="line">                    <span class="string">'å‡ºé”™äº†ï¼Œè¯·é‡è¯•'</span>,</span><br><span class="line">                    style: TextStyle(fontSize: <span class="number">18.0</span>, color: Colors.red),</span><br><span class="line">                  ),</span><br><span class="line">                );</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              <span class="built_in">List</span> items = snapshot.data;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">if</span> (items == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> Center(</span><br><span class="line">                  child: Text(</span><br><span class="line">                    <span class="string">'è¿˜æ²¡æœ‰ä»£åŠäº‹é¡¹ï¼Œå¿«å»æ·»åŠ å§'</span>,</span><br><span class="line">                    style: TextStyle(fontSize: <span class="number">18.0</span>),</span><br><span class="line">                  ),</span><br><span class="line">                );</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">return</span> ListView.builder(</span><br><span class="line">                  itemCount: items.length,</span><br><span class="line">                  itemBuilder: (_, index) &#123;</span><br><span class="line">                    <span class="keyword">return</span> Column(</span><br><span class="line">                      children: &lt;Widget&gt;[</span><br><span class="line">                        ListTile(</span><br><span class="line">                          title: Text(</span><br><span class="line">                            items[index].thing,</span><br><span class="line">                            style: TextStyle(</span><br><span class="line">                              color: items[index].finish</span><br><span class="line">                                  ? Colors.green</span><br><span class="line">                                  : Colors.grey,</span><br><span class="line">                            ),</span><br><span class="line">                          ),</span><br><span class="line">                          trailing: Container(</span><br><span class="line">                            width: <span class="number">150</span>,</span><br><span class="line">                            child: Row(</span><br><span class="line">                              mainAxisAlignment: MainAxisAlignment.end,</span><br><span class="line">                              children: &lt;Widget&gt;[</span><br><span class="line">                                EditTodoButton(todoIndex: index),</span><br><span class="line">                                RemoveTodoButton(todoIndex: index),</span><br><span class="line">                              ],</span><br><span class="line">                            ),</span><br><span class="line">                          ),</span><br><span class="line">                        ),</span><br><span class="line">                        Divider(),</span><br><span class="line">                      ],</span><br><span class="line">                    );</span><br><span class="line">                  &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">      floatingActionButton: Consumer&lt;Todos&gt;(</span><br><span class="line">        builder: (_, todos, child) &#123;</span><br><span class="line">          <span class="keyword">return</span> AddTodoButton();</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">      floatingActionButtonLocation: FloatingActionButtonLocation.centerFloat,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹æŒ‰é’®"><a href="#ä¿®æ”¹æŒ‰é’®" class="headerlink" title="ä¿®æ”¹æŒ‰é’®"></a>ä¿®æ”¹æŒ‰é’®</h2><p>æ¥ä¸‹æ¥å°±æ˜¯éœ€è¦ä¿®æ”¹æ–°å¢ï¼Œç¼–è¾‘ï¼Œåˆ é™¤ä»£åŠçš„æŒ‰é’®äº†ï¼ŒåŒç†ç”±äºç°åœ¨éœ€è¦è·ŸæœåŠ¡ç«¯è¿›è¡Œé€šä¿¡ï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®è¯·æ±‚çŠ¶æ€æ¥å¤„ç†é€»è¾‘ï¼Œä¸»è¦çš„ä¿®æ”¹å°±æ˜¯ä½¿ç”¨ <code>async/await</code> è¯­æ³•ç­‰åˆ°ä¸€ä¸ªè¯·æ±‚å®Œæˆåï¼Œæ ¹æ®è¿”å›å€¼è¿›è¡Œå¤„ç†ã€‚</p><p>æ·»åŠ  Todo æŒ‰é’®</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:provider/provider.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'../store/todos.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddTodoButton</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _AddTodoButtonState createState() =&gt; _AddTodoButtonState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_AddTodoButtonState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">AddTodoButton</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> _formKey = GlobalKey&lt;FormState&gt;();</span><br><span class="line">  <span class="keyword">final</span> _controller = TextEditingController();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _formKey.currentState.dispose();</span><br><span class="line">    _controller.dispose();</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Consumer&lt;Todos&gt;(</span><br><span class="line">      builder: (_, todos, child) &#123;</span><br><span class="line">        _addTodo() <span class="keyword">async</span> &#123;</span><br><span class="line">          <span class="keyword">final</span> isValid = _formKey.currentState.validate();</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (!isValid) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">final</span> thing = _controller.value.text;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">await</span> todos.addTodo(thing);</span><br><span class="line">            Navigator.pop(context);</span><br><span class="line">            _controller.clear();</span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            Scaffold.of(context).showSnackBar(</span><br><span class="line">              SnackBar(content: Text(<span class="string">'æ–°å¢ä»£åŠå¤±è´¥äº†ï¼Œè¯·é‡è¯•ã€‚'</span>)),</span><br><span class="line">            );</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> FloatingActionButton(</span><br><span class="line">          child: Icon(Icons.add),</span><br><span class="line">          onPressed: () &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">'add todo'</span>);</span><br><span class="line">            <span class="keyword">return</span> showDialog(</span><br><span class="line">              context: context,</span><br><span class="line">              builder: (BuildContext _) &#123;</span><br><span class="line">                <span class="keyword">return</span> SimpleDialog(</span><br><span class="line">                  title: Text(<span class="string">'æ·»åŠ  Todo'</span>),</span><br><span class="line">                  contentPadding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">24.0</span>),</span><br><span class="line">                  children: &lt;Widget&gt;[</span><br><span class="line">                    Form(</span><br><span class="line">                      key: _formKey,</span><br><span class="line">                      child: Column(</span><br><span class="line">                        children: &lt;Widget&gt;[</span><br><span class="line">                          TextFormField(</span><br><span class="line">                            autofocus: <span class="keyword">true</span>,</span><br><span class="line">                            autovalidate: <span class="keyword">false</span>,</span><br><span class="line">                            controller: _controller,</span><br><span class="line">                            keyboardType: TextInputType.text,</span><br><span class="line">                            decoration: InputDecoration(</span><br><span class="line">                              border: OutlineInputBorder(),</span><br><span class="line">                              labelText: <span class="string">'è¾“å…¥ä½ æƒ³åšçš„äº‹'</span>,</span><br><span class="line">                            ),</span><br><span class="line">                            validator: (val) &#123;</span><br><span class="line">                              <span class="keyword">if</span> (val.isEmpty) &#123;</span><br><span class="line">                                <span class="keyword">return</span> <span class="string">'æƒ³åšçš„äº‹ä¸èƒ½ä¸ºç©º'</span>;</span><br><span class="line">                              &#125;</span><br><span class="line"></span><br><span class="line">                              <span class="built_in">bool</span> isExist = todos.isTodoExist(val);</span><br><span class="line"></span><br><span class="line">                              <span class="keyword">if</span> (isExist) &#123;</span><br><span class="line">                                <span class="keyword">return</span> <span class="string">'è¿™ä»¶äº‹æƒ…å·²ç»å­˜åœ¨äº†'</span>;</span><br><span class="line">                              &#125;</span><br><span class="line">                              <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                            &#125;,</span><br><span class="line">                          ),</span><br><span class="line">                          SizedBox(height: <span class="number">20</span>),</span><br><span class="line">                          Row(</span><br><span class="line">                            mainAxisAlignment: MainAxisAlignment.end,</span><br><span class="line">                            children: &lt;Widget&gt;[</span><br><span class="line">                              FlatButton(</span><br><span class="line">                                child: Text(<span class="string">'å–æ¶ˆ'</span>),</span><br><span class="line">                                onPressed: () &#123;</span><br><span class="line">                                  Navigator.pop(context);</span><br><span class="line">                                &#125;,</span><br><span class="line">                              ),</span><br><span class="line">                              RaisedButton(</span><br><span class="line">                                child: Text(</span><br><span class="line">                                  <span class="string">'ç¡®å®š'</span>,</span><br><span class="line">                                  style: TextStyle(color: Colors.white),</span><br><span class="line">                                ),</span><br><span class="line">                                color: Theme.of(context).primaryColor,</span><br><span class="line">                                onPressed: _addTodo,</span><br><span class="line">                              ),</span><br><span class="line">                            ],</span><br><span class="line">                          ),</span><br><span class="line">                        ],</span><br><span class="line">                      ),</span><br><span class="line">                    ),</span><br><span class="line">                  ],</span><br><span class="line">                );</span><br><span class="line">              &#125;,</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¾‘ Todo æŒ‰é’®</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:provider/provider.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'../model/todo.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'../store/todos.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EditTodoButton</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> todoIndex;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> EditTodoButton(&#123;Key key, <span class="keyword">this</span>.todoIndex&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _EditTodoButtonState createState() =&gt; _EditTodoButtonState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_EditTodoButtonState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">EditTodoButton</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> _formKey = GlobalKey&lt;FormState&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _formKey?.currentState?.dispose();</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Consumer&lt;Todos&gt;(</span><br><span class="line">      builder: (context, todos, child) &#123;</span><br><span class="line">        <span class="keyword">final</span> todoIndex = widget.todoIndex;</span><br><span class="line">        <span class="keyword">final</span> Todo todo = todos.items[todoIndex];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> IconButton(</span><br><span class="line">          color: Colors.blue,</span><br><span class="line">          icon: Icon(Icons.edit),</span><br><span class="line">          onPressed: () &#123;</span><br><span class="line">            <span class="keyword">return</span> showDialog(</span><br><span class="line">              context: context,</span><br><span class="line">              builder: (_) &#123;</span><br><span class="line">                <span class="keyword">return</span> SimpleDialog(</span><br><span class="line">                  title: Text(<span class="string">'ç¼–è¾‘ Todo'</span>),</span><br><span class="line">                  contentPadding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">24.0</span>),</span><br><span class="line">                  children: &lt;Widget&gt;[</span><br><span class="line">                    Form(</span><br><span class="line">                      key: _formKey,</span><br><span class="line">                      child: Column(</span><br><span class="line">                        children: &lt;Widget&gt;[</span><br><span class="line">                          TextFormField(</span><br><span class="line">                            autofocus: <span class="keyword">false</span>,</span><br><span class="line">                            autovalidate: <span class="keyword">false</span>,</span><br><span class="line">                            initialValue: todo.thing,</span><br><span class="line">                            decoration: InputDecoration(</span><br><span class="line">                              border: OutlineInputBorder(),</span><br><span class="line">                              labelText: <span class="string">'è¾“å…¥ä½ æƒ³åšçš„äº‹'</span>,</span><br><span class="line">                            ),</span><br><span class="line">                            onChanged: (val) &#123;</span><br><span class="line">                              todo.thing = val;</span><br><span class="line">                            &#125;,</span><br><span class="line">                            validator: (val) &#123;</span><br><span class="line">                              <span class="keyword">if</span> (val.isEmpty) &#123;</span><br><span class="line">                                <span class="keyword">return</span> <span class="string">'æƒ³åšçš„äº‹ä¸èƒ½ä¸ºç©º'</span>;</span><br><span class="line">                              &#125;</span><br><span class="line">                              <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                            &#125;,</span><br><span class="line">                          ),</span><br><span class="line">                          SizedBox(height: <span class="number">20</span>),</span><br><span class="line">                          SwitchListTile(</span><br><span class="line">                            title: <span class="keyword">const</span> Text(<span class="string">'æ˜¯å¦å®Œæˆ'</span>),</span><br><span class="line">                            value: todo.finish,</span><br><span class="line">                            onChanged: (<span class="built_in">bool</span> value) &#123;</span><br><span class="line">                              todo.finish = value;</span><br><span class="line">                            &#125;,</span><br><span class="line">                          ),</span><br><span class="line">                          SizedBox(height: <span class="number">20</span>),</span><br><span class="line">                          Row(</span><br><span class="line">                            mainAxisAlignment: MainAxisAlignment.end,</span><br><span class="line">                            children: &lt;Widget&gt;[</span><br><span class="line">                              FlatButton(</span><br><span class="line">                                child: Text(<span class="string">'å–æ¶ˆ'</span>),</span><br><span class="line">                                onPressed: () =&gt; Navigator.pop(context),</span><br><span class="line">                              ),</span><br><span class="line">                              RaisedButton(</span><br><span class="line">                                child: Text(</span><br><span class="line">                                  <span class="string">'ç¡®å®š'</span>,</span><br><span class="line">                                  style: TextStyle(color: Colors.white),</span><br><span class="line">                                ),</span><br><span class="line">                                color: Theme.of(context).primaryColor,</span><br><span class="line">                                onPressed: () <span class="keyword">async</span> &#123;</span><br><span class="line">                                  <span class="keyword">final</span> isValid =</span><br><span class="line">                                      _formKey.currentState.validate();</span><br><span class="line"></span><br><span class="line">                                  <span class="keyword">if</span> (!isValid) &#123;</span><br><span class="line">                                    <span class="keyword">return</span>;</span><br><span class="line">                                  &#125;</span><br><span class="line"></span><br><span class="line">                                  <span class="keyword">try</span> &#123;</span><br><span class="line">                                    <span class="keyword">await</span> todos.editTodo(</span><br><span class="line">                                      todoIndex,</span><br><span class="line">                                      todo.thing,</span><br><span class="line">                                      todo.finish,</span><br><span class="line">                                    );</span><br><span class="line">                                    Navigator.pop(context);</span><br><span class="line">                                  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                                    Scaffold.of(context).showSnackBar(</span><br><span class="line">                                      SnackBar(content: Text(<span class="string">'ä¿®æ”¹ä»£åŠå¤±è´¥äº†ï¼Œè¯·é‡è¯•ã€‚'</span>)),</span><br><span class="line">                                    );</span><br><span class="line">                                  &#125;</span><br><span class="line">                                &#125;,</span><br><span class="line">                              )</span><br><span class="line">                            ],</span><br><span class="line">                          ),</span><br><span class="line">                        ],</span><br><span class="line">                      ),</span><br><span class="line">                    ),</span><br><span class="line">                  ],</span><br><span class="line">                );</span><br><span class="line">              &#125;,</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ é™¤ Todo æŒ‰é’®</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:provider/provider.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'../model/todo.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'../store/todos.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RemoveTodoButton</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> todoIndex;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> RemoveTodoButton(&#123;Key key, <span class="keyword">this</span>.todoIndex&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Consumer&lt;Todos&gt;(builder: (_, todos, child) &#123;</span><br><span class="line">      <span class="keyword">final</span> Todo todo = todos.items[todoIndex];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> IconButton(</span><br><span class="line">        color: Colors.red,</span><br><span class="line">        icon: Icon(Icons.delete),</span><br><span class="line">        onPressed: () &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">'delete todo'</span>);</span><br><span class="line">          showDialog(</span><br><span class="line">            context: context,</span><br><span class="line">            builder: (BuildContext context) &#123;</span><br><span class="line">              <span class="keyword">return</span> AlertDialog(</span><br><span class="line">                title: Text(<span class="string">'ç¡®è®¤åˆ é™¤ <span class="subst">$&#123;todo.thing&#125;</span>?'</span>),</span><br><span class="line">                actions: &lt;Widget&gt;[</span><br><span class="line">                  FlatButton(</span><br><span class="line">                    child: Text(</span><br><span class="line">                      <span class="string">'å–æ¶ˆ'</span>,</span><br><span class="line">                      style: TextStyle(color: Colors.grey),</span><br><span class="line">                    ),</span><br><span class="line">                    onPressed: () =&gt; Navigator.pop(context),</span><br><span class="line">                  ),</span><br><span class="line">                  FlatButton(</span><br><span class="line">                    child: Text(<span class="string">'ç¡®è®¤'</span>),</span><br><span class="line">                    onPressed: () <span class="keyword">async</span> &#123;</span><br><span class="line">                      <span class="keyword">await</span> todos.removeTodo(todoIndex);</span><br><span class="line">                      Navigator.pop(context);</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ),</span><br><span class="line">                ],</span><br><span class="line">              );</span><br><span class="line">            &#125;,</span><br><span class="line">          );</span><br><span class="line">        &#125;,</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>è‡³æ­¤æ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šäº†ï¼Œé‡å¯åº”ç”¨æ•°æ®ä¹Ÿä¼šä»æœåŠ¡å™¨ä¸Šè·å–äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸ºäº†å­˜å‚¨æ•°æ®å¯ä»¥å°†æ•°æ®å­˜åˆ°æ‰‹æœºçš„å­˜å‚¨é‡Œé¢æˆ–è€…å­˜åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œæœ¬æ–‡å°±å®ç°å¦‚ä½•ä½¿ç”¨ dio å°†æ•°æ®å­˜åˆ°æœåŠ¡å™¨&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Provider ç®¡ç† Flutter åº”ç”¨çŠ¶æ€ (ä¸Š)</title>
    <link href="https://coldstone.fun/post/2019/09/11/flutter-provider-todos-01/"/>
    <id>https://coldstone.fun/post/2019/09/11/flutter-provider-todos-01/</id>
    <published>2019-09-11T13:48:56.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡è¯´æ˜å¦‚ä½•ä½¿ç”¨ Provider æ¥ç®¡ç†è¿™ç§åº”ç”¨çš„å…¨å±€æ€§çš„æ•°æ®</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸€ä¸ªåº”ç”¨å†…é€šå¸¸ä¼šæœ‰ä¸¤ç§æ•°æ®ï¼Œéƒ¨ä»¶å†…éƒ¨çš„ä½¿ç”¨çš„ä¸´æ—¶æ€§æ•°æ®ä»¥åŠå¾ˆå¤šéƒ¨ä»¶ä½¿ç”¨çš„å…¨å±€æ€§æ•°æ®ï¼Œéƒ¨ä»¶å†…éƒ¨ä½¿ç”¨çš„æ•°æ®å¯ä»¥é€šè¿‡ StatefulWidget æ¥ç®¡ç†ï¼Œä½†æ˜¯å…¨å±€æ€§çš„æ•°æ®å¦‚æœé€šè¿‡ä»ä¸Šåˆ°ä¸‹ä¼ é€’çš„æ–¹å¼ä¼šä½¿ä»£ç å†™çš„ååˆ†ç¹çï¼Œè¿™æ—¶å°±éœ€è¦ä¸€ä¸ªçŠ¶æ€ç®¡ç†å·¥å…·æ¥è¿›è¡Œç®¡ç†äº†ï¼Œæœ¬æ–‡è¯´æ˜å¦‚ä½•ä½¿ç”¨ Provider æ¥ç®¡ç†è¿™ç§åº”ç”¨çš„å…¨å±€æ€§çš„æ•°æ®</p><h2 id="ä»€ä¹ˆæ˜¯-Provider"><a href="#ä»€ä¹ˆæ˜¯-Provider" class="headerlink" title="ä»€ä¹ˆæ˜¯ Provider"></a>ä»€ä¹ˆæ˜¯ Provider</h2><p>å®˜æ–¹çš„å®šä¹‰æ˜¯ï¼š A mixture between dependency injection (DI) and state management, built with widgets for widgets. ç¿»è¯‘è¿‡æ¥å¤§æ„æ˜¯ä¸€ç§ä¾èµ–æ³¨å…¥å’ŒçŠ¶æ€ç®¡ç†çš„æ··åˆæ–¹æ¡ˆï¼Œä½¿ç”¨éƒ¨ä»¶åˆ›å»ºï¼Œä½œç”¨äºéƒ¨ä»¶ ğŸ˜…</p><p><a href="https://pub.flutter-io.cn/documentation/provider/latest/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p><h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Provider"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Provider" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Provider"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Provider</h2><p>åº”ç”¨ä¸­é€šå¸¸ä¼šæœ‰ä¸€äº›å¾ˆå¤šéƒ¨ä»¶éƒ½éœ€è¦çš„æ•°æ®ï¼Œå¦‚ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼Œç”¨æˆ·è®¾ç½®ï¼Œåœ°ç†ä½ç½®ç­‰ï¼Œå¦‚æœåªæ˜¯ä½¿ç”¨ StatefullWeight çš„è¯å°±éœ€è¦å°†çŠ¶æ€æå‡åˆ°ä¸€ä¸ªçˆ¶éƒ¨ä»¶ä¸­ç„¶åå‘ä¸‹è¿›è¡Œä¼ é€’ï¼Œä¼šå¾ˆç¹çï¼Œä½¿ç”¨ provider çš„è¯å¯ä»¥å°†å¯¹ä¸€ç§çŠ¶æ€æ•°æ®çš„æ“ä½œæ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å†…ï¼Œç„¶åä½¿ç”¨åˆ°è¿™ä¸ªæ•°æ®çš„éƒ¨ä»¶åªéœ€è¦ä½¿ç”¨å°±å¯ä»¥äº†ï¼Œå½“æ•°æ®æœ‰å˜åŒ–æ—¶ï¼Œéƒ¨ä»¶ä¼šè‡ªåŠ¨çš„é‡æ–°æ„å»ºï¼Œä½¿ç•Œé¢æ›´æ–°ã€‚</p><h2 id="ä¸€ä¸ªä¾‹å­-ğŸŒ°"><a href="#ä¸€ä¸ªä¾‹å­-ğŸŒ°" class="headerlink" title="ä¸€ä¸ªä¾‹å­ ğŸŒ°"></a>ä¸€ä¸ªä¾‹å­ ğŸŒ°</h2><p>ä½¿ç”¨ä¸€ä¸ª todo åº”ç”¨æ¥è¯´æ˜å¦‚ä½•åœ¨ Flutter åº”ç”¨ä¸­ä½¿ç”¨ Providerï¼Œæœ€ç»ˆçš„å®Œæˆçš„åº”ç”¨æ˜¯è¿™æ ·çš„ï¼Œå¯ä»¥æ–°å¢ï¼Œç¼–è¾‘å’Œåˆ é™¤ todoã€‚</p><p><a href="https://github.com/xrr2016/flutter_provider_todos" target="_blank" rel="noopener">æºç åœ°å€</a></p><img src="images/provider-todos.png" width="360" style="max-width: 360px;"><h3 id="åˆ›å»ºåº”ç”¨"><a href="#åˆ›å»ºåº”ç”¨" class="headerlink" title="åˆ›å»ºåº”ç”¨"></a>åˆ›å»ºåº”ç”¨</h3><p>é¦–å…ˆä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºä¸€ä¸ªé¡¹ç›®</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter create flutter_provider_todos</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨é¡¹ç›®çš„ pubspec.yml æ·»åŠ  provider</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">provider:</span> <span class="string">^3.1.0</span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ª store æ–‡ä»¶å¤¹ä»¥åŠ todos.dart ç”¨æ¥å­˜æ”¾åº”ç”¨ä¸­éœ€è¦ç”¨åˆ°çš„å…¨å±€æ€§æ•°æ®ï¼Œæ–°å»ºä¸€ä¸ª widget ç›®å½•ï¼Œç”¨æ¥å­˜æ”¾åº”ç”¨ä¸­çš„éƒ¨ä»¶ä»¥åŠä¸€ä¸ªæ˜¾ç¤º todo çš„é¡µé¢ todos_page.dart</p><img src="images/todos-folder.jpg" width="360" style="max-width: 360px;"><p>é¦–å…ˆåˆ›å»º todos è¿™ä¸ªå…¨å±€æ€§çš„æ•°æ®ï¼Œä¿®æ”¹ store/todos.dartï¼Œåˆ›å»ºä¸€ä¸ª Todo ç±»è¡¨ç¤ºä¸€ä¸ªä»£åŠäº‹é¡¹ï¼Œç„¶åå®ç° Todos ç±»ï¼Œ Todos æ··åˆäº† ChangeNotifier ç±»ï¼Œä¸ºäº†ä½¿ç”¨ notifyListeners æ–¹æ³•æ¥é€šçŸ¥ UI æ›´æ–°ï¼Œå› æ­¤éœ€è¦å¯¼å…¥ foundation.dartï¼ŒTodos ç±»ä½¿ç”¨ä¸€ä¸ª _items æ•°ç»„å­˜æ”¾ Todo æ•°æ®ï¼Œä»¥åŠå…¶å®ƒå¯¹ Todo è¿›è¡Œæ“ä½œçš„æ–¹æ³•ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/foundation.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span> </span>&#123;</span><br><span class="line">  <span class="built_in">bool</span> finish;</span><br><span class="line">  <span class="built_in">String</span> thing;</span><br><span class="line"></span><br><span class="line">  Todo(&#123;</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.thing,</span><br><span class="line">    <span class="keyword">this</span>.finish = <span class="keyword">false</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todos</span> <span class="keyword">extends</span> <span class="title">ChangeNotifier</span> </span>&#123;</span><br><span class="line">  <span class="built_in">List</span>&lt;Todo&gt; _items = [</span><br><span class="line">    Todo(thing: <span class="string">'Play lol'</span>, finish: <span class="keyword">true</span>),</span><br><span class="line">    Todo(thing: <span class="string">'Learn flutter'</span>, finish: <span class="keyword">false</span>),</span><br><span class="line">    Todo(thing: <span class="string">'Read book'</span>, finish: <span class="keyword">false</span>),</span><br><span class="line">    Todo(thing: <span class="string">'Watch anime'</span>, finish: <span class="keyword">false</span>),</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> items &#123;</span><br><span class="line">    <span class="keyword">return</span> [..._items];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> finishTodos &#123;</span><br><span class="line">    <span class="keyword">return</span> _items.where((todo) =&gt; todo.finish);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> refresh() &#123;</span><br><span class="line">    notifyListeners();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> addTodo(Todo todo) &#123;</span><br><span class="line">    _items.insert(<span class="number">0</span>, todo);</span><br><span class="line"></span><br><span class="line">    refresh();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> removeTodo(<span class="built_in">int</span> index) &#123;</span><br><span class="line">    _items.removeAt(index);</span><br><span class="line"></span><br><span class="line">    refresh();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> editTodo(<span class="built_in">int</span> index, <span class="built_in">String</span> newThing, <span class="built_in">bool</span> isFinish) &#123;</span><br><span class="line">    Todo todo = _items[index];</span><br><span class="line">    todo.thing = newThing;</span><br><span class="line">    todo.finish = isFinish;</span><br><span class="line"></span><br><span class="line">    refresh();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> toggleFinish(<span class="built_in">int</span> index) &#123;</span><br><span class="line">    <span class="keyword">final</span> todo = _items[index];</span><br><span class="line">    todo.finish = !todo.finish;</span><br><span class="line"></span><br><span class="line">    refresh();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span> isTodoExist(<span class="built_in">String</span> thing) &#123;</span><br><span class="line">    <span class="built_in">bool</span> isExist = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; _items.length; i++) &#123;</span><br><span class="line">      <span class="keyword">final</span> todo = _items[i];</span><br><span class="line">      <span class="keyword">if</span> (todo.thing == thing) &#123;</span><br><span class="line">        isExist = <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> isExist;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨ provider æä¾›çš„ ChangeNotifierProvider æ–¹æ³•å°†æ•°æ®æ³¨å†Œåˆ°æ•´ä¸ªåº”ç”¨ï¼Œå¦‚æœæœ‰å¤šä¸ªæ•°æ®å°±éœ€è¦ä½¿ç”¨ MultiProvider æ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:provider/provider.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'todos_page.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'store/todos.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">'Todos'</span>,</span><br><span class="line">      debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primarySwatch: Colors.green,</span><br><span class="line">      ),</span><br><span class="line">      home: ChangeNotifierProvider(</span><br><span class="line">        builder: (context) =&gt; Todos(),</span><br><span class="line">        child: TodosPage(),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ—è¡¨é¡µé¢"><a href="#åˆ—è¡¨é¡µé¢" class="headerlink" title="åˆ—è¡¨é¡µé¢"></a>åˆ—è¡¨é¡µé¢</h3><p>æ¥ç€å°±æ˜¯å®ç°æ˜¾ç¤º todo åˆ—è¡¨çš„é¡µé¢ï¼Œè¿™ä¸ªé¡µé¢å°±æ˜¯è¦ç”¨åˆ° Todos ç±»é‡Œé¢çš„æ•°æ®çš„éƒ¨ä»¶ï¼Œè¦ä½¿ç”¨ provider çš„æ•°æ®é¦–å…ˆè¦å¯¼å…¥ provider ä»¥åŠå¯¹åº”çš„æ•°æ®ç±» Todosï¼Œç„¶åç”¨ Consumer åŠ ç±»å‹ Todos æ¥ä½¿ç”¨è¿™ä¸ªæ•°æ®</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Consumer&lt;Todos&gt;(</span><br><span class="line">  builder: (ctx, todos, child) &#123;</span><br><span class="line">    <span class="keyword">return</span> YourWidget()</span><br><span class="line">  &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé¡µé¢ä½¿ç”¨äº†ä¸€ä¸ª ListView.builder() æ¥æ¸²æŸ“ Todosï¼Œç„¶åæ¯ä¸€é¡¹ä½¿ç”¨ä¸€ä¸ª ListTile å±•ç¤ºã€‚æ–°å¢ï¼Œç¼–è¾‘å’Œåˆ é™¤å¯¹åº”äº† 3 ä¸ªä¸åŒçš„éƒ¨ä»¶ï¼Œåˆ†åˆ«æ˜¯ AddTodoButton()ï¼ŒEditTodoButton()ï¼Œ RemoveTodoButton()</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// todos_page.dart</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:provider/provider.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'store/todos.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'widget/add_todo_button.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'widget/edit_todo_button.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'widget/remove_todo_button.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodosPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(title: Text(<span class="string">'Flutter Provider Todos'</span>)),</span><br><span class="line">      body: Consumer&lt;Todos&gt;(</span><br><span class="line">        builder: (ctx, todos, child) &#123;</span><br><span class="line">          <span class="built_in">List</span>&lt;Todo&gt; items = todos.items;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> ListView.builder(</span><br><span class="line">            itemCount: items.length,</span><br><span class="line">            itemBuilder: (_, index) =&gt; Column(</span><br><span class="line">              children: &lt;Widget&gt;[</span><br><span class="line">                ListTile(</span><br><span class="line">                  title: Text(</span><br><span class="line">                    items[index].thing,</span><br><span class="line">                    style: TextStyle(</span><br><span class="line">                      color: items[index].finish ? Colors.green : Colors.grey,</span><br><span class="line">                    ),</span><br><span class="line">                  ),</span><br><span class="line">                  trailing: Container(</span><br><span class="line">                    width: <span class="number">150</span>,</span><br><span class="line">                    child: Row(</span><br><span class="line">                      mainAxisAlignment: MainAxisAlignment.end,</span><br><span class="line">                      children: &lt;Widget&gt;[</span><br><span class="line">                        EditTodoButton(todoIndex: index),</span><br><span class="line">                        RemoveTodoButton(todoIndex: index),</span><br><span class="line">                      ],</span><br><span class="line">                    ),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">                Divider(),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">          );</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">      floatingActionButton: AddTodoButton(),</span><br><span class="line">      floatingActionButtonLocation: FloatingActionButtonLocation.centerFloat,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°åŠŸèƒ½"><a href="#å®ç°åŠŸèƒ½" class="headerlink" title="å®ç°åŠŸèƒ½"></a>å®ç°åŠŸèƒ½</h3><p>æ¥ä¸‹æ¥å°±æ˜¯è¦å®ç°è¿™ 3 ä¸ªæŒ‰é’®äº†ï¼Œåœ¨ widget ç›®å½•åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶ï¼Œæ¯ä¸ªæŒ‰é’®éƒ½ä¼šä½¿ç”¨åˆ° Todos ç±»é‡Œé¢å®šä¹‰çš„æ–¹æ³•ï¼Œæ‰€ä»¥éƒ½éœ€è¦å¯¼å…¥ provider å’Œ Todos ç±»ï¼Œç‚¹å‡»æŒ‰é’®ä¼šå¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†è¯¢é—®å¯¹åº”çš„æ“ä½œï¼Œ</p><img src="images/todos-widget.jpg" style="max-width: 360px;"><p>æ·»åŠ  Todo æŒ‰é’®</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:provider/provider.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'../store/todos.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddTodoButton</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _AddTodoButtonState createState() =&gt; _AddTodoButtonState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_AddTodoButtonState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">AddTodoButton</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> _formKey = GlobalKey&lt;FormState&gt;();</span><br><span class="line">  <span class="keyword">final</span> _controller = TextEditingController();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _formKey.currentState.dispose();</span><br><span class="line">    _controller.dispose();</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Consumer&lt;Todos&gt;(</span><br><span class="line">      builder: (_, todos, child) &#123;</span><br><span class="line">        <span class="keyword">return</span> FloatingActionButton(</span><br><span class="line">          child: Icon(Icons.add),</span><br><span class="line">          onPressed: () &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">'add todo'</span>);</span><br><span class="line">            <span class="keyword">return</span> showDialog(</span><br><span class="line">              context: context,</span><br><span class="line">              builder: (BuildContext _) &#123;</span><br><span class="line">                <span class="keyword">return</span> SimpleDialog(</span><br><span class="line">                  title: Text(<span class="string">'æ·»åŠ  Todo'</span>),</span><br><span class="line">                  contentPadding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">24.0</span>),</span><br><span class="line">                  children: &lt;Widget&gt;[</span><br><span class="line">                    Form(</span><br><span class="line">                      key: _formKey,</span><br><span class="line">                      child: Column(</span><br><span class="line">                        children: &lt;Widget&gt;[</span><br><span class="line">                          TextFormField(</span><br><span class="line">                            autofocus: <span class="keyword">true</span>,</span><br><span class="line">                            autovalidate: <span class="keyword">false</span>,</span><br><span class="line">                            controller: _controller,</span><br><span class="line">                            keyboardType: TextInputType.text,</span><br><span class="line">                            decoration: InputDecoration(</span><br><span class="line">                              border: OutlineInputBorder(),</span><br><span class="line">                              labelText: <span class="string">'è¾“å…¥ä½ æƒ³åšçš„äº‹'</span>,</span><br><span class="line">                            ),</span><br><span class="line">                            validator: (val) &#123;</span><br><span class="line">                              <span class="keyword">if</span> (val.isEmpty) &#123;</span><br><span class="line">                                <span class="keyword">return</span> <span class="string">'æƒ³åšçš„äº‹ä¸èƒ½ä¸ºç©º'</span>;</span><br><span class="line">                              &#125;</span><br><span class="line"></span><br><span class="line">                              <span class="built_in">bool</span> isExist = todos.isTodoExist(val);</span><br><span class="line"></span><br><span class="line">                              <span class="keyword">if</span> (isExist) &#123;</span><br><span class="line">                                <span class="keyword">return</span> <span class="string">'è¿™ä»¶äº‹æƒ…å·²ç»å­˜åœ¨äº†'</span>;</span><br><span class="line">                              &#125;</span><br><span class="line">                              <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                            &#125;,</span><br><span class="line">                          ),</span><br><span class="line">                          SizedBox(height: <span class="number">20</span>),</span><br><span class="line">                          Row(</span><br><span class="line">                            mainAxisAlignment: MainAxisAlignment.end,</span><br><span class="line">                            children: &lt;Widget&gt;[</span><br><span class="line">                              FlatButton(</span><br><span class="line">                                child: Text(<span class="string">'å–æ¶ˆ'</span>),</span><br><span class="line">                                onPressed: () &#123;</span><br><span class="line">                                  Navigator.pop(context);</span><br><span class="line">                                &#125;,</span><br><span class="line">                              ),</span><br><span class="line">                              RaisedButton(</span><br><span class="line">                                child: Text(</span><br><span class="line">                                  <span class="string">'ç¡®å®š'</span>,</span><br><span class="line">                                  style: TextStyle(color: Colors.white),</span><br><span class="line">                                ),</span><br><span class="line">                                color: Theme.of(context).primaryColor,</span><br><span class="line">                                onPressed: () &#123;</span><br><span class="line">                                  <span class="keyword">final</span> isValid =</span><br><span class="line">                                      _formKey.currentState.validate();</span><br><span class="line"></span><br><span class="line">                                  <span class="keyword">if</span> (!isValid) &#123;</span><br><span class="line">                                    <span class="keyword">return</span>;</span><br><span class="line">                                  &#125;</span><br><span class="line"></span><br><span class="line">                                  <span class="keyword">final</span> thing = _controller.value.text;</span><br><span class="line"></span><br><span class="line">                                  todos.addTodo(Todo(</span><br><span class="line">                                    thing: thing,</span><br><span class="line">                                    finish: <span class="keyword">false</span>,</span><br><span class="line">                                  ));</span><br><span class="line">                                  _controller.clear();</span><br><span class="line">                                  Navigator.pop(context);</span><br><span class="line">                                &#125;,</span><br><span class="line">                              )</span><br><span class="line">                            ],</span><br><span class="line">                          ),</span><br><span class="line">                        ],</span><br><span class="line">                      ),</span><br><span class="line">                    ),</span><br><span class="line">                  ],</span><br><span class="line">                );</span><br><span class="line">              &#125;,</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://github.com/xrr2016/flutter_provider_todos/raw/master/add-todo.png" width="360" style="max-width: 360px;"><p>ç¼–è¾‘ Todo æŒ‰é’®</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:provider/provider.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'../store/todos.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EditTodoButton</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> todoIndex;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> EditTodoButton(&#123;Key key, <span class="keyword">this</span>.todoIndex&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _EditTodoButtonState createState() =&gt; _EditTodoButtonState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_EditTodoButtonState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">EditTodoButton</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> _formKey = GlobalKey&lt;FormState&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _formKey?.currentState?.dispose();</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Consumer&lt;Todos&gt;(</span><br><span class="line">      builder: (context, todos, child) &#123;</span><br><span class="line">        <span class="keyword">final</span> todoIndex = widget.todoIndex;</span><br><span class="line">        <span class="keyword">final</span> Todo todo = todos.items[todoIndex];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> IconButton(</span><br><span class="line">          color: Colors.blue,</span><br><span class="line">          icon: Icon(Icons.edit),</span><br><span class="line">          onPressed: () &#123;</span><br><span class="line">            <span class="keyword">return</span> showDialog(</span><br><span class="line">              context: context,</span><br><span class="line">              builder: (context) &#123;</span><br><span class="line">                <span class="keyword">return</span> SimpleDialog(</span><br><span class="line">                  title: Text(<span class="string">'ç¼–è¾‘ Todo'</span>),</span><br><span class="line">                  contentPadding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">24.0</span>),</span><br><span class="line">                  children: &lt;Widget&gt;[</span><br><span class="line">                    Form(</span><br><span class="line">                      key: _formKey,</span><br><span class="line">                      child: Column(</span><br><span class="line">                        children: &lt;Widget&gt;[</span><br><span class="line">                          TextFormField(</span><br><span class="line">                            autofocus: <span class="keyword">false</span>,</span><br><span class="line">                            autovalidate: <span class="keyword">false</span>,</span><br><span class="line">                            initialValue: todo.thing,</span><br><span class="line">                            decoration: InputDecoration(</span><br><span class="line">                              border: OutlineInputBorder(),</span><br><span class="line">                              labelText: <span class="string">'è¾“å…¥ä½ æƒ³åšçš„äº‹'</span>,</span><br><span class="line">                            ),</span><br><span class="line">                            onChanged: (val) &#123;</span><br><span class="line">                              todo.thing = val;</span><br><span class="line">                            &#125;,</span><br><span class="line">                            validator: (val) &#123;</span><br><span class="line">                              <span class="keyword">if</span> (val.isEmpty) &#123;</span><br><span class="line">                                <span class="keyword">return</span> <span class="string">'æƒ³åšçš„äº‹ä¸èƒ½ä¸ºç©º'</span>;</span><br><span class="line">                              &#125;</span><br><span class="line">                              <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                            &#125;,</span><br><span class="line">                          ),</span><br><span class="line">                          SizedBox(height: <span class="number">20</span>),</span><br><span class="line">                          SwitchListTile(</span><br><span class="line">                            title: <span class="keyword">const</span> Text(<span class="string">'æ˜¯å¦å®Œæˆ'</span>),</span><br><span class="line">                            value: todo.finish,</span><br><span class="line">                            onChanged: (<span class="built_in">bool</span> value) &#123;</span><br><span class="line">                              todo.finish = value;</span><br><span class="line">                            &#125;,</span><br><span class="line">                          ),</span><br><span class="line">                          SizedBox(height: <span class="number">20</span>),</span><br><span class="line">                          Row(</span><br><span class="line">                            mainAxisAlignment: MainAxisAlignment.end,</span><br><span class="line">                            children: &lt;Widget&gt;[</span><br><span class="line">                              FlatButton(</span><br><span class="line">                                child: Text(<span class="string">'å–æ¶ˆ'</span>),</span><br><span class="line">                                onPressed: () =&gt; Navigator.pop(context),</span><br><span class="line">                              ),</span><br><span class="line">                              RaisedButton(</span><br><span class="line">                                child: Text(</span><br><span class="line">                                  <span class="string">'ç¡®å®š'</span>,</span><br><span class="line">                                  style: TextStyle(color: Colors.white),</span><br><span class="line">                                ),</span><br><span class="line">                                color: Theme.of(context).primaryColor,</span><br><span class="line">                                onPressed: () &#123;</span><br><span class="line">                                  <span class="keyword">final</span> isValid =</span><br><span class="line">                                      _formKey.currentState.validate();</span><br><span class="line"></span><br><span class="line">                                  <span class="keyword">if</span> (!isValid) &#123;</span><br><span class="line">                                    <span class="keyword">return</span>;</span><br><span class="line">                                  &#125;</span><br><span class="line"></span><br><span class="line">                                  Navigator.pop(context);</span><br><span class="line"></span><br><span class="line">                                  todos.editTodo(</span><br><span class="line">                                    todoIndex,</span><br><span class="line">                                    todo.thing,</span><br><span class="line">                                    todo.finish,</span><br><span class="line">                                  );</span><br><span class="line">                                &#125;,</span><br><span class="line">                              )</span><br><span class="line">                            ],</span><br><span class="line">                          ),</span><br><span class="line">                        ],</span><br><span class="line">                      ),</span><br><span class="line">                    ),</span><br><span class="line">                  ],</span><br><span class="line">                );</span><br><span class="line">              &#125;,</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://github.com/xrr2016/flutter_provider_todos/raw/master/edit-todo.png" width="360" style="max-width: 360px;"><p>åˆ é™¤ Todo æŒ‰é’®</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:provider/provider.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'../store/todos.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RemoveTodoButton</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> todoIndex;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> RemoveTodoButton(&#123;Key key, <span class="keyword">this</span>.todoIndex&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Consumer&lt;Todos&gt;(builder: (_, todos, child) &#123;</span><br><span class="line">      <span class="keyword">final</span> Todo todo = todos.items[todoIndex];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> IconButton(</span><br><span class="line">        color: Colors.red,</span><br><span class="line">        icon: Icon(Icons.delete),</span><br><span class="line">        onPressed: () &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">'delete todo'</span>);</span><br><span class="line">          showDialog(</span><br><span class="line">            context: context,</span><br><span class="line">            builder: (BuildContext context) &#123;</span><br><span class="line">              <span class="keyword">return</span> AlertDialog(</span><br><span class="line">                title: Text(<span class="string">'ç¡®è®¤åˆ é™¤ <span class="subst">$&#123;todo.thing&#125;</span>?'</span>),</span><br><span class="line">                actions: &lt;Widget&gt;[</span><br><span class="line">                  FlatButton(</span><br><span class="line">                    child: Text(</span><br><span class="line">                      <span class="string">'å–æ¶ˆ'</span>,</span><br><span class="line">                      style: TextStyle(color: Colors.grey),</span><br><span class="line">                    ),</span><br><span class="line">                    onPressed: () =&gt; Navigator.pop(context),</span><br><span class="line">                  ),</span><br><span class="line">                  FlatButton(</span><br><span class="line">                    child: Text(<span class="string">'ç¡®è®¤'</span>),</span><br><span class="line">                    onPressed: () &#123;</span><br><span class="line">                      todos.removeTodo(todoIndex);</span><br><span class="line">                      Navigator.pop(context);</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ),</span><br><span class="line">                ],</span><br><span class="line">              );</span><br><span class="line">            &#125;,</span><br><span class="line">          );</span><br><span class="line">        &#125;,</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://github.com/xrr2016/flutter_provider_todos/raw/master/remove-todo.png" width="360" style="max-width: 360px;"><p>å¯ä»¥çœ‹åˆ°è¦ä½¿ç”¨å¯¹åº”çš„æ–¹æ³•éœ€è¦çš„åªæ˜¯å‘å¯¹åº”çš„éƒ¨ä»¶æ³¨å…¥è¿™ä¸ªæ•°æ®ï¼Œç„¶åä½¿ç”¨å°±å¯ä»¥äº†</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ä½¿ç”¨äº† provider åï¼Œæ•°æ®ä»¥åŠå¯¹ä¸€ä¸ª Todo çš„æ“ä½œéƒ½æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢äº†ï¼Œä¸ç”¨åœ¨å¤šä¸ªå±‚çº§é—´ä¼ é€’æ•°æ®ï¼Œå¹¶ä¸”åœ¨æ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°äº† UIï¼Œæ‰€ä»¥æ˜¯ååˆ†æœ‰å¿…è¦çš„ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡è¯´æ˜å¦‚ä½•ä½¿ç”¨ Provider æ¥ç®¡ç†è¿™ç§åº”ç”¨çš„å…¨å±€æ€§çš„æ•°æ®&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹å“ˆå¸Œè¡¨</title>
    <link href="https://coldstone.fun/post/2019/09/08/dsa-hash/"/>
    <id>https://coldstone.fun/post/2019/09/08/dsa-hash/</id>
    <published>2019-09-08T08:26:45.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>å“ˆå¸Œè¡¨æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥å¿«é€Ÿçš„æ’å…¥å’Œå–ç”¨ï¼Œä½†æ˜¯æŸ¥è¯¢æ•°æ®æ•ˆç‡ä½ä¸‹</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å“ˆå¸Œè¡¨æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥å¿«é€Ÿçš„æ’å…¥å’Œå–ç”¨ï¼Œä½†æ˜¯æŸ¥è¯¢æ•°æ®æ•ˆç‡ä½ä¸‹ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>åŸºäºæ•°ç»„å®ç°å“ˆå¸Œè¡¨ï¼Œæ•°ç»„çš„é•¿åº¦æ˜¯é¢„å…ˆè®¾å®šçš„ï¼Œæœ‰éœ€è¦æ˜¯å¢åŠ ã€‚æœ€å¸¸è§çš„æ˜¯å°†æ•°ç»„çš„é•¿åº¦è®¾ä¸ºä¸€ä¸ªè´¨æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> HashTable &#123;</span><br><span class="line">  table = &lt;<span class="built_in">any</span>&gt;[]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.table = <span class="built_in">Array</span>.from(&#123;</span><br><span class="line">      length: <span class="number">137</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å­—ç¬¦ä¸²çš„ ASCLL ç ç›¸åŠ å¯¹æ•°ç»„é•¿åº¦æ±‚ä½™</span></span><br><span class="line">  hash(data: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> total = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; data.length; index++) &#123;</span><br><span class="line">      total += data.charCodeAt(index)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total % <span class="keyword">this</span>.table.length</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ›´ä¼˜çš„ hash æ–¹æ³•</span></span><br><span class="line">  betterHash(data: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> H = <span class="number">37</span></span><br><span class="line">    <span class="keyword">let</span> total = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; data.length; index++) &#123;</span><br><span class="line">      total += H * total + data.charCodeAt(index)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    total = total % <span class="keyword">this</span>.table.length</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (total &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      total += <span class="keyword">this</span>.table.length - <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">parseInt</span>(total.toString())</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å­˜å‚¨æ•°æ®</span></span><br><span class="line">  put(key: <span class="built_in">string</span>, data: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pos = <span class="keyword">this</span>.betterHash(key)</span><br><span class="line">    <span class="keyword">this</span>.table[pos] = data</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–æ•°æ®</span></span><br><span class="line">  <span class="keyword">get</span>(key: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.table[<span class="keyword">this</span>.betterHash(key)]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ˜¾ç¤ºæ•°æ®</span></span><br><span class="line">  show() &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="keyword">this</span>.table.length; index++) &#123;</span><br><span class="line">      <span class="keyword">const</span> item = <span class="keyword">this</span>.table[index]</span><br><span class="line">      <span class="keyword">if</span> (item) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;index&#125;</span>: <span class="subst">$&#123;item&#125;</span>`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hashTable = <span class="keyword">new</span> HashTable()</span><br><span class="line"></span><br><span class="line">hashTable.put(<span class="string">'David'</span>, <span class="string">'David'</span>)</span><br><span class="line">hashTable.put(<span class="string">'Jennifer'</span>, <span class="string">'Jennifer'</span>)</span><br><span class="line">hashTable.put(<span class="string">'Donnie'</span>, <span class="string">'Donnie'</span>)</span><br><span class="line">hashTable.put(<span class="string">'Raymond'</span>, <span class="string">'Raymond'</span>)</span><br><span class="line">hashTable.put(<span class="string">'Cynthia'</span>, <span class="string">'Cynthia'</span>)</span><br><span class="line">hashTable.put(<span class="string">'Mike'</span>, <span class="string">'Mike'</span>)</span><br><span class="line">hashTable.put(<span class="string">'Clayton'</span>, <span class="string">'Clayton'</span>)</span><br><span class="line">hashTable.put(<span class="string">'Danny'</span>, <span class="string">'Danny'</span>)</span><br><span class="line">hashTable.put(<span class="string">'Jonathan'</span>, <span class="string">'Jonathan'</span>)</span><br><span class="line"></span><br><span class="line">hashTable.show()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Jonathan: '</span>, hashTable.get(<span class="string">'Jonathan'</span>))</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">12</span>: Jennifer</span><br><span class="line"><span class="number">22</span>: Raymond</span><br><span class="line"><span class="number">55</span>: Donnie</span><br><span class="line"><span class="number">58</span>: Clayton</span><br><span class="line"><span class="number">80</span>: Jonathan</span><br><span class="line"><span class="number">82</span>: Mike</span><br><span class="line"><span class="number">103</span>: Cynthia</span><br><span class="line"><span class="number">110</span>: Danny</span><br><span class="line">Jonathan:  Jonathan</span><br></pre></td></tr></table></figure><h2 id="ç¢°æ’å¤„ç†"><a href="#ç¢°æ’å¤„ç†" class="headerlink" title="ç¢°æ’å¤„ç†"></a>ç¢°æ’å¤„ç†</h2><p>å½“å“ˆå¸Œæ–¹æ³•å¯¹äºå¤šä¸ªè¾“å…¥äº§ç”Ÿäº†ç›¸åŒçš„è¾“å‡ºæ˜¯å°±ä¼šå‡ºç°ç¢°æ’ï¼Œä¸¤ç§å¯ä»¥è§£å†³é”®çš„ç¢°æ’é—®é¢˜å¼€é“¾æ³•ä»¥åŠçº¿æ€§æ¢æµ‹æ³•</p><p>å¼€é“¾æ³•</p><p>å¼€é“¾æ³•æŒ‡çš„æ˜¯åœ¨å®ç° hash è¡¨çš„åº•å±‚æ•°ç»„ä¸­ï¼Œæ¯ä¸ªæ•°ç»„åˆæ˜¯ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚å¦ä¸€ä¸ªæ•°ç»„ï¼Œè¿™æ ·å³ä½¿æœ‰ä¸¤ä¸ªé”® hash åçš„å€¼ç›¸åŒï¼Œä¾ç„¶è¢«ä¿å­˜åœ¨åŒæ ·çš„ä½ç½®ï¼Œä½†æ˜¯ä»–ä»¬åœ¨ç¬¬äºŒä¸ªæ•°ç»„ä¸­çš„ä½ç½®æ˜¯ä¸åŒçš„ã€‚</p><p>è¦å®ç°å¼€é“¾æ³•ï¼Œåœ¨åˆ›å»ºå­˜å‚¨é”®å€¼çš„æ•°ç»„æ—¶ï¼Œé€šè¿‡ä¸€ä¸ªå‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œç„¶åå°†è¯¥æ•°ç»„èµ‹å€¼ç»™ hash è¡¨é‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œåˆ›å»ºä¸€ä¸ªäºŒç»´æ•°ç»„ã€‚</p><p>çº¿æ€§æ¢æµ‹æ³•</p><p>çº¿æ€§æ¢æµ‹æ³•æŒ‡çš„æ˜¯å½“å‘ç”Ÿç¢°æ’æ—¶æ£€æŸ¥ hash è¡¨é‡Œçš„ä¸‹ä¸€ä¸ªä½ç½®æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºå°±å°†æ•°æ®å­˜å…¥è¯¥ä½ç½®ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™ç»§ç»­æŸ¥æ‰¾ä¸‹ä¸€ä¸ªä½ç½®ï¼Œç›´åˆ°æ‰¾åˆ°ç©ºä½å­ä¸ºæ­¢ã€‚é€šå¸¸æ¥è¯´å¦‚æœæ•°ç»„çš„å¤§å°æ˜¯å¾…å­˜å‚¨æ•°æ®ä¸ªæ•°çš„ 1.5 å€æ—¶ï¼Œé‚£ä¹ˆç”¨å¼€é“¾æ³•ï¼›å¦‚æœæ•°ç»„çš„å¤§å°æ˜¯å¾…å­˜å‚¨çš„æ•°æ®ä¸¤å€ä»¥ä¸Šæ—¶ï¼Œé‚£ä¹ˆä½¿ç”¨çº¿æ€§æ¢æµ‹æ³•ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å“ˆå¸Œè¡¨æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥å¿«é€Ÿçš„æ’å…¥å’Œå–ç”¨ï¼Œä½†æ˜¯æŸ¥è¯¢æ•°æ®æ•ˆç‡ä½ä¸‹&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="DSA" scheme="https://coldstone.fun/tags/DSA/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ Egg.js ä¸­ä½¿ç”¨ Redis ç¼“å­˜æå‡æ€§èƒ½</title>
    <link href="https://coldstone.fun/post/2019/08/31/egg-redis-cache/"/>
    <id>https://coldstone.fun/post/2019/08/31/egg-redis-cache/</id>
    <published>2019-08-31T05:20:56.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>Redis æ˜¯ä¸€æ¬¾å¼€æºçš„ï¼ŒåŸºäº BSD è®¸å¯çš„ï¼Œé«˜çº§é”®å€¼ç¼“å­˜å’Œå­˜å‚¨ç³»ç»Ÿ</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Redis æ˜¯ä¸€æ¬¾å¼€æºçš„ï¼ŒåŸºäº BSD è®¸å¯çš„ï¼Œé«˜çº§é”®å€¼ç¼“å­˜å’Œå­˜å‚¨ç³»ç»Ÿã€‚Redis çš„é”®åŒ…æ‹¬ stringï¼Œhashï¼Œlistï¼Œsetï¼Œsorted setï¼Œbitmap å’Œ hyperloglogã€‚ä½ å¯ä»¥åœ¨è¿™äº›ç±»å‹ä¸Šé¢è¿è¡ŒåŸå­æ“ä½œï¼Œä¾‹å¦‚ï¼Œè¿½åŠ å­—ç¬¦ä¸²ï¼Œå¢åŠ å“ˆå¸Œä¸­çš„å€¼ï¼ŒåŠ å…¥ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨ï¼Œè®¡ç®—é›†åˆçš„äº¤é›†ã€å¹¶é›†å’Œå·®é›†ï¼Œæˆ–è€…æ˜¯ä»æœ‰åºé›†åˆä¸­è·å–æœ€é«˜æ’åçš„å…ƒç´ ã€‚</p><p>è¦åœ¨ Egg.js ä¸­ä½¿ç”¨ redisï¼Œåªéœ€è¦æ‰§è¡Œ <code>npm i redis</code> å‘½ä»¤å³å¯ã€‚</p><p>é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥éªŒè¯ä¸€ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªå¯ä»¥è¿”å›å¼€æºä»“åº“åœ¨ Github ä¸Šçš„ star æ•°é‡çš„æ•°æ®æ¥å£ï¼Œæ¥æµ‹è¯•ä½¿ç”¨ Redis åå¸¦æ¥çš„æå‡ï¼Œä»£ç åœ°å€: <a href="https://github.com/xrr2016/egg-redis-test" target="_blank" rel="noopener">https://github.com/xrr2016/egg-redis-test</a></p><h2 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h2><p>é¦–å…ˆä½¿ç”¨ Egg.js åˆ›å»ºä¸€ä¸ªé¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir egg-redis-test &amp;&amp; <span class="built_in">cd</span> egg-redis-test</span><br><span class="line"></span><br><span class="line">npm init egg --<span class="built_in">type</span>=simple</span><br><span class="line"></span><br><span class="line">npm i</span><br></pre></td></tr></table></figure><p>å®‰è£… redis</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i redis</span><br></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br><span class="line"></span><br><span class="line">open http://localhost:7001</span><br></pre></td></tr></table></figure><p>å…ˆåˆ›å»º controller å’Œ service ç›®å½•ï¼Œç”¨æ¥æ”¾å¤„ç†è¯·æ±‚å’Œè¿”å›æ•°æ®çš„æ–¹æ³•ï¼Œå®Œæˆåçš„é¡¹ç›®ç›®å½•ä¸º</p><p><img src="/images/egg-folder.jpg" alt="folder"></p><p>ä¿®æ”¹ router.js æ–‡ä»¶ï¼Œæ·»åŠ è·¯ç”±ï¼Œç„¶ååœ¨ controller/home.js æ–‡ä»¶å®ç° stars æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; router, controller &#125; = app</span><br><span class="line"></span><br><span class="line">  router.get(<span class="string">'/'</span>, controller.home.index)</span><br><span class="line">  router.get(<span class="string">'/stars'</span>, controller.home.stars)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ controller/home.js æ–‡ä»¶ï¼Œæ¥æ”¶è¯·æ±‚ä¼ è¿‡æ¥çš„ query å‚æ•°å‘ä¸‹ä¼ ç»™ stars service è¿”å›ç»“æœ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Controller = <span class="built_in">require</span>(<span class="string">'egg'</span>).Controller</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> stars() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, service &#125; = <span class="keyword">this</span></span><br><span class="line">    <span class="keyword">const</span> &#123; owner, name &#125; = ctx.query</span><br><span class="line"></span><br><span class="line">    ctx.body = <span class="keyword">await</span> service.home.stars(owner, name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = HomeController</span><br></pre></td></tr></table></figure><p>åœ¨ service/home.js é‡Œå®ç° stars æ–¹æ³•ï¼Œéœ€è¦åšçš„å°±æ˜¯é€šè¿‡ controller ä¼ è¿‡æ¥çš„ owner, name å‚æ•°ï¼Œè¯·æ±‚ Github çš„æ¥å£ï¼Œè¿”å›æ•°æ®ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œè¯·æ±‚çš„æ˜¯ Github çš„ graphql æ¥å£ï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦åœ¨ Github ä¸Šæ–°å»ºä¸€ä¸ª tokenï¼Œtoken ä¸èƒ½ç›´æ¥å†™åœ¨ä»£ç é‡Œé¢ï¼Œéœ€è¦å°† token æ”¾åœ¨ç¯å¢ƒå˜é‡é‡Œï¼Œå¦åˆ™ä»£ç æäº¤åˆ° Github åä¼šå¤±æ•ˆã€‚</p><p><img src="/images/redis-token.jpg" alt="token"></p><p>åˆ›å»º token åä½¿ç”¨ <a href="https://github.com/motdotla/dotenv#readme" target="_blank" rel="noopener">dotenv</a> ä¿å­˜ç¯å¢ƒå˜é‡ï¼Œå…ˆå®‰è£…ç„¶ååœ¨é¡¹ç›®ç›®å½•åˆ›å»ºä¸€ä¸ª .env æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i dotenv</span><br></pre></td></tr></table></figure><p><img src="/images/env.jpg" alt="token"></p><p>ç„¶åå°±å¯ä»¥ä½¿ç”¨ egg.js è‡ªå¸¦çš„ crul æ–¹æ³•å‘ Github æ¥å£å‘é€ post è¯·æ±‚ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'dotenv'</span>).config()</span><br><span class="line"><span class="keyword">const</span> Service = <span class="built_in">require</span>(<span class="string">'egg'</span>).Service</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> stars(owner, name) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setResponse</span>(<span class="params">name, stars</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">msg</span>: <span class="string">`<span class="subst">$&#123;name&#125;</span> has <span class="subst">$&#123;stars&#125;</span> stars.`</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> query = <span class="string">`</span></span><br><span class="line"><span class="string">      query &#123;</span></span><br><span class="line"><span class="string">        repository(owner: <span class="subst">$&#123;owner&#125;</span>, name: <span class="subst">$&#123;name&#125;</span>) &#123;</span></span><br><span class="line"><span class="string">          stargazers &#123;</span></span><br><span class="line"><span class="string">            totalCount</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="keyword">this</span>.ctx.curl(<span class="string">'https://api.github.com/graphql'</span>, &#123;</span><br><span class="line">      method: <span class="string">'POST'</span>,</span><br><span class="line">      dataType: <span class="string">'json'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        Authorization: <span class="string">`token <span class="subst">$&#123;process.env.TOKEN&#125;</span>`</span></span><br><span class="line">      &#125;,</span><br><span class="line">      data: <span class="built_in">JSON</span>.stringify(&#123; query &#125;),</span><br><span class="line">      timeout: <span class="number">10000</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = result.data.data</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> setResponse(name, data.repository.stargazers.totalCount)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = HomeService</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ postman æµ‹è¯•ä¸€ä¸‹æ¥å£</p><p><img src="/images/redis-before.jpg" alt="folder"></p><p>è€—æ—¶å¹³å‡ 1 ç§’å·¦å³ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä½¿ç”¨ Redis æ·»åŠ ç¼“å­˜ï¼Œé¦–å…ˆéœ€è¦åœ¨æœ¬åœ°å®‰è£… Redisï¼Œå‚è€ƒ <a href="https://redis.io/download" target="_blank" rel="noopener">Redis download</a>ï¼ŒMac å¯ä»¥ç›´æ¥ä½¿ç”¨ homebrew å®‰è£…</p><p>å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install redis</span><br></pre></td></tr></table></figure><p>å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server /usr/<span class="built_in">local</span>/etc/redis.conf</span><br></pre></td></tr></table></figure><p>è¿›å…¥ redis å‘½ä»¤è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br></pre></td></tr></table></figure><p>ç¼“å­˜çš„ä¸»è¦é€»è¾‘å°±æ˜¯ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚å®Œå¾—åˆ° Github çš„æ•°æ®å°†æ•°æ®æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œå†æ¬¡è¯·æ±‚çš„æ—¶å€™ç›´æ¥ä½¿ç”¨ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œä¹Ÿéœ€è¦ç»™ç¼“å­˜è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œ<br>éœ€è¦ä»ç¯å¢ƒå˜é‡ä¸­æ‹¿åˆ° tokenï¼Œpost è¯·æ±‚çš„æ•°æ®è¦ç”¨ JSON.stringify æ–¹æ³•ä¼ ç»™ Github æ¥å£ï¼Œå¦åˆ™å‡ºç°è§£æé”™è¯¯ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'dotenv'</span>).config()</span><br><span class="line"><span class="keyword">const</span> redis = <span class="built_in">require</span>(<span class="string">'redis'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; promisify &#125; = <span class="built_in">require</span>(<span class="string">'util'</span>)</span><br><span class="line"><span class="keyword">const</span> Service = <span class="built_in">require</span>(<span class="string">'egg'</span>).Service</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> REDIS_PORT = process.env.PORT || <span class="number">6379</span></span><br><span class="line"><span class="keyword">const</span> client = redis.createClient(REDIS_PORT)</span><br><span class="line"><span class="keyword">const</span> getAsync = promisify(client.get).bind(client)</span><br><span class="line"><span class="keyword">const</span> setexAsync = promisify(client.setex).bind(client)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> stars(owner, name) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = <span class="string">`<span class="subst">$&#123;owner&#125;</span>/<span class="subst">$&#123;name&#125;</span>`</span></span><br><span class="line">    <span class="keyword">const</span> stars = <span class="keyword">await</span> getAsync(key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setResponse</span>(<span class="params">name, stars</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">msg</span>: <span class="string">`<span class="subst">$&#123;name&#125;</span> has <span class="subst">$&#123;stars&#125;</span> stars.`</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (stars !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> setResponse(name, stars)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> query = <span class="string">`</span></span><br><span class="line"><span class="string">      query &#123;</span></span><br><span class="line"><span class="string">        repository(owner: <span class="subst">$&#123;owner&#125;</span>, name: <span class="subst">$&#123;name&#125;</span>) &#123;</span></span><br><span class="line"><span class="string">          stargazers &#123;</span></span><br><span class="line"><span class="string">            totalCount</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="keyword">this</span>.ctx.curl(<span class="string">'https://api.github.com/graphql'</span>, &#123;</span><br><span class="line">      method: <span class="string">'POST'</span>,</span><br><span class="line">      dataType: <span class="string">'json'</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        Authorization: <span class="string">`token <span class="subst">$&#123;process.env.TOKEN&#125;</span>`</span></span><br><span class="line">      &#125;,</span><br><span class="line">      data: <span class="built_in">JSON</span>.stringify(&#123; query &#125;),</span><br><span class="line">      timeout: <span class="number">10000</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = result.data.data</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> setexAsync(key, <span class="number">10</span>, data.repository.stargazers.totalCount)</span><br><span class="line">    <span class="keyword">return</span> setResponse(name, data.repository.stargazers.totalCount)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = HomeService</span><br></pre></td></tr></table></figure><p>å†æ¬¡æµ‹è¯•ï¼Œé¦–å…ˆæŠŠ Redis é‡Œé¢çš„ç¼“å­˜æ¸…ç©ºï¼Œä½¿ç”¨ Redis çš„å‘½ä»¤è¡Œè¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLUSHALL</span><br></pre></td></tr></table></figure><p>å‘é€è¯·æ±‚ï¼Œç¬¬ä¸€æ¬¡çš„è€—æ—¶è¿˜æ˜¯ä¸€ç§’å¤šï¼Œç„¶ååœ¨å¤±æ•ˆæ—¶é—´å†…è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨ç¼“å­˜çš„æ•°æ®åè€—æ—¶å¤§å¤§å‡å°‘äº†ï¼Œæ€§èƒ½æå‡æ•ˆæœæ˜¾è‘—ï¼Œå®é™…é¡¹ç›®å¯ä»¥è®¾ç½®ä¸€ä¸ªè¾ƒé•¿çš„ç¼“å­˜å¤±æ•ˆæ—¶é—´</p><p><img src="/images/redis-after.jpg" alt="folder"></p><p>å½“ç„¶ç¼“å­˜è¿‡æœŸååˆè¦é‡æ–°å‘ Github å‘é€è¯·æ±‚äº†ï¼Œå› ä¸º Redis å·²ç»æŠŠæ•°æ®åˆ é™¤äº†</p><p><img src="/images/redis-vue.jpg" alt="folder"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://redis.io/documentation" target="_blank" rel="noopener">Redis documentation</a></p><p><a href="https://github.com/noderedis/node_redis" target="_blank" rel="noopener">Node Redis</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Redis æ˜¯ä¸€æ¬¾å¼€æºçš„ï¼ŒåŸºäº BSD è®¸å¯çš„ï¼Œé«˜çº§é”®å€¼ç¼“å­˜å’Œå­˜å‚¨ç³»ç»Ÿ&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Node" scheme="https://coldstone.fun/tags/Node/"/>
    
      <category term="Redis" scheme="https://coldstone.fun/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹å­—å…¸</title>
    <link href="https://coldstone.fun/post/2019/08/28/dsa-dictionary/"/>
    <id>https://coldstone.fun/post/2019/08/28/dsa-dictionary/</id>
    <published>2019-08-28T13:09:13.000Z</published>
    <updated>2021-06-28T09:25:25.301Z</updated>
    
    <content type="html"><![CDATA[<p>å­—å…¸æ˜¯ä¸€ç§ä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œé”®ç”¨æ¥æŸ¥æ‰¾ï¼Œå€¼ç”¨æ¥ä¿å­˜æ•°æ®</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å­—å…¸æ˜¯ä¸€ç§ä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œé”®ç”¨æ¥æŸ¥æ‰¾ï¼Œå€¼ç”¨æ¥ä¿å­˜æ•°æ®</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Dictionary &#123;</span><br><span class="line">  data: <span class="built_in">any</span>[] = []</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ å…ƒç´ </span></span><br><span class="line">  add(key: <span class="built_in">any</span>, value: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.data[key] = value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æŸ¥æ‰¾å…ƒç´ </span></span><br><span class="line">  find(key: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data[key]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ é™¤å…ƒç´ </span></span><br><span class="line">  remove(key: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">delete</span> <span class="keyword">this</span>.data[key]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ˜¾ç¤ºå…ƒç´ </span></span><br><span class="line">  show() &#123;</span><br><span class="line">    <span class="built_in">Object</span>.entries(<span class="keyword">this</span>.data).forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'key:'</span>, item[<span class="number">0</span>], <span class="string">' value:'</span>, item[<span class="number">1</span>])</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">  count() &#123;</span><br><span class="line">    <span class="keyword">let</span> n = <span class="number">0</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(<span class="keyword">this</span>.data).forEach(_ =&gt; &#123;</span><br><span class="line">      n += <span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¸…ç©ºå…ƒç´ </span></span><br><span class="line">  clear() &#123;</span><br><span class="line">    <span class="built_in">Object</span>.keys(<span class="keyword">this</span>.data).forEach(<span class="function">(<span class="params">key: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">delete</span> <span class="keyword">this</span>.data[key]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dictionary = <span class="keyword">new</span> Dictionary()</span><br><span class="line"></span><br><span class="line">dictionary.add(<span class="string">'a'</span>, <span class="string">'a'</span>)</span><br><span class="line">dictionary.add(<span class="string">'b'</span>, <span class="string">'b'</span>)</span><br><span class="line">dictionary.add(<span class="string">'c'</span>, <span class="string">'c'</span>)</span><br><span class="line">dictionary.add(<span class="string">'d'</span>, <span class="string">'d'</span>)</span><br><span class="line">dictionary.add(<span class="string">'e'</span>, <span class="string">'e'</span>)</span><br><span class="line"></span><br><span class="line">dictionary.show()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'count: '</span>, dictionary.count())</span><br><span class="line"></span><br><span class="line">dictionary.clear()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'clear: '</span>, dictionary.count())</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">key: a  value: a</span><br><span class="line">key: b  value: b</span><br><span class="line">key: c  value: c</span><br><span class="line">key: d  value: d</span><br><span class="line">key: e  value: e</span><br><span class="line">count:  5</span><br><span class="line">clear:  0</span><br></pre></td></tr></table></figure><p>æ’åºå­—å…¸çš„è¾“å‡ºï¼Œéœ€è¦é‡æ–°å®šä¹‰ show æ–¹æ³•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ˜¾ç¤ºå…ƒç´ </span></span><br><span class="line">show() &#123;</span><br><span class="line">  <span class="built_in">Object</span>.entries(<span class="keyword">this</span>.data)</span><br><span class="line">.sort()</span><br><span class="line">.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'key:'</span>, item[<span class="number">0</span>], <span class="string">' value:'</span>, item[<span class="number">1</span>])</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dictionary = <span class="keyword">new</span> Dictionary()</span><br><span class="line"></span><br><span class="line">dictionary.add(<span class="string">'c'</span>, <span class="string">'c'</span>)</span><br><span class="line">dictionary.add(<span class="string">'a'</span>, <span class="string">'a'</span>)</span><br><span class="line">dictionary.add(<span class="string">'d'</span>, <span class="string">'d'</span>)</span><br><span class="line">dictionary.add(<span class="string">'e'</span>, <span class="string">'e'</span>)</span><br><span class="line">dictionary.add(<span class="string">'b'</span>, <span class="string">'b'</span>)</span><br><span class="line"></span><br><span class="line">dictionary.show()</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">key: a  value: a</span><br><span class="line">key: b  value: b</span><br><span class="line">key: c  value: c</span><br><span class="line">key: d  value: d</span><br><span class="line">key: e  value: e</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Object.keys æ–¹æ³•æ‹¿åˆ°å­—å…¸çš„ keys æ•°ç»„åï¼Œåœ¨ç”¨ sort æ–¹æ³•å°±å¯ä»¥æ˜¾ç¤ºæœ‰åºçš„å­—å…¸è¾“å‡ºäº†</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å­—å…¸æ˜¯ä¸€ç§ä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œé”®ç”¨æ¥æŸ¥æ‰¾ï¼Œå€¼ç”¨æ¥ä¿å­˜æ•°æ®&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="DSA" scheme="https://coldstone.fun/tags/DSA/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹é“¾è¡¨</title>
    <link href="https://coldstone.fun/post/2019/08/25/dsa-linklist/"/>
    <id>https://coldstone.fun/post/2019/08/25/dsa-linklist/</id>
    <published>2019-08-25T04:49:36.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>é“¾è¡¨æ˜¯ä¸€ç»„èŠ‚ç‚¹ç»„æˆçš„é›†åˆï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æŒ‡å‘å®ƒçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæŒ‡å‘èŠ‚ç‚¹çš„å¼•ç”¨å«åšé“¾</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é“¾è¡¨æ˜¯ä¸€ç»„èŠ‚ç‚¹ç»„æˆçš„é›†åˆï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æŒ‡å‘å®ƒçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæŒ‡å‘èŠ‚ç‚¹çš„å¼•ç”¨å«åšé“¾ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>ä½¿ç”¨ LinkedListNode ç±»æ¥è¡¨ç¤ºèŠ‚ç‚¹ï¼Œä½¿ç”¨ LinkedList æ¥è¡¨ç¤ºé“¾è¡¨</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> LinkedListNode &#123;</span><br><span class="line">  element: <span class="built_in">any</span></span><br><span class="line">  next: LinkedListNode</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">element: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.element = element</span><br><span class="line">    <span class="keyword">this</span>.next = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> LinkedList &#123;</span><br><span class="line">  <span class="comment">// å¤´èŠ‚ç‚¹</span></span><br><span class="line">  head: LinkedListNode</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.head = <span class="keyword">new</span> LinkedListNode(<span class="string">'head'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æŸ¥æ‰¾</span></span><br><span class="line">  find(element: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> currentNode: LinkedListNode = <span class="keyword">this</span>.head</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (currentNode.element !== element) &#123;</span><br><span class="line">      currentNode = currentNode.next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> currentNode</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ’å…¥</span></span><br><span class="line">  insert(element: <span class="built_in">any</span>, item: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> newNode = <span class="keyword">new</span> LinkedListNode(element)</span><br><span class="line">    <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.find(item)</span><br><span class="line"></span><br><span class="line">    newNode.next = currentNode.next</span><br><span class="line">    currentNode.next = newNode</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç§»é™¤</span></span><br><span class="line">  remove(element: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> prevNode = <span class="keyword">this</span>.findPrevNode(element)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(prevNode.next === <span class="literal">null</span>)) &#123;</span><br><span class="line">      prevNode.next = prevNode.next.next</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  findPrevNode(element: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.head</span><br><span class="line">    <span class="keyword">while</span> (</span><br><span class="line">      !(currentNode.next === <span class="literal">null</span>) &amp;&amp;</span><br><span class="line">      currentNode.next.element !== element</span><br><span class="line">    ) &#123;</span><br><span class="line">      currentNode = currentNode.next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> currentNode</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ˜¾ç¤º</span></span><br><span class="line">  display() &#123;</span><br><span class="line">    <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.head</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!(currentNode.next === <span class="literal">null</span>)) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(currentNode.next.element)</span><br><span class="line">      currentNode = currentNode.next</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foods = <span class="keyword">new</span> LinkedList()</span><br><span class="line"></span><br><span class="line">foods.insert(<span class="string">'eggs'</span>, <span class="string">'head'</span>)</span><br><span class="line">foods.insert(<span class="string">'apple'</span>, <span class="string">'eggs'</span>)</span><br><span class="line">foods.insert(<span class="string">'bread'</span>, <span class="string">'apple'</span>)</span><br><span class="line">foods.insert(<span class="string">'chese'</span>, <span class="string">'bread'</span>)</span><br><span class="line">foods.insert(<span class="string">'rice'</span>, <span class="string">'chese'</span>)</span><br><span class="line">foods.display()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'------------'</span>)</span><br><span class="line">foods.remove(<span class="string">'bread'</span>)</span><br><span class="line">foods.display()</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">eggs</span><br><span class="line">apple</span><br><span class="line">bread</span><br><span class="line">chese</span><br><span class="line">rice</span><br><span class="line">------------</span><br><span class="line">eggs</span><br><span class="line">apple</span><br><span class="line">chese</span><br><span class="line">rice</span><br></pre></td></tr></table></figure><h2 id="åŒå‘é“¾è¡¨"><a href="#åŒå‘é“¾è¡¨" class="headerlink" title="åŒå‘é“¾è¡¨"></a>åŒå‘é“¾è¡¨</h2><p>è¦å®ç°åŒå‘é“¾è¡¨é¦–å…ˆè¦ä¸º LinkedListNode ç±»å¢åŠ ä¸€ä¸ª prev å±æ€§</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> LinkedListNode &#123;</span><br><span class="line">  element: <span class="built_in">any</span></span><br><span class="line">  prev: LinkedListNode</span><br><span class="line">  next: LinkedListNode</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">element: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.element = element</span><br><span class="line">    <span class="keyword">this</span>.prev = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">this</span>.next = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹ LinkedList ç±»çš„ insert, remove æ–¹æ³•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> LinkedList &#123;</span><br><span class="line">  <span class="comment">// å¤´èŠ‚ç‚¹</span></span><br><span class="line">  head: LinkedListNode = <span class="keyword">new</span> LinkedListNode(<span class="string">'head'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æŸ¥æ‰¾</span></span><br><span class="line">  find(element: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.head</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (currentNode.element !== element) &#123;</span><br><span class="line">      currentNode = currentNode.next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> currentNode</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ‰¾åˆ°æœ€åçš„èŠ‚ç‚¹</span></span><br><span class="line">  findLast() &#123;</span><br><span class="line">    <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.head</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (currentNode.next !== <span class="literal">null</span>) &#123;</span><br><span class="line">      currentNode = currentNode.next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> currentNode</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ’å…¥</span></span><br><span class="line">  insert(element: <span class="built_in">any</span>, item: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> newNode = <span class="keyword">new</span> LinkedListNode(element)</span><br><span class="line">    <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.find(item)</span><br><span class="line"></span><br><span class="line">    newNode.prev = currentNode</span><br><span class="line">    newNode.next = currentNode.next</span><br><span class="line">    currentNode.next = newNode</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç§»é™¤</span></span><br><span class="line">  remove(element: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.find(element)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (currentNode.next !== <span class="literal">null</span>) &#123;</span><br><span class="line">      currentNode.prev.next = currentNode.next</span><br><span class="line">      currentNode.next.prev = currentNode.prev</span><br><span class="line">      currentNode.next = <span class="literal">null</span></span><br><span class="line">      currentNode.prev = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ˜¾ç¤º</span></span><br><span class="line">  display() &#123;</span><br><span class="line">    <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.head</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!(currentNode.next === <span class="literal">null</span>)) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(currentNode.next.element)</span><br><span class="line">      currentNode = currentNode.next</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å€’å™æ˜¾ç¤º</span></span><br><span class="line">  displayReverse() &#123;</span><br><span class="line">    <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.findLast()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (currentNode.prev !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(currentNode.element)</span><br><span class="line">      currentNode = currentNode.prev</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">foods.insert(<span class="string">'eggs'</span>, <span class="string">'head'</span>)</span><br><span class="line">foods.insert(<span class="string">'apple'</span>, <span class="string">'eggs'</span>)</span><br><span class="line">foods.insert(<span class="string">'bread'</span>, <span class="string">'apple'</span>)</span><br><span class="line">foods.insert(<span class="string">'chese'</span>, <span class="string">'bread'</span>)</span><br><span class="line">foods.insert(<span class="string">'rice'</span>, <span class="string">'chese'</span>)</span><br><span class="line">foods.display()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'------------'</span>)</span><br><span class="line">foods.remove(<span class="string">'bread'</span>)</span><br><span class="line">foods.display()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'------------'</span>)</span><br><span class="line">foods.displayReverse()</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">eggs</span><br><span class="line">apple</span><br><span class="line">bread</span><br><span class="line">chese</span><br><span class="line">rice</span><br><span class="line">------------</span><br><span class="line">eggs</span><br><span class="line">apple</span><br><span class="line">chese</span><br><span class="line">rice</span><br><span class="line">------------</span><br><span class="line">rice</span><br><span class="line">chese</span><br><span class="line">apple</span><br><span class="line">eggs</span><br></pre></td></tr></table></figure><h2 id="å¾ªç¯é“¾è¡¨"><a href="#å¾ªç¯é“¾è¡¨" class="headerlink" title="å¾ªç¯é“¾è¡¨"></a>å¾ªç¯é“¾è¡¨</h2><p>åˆ›å»ºå¾ªç¯é“¾è¡¨éœ€è¦è®©å®ƒçš„å¤´èŠ‚ç‚¹çš„ next å±æ€§æŒ‡å‘æœ¬èº«ï¼Œ ç„¶åä¿®æ”¹ display æ–¹æ³•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.head.next = <span class="keyword">this</span>.head</span><br><span class="line"></span><br><span class="line"> <span class="comment">// æ˜¾ç¤º</span></span><br><span class="line">display() &#123;</span><br><span class="line">  <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.head</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (currentNode.next !== <span class="literal">null</span> &amp;&amp; currentNode.next.element !== <span class="string">'head'</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(currentNode.next.element)</span><br><span class="line">    currentNode = currentNode.next</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é“¾è¡¨æ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå¦‚æœå‘ç°æ•°ç»„åœ¨ä½¿ç”¨æ—¶å¾ˆæ…¢ï¼Œå°±å¯ä»¥è€ƒè™‘ç”¨é“¾è¡¨æ›¿ä»£å®ƒï¼Œä½†æ˜¯å¦‚æœéœ€è¦å¯¹æ•°æ®éšæœºè®¿é—®ï¼Œæ•°ç»„ä»»ç„¶æ˜¯æ›´ä¼˜çš„é€‰æ‹©</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é“¾è¡¨æ˜¯ä¸€ç»„èŠ‚ç‚¹ç»„æˆçš„é›†åˆï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æŒ‡å‘å®ƒçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæŒ‡å‘èŠ‚ç‚¹çš„å¼•ç”¨å«åšé“¾&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="DSA" scheme="https://coldstone.fun/tags/DSA/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•åœ¨ Egg.js ä¸­ä½¿ç”¨ Sequelize çš„äº‹åŠ¡ Transaction</title>
    <link href="https://coldstone.fun/post/2019/08/22/egg-sequelize-transaction/"/>
    <id>https://coldstone.fun/post/2019/08/22/egg-sequelize-transaction/</id>
    <published>2019-08-22T06:07:14.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>Egg.js æ¡†æ¶ä¸­ä½¿ç”¨äº‹åŠ¡</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨æŸ¥äº†å‡ é <a href="https://sequelize.org/" target="_blank" rel="noopener">Sequelize</a> å…³äº <a href="https://sequelize.org/master/manual/transactions.html" target="_blank" rel="noopener">Transactions</a> çš„æ–‡æ¡£ï¼Œçœ‹äº†å¤§ä½¬åŒäº‹çš„ä»£ç åï¼Œæˆ‘ç»ˆäºå¼„æ‡‚æ€ä¹ˆåœ¨ egg.js æ¡†æ¶é‡Œé¢ä½¿ç”¨äº‹åŠ¡äº† ğŸ˜“</p><h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p>Sequelize å…³äºäº‹åŠ¡çš„ç¤ºä¾‹ä»£ç æ˜¯è¿™æ ·æ»´ï¼Œé¦–å…ˆé€šè¿‡ <code>sequelize.transaction</code> æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªäº‹åŠ¡åï¼ŒæŠŠè¿™ä¸ªäº‹åŠ¡ä¼ ç»™éœ€è¦è¿›è¡Œæ“ä½œçš„å‡½æ•°ï¼Œå¦‚æ–°å¢ç”¨æˆ·ï¼Œç»™ç”¨æˆ·åŠ å±æ€§ç­‰ï¼Œä½†æ˜¯çœ‹ä¸Šå»ä»£ç æ¯”è¾ƒéš¾æ‡‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> sequelize.transaction().then(<span class="function"><span class="params">t</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> User.create(</span><br><span class="line">    &#123;</span><br><span class="line">      firstName: <span class="string">'Bart'</span>,</span><br><span class="line">      lastName: <span class="string">'Simpson'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="attr">transaction</span>: t &#125;</span><br><span class="line">  )</span><br><span class="line">    .then(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> user.addSibling(</span><br><span class="line">        &#123;</span><br><span class="line">          firstName: <span class="string">'Lisa'</span>,</span><br><span class="line">          lastName: <span class="string">'Simpson'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123; <span class="attr">transaction</span>: t &#125;</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> t.commit()</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> t.rollback()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å®é™…ä½¿ç”¨çš„è¯éœ€è¦ç”¨ <code>async/await</code> è¯­æ³•è®©ä»£ç çœ‹èµ·æ¥æ›´åŠ æ¸…æ™°ä¸€ç‚¹ï¼Œåœ¨ egg.js ä¸­ä½¿ç”¨çš„ç¤ºä¾‹å¦‚ä¸‹ï¼Œé¦–å…ˆéœ€è¦ç”¨å½“å‰ä¸Šä¸‹æ–‡ä¸­çš„ model å¯¹è±¡ï¼ˆå°±æ˜¯å¯¹æ•°æ®è¡¨çš„æ˜ å°„å¯¹è±¡ï¼‰åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œç„¶ååœ¨ <code>try/catch</code> ä¸­æ‰§è¡Œæ‰€è¦è¿›è¡Œçš„æ“ä½œï¼Œå¦‚æœæ“ä½œæŠ›å‡ºäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆå°±ä¼šå›æ»š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> transaction = <span class="keyword">await</span> <span class="keyword">this</span>.ctx.model.transaction()</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">this</span>.ctx.model.create(<span class="keyword">this</span>.ctx.request.body, &#123; transaction &#125;)</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">this</span>.ctx.service.user.find(userId, &#123; transaction &#125;);</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">this</span>.ctx.service.product.destory(productId, &#123; transaction &#125;);</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">await</span> transaction.commit()</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  <span class="keyword">await</span> transaction.rollback()</span><br><span class="line">  <span class="keyword">throw</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨äº† <code>async/await</code> è¯­æ³•ï¼Œä»£ç ç¡®å®æ¸…æ™°äº†å¾ˆå¤š</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Egg.js æ¡†æ¶ä¸­ä½¿ç”¨äº‹åŠ¡&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Egg.js" scheme="https://coldstone.fun/tags/Egg-js/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹é˜Ÿåˆ—</title>
    <link href="https://coldstone.fun/post/2019/08/18/das-queue/"/>
    <id>https://coldstone.fun/post/2019/08/18/das-queue/</id>
    <published>2019-08-18T14:18:36.000Z</published>
    <updated>2021-06-28T09:25:25.301Z</updated>
    
    <content type="html"><![CDATA[<p>é˜Ÿåˆ—æ˜¯ä¸€ç§åˆ—è¡¨ï¼Œåªèƒ½åœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ ï¼Œåœ¨é˜Ÿé¦–åˆ é™¤å…ƒç´ ã€‚é˜Ÿåˆ—ç”¨äºå­˜å‚¨æŒ‰é¡ºåºæ’åˆ—çš„çš„æ•°æ®ï¼Œå…ˆè¿›å…ˆå‡ºï¼Œå¯ä»¥å°†é˜Ÿåˆ—æƒ³è±¡æˆåœ¨é¥­åº—æ’é˜Ÿå–é¤çš„äººç¾¤ï¼Œåœ¨é˜Ÿä¼å‰é¢çš„å…ˆå–é¤ï¼Œåæ¥çš„äººåå–é¤</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é˜Ÿåˆ—æ˜¯ä¸€ç§åˆ—è¡¨ï¼Œåªèƒ½åœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ ï¼Œåœ¨é˜Ÿé¦–åˆ é™¤å…ƒç´ ã€‚é˜Ÿåˆ—ç”¨äºå­˜å‚¨æŒ‰é¡ºåºæ’åˆ—çš„çš„æ•°æ®ï¼Œå…ˆè¿›å…ˆå‡ºï¼Œå¯ä»¥å°†é˜Ÿåˆ—æƒ³è±¡æˆåœ¨é¥­åº—æ’é˜Ÿå–é¤çš„äººç¾¤ï¼Œåœ¨é˜Ÿä¼å‰é¢çš„å…ˆå–é¤ï¼Œåæ¥çš„äººåå–é¤ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>ç”¨ TypeScript å®ç°é˜Ÿåˆ—</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Queue &#123;</span><br><span class="line">  data: <span class="built_in">Array</span>&lt;<span class="built_in">any</span>&gt; = []</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å…¥é˜Ÿ</span></span><br><span class="line">  enqueue(element: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.data.push(element)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å‡ºé˜Ÿ</span></span><br><span class="line">  dequeue() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data.shift()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">  front() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data[<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">  back() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data[<span class="keyword">this</span>.data.length - <span class="number">1</span>]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ˜¾ç¤ºé˜Ÿåˆ—ä¸­æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">  toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data.map(<span class="function"><span class="params">ele</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;ele&#125;</span>`</span>).toString()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">  empty() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.data.length) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> queue = <span class="keyword">new</span> Queue()</span><br><span class="line"></span><br><span class="line">queue.enqueue(<span class="string">'a'</span>)</span><br><span class="line">queue.enqueue(<span class="string">'b'</span>)</span><br><span class="line">queue.enqueue(<span class="string">'c'</span>)</span><br><span class="line">queue.enqueue(<span class="string">'d'</span>)</span><br><span class="line">queue.enqueue(<span class="string">'e'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'queue: '</span>, queue)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'front: '</span>, queue.front())</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'back: '</span>, queue.back())</span><br><span class="line"></span><br><span class="line">queue.dequeue()</span><br><span class="line">queue.dequeue()</span><br><span class="line">queue.dequeue()</span><br><span class="line">queue.dequeue()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'queue: '</span>, queue)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'queue: '</span>, queue.empty())</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">queue:  Queue &#123; data: [ 'a', 'b', 'c', 'd', 'e' ] &#125;</span><br><span class="line"></span><br><span class="line">front: a</span><br><span class="line"></span><br><span class="line">back:  e</span><br><span class="line"></span><br><span class="line">queue:  Queue &#123; data: [ 'e' ] &#125;</span><br><span class="line"></span><br><span class="line">queue:  false</span><br></pre></td></tr></table></figure><h2 id="ä¼˜å…ˆé˜Ÿåˆ—"><a href="#ä¼˜å…ˆé˜Ÿåˆ—" class="headerlink" title="ä¼˜å…ˆé˜Ÿåˆ—"></a>ä¼˜å…ˆé˜Ÿåˆ—</h2><p>ä¼˜å…ˆé˜Ÿåˆ—æŒ‡çš„æ˜¯åœ¨åˆ é™¤é˜Ÿåˆ—ä¸­å…ƒç´ çš„æ—¶å€™éœ€è¦è€ƒè™‘å…ƒç´ çš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜çš„å…ƒç´ å…ˆå‡ºé˜Ÿï¼Œä¼˜å…ˆçº§ä½çš„åå‡ºé˜Ÿï¼ŒåŒç­‰ä¼˜å…ˆçº§çš„å…ƒç´ æŒ‰åŸæœ¬çš„é¡ºåºå‡ºé˜Ÿã€‚</p><p>é¦–å…ˆéœ€è¦ä¸€ä¸ªå…·æœ‰ä¼˜å…ˆçº§çš„å…ƒç´ </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Element &#123;</span><br><span class="line">  data: <span class="built_in">any</span></span><br><span class="line">  code: <span class="built_in">number</span> <span class="comment">// code è¡¨ç¤ºä¼˜å…ˆçº§ï¼Œæ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œ0 ä¸ºæœ€é«˜</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åéœ€è¦ä¿®æ”¹ä¸‹é˜Ÿåˆ—çš„å‡ºé˜Ÿæ–¹æ³•ï¼Œæ‰¾åˆ°é˜Ÿåˆ—ä¸­ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ï¼Œç„¶åå°†å…¶ç§»é™¤é˜Ÿåˆ—</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dequeue() &#123;</span><br><span class="line">  <span class="keyword">const</span> codes = <span class="keyword">this</span>.data.map(<span class="function"><span class="params">ele</span> =&gt;</span> ele.code)</span><br><span class="line">  <span class="keyword">const</span> minCode = <span class="built_in">Math</span>.min.apply(<span class="literal">null</span>, codes)</span><br><span class="line">  <span class="keyword">const</span> index = <span class="keyword">this</span>.data.findIndex(<span class="function"><span class="params">ele</span> =&gt;</span> ele.code === minCode)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.data.splice(index, <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> queue = <span class="keyword">new</span> Queue()</span><br><span class="line"></span><br><span class="line">queue.enqueue(&#123; data: <span class="string">'a'</span>, code: <span class="number">5</span> &#125;)</span><br><span class="line">queue.enqueue(&#123; data: <span class="string">'b'</span>, code: <span class="number">4</span> &#125;)</span><br><span class="line">queue.enqueue(&#123; data: <span class="string">'c'</span>, code: <span class="number">3</span> &#125;)</span><br><span class="line">queue.enqueue(&#123; data: <span class="string">'d'</span>, code: <span class="number">2</span> &#125;)</span><br><span class="line">queue.enqueue(&#123; data: <span class="string">'e'</span>, code: <span class="number">1</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'queue: '</span>, queue)</span><br><span class="line"></span><br><span class="line">queue.dequeue()</span><br><span class="line">queue.dequeue()</span><br><span class="line">queue.dequeue()</span><br><span class="line">queue.dequeue()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'queue: '</span>, queue)</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">queue:  Queue &#123;</span><br><span class="line">  data:</span><br><span class="line">   [</span><br><span class="line">     &#123; data: 'a', code: 5 &#125;,</span><br><span class="line">     &#123; data: 'b', code: 4 &#125;,</span><br><span class="line">     &#123; data: 'c', code: 3 &#125;,</span><br><span class="line">     &#123; data: 'd', code: 2 &#125;,</span><br><span class="line">     &#123; data: 'e', code: 1 &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">queue:  Queue &#123;</span><br><span class="line">  data:</span><br><span class="line">    [</span><br><span class="line">      &#123; data: 'a', code: 5 &#125;,</span><br><span class="line">      &#123; data: 'b', code: 4 &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é˜Ÿåˆ—ä¸­å‰©ä¸‹äº†ä¼˜å…ˆçº§è¾ƒä½çš„å…ƒç´ </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é˜Ÿåˆ—æ˜¯ä¸€ç§åˆ—è¡¨ï¼Œåªèƒ½åœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ ï¼Œåœ¨é˜Ÿé¦–åˆ é™¤å…ƒç´ ã€‚é˜Ÿåˆ—ç”¨äºå­˜å‚¨æŒ‰é¡ºåºæ’åˆ—çš„çš„æ•°æ®ï¼Œå…ˆè¿›å…ˆå‡ºï¼Œå¯ä»¥å°†é˜Ÿåˆ—æƒ³è±¡æˆåœ¨é¥­åº—æ’é˜Ÿå–é¤çš„äººç¾¤ï¼Œåœ¨é˜Ÿä¼å‰é¢çš„å…ˆå–é¤ï¼Œåæ¥çš„äººåå–é¤&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="DSA" scheme="https://coldstone.fun/tags/DSA/"/>
    
  </entry>
  
  <entry>
    <title>å…³äº Flutter çš„å®‰å“æ‰“åŒ…</title>
    <link href="https://coldstone.fun/post/2019/08/14/flutter-android-build/"/>
    <id>https://coldstone.fun/post/2019/08/14/flutter-android-build/</id>
    <published>2019-08-14T01:56:55.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>Flutter åœ¨æ‰“åŒ…å®‰å“åº”ç”¨æ—¶æœ‰ä¸¤ç§æ–¹å¼ <code>flutter build apk</code> å’Œ <code>flutter build appbundle</code>ï¼Œæœ¬æ–‡è¯´ä¸‹è¿™ä¸¤ç§æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Flutter åœ¨æ‰“åŒ…å®‰å“åº”ç”¨æ—¶æœ‰ä¸¤ç§æ–¹å¼ <code>flutter build apk</code> å’Œ <code>flutter build appbundle</code>ï¼Œæœ¬æ–‡è¯´ä¸‹è¿™ä¸¤ç§æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p><h2 id="Appbundle"><a href="#Appbundle" class="headerlink" title="Appbundle"></a>Appbundle</h2><p>Android App Bundle æ˜¯ä¸Šä¼ åˆ° Google Play ç”¨ä»¥æ”¯æŒ Dynamic Delivery çš„æ–‡ä»¶ï¼Œæ‰©å±•åä¸º .aabï¼Œä¸€ä¸ª bundle åŒ…å«æ‰€æœ‰åº”ç”¨çš„å·²ç¼–è¯‘ä»£ç å’Œèµ„æºï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ç”Ÿæˆ apk å’Œ Google Play çš„ç­¾åã€‚</p><p>Google Play çš„æ–°åº”ç”¨æœåŠ¡æ¨¡å¼ç§°ä¸º Dynamic Deliveryï¼ˆåŠ¨æ€ä¼ é€ï¼‰ï¼Œä½¿ç”¨ä½ çš„åº”ç”¨åŒ…ä¸ºæ¯ä¸ªç”¨æˆ·çš„è®¾å¤‡é…ç½®ç”Ÿæˆå¹¶æä¾›ä¼˜åŒ–çš„ APKï¼Œå› æ­¤ç”¨æˆ·åªä¸‹è½½è¿è¡Œåº”ç”¨æ‰€éœ€çš„ä»£ç å’Œèµ„æºã€‚å¼€å‘è€…ä¸å†éœ€è¦æ„å»ºï¼Œç­¾åå’Œç®¡ç†å¤šä¸ª APK æ¥æ”¯æŒä¸åŒçš„è®¾å¤‡ï¼Œç”¨æˆ·å¯ä»¥è·å¾—æ›´å°ï¼Œæ›´ä¼˜åŒ–çš„ä¸‹è½½ã€‚</p><p><a href="https://developer.android.com/guide/app-bundle" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p><h2 id="Apk"><a href="#Apk" class="headerlink" title="Apk"></a>Apk</h2><p>å¦‚æœåº”ç”¨ä¸å‘å¸ƒåˆ° Google Playï¼Œåˆ™éœ€è¦å‘å¸ƒå¤šä¸ª apkï¼Œä½†å¿…é¡»è‡ªå·±æ„å»ºï¼Œç­¾åå’Œç®¡ç†æ¯ä¸ª apkã€‚</p><p>é€šå¸¸æ„å»ºä¸€ä¸ª apk ç”¨ä»¥æ”¯æŒæ‰€æœ‰ç›®æ ‡è®¾å¤‡ï¼Œä½†ç”±äºéœ€è¦æ”¯æŒå¤šä¸ªå±å¹•å¯†åº¦æˆ–åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼ˆABIï¼‰çš„æ–‡ä»¶ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´éå¸¸å¤§çš„ apkï¼Œå‡å°‘ apk å¤§å°çš„ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºå¤šä¸ª apkï¼Œåœ¨æ‰§è¡Œ <code>flutter build apk</code> çš„æ—¶å€™å¯ä»¥æ·»åŠ æ„å»ºå‚æ•° <code>--target-platform android-arm,android-arm64 --split-per-abi</code>ï¼Œ è¿™æ ·æ„å»ºå‡ºæ¥çš„ apk åŒ…å«ç‰¹å®šå±å¹•å¯†åº¦æˆ– ABI çš„æ–‡ä»¶ã€‚</p><p><a href="https://developer.android.com/studio/build/configure-apk-splits" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Flutter åœ¨æ‰“åŒ…å®‰å“åº”ç”¨æ—¶æœ‰ä¸¤ç§æ–¹å¼ &lt;code&gt;flutter build apk&lt;/code&gt; å’Œ &lt;code&gt;flutter build appbundle&lt;/code&gt;ï¼Œæœ¬æ–‡è¯´ä¸‹è¿™ä¸¤ç§æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹æ ˆ</title>
    <link href="https://coldstone.fun/post/2019/08/10/dsa-stack/"/>
    <id>https://coldstone.fun/post/2019/08/10/dsa-stack/</id>
    <published>2019-08-10T15:12:09.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>æ ˆæ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå› ä¸ºå®ƒåªèƒ½åœ¨æ ˆé¡¶æ·»åŠ æˆ–åˆ é™¤ï¼Œè¿™æ ·çš„æ“ä½œå¾ˆå¿«ï¼Œå®ƒæ˜¯è¢«ç§°ä¹‹ä¸ºåå…¥å…ˆå‡ºï¼ˆLIFOï¼Œlast in first outï¼‰çš„æ•°æ®ç»“æ„ã€‚å¯ä»¥å°†æ ˆæƒ³è±¡æˆä¸€å è£…èœçš„ç›˜å­ï¼Œç”¨çš„æ—¶å€™å…ˆæ‹¿æœ€ä¸Šé¢çš„ï¼Œæ´—å¥½çš„ç›˜å­åˆä¼šæ”¾åˆ°æœ€ä¸Šé¢</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ ˆæ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå› ä¸ºå®ƒåªèƒ½åœ¨æ ˆé¡¶æ·»åŠ æˆ–åˆ é™¤ï¼Œè¿™æ ·çš„æ“ä½œå¾ˆå¿«ï¼Œå®ƒæ˜¯è¢«ç§°ä¹‹ä¸ºåå…¥å…ˆå‡ºï¼ˆLIFOï¼Œlast in first outï¼‰çš„æ•°æ®ç»“æ„ã€‚å¯ä»¥å°†æ ˆæƒ³è±¡æˆä¸€å è£…èœçš„ç›˜å­ï¼Œç”¨çš„æ—¶å€™å…ˆæ‹¿æœ€ä¸Šé¢çš„ï¼Œæ´—å¥½çš„ç›˜å­åˆä¼šæ”¾åˆ°æœ€ä¸Šé¢ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>ç”¨ TypeScript å®ç°æ ˆ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Stack &#123;</span><br><span class="line">  top: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  data: <span class="built_in">Array</span>&lt;<span class="built_in">any</span>&gt; = []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> length() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.top</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å‘æ ˆä¸­å‹å…¥ä¸€ä¸ªæ–°å…ƒç´ </span></span><br><span class="line">  push(element: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.data.push(element)</span><br><span class="line">    <span class="keyword">this</span>.top += <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›æ ˆé¡¶å…ƒç´ , åŒæ—¶å°† top å€¼å‡ 1</span></span><br><span class="line">  pop() &#123;</span><br><span class="line">    <span class="keyword">this</span>.top -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data.pop()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›æ ˆé¡¶å…ƒç´ </span></span><br><span class="line">  peek() &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.data.length) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data[<span class="keyword">this</span>.top - <span class="number">1</span>]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¸…ç©ºæ ˆ</span></span><br><span class="line">  clear() &#123;</span><br><span class="line">    <span class="keyword">this</span>.top = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> stack = <span class="keyword">new</span> Stack()</span><br><span class="line"></span><br><span class="line">stack.push(<span class="string">'aaa'</span>)</span><br><span class="line">stack.push(<span class="string">'bbb'</span>)</span><br><span class="line">stack.push(<span class="string">'ccc'</span>)</span><br><span class="line">stack.push(<span class="string">'ddd'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'æ‰§è¡Œ push æ–¹æ³•å\n'</span>, stack)</span><br><span class="line"></span><br><span class="line">stack.pop()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'æ‰§è¡Œ pop æ–¹æ³•å\n'</span>, stack)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'æ‰§è¡Œ peek æ–¹æ³•åè¿”å›ï¼š'</span>, stack.peek())</span><br><span class="line"></span><br><span class="line">stack.clear()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'æ‰§è¡Œ clear æ–¹æ³•å\n'</span>, stack)</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œ push æ–¹æ³•å</span><br><span class="line"> Stack &#123; data: [ <span class="string">'aaa'</span>, <span class="string">'bbb'</span>, <span class="string">'ccc'</span>, <span class="string">'ddd'</span> ], top: <span class="number">4</span> &#125;</span><br><span class="line">æ‰§è¡Œ pop æ–¹æ³•å</span><br><span class="line"> Stack &#123; data: [ <span class="string">'aaa'</span>, <span class="string">'bbb'</span>, <span class="string">'ccc'</span> ], top: <span class="number">3</span> &#125;</span><br><span class="line">æ‰§è¡Œ peek æ–¹æ³•åè¿”å›ï¼š ccc</span><br><span class="line">æ‰§è¡Œ clear æ–¹æ³•å</span><br><span class="line"> Stack &#123; data: [ <span class="string">'aaa'</span>, <span class="string">'bbb'</span>, <span class="string">'ccc'</span> ], top: <span class="number">0</span> &#125;</span><br></pre></td></tr></table></figure><h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h2><h3 id="å°†-10-è¿›åˆ¶çš„æ•°è½¬åŒ–ä¸ºå¦ä¸€ç§è¿›åˆ¶"><a href="#å°†-10-è¿›åˆ¶çš„æ•°è½¬åŒ–ä¸ºå¦ä¸€ç§è¿›åˆ¶" class="headerlink" title="å°† 10 è¿›åˆ¶çš„æ•°è½¬åŒ–ä¸ºå¦ä¸€ç§è¿›åˆ¶"></a>å°† 10 è¿›åˆ¶çš„æ•°è½¬åŒ–ä¸ºå¦ä¸€ç§è¿›åˆ¶</h3><p>æ­¤ç®—æ³•åªé’ˆå¯¹åŸºæ•°ä¸º 2 ï½ 9 çš„æƒ…å†µ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mulBase</span>(<span class="params">num: <span class="built_in">number</span>, base: <span class="built_in">number</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> stack = <span class="keyword">new</span> Stack()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (num &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    stack.push(num % base)</span><br><span class="line">    num = <span class="built_in">Math</span>.floor((num /= base))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> converted = <span class="string">''</span></span><br><span class="line">  <span class="keyword">while</span> (stack.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    converted += stack.pop()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> converted</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'num = 2 base = 2ï¼š'</span>, mulBase(<span class="number">2</span>, <span class="number">2</span>)) <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'num = 32 base = 2ï¼š'</span>, mulBase(<span class="number">32</span>, <span class="number">2</span>)) <span class="comment">// 100000</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'num = 125 base = 8ï¼š'</span>, mulBase(<span class="number">125</span>, <span class="number">8</span>)) <span class="comment">// 175</span></span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­å›æ–‡"><a href="#åˆ¤æ–­å›æ–‡" class="headerlink" title="åˆ¤æ–­å›æ–‡"></a>åˆ¤æ–­å›æ–‡</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPalindrome</span>(<span class="params">word: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> rword = <span class="string">''</span></span><br><span class="line">  <span class="keyword">const</span> stack = <span class="keyword">new</span> Stack()</span><br><span class="line"></span><br><span class="line">  word.split(<span class="string">''</span>).forEach(<span class="function"><span class="params">w</span> =&gt;</span> stack.push(w))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (stack.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">     rword += stack.pop()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(word === rword) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'hello'</span>, isPalindrome(<span class="string">'hello'</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'bob'</span>, isPalindrome(<span class="string">'bob'</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'racecar'</span>, isPalindrome(<span class="string">'racecar'</span>));</span><br><span class="line"></span><br><span class="line">hello <span class="literal">false</span></span><br><span class="line">bob <span class="literal">true</span></span><br><span class="line">racecar <span class="literal">true</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ ˆæ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå› ä¸ºå®ƒåªèƒ½åœ¨æ ˆé¡¶æ·»åŠ æˆ–åˆ é™¤ï¼Œè¿™æ ·çš„æ“ä½œå¾ˆå¿«ï¼Œå®ƒæ˜¯è¢«ç§°ä¹‹ä¸ºåå…¥å…ˆå‡ºï¼ˆLIFOï¼Œlast in first outï¼‰çš„æ•°æ®ç»“æ„ã€‚å¯ä»¥å°†æ ˆæƒ³è±¡æˆä¸€å è£…èœçš„ç›˜å­ï¼Œç”¨çš„æ—¶å€™å…ˆæ‹¿æœ€ä¸Šé¢çš„ï¼Œæ´—å¥½çš„ç›˜å­åˆä¼šæ”¾åˆ°æœ€ä¸Šé¢&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="DSA" scheme="https://coldstone.fun/tags/DSA/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹åˆ—è¡¨</title>
    <link href="https://coldstone.fun/post/2019/08/08/datastructure-list/"/>
    <id>https://coldstone.fun/post/2019/08/08/datastructure-list/</id>
    <published>2019-08-08T14:14:05.000Z</published>
    <updated>2021-06-28T09:25:25.301Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ—è¡¨æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¦‚ä»£åŠäº‹é¡¹ï¼Œåä½³æ¦œå•ç­‰ã€‚å½“ä¸éœ€è¦åœ¨ä¸€ä¸ªå¾ˆé•¿çš„åºåˆ—ä¸­æŸ¥æ‰¾å…ƒç´ ï¼Œæˆ–è€…å¯¹å…¶æ’åºæ—¶ï¼Œåˆ—è¡¨æ˜¾å¾—å°¤å…¶æœ‰ç”¨</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åˆ—è¡¨æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¦‚ä»£åŠäº‹é¡¹ï¼Œåä½³æ¦œå•ç­‰ã€‚å½“ä¸éœ€è¦åœ¨ä¸€ä¸ªå¾ˆé•¿çš„åºåˆ—ä¸­æŸ¥æ‰¾å…ƒç´ ï¼Œæˆ–è€…å¯¹å…¶æ’åºæ—¶ï¼Œåˆ—è¡¨æ˜¾å¾—å°¤å…¶æœ‰ç”¨</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>ä½¿ç”¨ TypeScript å®ç°åˆ—è¡¨ç±»ï¼Œè¦å®ç°çš„çš„åˆ—è¡¨ç±»æ˜¯</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> List &#123;</span><br><span class="line">  pos: <span class="built_in">number</span> <span class="comment">// åˆ—è¡¨å½“å‰ä½ç½®</span></span><br><span class="line">  listSize: <span class="built_in">number</span> <span class="comment">// åˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">  data: [] <span class="comment">// åˆ—è¡¨çš„æ•°æ®å­˜å‚¨ä½ç½®</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.pos = <span class="number">0</span></span><br><span class="line">    <span class="keyword">this</span>.listSize = <span class="number">0</span></span><br><span class="line">    <span class="keyword">this</span>.data = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> length() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.listSize</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¸…ç©ºåˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">  clear() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›åˆ—è¡¨çš„å­—ç¬¦ä¸²å½¢å¼</span></span><br><span class="line">  toString() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›å½“å‰ä½ç½®çš„å…ƒç´ </span></span><br><span class="line">  getElement() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨ç°æœ‰å…ƒç´ åæ’å…¥æ–°å…ƒç´ </span></span><br><span class="line">  insert() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨åˆ—è¡¨çš„æœ«å°¾æ·»åŠ æ–°å…ƒç´ </span></span><br><span class="line">  append() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä»åˆ—è¡¨ä¸­åˆ é™¤å…ƒç´ </span></span><br><span class="line">  remove() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†åˆ—è¡¨çš„å½“å‰ä½ç½®ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">  front() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†åˆ—è¡¨çš„å½“å‰ä½ç½®ç§»åŠ¨åˆ°æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">  end() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å½“å‰ä½ç½®å‘å‰ç§»ä¸€ä½</span></span><br><span class="line">  prev() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å½“å‰ä½ç½®å‘åç§»ä¸€ä½</span></span><br><span class="line">  next() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">  hasNext() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰å‰ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">  hasPrev() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›åˆ—è¡¨çš„å½“å‰ä½ç½®</span></span><br><span class="line">  currentPos() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†åˆ—è¡¨çš„å½“å‰ä½ç½®ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®</span></span><br><span class="line">  moveTo() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†åˆ—è¡¨ç±»å®ç°å</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> List &#123;</span><br><span class="line">  pos: <span class="built_in">number</span> <span class="comment">// åˆ—è¡¨å½“å‰ä½ç½®</span></span><br><span class="line">  data: <span class="built_in">Array</span>&lt;<span class="built_in">any</span>&gt; <span class="comment">// åˆ—è¡¨çš„æ•°æ®å­˜å‚¨</span></span><br><span class="line">  listSize: <span class="built_in">number</span> <span class="comment">// åˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.pos = <span class="number">0</span></span><br><span class="line">    <span class="keyword">this</span>.listSize = <span class="number">0</span></span><br><span class="line">    <span class="keyword">this</span>.data = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›åˆ—è¡¨çš„é•¿åº¦</span></span><br><span class="line">  <span class="keyword">get</span> length() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.listSize</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›åˆ—è¡¨çš„å½“å‰ä½ç½®</span></span><br><span class="line">  <span class="keyword">get</span> currentPos() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.pos</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¸…ç©ºåˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">  clear() &#123;</span><br><span class="line">    <span class="keyword">delete</span> <span class="keyword">this</span>.data</span><br><span class="line">    <span class="keyword">this</span>.data.length = <span class="keyword">this</span>.listSize = <span class="keyword">this</span>.pos = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›åˆ—è¡¨çš„å­—ç¬¦ä¸²å½¢å¼</span></span><br><span class="line">  toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data.toString()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›å½“å‰ä½ç½®çš„å…ƒç´ </span></span><br><span class="line">  getElement() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data[<span class="keyword">this</span>.pos]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨ç°æœ‰å…ƒç´ åæ’å…¥æ–°å…ƒç´ </span></span><br><span class="line">  insert(element: <span class="built_in">any</span>, after: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> index = <span class="keyword">this</span>.findIndex(after)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.data.splice(index + <span class="number">1</span>, <span class="number">0</span>, element)</span><br><span class="line">      <span class="keyword">this</span>.listSize += <span class="number">1</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨åˆ—è¡¨çš„æœ«å°¾æ·»åŠ æ–°å…ƒç´ </span></span><br><span class="line">  append(element: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.data.push(element)</span><br><span class="line">    <span class="keyword">this</span>.listSize += <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä»åˆ—è¡¨ä¸­åˆ é™¤å…ƒç´ </span></span><br><span class="line">  remove(element: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> index = <span class="keyword">this</span>.findIndex(element)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.data.splice(index, <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">this</span>.listSize -= <span class="number">1</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­</span></span><br><span class="line">  contains(element: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data.includes(element)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†åˆ—è¡¨çš„å½“å‰ä½ç½®ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">  front() &#123;</span><br><span class="line">    <span class="keyword">this</span>.pos = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†åˆ—è¡¨çš„å½“å‰ä½ç½®ç§»åŠ¨åˆ°æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">  end() &#123;</span><br><span class="line">    <span class="keyword">this</span>.pos = <span class="keyword">this</span>.listSize - <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å½“å‰ä½ç½®å‘å‰ç§»ä¸€ä½</span></span><br><span class="line">  prev() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.pos &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.pos -= <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å½“å‰ä½ç½®å‘åç§»ä¸€ä½</span></span><br><span class="line">  next() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.pos &lt; <span class="keyword">this</span>.listSize) &#123;</span><br><span class="line">      <span class="keyword">this</span>.pos += <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">  hasNext() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.pos &lt; <span class="keyword">this</span>.listSize</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰å‰ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">  hasPrev() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.pos &gt; <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†åˆ—è¡¨çš„å½“å‰ä½ç½®ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®</span></span><br><span class="line">  moveTo(position: <span class="built_in">number</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (position &gt; <span class="number">0</span> &amp;&amp; position &lt; <span class="keyword">this</span>.listSize) &#123;</span><br><span class="line">      <span class="keyword">this</span>.pos = position</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æŸ¥æ‰¾å…ƒç´ ä½ç½®</span></span><br><span class="line">  <span class="keyword">private</span> findIndex(element: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data.findIndex(<span class="function"><span class="params">ele</span> =&gt;</span> element === ele)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list = <span class="keyword">new</span> List()</span><br><span class="line"></span><br><span class="line">list.append(<span class="string">'aaa'</span>)</span><br><span class="line">list.append(<span class="string">'bbb'</span>)</span><br><span class="line">list.append(<span class="string">'ccc'</span>)</span><br><span class="line">list.append(<span class="string">'ddd'</span>)</span><br><span class="line">list.append(<span class="string">'eee'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'list :'</span>, list)</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">list : List &#123;</span><br><span class="line">  pos: <span class="number">0</span>,</span><br><span class="line">  listSize: <span class="number">5</span>,</span><br><span class="line">  data: [ <span class="string">'aaa'</span>, <span class="string">'bbb'</span>, <span class="string">'ccc'</span>, <span class="string">'ddd'</span>, <span class="string">'eee'</span> ] &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åˆ—è¡¨æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¦‚ä»£åŠäº‹é¡¹ï¼Œåä½³æ¦œå•ç­‰ã€‚å½“ä¸éœ€è¦åœ¨ä¸€ä¸ªå¾ˆé•¿çš„åºåˆ—ä¸­æŸ¥æ‰¾å…ƒç´ ï¼Œæˆ–è€…å¯¹å…¶æ’åºæ—¶ï¼Œåˆ—è¡¨æ˜¾å¾—å°¤å…¶æœ‰ç”¨&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="DSA" scheme="https://coldstone.fun/tags/DSA/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨æœåŠ¡å™¨ä¸Šæ­å»º Npm ç§æœ</title>
    <link href="https://coldstone.fun/post/2019/08/08/create-privite-npm-server/"/>
    <id>https://coldstone.fun/post/2019/08/08/create-privite-npm-server/</id>
    <published>2019-08-08T07:33:00.000Z</published>
    <updated>2021-06-28T09:25:25.301Z</updated>
    
    <content type="html"><![CDATA[<p>éƒ¨é—¨éœ€è¦å»ºä¸€ä¸ª npm ç§æœï¼Œæˆ‘æŸ¥äº†ä¸€ä¸‹å‘ç°æœ‰ä¸€ä¸ªå¾ˆå¥½ç”¨çš„å¼€æºå·¥å…· Verdaccioï¼Œæœ‰ 3 ä¸­æ–¹å¼å¯ä»¥åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šæ­å»ºï¼Œä»¥ Centos ä¸ºä¾‹</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>éƒ¨é—¨éœ€è¦å»ºä¸€ä¸ª npm ç§æœï¼Œæˆ‘æŸ¥äº†ä¸€ä¸‹å‘ç°æœ‰ä¸€ä¸ªå¾ˆå¥½ç”¨çš„å¼€æºå·¥å…· <a href="https://github.com/verdaccio/verdaccio" target="_blank" rel="noopener">Verdaccio</a>ï¼Œæœ‰ 3 ä¸­æ–¹å¼å¯ä»¥åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šæ­å»ºï¼Œä»¥ Centos ä¸ºä¾‹</p><h2 id="ä½¿ç”¨-Node-js-ç¯å¢ƒ"><a href="#ä½¿ç”¨-Node-js-ç¯å¢ƒ" class="headerlink" title="ä½¿ç”¨ Node.js ç¯å¢ƒ"></a>ä½¿ç”¨ Node.js ç¯å¢ƒ</h2><p>é¦–å…ˆéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… node ç¯å¢ƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sL https://rpm.nodesource.com/setup_10.x | sudo bash -</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install nodejs</span><br></pre></td></tr></table></figure><p>å®‰è£…åæ£€æŸ¥ node æ˜¯å¦æ­£ç¡®å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure><p>ç„¶åå®‰è£… Verdaccio</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g verdaccio</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆå°±å¯ä»¥ä½¿ç”¨äº†ï¼Œ å¦‚æœä½¿ç”¨çš„æ˜¯ root ç”¨æˆ·ä¼šæç¤ºä½ ä¸è¦ä½¿ç”¨ root è´¦æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">verdaccio</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·é€€å‡ºåæœåŠ¡å°±åœæ­¢äº†ï¼Œæ‰€ä»¥éœ€è¦ pm2 è¿›è¡Œå¯åŠ¨</p><p>å…¨å±€å®‰è£… pm2</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g pm2</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ pm2 å¯åŠ¨ Verdaccio</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 start verdaccio</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-Docker"><a href="#ä½¿ç”¨-Docker" class="headerlink" title="ä½¿ç”¨ Docker"></a>ä½¿ç”¨ Docker</h2><p>é¦–å…ˆéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… Dockerï¼Œæœ‰äº† Docker ä¹‹åå°±å¾ˆç®€å•äº†</p><p>æ‹‰å–é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull verdaccio/verdaccio</span><br></pre></td></tr></table></figure><p>è¿è¡Œå®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --rm --name verdaccio -p 4873:4873 verdaccio/verdaccio</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-Cloudron"><a href="#ä½¿ç”¨-Cloudron" class="headerlink" title="ä½¿ç”¨ Cloudron"></a>ä½¿ç”¨ Cloudron</h2><p>è¿™ç§æ–¹å¼æ²¡è¯•è¿‡ï¼Œå› ä¸ºä¸Šé¢ä¸¤ç§å·²ç»å¾ˆæ–¹ä¾¿äº†</p><p>é“¾æ¥ <a href="https://cloudron.io/button/org.eggertsson.verdaccio.html" target="_blank" rel="noopener">https://cloudron.io/button/org.eggertsson.verdaccio.html</a></p><h2 id="è®¿é—®"><a href="#è®¿é—®" class="headerlink" title="è®¿é—®"></a>è®¿é—®</h2><p>ç§æœå®‰è£…å®Œæˆåå¯ä»¥é€šè¿‡ ip åœ°å€+ç«¯å£å·çš„å½¢å¼è®¿é—®äº† xxx.xxx.xxx.xxx:4873</p><p>è¦ç”¨åŸŸåè®¿é—®çš„è¯å°±éœ€è¦å°†è‡ªå·±çš„åŸŸåè§£æåˆ°æœåŠ¡å™¨ä¸Šå»</p><h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><p><a href="https://verdaccio.org/docs/en/installation" target="_blank" rel="noopener">https://verdaccio.org/docs/en/installation</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;éƒ¨é—¨éœ€è¦å»ºä¸€ä¸ª npm ç§æœï¼Œæˆ‘æŸ¥äº†ä¸€ä¸‹å‘ç°æœ‰ä¸€ä¸ªå¾ˆå¥½ç”¨çš„å¼€æºå·¥å…· Verdaccioï¼Œæœ‰ 3 ä¸­æ–¹å¼å¯ä»¥åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šæ­å»ºï¼Œä»¥ Centos ä¸ºä¾‹&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Node" scheme="https://coldstone.fun/tags/Node/"/>
    
      <category term="Docker" scheme="https://coldstone.fun/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ Centos ä¸­å®‰è£… Java8</title>
    <link href="https://coldstone.fun/post/2019/08/01/centos-install-java8/"/>
    <id>https://coldstone.fun/post/2019/08/01/centos-install-java8/</id>
    <published>2019-08-01T10:56:29.000Z</published>
    <updated>2021-06-28T09:25:25.301Z</updated>
    
    <content type="html"><![CDATA[<p>ç”±äºè¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… Jenkins æ‰€ä»¥é¦–å…ˆè¦å®‰è£… java</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç”±äºè¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… <a href="https://jenkins.io/zh/" target="_blank" rel="noopener">Jenkins</a> æ‰€ä»¥é¦–å…ˆè¦å®‰è£… javaã€‚</p><h2 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h2><p>å®‰è£…ä¹‹å‰æœ€å¥½æ›´æ–°ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y update</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…-Java8"><a href="#å®‰è£…-Java8" class="headerlink" title="å®‰è£… Java8"></a>å®‰è£… Java8</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install java-1.8.0-openjdk</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹ç‰ˆæœ¬"><a href="#æŸ¥çœ‹ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹ç‰ˆæœ¬"></a>æŸ¥çœ‹ç‰ˆæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure><h2 id="è®¾ç½®ç¯å¢ƒå˜é‡-JAVA-HOME"><a href="#è®¾ç½®ç¯å¢ƒå˜é‡-JAVA-HOME" class="headerlink" title="è®¾ç½®ç¯å¢ƒå˜é‡ JAVA_HOME"></a>è®¾ç½®ç¯å¢ƒå˜é‡ JAVA_HOME</h2><p>é¦–å…ˆæ‰¾åˆ°å®‰è£… java çš„ä½ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update-alternatives --config java</span><br></pre></td></tr></table></figure><p>ç¼–è¾‘ .bash_profile æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim .bash_profile</span><br></pre></td></tr></table></figure><p>æ·»åŠ è¿™ä¸€è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.191.b12-1.el7_6.x86_64/jre/bin/java</span><br></pre></td></tr></table></figure><p>é‡æ–°æ‰§è¡Œåˆšä¿®æ”¹çš„ .bash_profile</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> .bash_profile</span><br></pre></td></tr></table></figure><h2 id="éªŒè¯ä¸€ä¸‹"><a href="#éªŒè¯ä¸€ä¸‹" class="headerlink" title="éªŒè¯ä¸€ä¸‹"></a>éªŒè¯ä¸€ä¸‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$JAVA_HOME</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç”±äºè¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… Jenkins æ‰€ä»¥é¦–å…ˆè¦å®‰è£… java&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Centos" scheme="https://coldstone.fun/tags/Centos/"/>
    
      <category term="Java" scheme="https://coldstone.fun/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>ç†è§£ Flutter åº”ç”¨å’Œéƒ¨ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</title>
    <link href="https://coldstone.fun/post/2019/07/28/understand-flutter-lifecycle/"/>
    <id>https://coldstone.fun/post/2019/07/28/understand-flutter-lifecycle/</id>
    <published>2019-07-28T05:21:03.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ Flutter é‡Œé¢éƒ¨ä»¶ä»¥åŠåº”ç”¨æœ¬èº«éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œæœ¬æ–‡åˆ†åˆ«è¯´æ˜å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸ</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ Flutter é‡Œé¢éƒ¨ä»¶ä»¥åŠåº”ç”¨æœ¬èº«éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œæœ¬æ–‡åˆ†åˆ«è¯´æ˜å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸ</p><h2 id="éƒ¨ä»¶"><a href="#éƒ¨ä»¶" class="headerlink" title="éƒ¨ä»¶"></a>éƒ¨ä»¶</h2><p>åœ¨ Flutter é‡Œé¢æœ‰ä¸¤ç§éƒ¨ä»¶ StatefulWidget å’Œ StatelessWidgetï¼Œå®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸåˆ†åˆ«æ˜¯</p><h3 id="StatelessWidget"><a href="#StatelessWidget" class="headerlink" title="StatelessWidget"></a>StatelessWidget</h3><p>æ— çŠ¶æ€éƒ¨ä»¶çš„ç”Ÿå‘½å‘¨æœŸå¾ˆç®€å•ï¼Œé¦–å…ˆæ‰§è¡Œæ„é€ å‡½æ•°ç„¶åå°±æ‰§è¡Œ build æ–¹æ³•äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Constructor Function</span><br><span class="line"></span><br><span class="line">build()</span><br></pre></td></tr></table></figure><h3 id="StatefulWidget"><a href="#StatefulWidget" class="headerlink" title="StatefulWidget"></a>StatefulWidget</h3><p>æœ‰çŠ¶æ€éƒ¨ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¼šå¤æ‚ä¸€äº›ï¼Œå› ä¸ºæ˜¯å¤šäº†çŠ¶æ€å˜åŒ–ã€‚é¦–å…ˆæ˜¯æ„é€ å‡½æ•°ï¼Œç„¶åä¼šåˆå§‹åŒ– State åœ¨æ‰§è¡Œ build æ–¹æ³•ï¼Œå¦‚æœæ‰§è¡Œäº† setState æ–¹æ³•ï¼Œå°±è¦æ£€æŸ¥éƒ¨ä»¶æ˜¯å¦æ›´æ–°ï¼Œåœ¨æ‰§è¡Œ buildï¼Œæœ€åéƒ¨ä»¶é”€æ¯çš„æ—¶å€™æ‰§è¡Œ dispose æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Constructor Function</span><br><span class="line"></span><br><span class="line">initState()</span><br><span class="line"></span><br><span class="line">build()</span><br><span class="line"></span><br><span class="line">setState()</span><br><span class="line"></span><br><span class="line">didUpdateWidget()</span><br><span class="line"></span><br><span class="line">build()</span><br><span class="line"></span><br><span class="line">dispose()</span><br></pre></td></tr></table></figure><h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h2><p>Flutter åº”ç”¨æœ¬èº«ä¹Ÿæœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¦è§‚å¯Ÿåˆ°è¿™äº›çŠ¶æ€çš„å˜åŒ–éœ€è¦è®©ä¸€ä¸ªæœ‰çŠ¶æ€éƒ¨ä»¶æ··å…¥ <code>WidgetsBindingObserver</code>ï¼Œç„¶ååœ¨ <code>initState</code> æ–¹æ³•ä¸­åˆ›å»ºä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œå½“ç„¶éƒ¨ä»¶é”€æ¯çš„æ—¶å€™éœ€è¦æŠŠåˆ›å»ºçš„è§‚å¯Ÿè€…å®ç°æ¸…é™¤</p><ul><li><p>inactive åº”ç”¨å¤„äºéæ´»åŠ¨çŠ¶æ€ï¼Œå¹¶ä¸”æœªæ¥æ”¶ç”¨æˆ·è¾“å…¥</p></li><li><p>paused åº”ç”¨å½“å‰å¯¹ç”¨æˆ·ä¸å¯è§ï¼Œä¸å“åº”ç”¨æˆ·è¾“å…¥ï¼Œå¹¶åœ¨åå°è¿è¡Œ</p></li><li><p>resumed åº”ç”¨å¯è§å¹¶å“åº”ç”¨æˆ·è¾“å…¥</p></li><li><p>suspending åº”ç”¨é€€å‡ºäº†</p></li></ul><p>ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return MaterialApp(</span><br><span class="line">      title: &#39;Flutter Lifecycle&#39;,</span><br><span class="line">      home: MyHomePage(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyHomePage extends StatefulWidget &#123;</span><br><span class="line">  @override</span><br><span class="line">  _MyHomePageState createState() &#x3D;&gt; _MyHomePageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class _MyHomePageState extends State&lt;MyHomePage&gt; with WidgetsBindingObserver &#123;</span><br><span class="line">  @override</span><br><span class="line">  void initState() &#123;</span><br><span class="line">    WidgetsBinding.instance.addObserver(this);</span><br><span class="line">    super.initState();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  void didChangeAppLifecycleState(AppLifecycleState state) &#123;</span><br><span class="line">print(state);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  void dispose() &#123;</span><br><span class="line">    WidgetsBinding.instance.removeObserver(this);</span><br><span class="line">    super.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return Scaffold();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨ Flutter åº”ç”¨é‡Œé¢è¿™äº›ç”Ÿå‘½å‘¨æœŸè¿˜æ˜¯æŒºç®€å•æ˜“æ‡‚çš„</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ Flutter é‡Œé¢éƒ¨ä»¶ä»¥åŠåº”ç”¨æœ¬èº«éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œæœ¬æ–‡åˆ†åˆ«è¯´æ˜å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸ&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>å¯¹äº Workbox Strategieså‡ ç§ç­–ç•¥çš„è§£é‡Š</title>
    <link href="https://coldstone.fun/post/2019/07/26/about-workbox-strategies/"/>
    <id>https://coldstone.fun/post/2019/07/26/about-workbox-strategies/</id>
    <published>2019-07-26T20:36:13.000Z</published>
    <updated>2021-06-28T09:25:25.301Z</updated>
    
    <content type="html"><![CDATA[<p>è¦å°†è‡ªå·±çš„ç½‘ç«™æ”¯æŒ PWAï¼Œéœ€è¦æ³¨å†Œä¸€ä¸ª serviceWorker åˆ°æµè§ˆå™¨ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ Google çš„ Workbox å·¥å…·ï¼ŒWorkbox å¯ä»¥åœ¨æµè§ˆå™¨è¯·æ±‚èµ„æºçš„æ—¶å€™æä¾›äº†å‡ ç§ä¸åŒçš„ç­–ç•¥å¯¹è¯·æ±‚å“åº”ï¼Œæœ¬æ–‡å¯¹å‡ ç§ç­–ç•¥è¿›è¡Œè¯´æ˜</p><a id="more"></a><p>è¦å°†è‡ªå·±çš„ç½‘ç«™æ”¯æŒ PWAï¼Œéœ€è¦æ³¨å†Œä¸€ä¸ª serviceWorker åˆ°æµè§ˆå™¨ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ Google çš„ <a href="https://developers.google.com/web/tools/workbox/" target="_blank" rel="noopener">Workbox</a> å·¥å…·ï¼ŒWorkbox å¯ä»¥åœ¨æµè§ˆå™¨è¯·æ±‚èµ„æºçš„æ—¶å€™æä¾›äº†å‡ ç§ä¸åŒçš„ç­–ç•¥å¯¹è¯·æ±‚å“åº”ï¼Œæœ¬æ–‡å¯¹å‡ ç§ç­–ç•¥è¿›è¡Œè¯´æ˜ã€‚</p><h2 id="StaleWhileRevalidate"><a href="#StaleWhileRevalidate" class="headerlink" title="StaleWhileRevalidate"></a>StaleWhileRevalidate</h2><p>StaleWhileRevalidate æ¨¡å¼å…è®¸æ‚¨ä½¿ç”¨ç¼“å­˜çš„å“åº”å°½å¿«å“åº”è¯·æ±‚ï¼Œå¦‚æœæœªç¼“å­˜ï¼Œåˆ™è¿”å›åˆ°ç½‘ç»œè¯·æ±‚ï¼Œç„¶åï¼Œç”¨ç½‘ç»œè¯·æ±‚æ›´æ–°ç¼“å­˜ã€‚</p><p><img src="https://developers.google.com/web/tools/workbox/images/modules/workbox-strategies/stale-while-revalidate.png" alt="StaleWhileRevalidate"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">workbox.routing.registerRoute(</span><br><span class="line">  /\.(?:js|css)$/,</span><br><span class="line">  <span class="keyword">new</span> workbox.strategies.StaleWhileRevalidate(&#123;</span><br><span class="line">    cacheName: <span class="string">'static'</span></span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="CacheFirst"><a href="#CacheFirst" class="headerlink" title="CacheFirst"></a>CacheFirst</h2><p>å¦‚æœç¼“å­˜ä¸­å­˜åœ¨å“åº”ï¼Œåˆ™å°†ä½¿ç”¨ç¼“å­˜çš„å“åº”æ¥å®Œæˆè¯·æ±‚ï¼Œå¹¶ä¸”æ ¹æœ¬ä¸ä¼šä½¿ç”¨ç½‘ç»œã€‚ å¦‚æœæ²¡æœ‰ç¼“å­˜çš„å“åº”ï¼Œåˆ™å°†é€šè¿‡ç½‘ç»œè¯·æ±‚æ¥æ»¡è¶³è¯·æ±‚ï¼Œå¹¶ä¸”å°†ç¼“å­˜å“åº”ï¼Œä»¥ä¾¿ç›´æ¥ä»ç¼“å­˜æä¾›ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚</p><p><img src="https://developers.google.com/web/tools/workbox/images/modules/workbox-strategies/cache-first.png" alt="CacheFirst"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">workbox.routing.registerRoute(</span><br><span class="line">  /\.(?:js|css)$/,</span><br><span class="line">  <span class="keyword">new</span> workbox.strategies.CacheFirst(&#123;</span><br><span class="line">    cacheName: <span class="string">'static'</span></span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="NetworkFirst"><a href="#NetworkFirst" class="headerlink" title="NetworkFirst"></a>NetworkFirst</h2><p>å¯¹äºé¢‘ç¹æ›´æ–°çš„è¯·æ±‚ï¼Œç½‘ç»œä¼˜å…ˆç­–ç•¥æ˜¯ç†æƒ³çš„è§£å†³æ–¹æ¡ˆã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†å°è¯•ä»ç½‘ç»œè·å–æœ€æ–°å“åº”ï¼Œå¦‚æœè¯·æ±‚æˆåŠŸï¼Œå®ƒä¼šå°†å“åº”æ”¾å…¥ç¼“å­˜ä¸­ã€‚ å¦‚æœç½‘ç»œæ— æ³•è¿”å›å“åº”ï¼Œåˆ™å°†ä½¿ç”¨ç¼“å­˜çš„å“åº”ã€‚</p><p><img src="https://developers.google.com/web/tools/workbox/images/modules/workbox-strategies/network-first.png" alt="NetworkFirst"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">workbox.routing.registerRoute(</span><br><span class="line">  /\.(?:js|css)$/,</span><br><span class="line">  <span class="keyword">new</span> workbox.strategies.NetworkFirst(&#123;</span><br><span class="line">    cacheName: <span class="string">'static'</span></span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="NetworkOnly"><a href="#NetworkOnly" class="headerlink" title="NetworkOnly"></a>NetworkOnly</h2><p>ä»…ä½¿ç”¨ç½‘ç»œå“åº”è¯·æ±‚ã€‚</p><p><img src="https://developers.google.com/web/tools/workbox/images/modules/workbox-strategies/network-only.png" alt="NetworkOnly"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">workbox.routing.registerRoute(</span><br><span class="line">  /\.(?:js|css)$/,</span><br><span class="line">  <span class="keyword">new</span> workbox.strategies.NetworkOnly(&#123;</span><br><span class="line">    cacheName: <span class="string">'static'</span></span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="CacheOnly"><a href="#CacheOnly" class="headerlink" title="CacheOnly"></a>CacheOnly</h2><p>ä»…ä½¿ç”¨ç¼“å­˜å“åº”è¯·æ±‚ã€‚ä¸å¸¸è§ï¼Œä½†å¦‚æœæ‚¨æœ‰è‡ªå·±çš„é¢„å…ˆç¼“å­˜æ­¥éª¤ï¼Œåˆ™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚</p><p><img src="https://developers.google.com/web/tools/workbox/images/modules/workbox-strategies/cache-only.png" alt="CacheOnly"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">workbox.routing.registerRoute(</span><br><span class="line">  /\.(?:js|css)$/,</span><br><span class="line">  <span class="keyword">new</span> workbox.strategies.CacheOnly(&#123;</span><br><span class="line">    cacheName: <span class="string">'static'</span></span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://developers.google.com/web/tools/workbox/modules/workbox-strategies" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¦å°†è‡ªå·±çš„ç½‘ç«™æ”¯æŒ PWAï¼Œéœ€è¦æ³¨å†Œä¸€ä¸ª serviceWorker åˆ°æµè§ˆå™¨ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ Google çš„ Workbox å·¥å…·ï¼ŒWorkbox å¯ä»¥åœ¨æµè§ˆå™¨è¯·æ±‚èµ„æºçš„æ—¶å€™æä¾›äº†å‡ ç§ä¸åŒçš„ç­–ç•¥å¯¹è¯·æ±‚å“åº”ï¼Œæœ¬æ–‡å¯¹å‡ ç§ç­–ç•¥è¿›è¡Œè¯´æ˜&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Workbox" scheme="https://coldstone.fun/tags/Workbox/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Travis CI éƒ¨ç½² Hugo åšå®¢åˆ° Github Pages</title>
    <link href="https://coldstone.fun/post/2019/07/26/hugo-travis-github-page/"/>
    <id>https://coldstone.fun/post/2019/07/26/hugo-travis-github-page/</id>
    <published>2019-07-26T12:58:25.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>åŸæœ¬ä½¿ç”¨çš„æ˜¯ Netlify å»éƒ¨ç½²åšå®¢çš„ï¼ŒåŸŸåè§£æä¹Ÿæ˜¯é€šè¿‡ Netlify çš„ DNS æœåŠ¡å™¨ï¼Œä½†æ˜¯å‘ç°åšå®¢åœ¨åˆ«äººçš„ç”µè„‘ä¸Šæ‰“ä¸å¼€â€¦</p><a id="more"></a><p>åŸæœ¬ä½¿ç”¨çš„æ˜¯ Netlify å»éƒ¨ç½²åšå®¢çš„ï¼ŒåŸŸåè§£æä¹Ÿæ˜¯é€šè¿‡ Netlify çš„ DNS æœåŠ¡å™¨ï¼Œä½†æ˜¯å‘ç°åšå®¢åœ¨åˆ«äººçš„ç”µè„‘ä¸Šæ‰“ä¸å¼€â€¦å‘ç°æ˜¯åŸŸåè§£æçš„é—®é¢˜ï¼Œæ‰€ä»¥å°±æŠŠåšå®¢æ”¾åˆ° Github Pages ä¸Šäº†ï¼Œä½†æ˜¯è¿™æ ·å°±å¤±å»äº† Netlify æä¾›çš„è‡ªåŠ¨æ„å»ºå’Œéƒ¨ç½²çš„èƒ½åŠ›ï¼Œéœ€è¦è‡ªå·±å»é…ç½® Travis CI å®ç°è‡ªåŠ¨éƒ¨ç½²äº†ã€‚</p><h2 id="é¢„å…ˆè¦æ±‚"><a href="#é¢„å…ˆè¦æ±‚" class="headerlink" title="é¢„å…ˆè¦æ±‚"></a>é¢„å…ˆè¦æ±‚</h2><ul><li>æœ¬åœ°å®‰è£…äº† <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></li><li>ä¸€ä¸ª <a href="https://github.com/" target="_blank" rel="noopener">Github</a> è´¦å·</li><li>ä½¿ç”¨ Github è´¦å·ç™»å½• <a href="https://travis-ci.org" target="_blank" rel="noopener">Travis</a></li></ul><h2 id="åˆ›å»ºåšå®¢"><a href="#åˆ›å»ºåšå®¢" class="headerlink" title="åˆ›å»ºåšå®¢"></a>åˆ›å»ºåšå®¢</h2><p>ä½¿ç”¨ Hugo å‘½ä»¤è¡Œå·¥å…·æ–°å»ºè‡ªå·±çš„åšå®¢ï¼Œå°†ä»£ç æ¨é€åˆ°è‡ªå·±çš„ Github ä»“åº“</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hugo new site my-blog</span><br><span class="line">...</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><h2 id="æ–°å»ºä¸€ä¸ª-Github-Personal-access-token"><a href="#æ–°å»ºä¸€ä¸ª-Github-Personal-access-token" class="headerlink" title="æ–°å»ºä¸€ä¸ª Github Personal access token"></a>æ–°å»ºä¸€ä¸ª Github Personal access token</h2><p>åœ¨ <a href="https://github.com/settings/tokens" target="_blank" rel="noopener">https://github.com/settings/tokens</a> æ–°å»ºä¸€ä¸ª Personal access token ç”¨æ¥å‘å¸ƒåšå®¢åˆ° Github Pages æ—¶è¿›è¡ŒéªŒè¯ï¼Œå¤åˆ¶ç”Ÿæˆçš„ tokenï¼Œä¸è¦åˆ·æ–°æˆ–ç¦»å¼€å½“å‰é¡µé¢ï¼Œå¦åˆ™ token å°±çœ‹ä¸è§äº†ï¼Œåªèƒ½é‡æ–°ç”Ÿæˆ</p><p><img src="/images/github-token.jpg" alt="token"></p><p>ç™»å½•åˆ° <a href="https://travis-ci.org" target="_blank" rel="noopener">Travis CI</a> å¯¹é¡¹ç›®è¿›è¡Œå…³è” <a href="https://travis-ci.org/account/repositories" target="_blank" rel="noopener">https://travis-ci.org/account/repositories</a></p><p>å®Œæˆåè¿›å…¥è®¾ç½®ç•Œé¢ <code>https://travis-ci.org/your-gihub-user-name/your-gihub-repo/settings</code></p><p>åœ¨ Environment Variables å¡«å†™ GITHUB_TOKEN å˜é‡ï¼Œç‚¹å‡» Add æŒ‰é’®ï¼Œè¿™æ ·ä½ çš„ç¯å¢ƒå˜é‡å°±æ·»åŠ å®Œæˆäº†</p><h2 id="é…ç½®-travis-yml"><a href="#é…ç½®-travis-yml" class="headerlink" title="é…ç½® .travis.yml"></a>é…ç½® .travis.yml</h2><p>å› ä¸º Hugo æ˜¯ç”¨ GO è¯­è¨€å†™çš„ï¼Œæ‰€ä»¥è¦é…ç½® GO ç¼–è¯‘ç¯å¢ƒï¼Œåœ¨ before_script é‡Œåˆ é™¤äº† public æ–‡ä»¶å¤¹ï¼Œå¦‚æœæœ‰è‡ªå®šä¹‰åŸŸåï¼Œå°†è‡ªå®šä¹‰åŸŸåè¾“å‡ºåˆ°æ„å»ºå‡ºæ¥çš„ CNAME æ–‡ä»¶é‡Œé¢å»ï¼Œè®°å¾—æ·»åŠ  DNS è§£æè®°å½•åˆ° Gihub å» <a href="https://help.github.com/cn/articles/using-a-custom-domain-with-github-pages" target="_blank" rel="noopener">å‚è€ƒ</a></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">language: go</span><br><span class="line"></span><br><span class="line">dist: trusty</span><br><span class="line"></span><br><span class="line">sudo: false</span><br><span class="line"></span><br><span class="line">env:</span><br><span class="line">  - HUGO_VERSION=0.56.0</span><br><span class="line"></span><br><span class="line">install: true</span><br><span class="line"></span><br><span class="line">before_script:</span><br><span class="line">  - wget https://github.com/gohugoio/hugo/releases/download/v$&#123;HUGO_VERSION&#125;/hugo_$&#123;HUGO_VERSION&#125;_Linux-64bit.deb</span><br><span class="line">  - sudo dpkg -i hugo_$&#123;HUGO_VERSION&#125;_Linux-64bit.deb</span><br><span class="line">  - rm -rf public || exit 0</span><br><span class="line"></span><br><span class="line">script:</span><br><span class="line">  - hugo -v --gc --minify</span><br><span class="line">  - echo 'your-custom-domain.com' &gt; public/CNAME</span><br><span class="line"></span><br><span class="line">deploy:</span><br><span class="line">  provider: pages</span><br><span class="line">  local-dir: public</span><br><span class="line">  skip-cleanup: true</span><br><span class="line">  github-token: $GITHUB_TOKEN</span><br><span class="line">  keep-history: true</span><br><span class="line">  on:</span><br><span class="line">    branch: master</span><br><span class="line"></span><br><span class="line">branches:</span><br><span class="line">  only:</span><br><span class="line">  - master</span><br></pre></td></tr></table></figure><h2 id="æäº¤è§¦å‘æ„å»º"><a href="#æäº¤è§¦å‘æ„å»º" class="headerlink" title="æäº¤è§¦å‘æ„å»º"></a>æäº¤è§¦å‘æ„å»º</h2><p>æœ€åæ–°å»ºä¸€ç¯‡æ–‡ç« ï¼Œpush åˆ° Github ä»“åº“ï¼Œè§¦å‘ Travis æ„å»ºå°±å¯ä»¥äº†ï¼Œä»¥ååšå®¢è¿›è¡Œæ›´æ–°åå°±å¯ä»¥è‡ªåŠ¨æ„å»ºå‘å¸ƒäº†ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hugo new posts/my-first-post.md</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åŸæœ¬ä½¿ç”¨çš„æ˜¯ Netlify å»éƒ¨ç½²åšå®¢çš„ï¼ŒåŸŸåè§£æä¹Ÿæ˜¯é€šè¿‡ Netlify çš„ DNS æœåŠ¡å™¨ï¼Œä½†æ˜¯å‘ç°åšå®¢åœ¨åˆ«äººçš„ç”µè„‘ä¸Šæ‰“ä¸å¼€â€¦&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Hugo" scheme="https://coldstone.fun/tags/Hugo/"/>
    
  </entry>
  
  <entry>
    <title>å¯¹äº PWA åº”ç”¨çš„ manifest.json æ–‡ä»¶çš„è§£é‡Š</title>
    <link href="https://coldstone.fun/post/2019/07/24/about-manifest/"/>
    <id>https://coldstone.fun/post/2019/07/24/about-manifest/</id>
    <published>2019-07-24T21:31:51.000Z</published>
    <updated>2021-06-28T09:25:25.301Z</updated>
    
    <content type="html"><![CDATA[<p>ç½‘ç«™è¦æ”¯æŒ PWAï¼Œéœ€è¦ä¸€ä¸ª <code>manifest.json</code> æ–‡ä»¶ï¼ŒW3C Web App Manifest çš„è‰æ¡ˆä¸Šå®šä¹‰äº†ä»¥ä¸‹çš„å­—æ®µï¼Œè§£é‡Šä¸€ä¸‹æ¯ä¸ªå­—æ®µæ˜¯ä»€ä¹ˆæ„æ€ã€‚</p><a id="more"></a><p>ç½‘ç«™è¦æ”¯æŒ PWAï¼Œéœ€è¦ä¸€ä¸ª <code>manifest.json</code> æ–‡ä»¶ï¼ŒW3C Web App Manifest çš„è‰æ¡ˆä¸Šå®šä¹‰äº†ä»¥ä¸‹çš„å­—æ®µï¼Œè§£é‡Šä¸€ä¸‹æ¯ä¸ªå­—æ®µæ˜¯ä»€ä¹ˆæ„æ€ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">dictionary WebAppManifest &#123;</span><br><span class="line">   TextDirectionType dir = <span class="string">"auto"</span>;</span><br><span class="line">   DOMString lang;</span><br><span class="line">   USVString name;</span><br><span class="line">   USVString short_name;</span><br><span class="line">   USVString description;</span><br><span class="line">   sequence&lt;ImageResource&gt; icons;</span><br><span class="line">   sequence&lt;ImageResource&gt; screenshots;</span><br><span class="line">   sequence&lt;USVString&gt; categories;</span><br><span class="line">   DOMString iarc_rating_id;</span><br><span class="line">   USVString start_url;</span><br><span class="line">   DisplayModeType display = <span class="string">"browser"</span>;</span><br><span class="line">   OrientationLockType orientation;</span><br><span class="line">   USVString theme_color;</span><br><span class="line">   USVString background_color;</span><br><span class="line">   USVString scope;</span><br><span class="line">   ServiceWorkerRegistrationObject serviceworker;</span><br><span class="line">   sequence&lt;ExternalApplicationResource&gt; related_applications;</span><br><span class="line">   boolean prefer_related_applications = <span class="string">"false"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">dictionary ImageResource &#123;</span><br><span class="line">  required USVString src;</span><br><span class="line">  DOMString sizes;</span><br><span class="line">  USVString type;</span><br><span class="line">  USVString purpose;</span><br><span class="line">  USVString platform;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">dictionary ServiceWorkerRegistrationObject &#123;</span><br><span class="line">  required USVString src;</span><br><span class="line">  USVString scope;</span><br><span class="line">  WorkerType type = <span class="string">"classic"</span>;</span><br><span class="line">  ServiceWorkerUpdateViaCache update_via_cache = <span class="string">"imports"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">dictionary ExternalApplicationResource &#123;</span><br><span class="line">  required USVString platform;</span><br><span class="line">  USVString url;</span><br><span class="line">  DOMString id;</span><br><span class="line">  USVString min_version;</span><br><span class="line">  sequence&lt;Fingerprint&gt; fingerprints;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>dir</strong> æŒ‡å®šäº† manifest ä¸­å…·æœ‰æ–¹å‘æ€§çš„æˆå‘˜çš„åŸºæœ¬æ–¹å‘ï¼Œå¯ä»¥è®¾ç½® <code>ltr</code> å·¦è‡³å³, <code>rtl</code> å³è‡³å·¦, <code>auto</code> æ²¡æœ‰æ˜ç¡®æ–¹å‘ã€‚</p><p><strong>lang</strong> æŒ‡å®š manifest ä¸­å…·æœ‰æ–¹å‘æ€§æˆå‘˜çš„å€¼çš„ä¸»è¦è¯­è¨€ï¼ˆå› ä¸ºçŸ¥é“è¯­è¨€ä¹Ÿå¯ä»¥å¸®åŠ©æ–¹å‘æ€§ï¼‰ã€‚</p><p><strong>name</strong> è¡¨ç¤ºåº”ç”¨çš„åç§°ã€‚</p><p><strong>short_name</strong> è¡¨ç¤º Web åº”ç”¨ç¨‹åºåç§°çš„ç®€çŸ­ç‰ˆæœ¬ï¼Œç”¨äºæ²¡æœ‰è¶³å¤Ÿç©ºé—´æ¥æ˜¾ç¤º Web åº”ç”¨ç¨‹åºçš„å…¨åçš„åœ°æ–¹ã€‚</p><p><strong>description</strong> æè¿° Web åº”ç”¨ç¨‹åºçš„ç›®çš„ã€‚</p><p><strong>scope</strong> è¡¨ç¤º Web åº”ç”¨ç¨‹åºå¯¼èˆªèŒƒå›´ã€‚</p><p><strong>icons</strong> icons æ˜¯ ImageResources çš„æ•°ç»„ï¼Œå¯ä»¥åœ¨å„ç§æƒ…å†µä¸‹å……å½“ Web åº”ç”¨ç¨‹åºçš„å›¾æ ‡è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œå®ƒä»¬å¯ç”¨äºåœ¨å…¶ä»–åº”ç”¨ç¨‹åºåˆ—è¡¨ä¸­è¡¨ç¤º Web åº”ç”¨ç¨‹åºï¼Œæˆ–è€…å°† Web åº”ç”¨ç¨‹åºä¸ OS çš„ä»»åŠ¡åˆ‡æ¢å™¨å’Œ/æˆ–ç³»ç»Ÿé¦–é€‰é¡¹é›†æˆã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"icons"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"src"</span>: <span class="string">"icon/lowres.webp"</span>,</span><br><span class="line">      <span class="attr">"sizes"</span>: <span class="string">"48x48"</span>,</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"image/webp"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"src"</span>: <span class="string">"icon/lowres"</span>,</span><br><span class="line">      <span class="attr">"sizes"</span>: <span class="string">"48x48"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"src"</span>: <span class="string">"icon/hd_hi.ico"</span>,</span><br><span class="line">      <span class="attr">"sizes"</span>: <span class="string">"72x72 96x96 128x128 256x256"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"src"</span>: <span class="string">"icon/hd_hi.svg"</span>,</span><br><span class="line">      <span class="attr">"sizes"</span>: <span class="string">"257x257"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>display</strong> å…¶å€¼æ˜¯ DisplayModeType å€¼ä¹‹ä¸€ï¼Œè¡¨ç¤ºå¼€å‘äººå‘˜å¯¹ Web åº”ç”¨ç¨‹åºçš„é¦–é€‰æ˜¾ç¤ºæ¨¡å¼ã€‚å¯ä»¥è®¾ç½®</p><ul><li>â€œfullscreenâ€ å ç”¨æ•´ä¸ªå¯ç”¨çš„æ˜¾ç¤ºåŒºåŸŸï¼›</li><li>â€œstandaloneâ€ ä½¿å…¶å¤–è§‚å’Œæ„Ÿè§‰å°±åƒä¸€ä¸ªç‹¬ç«‹çš„æœ¬æœºåº”ç”¨ç¨‹åºï¼›</li><li>â€œminimal-uiâ€ ç±»ä¼¼äº standalone æ¨¡å¼ï¼Œä½†ä¸ºæœ€ç»ˆç”¨æˆ·æä¾›äº†ä¸€äº›æ–¹æ³•æ¥è®¿é—®ç”¨äºæ§åˆ¶å¯¼èˆªçš„æœ€å° UI å…ƒç´ é›†ï¼ˆå³ï¼Œåé€€ï¼Œå‰è¿›ï¼Œé‡æ–°åŠ è½½ä»¥åŠå¯èƒ½ä»¥æŸç§æ–¹å¼æŸ¥çœ‹æ–‡æ¡£çš„åœ°å€ï¼‰ï¼›</li><li>â€œbrowserâ€ ä½¿ç”¨ç‰¹å®šäºå¹³å°çš„çº¦å®šæ‰“å¼€ Web åº”ç”¨ç¨‹åºï¼Œä»¥åœ¨ç”¨æˆ·ä»£ç†ä¸­æ‰“å¼€è¶…é“¾æ¥ï¼ˆä¾‹å¦‚ï¼Œåœ¨æµè§ˆå™¨é€‰é¡¹å¡æˆ–æ–°çª—å£ä¸­ï¼‰ï¼›</li></ul><p><strong>orientation</strong> Web åº”ç”¨ç¨‹åºçš„æ‰€æœ‰é¡¶çº§æµè§ˆä¸Šä¸‹æ–‡çš„é»˜è®¤æ–¹å‘ã€‚</p><p><strong>start_url</strong> è¡¨ç¤ºèµ·å§‹ URL çš„å­—ç¬¦ä¸²ï¼Œè¯¥ URL æ˜¯ç”¨æˆ·å¯åŠ¨ Web åº”ç”¨ç¨‹åºæ—¶å¼€å‘äººå‘˜æ›´å–œæ¬¢ç”¨æˆ·ä»£ç†åŠ è½½çš„ URLï¼ˆä¾‹å¦‚ï¼Œå½“ç”¨æˆ·ä»è®¾å¤‡çš„åº”ç”¨ç¨‹åºèœå•ä¸­å•å‡» Web åº”ç”¨ç¨‹åºçš„å›¾æ ‡æ—¶æˆ–ä¸»å±å¹•ï¼‰ã€‚</p><p><strong>serviceworker</strong> è¡¨ç¤ºåº”ç”¨ä¸­ serviceWorker çš„ä¿¡æ¯ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"serviceworker": &#123;</span><br><span class="line">  "src": "sw.js",</span><br><span class="line">  "scope": "/foo",</span><br><span class="line">  "update_via_cache": "none"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>theme_color</strong> åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„é»˜è®¤ä¸»é¢˜é¢œè‰²ã€‚</p><p><strong>related_applications</strong> æ˜¯åº•å±‚åº”ç”¨ç¨‹åºå¹³å°å¯è®¿é—®çš„åº”ç”¨ç¨‹åºã€‚</p><p><strong>prefer_related_applications</strong> è¡¨ç¤ºç›¸å…³åº”ç”¨ç¨‹åºæ˜¯å¦åº”ä¼˜å…ˆäºå½“å‰çš„ Web åº”ç”¨ç¨‹åºã€‚</p><p><strong>background_color</strong> Web åº”ç”¨ç¨‹åºçš„é¢„æœŸèƒŒæ™¯é¢œè‰²ã€‚</p><p><strong>categories</strong> Web åº”ç”¨ç¨‹åºæ‰€å±çš„é¢„æœŸåº”ç”¨ç¨‹åºç±»åˆ«ã€‚</p><p><strong>screenshots</strong> ä¸€ä¸ª ImageResources æ•°ç»„ï¼Œè¡¨ç¤ºå¸¸è§ä½¿ç”¨åœºæ™¯ä¸­çš„ Web åº”ç”¨ç¨‹åºçš„æˆªå›¾ã€‚</p><p><strong>iarc_rating_id</strong> ç”¨äºç¡®å®š Web åº”ç”¨ç¨‹åºé€‚åˆçš„å¹´é¾„ã€‚</p><p>ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"lang"</span>: <span class="string">"en"</span>,</span><br><span class="line">  <span class="attr">"dir"</span>: <span class="string">"ltr"</span>,</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"Super Racer 3000"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"The ultimate futuristic racing game from the future!"</span>,</span><br><span class="line">  <span class="attr">"short_name"</span>: <span class="string">"Racer3K"</span>,</span><br><span class="line">  <span class="attr">"icons"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"src"</span>: <span class="string">"icon/lowres.webp"</span>,</span><br><span class="line">      <span class="attr">"sizes"</span>: <span class="string">"64x64"</span>,</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"image/webp"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"src"</span>: <span class="string">"icon/lowres.png"</span>,</span><br><span class="line">      <span class="attr">"sizes"</span>: <span class="string">"64x64"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"src"</span>: <span class="string">"icon/hd_hi"</span>,</span><br><span class="line">      <span class="attr">"sizes"</span>: <span class="string">"128x128"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"scope"</span>: <span class="string">"/racer/"</span>,</span><br><span class="line">  <span class="attr">"start_url"</span>: <span class="string">"/racer/start.html"</span>,</span><br><span class="line">  <span class="attr">"display"</span>: <span class="string">"fullscreen"</span>,</span><br><span class="line">  <span class="attr">"orientation"</span>: <span class="string">"landscape"</span>,</span><br><span class="line">  <span class="attr">"theme_color"</span>: <span class="string">"aliceblue"</span>,</span><br><span class="line">  <span class="attr">"background_color"</span>: <span class="string">"red"</span>,</span><br><span class="line">  <span class="attr">"serviceworker"</span>: &#123;</span><br><span class="line">    <span class="attr">"src"</span>: <span class="string">"sw.js"</span>,</span><br><span class="line">    <span class="attr">"scope"</span>: <span class="string">"/racer/"</span>,</span><br><span class="line">    <span class="attr">"update_via_cache"</span>: <span class="string">"none"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"screenshots"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"src"</span>: <span class="string">"screenshots/in-game-1x.jpg"</span>,</span><br><span class="line">      <span class="attr">"sizes"</span>: <span class="string">"640x480"</span>,</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"image/jpeg"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"src"</span>: <span class="string">"screenshots/in-game-2x.jpg"</span>,</span><br><span class="line">      <span class="attr">"sizes"</span>: <span class="string">"1280x920"</span>,</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"image/jpeg"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦åœ¨é¡µé¢æ˜¯ä½¿ç”¨çš„è¯ç›´æ¥ç”¨ <link> æ ‡ç­¾å¼•ç”¨å³å¯ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"manifest"</span> <span class="attr">href</span>=<span class="string">"/manifest.json"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·æµè§ˆå™¨å°±å¯ä»¥å®‰è£…ä½ çš„ Web åº”ç”¨äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç½‘ç«™è¦æ”¯æŒ PWAï¼Œéœ€è¦ä¸€ä¸ª &lt;code&gt;manifest.json&lt;/code&gt; æ–‡ä»¶ï¼ŒW3C Web App Manifest çš„è‰æ¡ˆä¸Šå®šä¹‰äº†ä»¥ä¸‹çš„å­—æ®µï¼Œè§£é‡Šä¸€ä¸‹æ¯ä¸ªå­—æ®µæ˜¯ä»€ä¹ˆæ„æ€ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="PWA" scheme="https://coldstone.fun/tags/PWA/"/>
    
  </entry>
  
  <entry>
    <title>è®© Hugo åšå®¢æ”¯æŒ PWA</title>
    <link href="https://coldstone.fun/post/2019/07/23/add-pwa-support-to-hugo/"/>
    <id>https://coldstone.fun/post/2019/07/23/add-pwa-support-to-hugo/</id>
    <published>2019-07-23T21:34:17.000Z</published>
    <updated>2021-06-28T09:25:25.301Z</updated>
    
    <content type="html"><![CDATA[<p>è®©ç”¨ Hugo æ­å»ºçš„åšå®¢æ”¯æŒ PWA å¾ˆç®€å•ï¼Œåªéœ€ 2 ä¸ªæ­¥éª¤å³å¯</p><a id="more"></a><p>è®©ç”¨ Hugo æ­å»ºçš„åšå®¢æ”¯æŒ PWA å¾ˆç®€å•ï¼Œåªéœ€ 2 ä¸ªæ­¥éª¤å³å¯ï¼š</p><h2 id="æ·»åŠ ä¸€ä¸ª-manifest-json-æ–‡ä»¶"><a href="#æ·»åŠ ä¸€ä¸ª-manifest-json-æ–‡ä»¶" class="headerlink" title="æ·»åŠ ä¸€ä¸ª manifest.json æ–‡ä»¶"></a>æ·»åŠ ä¸€ä¸ª manifest.json æ–‡ä»¶</h2><p>ä½¿ç”¨ <a href="https://app-manifest.firebaseapp.com" target="_blank" rel="noopener">https://app-manifest.firebaseapp.com</a> æ¥ç”Ÿæˆåšå®¢çš„ manifest.json æ–‡ä»¶ï¼Œç„¶åå°†ç”Ÿæˆå‡ºæ¥çš„æ–‡ä»¶å’Œå›¾ç‰‡æ”¾åˆ°åšå®¢çš„ static ç›®å½•ï¼Œç„¶ååœ¨ layout/index.html çš„ <head> æ ‡ç­¾å†…å¼•ç”¨è¿™ä¸ªæ–‡ä»¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"manifest"</span> <span class="attr">href</span>=<span class="string">"/manifest.json"</span> /&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·ä½ çš„åšå®¢å°±å¯ä»¥å®‰è£…åˆ°æ¡Œé¢äº†</p><h2 id="ä½¿ç”¨-Workbox-å·¥å…·æ³¨å†Œ-ServiceWorker"><a href="#ä½¿ç”¨-Workbox-å·¥å…·æ³¨å†Œ-ServiceWorker" class="headerlink" title="ä½¿ç”¨ Workbox å·¥å…·æ³¨å†Œ ServiceWorker"></a>ä½¿ç”¨ Workbox å·¥å…·æ³¨å†Œ ServiceWorker</h2><p>åœ¨ static æ–°å»ºä¸€ä¸ª <code>sw.js</code> æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶æ·»åŠ ä»¥ä¸‹å†…å®¹ç”¨æ¥ä¸ºç½‘ç»œè¯·æ±‚æ·»åŠ ç¼“å­˜ï¼›ä¸»è¦æ˜¯ç¼“å­˜é™æ€èµ„æº jsï¼Œcssï¼Œå›¾ç‰‡ä»¥åŠå­—ä½“ç­‰æ–‡ä»¶ï¼Œ<br>è¯¦ç»†æ–‡æ¡£å¯ä»¥æŸ¥çœ‹ <a href="https://developers.google.cn/web/tools/workbox" target="_blank" rel="noopener">Workbox æ–‡æ¡£</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">importScripts(<span class="string">'https://cdn.jsdelivr.net/npm/workbox-cdn/workbox/workbox-sw.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (workbox) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Yay! Workbox is loaded ğŸ‰`</span>)</span><br><span class="line"></span><br><span class="line">  workbox.routing.registerRoute(</span><br><span class="line">    /\.(?:js|css)$/,</span><br><span class="line">    <span class="keyword">new</span> workbox.strategies.StaleWhileRevalidate(&#123;</span><br><span class="line">      cacheName: <span class="string">'static-resources'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  workbox.routing.registerRoute(</span><br><span class="line">    /\.(?:png|jpg|jpeg|svg|gif)$/,</span><br><span class="line">    <span class="keyword">new</span> workbox.strategies.CacheFirst(&#123;</span><br><span class="line">      cacheName: <span class="string">'image-cache'</span>,</span><br><span class="line">      plugins: [</span><br><span class="line">        <span class="keyword">new</span> workbox.expiration.Plugin(&#123;</span><br><span class="line">          maxEntries: <span class="number">20</span>,</span><br><span class="line">          maxAgeSeconds: <span class="number">7</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span></span><br><span class="line">        &#125;)</span><br><span class="line">      ]</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  workbox.routing.registerRoute(</span><br><span class="line">    /^https:\/\/fonts\.googleapis\.com/,</span><br><span class="line">    <span class="keyword">new</span> workbox.strategies.StaleWhileRevalidate(&#123;</span><br><span class="line">      cacheName: <span class="string">'google-fonts-stylesheets'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  workbox.routing.registerRoute(</span><br><span class="line">    /^https:\/\/fonts\.gstatic\.com/,</span><br><span class="line">    <span class="keyword">new</span> workbox.strategies.CacheFirst(&#123;</span><br><span class="line">      cacheName: <span class="string">'google-fonts-webfonts'</span>,</span><br><span class="line">      plugins: [</span><br><span class="line">        <span class="keyword">new</span> workbox.cacheableResponse.Plugin(&#123;</span><br><span class="line">          statuses: [<span class="number">0</span>, <span class="number">200</span>]</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> workbox.expiration.Plugin(&#123;</span><br><span class="line">          maxAgeSeconds: <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">365</span>,</span><br><span class="line">          maxEntries: <span class="number">30</span></span><br><span class="line">        &#125;)</span><br><span class="line">      ]</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Boo! Workbox didn't load ğŸ˜¬`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸºæœ¬å®Œæˆäº†ï¼Œå¯ä»¥ç”¨ Chrome çš„ Audits çš„å·¥å…·è·‘äº†ä¸€ä¸‹åˆ†ï¼Œçœ‹çœ‹è¿˜æœ‰ä»€ä¹ˆåœ°æ–¹è¦ä¿®æ”¹çš„ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è®©ç”¨ Hugo æ­å»ºçš„åšå®¢æ”¯æŒ PWA å¾ˆç®€å•ï¼Œåªéœ€ 2 ä¸ªæ­¥éª¤å³å¯&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="PWA" scheme="https://coldstone.fun/tags/PWA/"/>
    
  </entry>
  
  <entry>
    <title>äº†è§£ &lt;Link&gt; æ ‡ç­¾ä¸Š Rel=prexxx çš„ä½œç”¨</title>
    <link href="https://coldstone.fun/post/2019/07/22/understand-link-prexxx/"/>
    <id>https://coldstone.fun/post/2019/07/22/understand-link-prexxx/</id>
    <published>2019-07-22T01:39:27.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ HTML ä¸­ <link> æ ‡ç­¾æŒ‡å®šäº†å½“å‰æ–‡æ¡£ä¸å¤–éƒ¨èµ„æºä¹‹é—´çš„å…³ç³»ï¼Œæœ¬æ–‡è¯´æ˜ <link> æ ‡ç­¾çš„ rel å±æ€§åˆ†åˆ«è®¾ç½® dns-prefetchï¼Œpreconnectï¼Œprefetchï¼Œpreloadï¼Œprerender çš„æ—¶å€™æœ‰è¯´æ˜ä½œç”¨</p><a id="more"></a><p>åœ¨ HTML ä¸­ <link> æ ‡ç­¾æŒ‡å®šäº†å½“å‰æ–‡æ¡£ä¸å¤–éƒ¨èµ„æºä¹‹é—´çš„å…³ç³»<br>æœ¬æ–‡è¯´æ˜ <link> æ ‡ç­¾çš„ rel å±æ€§åˆ†åˆ«è®¾ç½® dns-prefetchï¼Œpreconnectï¼Œprefetchï¼Œpreloadï¼Œprerender çš„æ—¶å€™æœ‰è¯´æ˜ä½œç”¨</p><p>dns-prefetchï¼šå‘æµè§ˆå™¨æç¤ºéœ€è¦èµ„æºï¼Œå…è®¸æµè§ˆå™¨åœ¨ç”¨æˆ·å•å‡»é“¾æ¥ä¹‹å‰è¿›è¡Œ DNS æŸ¥æ‰¾å’Œåè®®æ¡æ‰‹</p><p>preconnectï¼šå‘æµè§ˆå™¨æä¾›æç¤ºï¼Œå»ºè®®å®ƒæå‰æ‰“å¼€ä¸é“¾æ¥ç½‘ç«™çš„è¿æ¥ï¼Œè€Œä¸æ³„éœ²ä»»ä½•ç§äººä¿¡æ¯æˆ–ä¸‹è½½ä»»ä½•å†…å®¹ï¼Œä»¥ä¾¿åœ¨éµå¾ªé“¾æ¥æ—¶å¯ä»¥æ›´å¿«åœ°è·å–é“¾æ¥çš„å†…å®¹</p><p>prefetchï¼šå»ºè®®æµè§ˆå™¨æå‰è·å–é“¾æ¥èµ„æºï¼Œå› ä¸ºå®ƒå¯èƒ½æ˜¯ç”¨æˆ·è¯·æ±‚çš„ã€‚ ä» Firefox 44 å¼€å§‹ï¼Œå°†è€ƒè™‘ crossorigin å±æ€§çš„å€¼ï¼Œä»è€Œå¯ä»¥è¿›è¡ŒåŒ¿åé¢„å–</p><p>preloadï¼šå‘Šè¯‰æµè§ˆå™¨ä¸‹è½½èµ„æºï¼Œå› ä¸ºç¨ååœ¨å½“å‰å¯¼èˆªæœŸé—´å°†éœ€è¦æ­¤èµ„æº</p><p>prerenderï¼šå»ºè®®æµè§ˆå™¨æå‰è·å–é“¾æ¥èµ„æºï¼Œå¹¶ä¸”å®ƒè¿˜åœ¨å±å¹•å¤–æ¸²æŸ“é¢„å–å†…å®¹ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶å¯ä»¥å¿«é€Ÿå‘ˆç°ç»™ç”¨æˆ·</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://devdocs.io/html/link_types" target="_blank" rel="noopener">link_types</a></p><p><a href="https://stackoverflow.com/questions/47273743/preconnect-vs-dns-prefetch-resource-hints" target="_blank" rel="noopener">preconnect-vs-dns-prefetch-resource-hints</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ HTML ä¸­ &lt;link&gt; æ ‡ç­¾æŒ‡å®šäº†å½“å‰æ–‡æ¡£ä¸å¤–éƒ¨èµ„æºä¹‹é—´çš„å…³ç³»ï¼Œæœ¬æ–‡è¯´æ˜ &lt;link&gt; æ ‡ç­¾çš„ rel å±æ€§åˆ†åˆ«è®¾ç½® dns-prefetchï¼Œpreconnectï¼Œprefetchï¼Œpreloadï¼Œprerender çš„æ—¶å€™æœ‰è¯´æ˜ä½œç”¨&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="HTML" scheme="https://coldstone.fun/tags/HTML/"/>
    
  </entry>
  
  <entry>
    <title>æµè§ˆå™¨è¯·æ±‚è€—æ—¶é˜¶æ®µè§£é‡Š</title>
    <link href="https://coldstone.fun/post/2019/07/18/request-timimg/"/>
    <id>https://coldstone.fun/post/2019/07/18/request-timimg/</id>
    <published>2019-07-18T00:04:07.000Z</published>
    <updated>2021-06-28T09:25:25.305Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹äºä¸€ä¸ªæµè§ˆå™¨ç½‘ç»œè¯·æ±‚è€—æ—¶é˜¶æ®µè§£é‡Š</p><a id="more"></a><h3 id="Queueing"><a href="#Queueing" class="headerlink" title="Queueing"></a>Queueing</h3><p>æµè§ˆå™¨ä¼šåœ¨ä»¥ä¸‹æƒ…å†µæ—¶å°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—ï¼Œæœ‰ä¼˜å…ˆçº§æ›´é«˜çš„è¯·æ±‚ï¼›å½“è¯·æ±‚åè®®æ˜¯ HTTP/1.0 å’Œ HTTP/1.1 æ—¶ï¼ŒåŒä¸€åŸŸåä¸‹å·²ç»æœ‰ 6 ä¸ª TCP é“¾æ¥ï¼›æµè§ˆå™¨åœ¨åˆ†é…ç£ç›˜ç¼“å­˜</p><h3 id="Stalled"><a href="#Stalled" class="headerlink" title="Stalled"></a>Stalled</h3><p>ç”±äºæ’é˜Ÿä¸­æè¿°çš„ä»»ä½•åŸå› ï¼Œè¯·æ±‚å¯èƒ½ä¼šåœæ­¢</p><h3 id="DNS-Lookup"><a href="#DNS-Lookup" class="headerlink" title="DNS Lookup"></a>DNS Lookup</h3><p>æµè§ˆå™¨æ­£åœ¨è§£æè¯·æ±‚çš„ IP åœ°å€</p><h3 id="Proxy-negotiation"><a href="#Proxy-negotiation" class="headerlink" title="Proxy negotiation"></a>Proxy negotiation</h3><p>æµè§ˆå™¨ä¸ä»£ç†æœåŠ¡å™¨åå•†è¯·æ±‚</p><h3 id="Request-sent"><a href="#Request-sent" class="headerlink" title="Request sent"></a>Request sent</h3><p>è¯·æ±‚å·²ç»å‘å‡º</p><h3 id="ServiceWorker-Preparation"><a href="#ServiceWorker-Preparation" class="headerlink" title="ServiceWorker Preparation"></a>ServiceWorker Preparation</h3><p>æµè§ˆå™¨å¯åŠ¨ service worker</p><h3 id="Request-to-ServiceWorker"><a href="#Request-to-ServiceWorker" class="headerlink" title="Request to ServiceWorker"></a>Request to ServiceWorker</h3><p>è¯·æ±‚å·²ç»å‘ service worker å‘å‡º</p><h3 id="Waiting-TTFB"><a href="#Waiting-TTFB" class="headerlink" title="Waiting (TTFB)"></a>Waiting (TTFB)</h3><p>æµè§ˆå™¨ç­‰å¾…ç¬¬ä¸€ä¸ªå­—èŠ‚è¿”å›ï¼Œæ­¤æ—¶é—´åŒ…æ‹¬ 1 æ¬¡å¾€è¿”å»¶è¿Ÿå’ŒæœåŠ¡å™¨å‡†å¤‡å“åº”æ‰€ç”¨çš„æ—¶é—´ã€‚</p><h3 id="Content-Download"><a href="#Content-Download" class="headerlink" title="Content Download"></a>Content Download</h3><p>æµè§ˆå™¨æ¥æ”¶å“åº”ï¼Œä¸‹è½½è¿”å›å†…å®¹</p><h3 id="Receiving-Push"><a href="#Receiving-Push" class="headerlink" title="Receiving Push"></a>Receiving Push</h3><p>æµè§ˆå™¨æ”¶åˆ°é€šè¿‡ HTTP/2 Server Push çš„å“åº”</p><h3 id="Reading-Push"><a href="#Reading-Push" class="headerlink" title="Reading Push"></a>Reading Push</h3><p>æµè§ˆå™¨æ­£åœ¨è¯»å–ä¹‹å‰è·å–å­˜å‚¨åˆ°æœ¬åœ°çš„æ•°æ®</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¯¹äºä¸€ä¸ªæµè§ˆå™¨ç½‘ç»œè¯·æ±‚è€—æ—¶é˜¶æ®µè§£é‡Š&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Browser" scheme="https://coldstone.fun/tags/Browser/"/>
    
  </entry>
  
  <entry>
    <title>Dart è¯­è¨€ä¸­çš„ Final ä¸ Const çš„åŒºåˆ«</title>
    <link href="https://coldstone.fun/post/2019/07/16/dart-final-vs-const/"/>
    <id>https://coldstone.fun/post/2019/07/16/dart-final-vs-const/</id>
    <published>2019-07-16T01:23:06.000Z</published>
    <updated>2021-06-28T09:25:25.301Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ Dart ä¸­æœ‰ <code>final</code> å’Œ <code>const</code> ä¸¤ä¸ªå…³é”®å­—ï¼Œè²Œä¼¼éƒ½æ˜¯è¡¨ç¤ºå¸¸é‡çš„ï¼Œä½†æ˜¯å®ƒä»¬è¿˜æ˜¯æœ‰åŒºåˆ«çš„</p><a id="more"></a><p>åœ¨ Dart ä¸­æœ‰ <code>final</code> å’Œ <code>const</code> ä¸¤ä¸ªå…³é”®å­—ï¼Œè²Œä¼¼éƒ½æ˜¯è¡¨ç¤ºå¸¸é‡çš„ï¼Œä½†æ˜¯å®ƒä»¬è¿˜æ˜¯æœ‰åŒºåˆ«çš„</p><p>final å˜é‡çš„å€¼åªèƒ½è¢«è®¾ç½®ä¸€æ¬¡ï¼› const å˜é‡åœ¨ç¼–è¯‘æ—¶å°±å·²ç»å›ºå®š (const å˜é‡æ˜¯éšå¼ final çš„ç±»å‹.) æœ€é«˜çº§ final å˜é‡æˆ–ç±»å˜é‡åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶è¢«åˆå§‹åŒ–ã€‚</p><p><a href="https://dart.dev/guides/language/language-tour#final-and-const" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ Dart ä¸­æœ‰ &lt;code&gt;final&lt;/code&gt; å’Œ &lt;code&gt;const&lt;/code&gt; ä¸¤ä¸ªå…³é”®å­—ï¼Œè²Œä¼¼éƒ½æ˜¯è¡¨ç¤ºå¸¸é‡çš„ï¼Œä½†æ˜¯å®ƒä»¬è¿˜æ˜¯æœ‰åŒºåˆ«çš„&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Dart" scheme="https://coldstone.fun/tags/Dart/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºåº”ç”¨çš„ Code Signing</title>
    <link href="https://coldstone.fun/post/2019/07/15/code-signing/"/>
    <id>https://coldstone.fun/post/2019/07/15/code-signing/</id>
    <published>2019-07-15T04:54:56.000Z</published>
    <updated>2021-06-28T09:25:25.301Z</updated>
    
    <content type="html"><![CDATA[<p>Flutter é¡¹ç›®ä»£ç ç­¾å</p><a id="more"></a><h2 id="ä»£ç ç­¾å"><a href="#ä»£ç ç­¾å" class="headerlink" title="ä»£ç ç­¾å"></a>ä»£ç ç­¾å</h2><p>è¦å°†åº”ç”¨å‘å¸ƒåˆ° <code>Apple store</code> æˆ–è€… <code>Goople play</code> ä¸Šå°±å¿…é¡»å¯¹ä½ çš„åº”ç”¨è¿›è¡Œä»£ç ç­¾åï¼Œä»£ç ç­¾åç›®çš„æ˜¯ä¸ºäº†è¯†åˆ«è°å¼€å‘äº†è¯¥åº”ç”¨ç¨‹åºï¼Œå¹¶ç¡®ä¿è¯¥åº”ç”¨ç¨‹åºçš„æ‰€æœ‰æ›´æ–°å‡æ¥è‡ªè¿™ä¸ªäººã€‚</p><h2 id="Andorid"><a href="#Andorid" class="headerlink" title="Andorid"></a>Andorid</h2><p>å¯¹äº Android æ¥è¯´æœ‰ä¸¤ç§ç­¾åï¼šå‘å¸ƒç­¾åå’Œä¸Šä¼ ç­¾åã€‚æœ€ç»ˆç”¨æˆ·ä¸‹è½½çš„ <code>.aab/.apk</code> æ–‡ä»¶ä½¿ç”¨å‘å¸ƒç­¾åã€‚ä¸Šä¼ ç­¾åæä¾›ç»™å¼€å‘è€…ä¸Šä¼ åˆ° <code>Google Play</code> å•†åº—çš„è®¤è¯ã€‚ä¸Šä¼ åï¼Œ<code>Google Play</code> ä¼šé‡æ–°ä½¿ç”¨å‘å¸ƒç­¾åå¯¹ <code>.aab/.apk</code> æ–‡ä»¶ç­¾åã€‚</p><ol><li>ä½¿ç”¨ <code>Android Studio</code> <a href="https://developer.android.google.cn/studio/publish/app-signing#sign-apk" target="_blank" rel="noopener">ä¸ºæ‚¨çš„åº”ç”¨ç­¾å</a></li><li>ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·è¿›è¡Œç­¾å <a href="https://flutter.cn/docs/deployment/android#signing-the-app" target="_blank" rel="noopener">ä¸º app ç­¾å</a></li></ol><h2 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h2><ol><li>åœ¨ <a href="https://developer.apple.com/account/ios/certificate/" target="_blank" rel="noopener">Apple Developer Account console</a> åˆ›å»ºå¹¶ä¸‹è½½ä¸€ä¸ªåˆ†å‘è¯ä¹¦ã€‚</li><li>æ‰“å¼€ <code>ios/Runner.xcworkspace</code> åœ¨ä½ çš„é¡¹ç›®è®¾ç½®é‡Œé€‰æ‹©ä¸€ä¸ªåˆ†å‘è¯ä¹¦ã€‚</li></ol><p><a href="https://developer.apple.com/support/code-signing/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Flutter é¡¹ç›®ä»£ç ç­¾å&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Andorid" scheme="https://coldstone.fun/tags/Andorid/"/>
    
      <category term="iOS" scheme="https://coldstone.fun/tags/iOS/"/>
    
  </entry>
  
</feed>
